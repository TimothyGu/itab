<%args>
	$circuit
	$tourn
	$event_id => undef
	$sort_by => "code"
</%args>
<%init> 

	my @non_speech_events = Tab::Event->search( tournament => $tourn->id, type => "congress");
	push (@non_speech_events, Tab::Event->search( tournament => $tourn->id, type => "debate"));

	my $event = Tab::Event->retrieve($event_id) if $event_id;

</%init>

	<h2>Externally tabbed sweepstakes points:</h2>


	<div id="rightsmall">

		<a class="red block" href="ncfl/upload_debate_sweeps.mhtml">Upload JOT Debate Records</a>

		<hr>

		<h3>Choose Event:</h3>

%			foreach my $event (sort {$a->name cmp $b->name} @non_speech_events) { 
				<a class="blue block" href="congress_sweeps.mhtml?event_id=<% $event->id %>&sort_by=<% $sort_by %>">
					<% $event->name %>
				</a>
%			}


	</div>

	<div class="left huge">

% 		if ($event) { 

% 			my @comps = $event->comps( dropped => 0, waitlist =>0 );
%			@comps = sort {$a->code <=> $b->code} @comps;
%			@comps = sort {$a->student->last cmp $b->student->last} @comps if $sort_by eq "lastname";
%			@comps = sort {$a->school->name cmp $b->school->name} @comps if $sort_by eq "schoolname";
%			@comps = sort {$a->school->code cmp $b->school->code} @comps if $sort_by eq "schoolcode";
%			@comps = sort {length($a->school->code) cmp length($b->school->code)} @comps if $sort_by eq "schoolcode";
%			@comps = sort {$a->school->region->name cmp $b->school->region->name} @comps if $sort_by eq "region";
%			@comps = sort {$a->school->region->code cmp $b->school->region->code} @comps if $sort_by eq "regioncode";
%			@comps = sort {length($a->school->region->code) <=> length($b->school->region->code)} @comps if $sort_by eq "regioncode";
%			@comps = sort {$b->sweeps_points <=> $a->sweeps_points} @comps if $sort_by eq "points";

			<h4><% $event->name %>: <% scalar @comps %> entries</h4>

			<table cellpadding="3" cellspacing="1" width="100%">

				<tr class="liblrow">

					<th class="smaller" align="center">
						<form action="congress_sweeps.mas" method="post"> 
						<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
						<input type="hidden" name="event_id" value="<% $event->id %>">
						<input type="hidden" name="sort_by" value="<% $sort_by %>">

						<a href="congress_sweeps.mhtml?event_id=<% $event_id %>&sort_by=code" class="blue block">
							Code
						</a>
					</th>
					
					<th class="smaller">
						<a href="congress_sweeps.mhtml?event_id=<% $event_id %>&sort_by=lastname" class="blue block">
							Name
						</a>
					</th>

					<th class="smaller">
						<a href="congress_sweeps.mhtml?event_id=<% $event_id %>&sort_by=schoolname" class="blue block">
							School
						</a>
					</th>

%					if ($circuit->diocese_based) { 
						<th class="smaller">
							<a href="congress_sweeps.mhtml?event_id=<% $event_id %>&sort_by=regionname" class="blue block">
								Diocese
							</a>
						</th>

						<th class="smaller" align="center">
							<a href="congress_sweeps.mhtml?event_id=<% $event_id %>&sort_by=regioncode" class="blue block">
								Code
							</a>
						</th>

%					} else { 

						<th class="smaller" align="center">
							<a href="congress_sweeps.mhtml?event_id=<% $event_id %>&sort_by=schoolcode" class="blue block">
								Code
							</a>
						</th>

%					}

					<th class="smaller">
						<a href="congress_sweeps.mhtml?event_id=<% $event_id %>&sort_by=points" class="blue block">
							Sweeps
						</a>
					</th>

				</tr>

%				my $switch;

% 				foreach my $comp (@comps) { 

%					my $block = "whiteblock";

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td class="smaller" align="center">
							<a class="<% $block %>" href="<% $Tab::url_prefix %>/register/comp_edit.mhtml?comp_id=<% $comp->id %>">
								<% $comp->code %>
							</a>
						</td>

						<td class="smaller">
							<a class="<% $block %>" href="<% $Tab::url_prefix %>/register/comp_edit.mhtml?comp_id=<% $comp->id %>">
								<% $comp->team_name %> 
							</a>
						</td>

						<td class="smaller">
							<a class="<% $block %>" href="/register/registration.mhtml?school_id=<% $comp->school->id %>">
								<% $comp->school->short_name %>
							</a>
						</td>

%						if ($circuit->diocese_based) { 

							<td class="smaller">
								<a class="<% $block %>" href="/register/dioceses.mhtml?diocese_id=<% $comp->school->region->id %>">
									<% substr($comp->school->region->name,0, 15)%>
								</a>
							</td>

							<td align="center" class="smaller">
								<% $comp->school->region->code %>
							</td>

%						} else { 

							<td align="center" class="smaller">
								<a class="<% $block %>" href="/register/registration.mhtml?school_id=<% $comp->school->id %>">
									<% $comp->school->code %>
								</a>
							</td>

%						}

						<td align="center">
							<input size="3" type="text" name="sweeps_<% $comp->id %>" value="<% ($comp->sweeps_points) ? $comp->sweeps_points : "" %>">
						</td>

					</tr>

% 				}
 		
				<tr class="lirdrow">

					<td align="right" colspan="7">
						<input class="blue" type="submit" value="  Save Sweepstakes Points   ">
						</form>
					</td>

				</tr>
		
			</table>

% 		}

	</div>

	<br style="clear: both;">
