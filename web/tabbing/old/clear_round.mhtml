<%args>
	$round_id
	$account
	$tourn
</%args>
<%perl>

	my $round = Tab::Round->retrieve($round_id);

	my $event = $round->event;

	foreach my $panel ($round->panels) {

		my @judges = $panel->judges;

		my $chair;

		foreach my $ballot ($panel->ballots) {
			$chair = $ballot->judge->id if $ballot->chair > 0;
			$ballot->delete;
		}

		foreach my $judge (@judges) {
		
        	my $ballot = Tab::Ballot->create({
            	judge => $judge->id,
            	speechnumber => 1,
            	panel => $panel->id,
            	speakerorder => 0
        	});
	
		}
	}

	#Turn the round into a preset, nonspeaker ordered round

	$round->preset(1);
	$round->update;

	$m->redirect("$Tab::url_prefix/tabbing/do_breaks.mhtml?event_id=".$event->id);

</%perl>



