<%args>
	$account => undef
	$circuit_id => undef
	$session => undef
	$tz => undef
</%args>
<%perl>

	unless ($session) {
		my $msg = "Please log in first!";
		$m->redirect("/index/index.mhtml?msg=$msg");
	}
	
	my $circuit = Tab::Circuit->retrieve($circuit_id);

	unless ($circuit) { 
		$m->print("Buh? That circuit doesn't exist.  You either tripped a bug or are screwing around.  If the latter, stop.");
		$m->abort();
	}

   	unless ($account->site_admin || (grep $_->id == $circuit_id, $account->circuits)) {
		my $err = "You are not an administrator for that circuit.  Access Denied.";
		$m->redirect("/user/home.mhtml?err=$err");
   	}

	unless ($session->circuit && $circuit_id == $session->circuit->id) { 
		$session->circuit($circuit) ;
		$session->update;
	}

</%perl>

	<div id="wrapper">
		<div id="content">
	
			<div class="left huge">

%				$m->call_next(session => $session, tz => $tz, account => $account, circuit => $circuit);

			</div>

%			unless ($r->uri =~ /event_edit/) { 

				<div class="right small">
					<& /circuit/circuit_menu.mas, circuit => $circuit  &>
				</div>

%			}


			<br style="clear: both;" />

		</div>
	
		<div id="content-spacer"></div>

	</div>
