<%args>
	$account
	$admin_id
	$circuit_id
</%args>
<%init>

	my $err;

	my $circuit = Tab::Circuit->retrieve($circuit_id);

	my $admin = Tab::Account->retrieve($admin_id);

	my @circuit_access = Tab::CircuitAdmin->search( circuit => $circuit_id, account => $account->id) if $circuit_id;

    unless ($account->site_admin || @circuit_access) {
        $err = "Only site or circuit admins may make changes to circuits";
        $m->redirect("$Tab::url_prefix/user/home.mhtml?err=$err");
    }

	my @existing = Tab::CircuitAdmin->search( account => $admin_id, circuit => $circuit_id );

	foreach (@existing) { $_->delete; }

	Tab::log($account->email." removed circuit admin ".$admin->email);

	$err = "Admin deleted";

	$m->redirect("$Tab::url_prefix/circuit/circuit_view.mhtml?err=$err&circuit_id=".$circuit_id);


</%init>
