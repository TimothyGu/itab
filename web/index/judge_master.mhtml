<%args>
	$judge_id => undef
	$group_id
	$school_id => undef
</%args>
<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id);

	unless ($group->pub_assigns) { 

		my $err = "Nice try.  That group has not been published";

		$m->redirect("/setup/postings.mhtml?tourn_id=".$group->tourn->id."&err=".$err);

	}	

	my $judge = Tab::Judge->retrieve($judge_id) if $judge_id;

	my @judges = $group->judges;

	@judges = sort {$a->last cmp $b->last} @judges;

	@judges = sort {$a->school->name cmp $b->school->name} @judges;

</%init>

	<div id="leftsmall">

		<h4>Choose a judge to see assignments:</h4>

%		my $current;

%		if ($school_id) {

			<a class="grey block" href="judge_master.mhtml?group_id=<% $group_id %>">Return to Full Listing</a>

%		} else { 

			<a class="red block">Tournament Hires</a>

%		}

%		foreach my $ljudge (@judges) { 

%			next if $school_id && $ljudge->school->id != $school_id;

%			if ($current != $ljudge->school->id) { 

%				$current = $ljudge->school->id;

				<a class="red block"><% ($ljudge->school) ? $ljudge->school->name : "Tournament Hires" %></a>

%			}

			<a href="judge_master.mhtml?school_id=<% $ljudge->school->id %>&group_id=<% $group_id %>&judge_id=<% $ljudge->id %>" 
				class="<% ($ljudge->id == $judge_id) ? "dkblue block" : "blue block" %>"
				style="margin-left: 10px;">
				<% $ljudge->first." ".$ljudge->last %>
			</a>

%		}

	</div>

	<div id="rightbig">

%		if ($judge) { 

%			my $switch;

			<table cellpadding="4" cellspacing="1" width="100%">

				<tr>
					<td width="100%">
						<h2>
							Judge Assignment for <% $judge->first." ".$judge->last %>
						</h2>
					</td>

					<td>
						<form action="judge_print.mhtml" method="post">
						<input type="hidden" name="judge_id" value="<% $judge->id %>">
						<input type="submit" value=" Print Judge Sheet ">
						</form>
					</td>

				</tr>

			</table>

			<p>
				<% ($judge->special) ? "Special Assignment: ".$judge->special : "" %>
			</p>

			<h3> 
				Rounds Assigned:
			</h3>

			<table cellpadding="5" cellspacing="1" width="100%">

%				foreach my $timeslot (sort {$a->start->epoch <=> $b->start->epoch} $group->tournament->timeslots) { 

%					my $panel = $judge->panel_in($timeslot);
%					my $pool = $judge->pool_in($timeslot); 

%					if ($panel) { 

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td>
								<% $timeslot->name %>
							</td>

							<td>
								<% $panel->event->abbr %>
							</td>

							<td>
								<% $panel->room->name %>
							</td>

							<td>
								<% &Tab::niceshortdt( $timeslot->start->set_time_zone($group->tournament->tourn->tz) ) %>
							</td>

						</tr>

%					} elsif ($pool) { 

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td> 
								Standby Pool
							</td>

							<td>
								<% $pool->name %>
							</td>

							<td>
								<% &Tab::niceshortdt( $timeslot->start->set_time_zone($group->tournament->tourn->tz) ) %>
							</td>

						</tr>

%					}

%				}

			</table>

%		}

	</div>
