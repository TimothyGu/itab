<%args>
	$year => undef
</%args>
<%perl>

    my $now = DateTime->now;

    my $foo++ unless $year;

    $year = $now->year unless $year;

    if ($now->month > 6 && $foo)  {
        $year++;
    }

    my $begin = DateTime->new(
        year => $year - 1,
        month => 7,
        day  => 01 );

    my $stop = DateTime->new(
        year => $year,
        month => 6,
        day => 30 );

    my @all_tournaments = Tab::Tournament->retrieve_all;

    my @tournaments;

    foreach my $at (@all_tournaments) {
        push (@tournaments, $at) if ($at->start > $begin && $at->end < $stop);
    }

    @tournaments = sort {$a->start <=> $b->start } @tournaments;

</%perl>

<h2>Tournaments this school year</h2>

<table cellpadding="5" cellspacing="1" width="100%">

<tr>
	<th>Tournament</th>
	<th>Circuit</th>
	<th>Start</th>
	<th></th>
</tr>

% my $switch;

% foreach my $tourn (@tournaments) { 

	<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

		<th>
			<a href="<% $Tab::url_prefix %>/index/tournament.mhtml?tourn_id=<% $tourn->id %>"><% $tourn->name %></a>
		</th>

		<td>
			<% $tourn->circuit->short_name %>
		</td>

		<td>
			<% $tourn->start->mdy('/') %>
		</td>

		<td>

%			if ($tourn->results) { 
                (<a href="<% $Tab::url_prefix %>/public_site/results/<% $tourn->circuit->id %>/<% $tourn->id %>/index.mhtml">Results</a>)
%			}

		</td>

	</tr>

% }

</table>

<br>
<br>
<br>
