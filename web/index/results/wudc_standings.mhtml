<%args>
	$account => undef
	$circuit => undef
</%args>
<%init>
	
	use Time::HiRes qw( time );
	use Data::Dumper;
		
	my $start = time(); 
	
	Tab::Chapter->columns(TEMP => qw/points/);
	Tab::Chapter->columns(TEMP => qw/nevents/);
	Tab::Chapter->set_sql(pull_competitors => "
		select chapter.id, sum(result_value.value) as points, chapter.name, count(entry.id) as nevents
		from entry, result, result_value, chapter, school
		where school.chapter=chapter.id
		and school.id=entry.school
		and result.entry=entry.id
		and result_value.result=result.id
		and result_value.tag='WUDC Points'
		group by chapter.id
		order by points desc
	");
	my @chpt = Tab::Chapter->search_pull_competitors;
	
	sub commify {
		local($_)=shift;
		1 while s/^(-?\d+)(\d{3})/$1,$2/;
		return $_;
	}
	
</%init>

	<h2>WUDC point standings</h2>
	<div class="left huge">
	<& /funclib/tablesorter.mas, table => "WUDC" &>

		<table cellpadding="3" width="100%" id="WUDC" class="tablesorter">
		<thead>
			<tr class="dkgreen">
				<th class="smaller">chapter</th>
				<th class="smaller">Points</th>
			</tr>
		</thead>
%			foreach my $chpt (@chpt) {
				<tr>
					<td> <a href="wudc_chapter_points.mhtml?chapter_id=<% $chpt->id %>"> <% $chpt->name %> </a></td>
					<td> <% commify($chpt->points) %> </td>
				</tr>
%			}

		</table>
		
% my $end = time();
% printf("%.2f\n", $end - $start);

	</div>

	<div class="right small">

		<div class="sidenote">

			<h4>Places to go</h4>

			<a class="yellow block" href="https://www.tabroom.com/jbruschke/TeamResults.php">NDT/CEDA Results Sheets</a>
			<a class="yellow block" href="index.mhtml">Main Results Page</a>

		</div>

	</div>
