<%args>
	$tourn_id
	$session => undef
	$account => undef
</%args>
<%init>

	my $tourn = Tab::Tourn->retrieve($tourn_id);

	if ($account && $session) { 

	    my @chapters = $account->chapters;
	    my $chapter = shift @chapters if scalar @chapters == 1;	

		unless ($chapter) { 

			my $err = "You have several chapters; choose one please and register for ".$tourn->name;
			$m->redirect("/user/home.mhtml?err=$err");

		}

		$session->tourn($tourn_id);
		$m->redirect("/user/enter/create.mhtml?tourn_id=".$tourn->id."&chapter_id=".$chapter->id);

	} else { 

		$m->redirect("/user/login/login.mhtml?tourn_id=$tourn_id");

	}

</%init>
