<%args>
	$tourn_id
	$event_id => undef
</%args>
<%init>

	my $tourn =  Tab::Tourn->retrieve($tourn_id);
	my $event =  Tab::Event->retrieve($event_id);

	Tab::Event->set_sql( field_reports => "
		select event.* from event, event_setting
		where event.tourn = ?
		and event.id = event_setting.event
		and event_setting.tag = \"field_report\"
		and event_setting.value = 1
		order by event.name
	");

	my @events = Tab::Event->search_field_reports($tourn->id);

	$event = $events[0] unless $event;

    my $webpage = Tab::Webpage->search( tourn => $tourn_id, special => "fields")->first;

	my $switch;

</%init>

	<div class="left huge">

        <h2>
            <% $tourn->name %>: <% $tourn->location %>  
        </h2>

        <& tourn_header.mas, tourn => $tourn &>

%		if ($event) { 

%			my @entries = sort {$a->school->name cmp $b->school->name} $event->entries(waitlist => 0, dropped => 0);

			<h4>Field in <% $event->name %> (<% scalar @entries %> entries) </h4>

			<table cellpadding="6" cellspacing="1" width="100%">

%				foreach my $entry (@entries) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
						<td>
							<% substr($entry->school->name,0,35) %>
						</td>

						<td>
							<% $entry->school->chapter->state %>
						</td>

						<td>
							<% $m->comp('/funclib/entry_students.mas', entry => $entry, name => 1) %>
						</td>

					</tr>

%				}

			</table>

%		} elsif ($webpage) { 

	        <p>
				<% $webpage->content %>
			</p>

%		} else { 

			<p>Choose an event at right to see the reported field.  You may not see all events
			or divisions in the field report; the system only reports fields which the tournament
			officials have released.</p>

%		}

		</table>

	</div>

	<div class="right small">
	
		<div class="sidenote">

			<h4>Events</h4>

%		foreach my $oevent (sort {$a->name cmp $b->name} @events) { 

			<a class="<% ($oevent->id == $event_id ) ? "dk" : "" %>blue block" 
				href="/index/tourn/fields.mhtml?tourn_id=<% $tourn_id %>&event_id=<% $oevent->id %>">
				<% $oevent->name %>
			</a>

%		}
	
		</div>

	</div>

