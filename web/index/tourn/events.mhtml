<%args>
	$tourn_id
	$event_id => undef
</%args>
<%init>

    my $tourn = Tab::Tourn->retrieve($tourn_id);
    my $event = Tab::Event->retrieve($event_id) if $event_id;


    my @events = sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn);

	my @webpages = Tab::Webpage->search( tourn => $tourn_id, special => "events");

	my $webpage = shift @webpages if @webpages;

	my $switch;


</%init>

	<div id="lefthuge">

%	if ($event) {
 
		<h3>
			<% $event->name %>
		</h3>

		<table cellpadding="4" cellspacing="1" width="100%">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
		
				<th>
					Abbreviation:
				</th>
	
				<td>
					<% $event->abbr %>
				</td>
	
			</tr>
	
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
				<th>
					Type:
				</th>
	
				<td>
					<% ucfirst $event->type %>
					<% ($event->supp) ? "(Supplemental)" : "" %>
				</td>
	
			</tr>
	
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
				<th>
					Entry Fee:
				</th>
	
				<td>
					$<% sprintf("%.2f", $event->fee) %> 
					<% ($tourn->method && $tourn->method->per_student_fee) ? "(Plus \$".$tourn->method->per_student_fee."/student)" :  "" %>
				</td>

			</tr>
	
% 			if ($event->cap) { 
	
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
			
					<th>
						Overall Entry Limit:
					</th>
	
					<td>
						<% $event->cap %>
					</td>
	
				</tr>
% 			}
	
% 			if ($event->school_cap) { 
	
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
				
					<th>
						Entry Limit Per School:
					</th>
				
					<td>
						<% $event->school_cap %>
					</td>
				
				</tr>
% 			}
	
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
		
				<th>
					Entry:
				</th>
	
				<td>
					<% ($event->team == 1) ? "Individuals" : "" %>
					<% ($event->team == 2) ? "Pairs" : "" %>
					<% ($event->team == 3) ? "Teams" : "" %>
				</td>
		
			</tr>
	
%	 		if ($event->ballot) {

				<tr>
	
					<th>
						Sample Ballot:
					</th>
	
					<td>
						(<a href="<% $Tab::url_prefix%>/files/tourns/<% $event->tourn->id."/events/".$event->id."/".$event->ballot %>">Download</a>)
					</td>	
	
				</tr>
%  			}

%			if ($event->setting('description')) {

				<tr>
					<td colspan="2">
						<h4>Event Description:</h4>
					</td>
				</tr>
	
				<tr>
					<td colspan="2">
						<% $event->setting('description') %>
					</td>
				</tr>

%			}
	
		</table>

%	} elsif ($webpage) {

		<p>
			<% $webpage->content %>
		</p>

%	} else { 

		<p>Please select an event at right to view rules & information about each event.</p>


%	}

	</div>

	<div id="righttiny">

%		undef $switch;

%      	foreach my $event (@events) { 

           	<a <% ($event->id == $event_id) ? "class=\"chosenblock\"" : ($switch % 2) ? "class=\"white block\"" : "class=\"blue block\"" %>
				href="events.mhtml?event_id=<% $event->id %>&tourn_id=<% $tourn->id %>">
				<% $event->name %>
			</a>

%			$switch++;

%      	}

	</div>



