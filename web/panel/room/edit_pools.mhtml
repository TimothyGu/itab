<%args>
	$account
	$tourn
	$rg_name => undef
</%args>
<%init>

	my $msg;
	my $switch;

	if ($rg_name) { 
		my $pool = Tab::RoomGroup->create({
			tourn => $tourn->id,
			name  => $rg_name,
		});
		$msg = "Pool $rg_name created";
	}

	my @pools = sort {$a->name cmp $b->name} $tourn->room_groups;

</%init>

	<& menu.mas, tourn => $tourn, whoami => "edit_pools" &>

	<div class="left huge">

		<% $msg ? '<p class="explain">'.$msg.'</p>' : "" %>

		<h2>Room Pools</h2>
	
		<& tabbar.mas, tourn => $tourn, whoami => "edit_pools" &>

		<& /funclib/tablesorter.mas, table => "sortme" &>

		<table id="sortme" cellpadding="3" cellspacing="1">

			<thead>

				<tr class="yellowrow smallish">

					<th>
						Pool Name
					</th>

					<th>
						Rounds (Click to remove)
					</th>

					<th>
						#Rms
					</th>

					<th class="nosort">
						Add Rounds
					</th>
					
					<th class="nosort">
						Add All From
					</th>

					<th class="nosort">
					</th>

				</tr>

			</thead>

			<tbody>

%			foreach my $pool (@pools) { 

				<tr>

					<td>
						<a id="<% $pool->id %>"></a>
						<span class="hidden"><% $pool->name %></span>
						<input type="text" name="<% $pool->id %>" value="<% $pool->name %>" size="12">
					</td>

					<td>
%						my %used_round;
%						foreach my $round ($pool->rounds) {
%							$used_round{$round->id}++;
%							next unless $round->event;
							<span class="nospace half nowrap smallish">
								<a class="white hover" href="pool_round_rm.mhtml?pool_id=<% $pool->id %>&round_id=<% $round->id %>">
								<% $round->event ? $round->event->abbr : "" %>
								<% $round->realname %>
								</a>
							</span>
%						}
					</td>

					<td class="rightalign smallish">
						<% scalar $pool->rooms %>
					</td>

					<td>
						<form action="pool_round_add.mhtml" method="post">
						<input type="hidden" name="pool_id" value="<% $pool->id %>">

						<select name="round_id" class="chosen fixedsmaller" onchange='this.form.submit()'>
							<option value=""></option>
%							my @rounds = $m->comp("/funclib/tourn_rounds.mas", tourn => $tourn);
%	                       	foreach my $round (@rounds) {
%								next if $used_round{$round->id};
								<option value="<% $round->id %>"><% $round->event->name %> <% $round->realname %></option>
%	                       	}
						</select>

						</form>
					</td>

					<td>
						<form action="pool_event_add.mhtml" method="post">
						<input type="hidden" name="pool_id" value="<% $pool->id %>">

						<select name="event_id" class="chosen fixedsmaller" onchange='this.form.submit()'>
							<option value=""></option>
%	                       	foreach my $event ($tourn->events) {
								<option value="<% $event->id %>"><% $event->name %></option>
%	                       	}
						</select>

						</form>
					</td>


					<td class="centeralign" style="padding-left: 2px;">

%						my $warn = "You are about to delete this room pool and cast any rounds in it to pull from the main list.  Are you sure?";
						<a class="dkred marno block" <& "/funclib/confirm.mas", warn => $warn &>  href="pool_delete.mhtml?pool_id=<% $pool->id %>">
							X
						</a>
					</td>
				
				
				</tr>
%			}

			</tbody>

		</table>

	</div>
