<%args>
	$tourn
	$judge_id
	$panel_id
	$from => undef
</%args>
<%perl>

	my $judge = Tab::Judge->retrieve($judge_id);
	my $panel = Tab::Panel->retrieve($panel_id);

	my $ballot = Tab::Ballot->search( judge => $judge->id, panel => $panel->id)->first;

	Tab::Ballot->set_sql(remove_chairs => "update ballot set chair = 0 where panel = ? and judge = ? and chair = 1");
	Tab::Ballot->set_sql(add_chair => "update ballot set chair = 1 where panel = ? and judge = ? and chair = 0");

	my $msg;

	if ($ballot->chair) { 

		Tab::Ballot->sql_remove_chairs->execute($panel->id, $judge->id);
		$msg = "Chair of panel removed";

	} else { 

		Tab::Ballot->sql_add_chair->execute($panel->id, $judge->id);
		$msg = "Chair of panel added";
	}


	$m->redirect("panel_view.mhtml?panel_id=".$panel->id."&msg=$msg");


</%perl>
