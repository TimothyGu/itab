<%args>
	$account
	$tourn
	$show     => undef
	$done     => undef
	$disp     => undef
	$seeds    => undef
	$nowarn   => undef
	$settings => undef
	$event_id => undef
	$round_id => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id) if $event_id;
	my $round = Tab::Round->retrieve($round_id) if $round_id;
	
	my $ncfl++ if $tourn->setting("ncfl");

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	unless ($event || $round) { 
		my $msg = "Please pick an event or a round plz";
		$m->redirect("/register/index.mhtml?msg=$msg");
	}

	$event = $round->event unless $event;

	my $round_robin++ if $event->setting("round_robin");

	my $prefs;
	my $rounds_per;
	my $group;

	if ($event) {
		$group = $event->judge_group if $event;
		$prefs = $group->setting("prefs");
		$rounds_per = $group->setting("rounds_per");
	}

	my $hihi_warn;
	if ($round) {
		my $oddround = 1;
		my $dummy = $round->name;
		if ( ($dummy/2) == abs($dummy/2) ) { $oddround=0 }; 
		if ( $round->type eq "highhigh" and $oddround == 0  && $round->type ne "pf") { 
			$hihi_warn = " This is a high-high debate in an even, side-constrained round.  This is rarely done; if you haven't done this for a very good reason you should probably change the settings to high-low and try again.";	
		}
	}
	
	my @rounds = sort {$a->name <=> $b->name} $event->rounds;

	unless ($round) { 

		unless (@rounds) { 
			my $msg = "There are no rounds scheduled of ".$event->name.".  Try scheduling some?";
			$m->redirect("/setup/schedule/event.mhtml?event_id=$event_id&msg=$msg");
		}

		$round = $m->comp("/funclib/event_current_round.mas", event => $event);
		$round = $m->comp("/funclib/event_current_round.mas", event => $event, done => "done") unless $round;
		$round = $rounds[0] unless $round;

	}

	my $preset++ unless $m->comp('/funclib/round_entries.mas', round => $round);

	my $start = $round->start_time;
	$start = $round->timeslot->start unless $start;
	$start->set_time_zone($tz);

	my $tourn_access = Tab::TournAdmin->search( account => $account->id, tourn => $tourn->id )->first;
	my $entry_only++ if $tourn_access && $tourn_access->entry_only;
	undef $entry_only if $account->site_admin;
	$show = "schools" if $entry_only;

</%init>

	<div class="right small">

%		if ($entry_only) { 

			<div class="sidenote">

				<h4>Return</h4>
				
				<a class="blue block" href="/tabbing/entry/index.mhtml">
					Return to Ballot Entry
				</a>

			</div>

%		} else { 

			<div class="sidenote">

				<h4>Share & Enjoy</h4>

				<div class="block evenrow">
					<form action="start_time.mhtml" method="post">
					Start time
					<input type="hidden" name="round_id" value="<% $round->id %>">
						<& /funclib/timepicker.mas, name => "starttime", time => $start, size => 10 &>
					<input type="submit" class="notfirst thinner" value="Set">
					</form>
				</div>

%				my $switch;
				<form action="publish.mhtml" method="post">
				<input type="hidden" name="round_id" value="<% $round->id %>">

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block martop">
					<span class="smallerspan padno">
						Round:
					</span>

					<span class="hundo">
						<select name="published" id="notfirst" class="notfirst fixedtiny">
							<option value="0" <% $round->published ? "" : "selected" %> >Not Public</option>
							<option value="1" <% $round->published == 1 ? "selected" : "" %>>On Web</option>
							<option value="2" <% $round->published == 2 ? "selected" : "" %>>On Web w/o Judges</option>
%							if ($event->type eq "wudc") { 
								<option value="3" <% $round->published == 3 ? "selected" : "" %>>On Web w/Motion</option>
%							}
						</select>
					</span>

					<span>
						<input type="submit" value="Go" class="thinner notfirst">
						</form>
					</span>
				</div>

				<form action="blast.mhtml" method="post">
				<input type="hidden" name="round_id" value="<% $round->id %>">

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block">
					<span class="onefifty padno">
						Blast Emails & Texts
					</span>
					<span style="padding-left: 5px;">
						<input type="submit" value="Go" class="thinner notfirst">
						</form>
					</span>
				</div>

				<form action="post_results.mhtml" method="post">
				<input type="hidden" name="round_id" value="<% $round->id %>">

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block">

					<span class="smallerspan padno">
						Results:
					</span>

					<span class="hundo">
						<select name="post" id="notfirst" class="notfirst fixedtiny">
							<option value="0" <% $round->post_results ? "" : "selected" %> >Not Public</option>
							<option value="1" <% $round->post_results == 1 ? "selected" : "" %>>Only <% $event->type eq "wudc" || $event->type eq "speech" || $event->type eq "congress" ? "Ranks" : "Win/Loss"%></option>
							<option value="2" <% $round->post_results == 2 ? "selected" : "" %>>Full Results</option>
						</select>
					</span>

					<span>
						<input type="submit" value="Go" class="thinner notfirst">
						</form>
					</span>

				</div>

%				if ($round->type eq "elim" || $round->type eq "final") { 

					<form action="publish.mhtml" method="post">
					<input type="hidden" name="round_id" value="<% $round->id %>">

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block">

						<span class="huntwofive padno">
							<label for="listed">
								Alphabetical list on web
							</label>
						</span>

						<span style="padding-right: 5px;">
							<input type="hidden" name="clearing" value="1">
							<input type="checkbox" class="thin" id="listed" name="listed" value="1" <% $round->listed ? 'checked="checked"' : "" %>>
						</span>

						<span>
							<input type="submit" value="Go" class="thinner notfirst">
							</form>
						</span>

					</div>
%				}

				<h4>Display & Print</h4>

				<a class="<% $settings || $show || $seeds ?  "" : "dk" %>blue halfblock" href="show.mhtml?round_id=<% $round->id %>">
					Show Pairing
				</a><a class="<% $show eq "yeppers" ?  "dk" : "" %>blue halfblock" href="show.mhtml?round_id=<% $round->id %>&show=yeppers">
					w/<% $ncfl ? "Dioceses" : "Schools" %>
				</a>

%				if ($event->type eq "congress" || $event->type eq "speech") { 

%					if ($round->type eq "elim" || $round->type eq "final") { 
						<a class="blue block" href="/panel/report/postings.mhtml?timeslot_id=<% $round->timeslot->id %>&event_id=<% $round->event->id %>">	
							Print Elim Postings
						</a>
%					}
				
					<a class="blue halfblock" href="/panel/report/schematic.mhtml?round_id=<% $round->id %>&event_id=<% $round->event->id %>">	
						Print Schematic
					</a><a class="blue halfblock" href="/panel/report/schematic.mhtml?round_id=<% $round->id %>&event_id=<% $round->event->id %>&schools=yep">	
						w/<% $ncfl ? "Dioceses" : "Schools" %>
					</a>

%				} else { 


					<a class="blue halfblock" href="/panel/report/schematic.mhtml?round_id=<% $round->id %>&event_id=<% $round->event->id %>">	
						Print Pairing
					</a><a class="blue halfblock" href="/panel/report/schematic.mhtml?record=sanchez&round_id=<% $round->id %>&event_id=<% $round->event->id %>">	
						w/Records
					</a>
%				} 

%				if ($event->setting("pair_seeds") || $event->setting("apda") || $event->setting('seed_presets')) { 
					<a class="<% $seeds ?  "dk" : "" %>blue block " href="show.mhtml?round_id=<% $round->id %>&seeds=yesmaam">
						Show Pairing w/seeds
					</a>
%				}

				<a class="blue halfblock" href="/panel/report/master_ballots.mhtml?timeslot_id=<% $round->timeslot->id %>&event_id=<% $event->id %>&sort_by=name">	
					Ballots by Name
				</a><a class="blue halfblock" href="/panel/report/master_ballots.mhtml?timeslot_id=<% $round->timeslot->id %>&event_id=<% $event->id %>&sort_by=panel">	
					Ballots by Room
				</a>

%				if ($event->setting("online_ballots")) { 
%#					Warren Decker
					<a class="blue block" href="/panel/report/master_ballots.mhtml?timeslot_id=<% $round->timeslot->id %>&event_id=<% $event->id %>&sort_by=name&accountless=1">	
						Ballots for unlinked judges only
					</a>
%				} 

%				if ($event->type eq "congress") { 
					<a class="blue block" href="/panel/report/chamber_roster.mhtml?round_id=<% $round->id %>">	
						Print Roster with Chambers
					</a>
%				} 

			</div>

			<div class="sidenote">

%				my $settings_visible;
%				$settings_visible++ if $settings;
%				$settings_visible++ if $preset;
%				$settings_visible++ if $disp;
				
				<div class="block padless" style="border-bottom: 1px dashed brown;">
					<span style="display: inline-block; vertical-align: bottom;">
						<button class="notfirst hide hidebox" id="hide" style="<% $settings_visible ? "" : "display: none;"%>">-</button>
						<button class="notfirst show hidebox" id="show" style="<% $settings_visible ? "display: none;" : ""%>">+</button>
					</span>
					<span class="oneeighty padno marno" style="vertical-align: bottom;">
						<h4 class="padno" style="margin-bottom: 2px;" >Change & Destroy</h4>
					</span>
				</div>

				<div id="eraser" style="<% $settings_visible ? "" : "display: none;"%>">

					<a class="<% $settings ? "dkred" : "yellow" %> block" href="/panel/schemat/show.mhtml?round_id=<% $round->id %>&settings=1">
						Edit <% $round->realname %> Settings
					</a>

%					if ($preset) { 

%						my $warn;

%						if ($event->type eq "wudc") { 
%							my @entries = $event->entries( dropped => 0, waitlist => 0, unconfirmed => 0);
%							$warn = "The field size is not divisible by 4.  This pairing will have byes." if (scalar @entries % 4);	
%						}

%						if ($round->type ne "elim" && $round->type ne "final") { 
							<a class="dkgreen block martop" <& "/funclib/confirm.mas", warn => $warn &> href="/panel/round/panel_master.mhtml?round_id=<% $round->id %>">
								<% $round_robin ? "Pair Round Robin" : "Auto-pair round" %>
							</a>
%						} else { 
							<a class="dkgreen block martop" <& "/funclib/confirm.mas", warn => $warn &> href="/tabbing/break/index.mhtml?preset_id=<% $round->id %>&event_id=<% $event->id %>">
								Break round
							</a>
%						} 

%						if ($event->type eq "speech" || $event->type eq "congress") { 
							<a class="dkgreen martop block" href="/panel/manipulate/manual_speech.mhtml?event_id=<% $event->id %>&round_id=<% $round->id %>">
								Manually pair round
							</a>

%						} else { 

%                           if ($round->type eq "highlow" || $round->type eq "highhigh") { 
								<a class="yellow martop block" href="/panel/manipulate/manual_powermatch.mhtml?event_id=<% $event->id %>&round_id=<% $round->id %>&bracket=-1">
									Powermatch round manually
								</a>
%							} 

							<a class="yellow block" href="/panel/manipulate/manual_debate.mhtml?event_id=<% $event->id %>&round_id=<% $round->id %>&bracket=-1">
								Pair round manually
							</a>
%						} 

						<br />

%						$warn = "You will destroy this round and not get it back.  Are you sure?";

						<a class="dkred block" href="/panel/schemat/round_rm.mhtml?round_id=<% $round->id %>" <& "/funclib/confirm.mas", warn => $warn &> >
							Delete Round
						</a>

						<p class="explain">
							Create sections using the Create Additional Sections
							box on the left if you want to pair this round.  
						</p>

						<p class="explain">
							Otherwise you can mass-pair prelims using the
							functions under Paneling -> Pair Round. (Mostly
							useful for IE/Congress)
						</p>

%					} else { 


%						my $warn;

%						if ($round->type ne "elim" && $round->type ne "final") { 
%							if ($round_robin) { 
%								$warn = "Danger, Will Robinson! You are about to pair this entire round robin.  Are you sure?";
								<a class="yellow martop block" <& "/funclib/confirm.mas", warn => $warn &> href="/panel/round/panel_master.mhtml?round_id=<% $round->id %>">
									Auto-pair all round robin prelims
								</a>
%							} else { 
%								my $mantype = "debate";
%								$mantype = "speech" if $event->type eq "speech" || $event->type eq "congress";
%								$warn = "Danger, Will Robinson! You are about to repanel this round entirely.  Are you sure?";
%								$warn.= $hihi_warn;	
								<a class="yellow martop halfblock" <& "/funclib/confirm.mas", warn => $warn &> href="/panel/round/panel_master.mhtml?round_id=<% $round->id %>">
									Auto-pair round
								</a><a class="yellow halfblock" href="/panel/manipulate/manual_<% $mantype %>.mhtml?event_id=<% $event->id %>&round_id=<% $round->id %>&bracket=-1">
									Hand pair round 
%  	  	                       	if ($round->type eq "highlow" || $round->type eq "highhigh") { 
									</a>

									<span class="plain halfblock">
									</span><a class="yellow halfblock" href="/panel/manipulate/manual_powermatch.mhtml?event_id=<% $event->id %>&round_id=<% $round->id %>&bracket=-1">
										Hand powermatch
									</a>
%								}  else { 
									</a><br />
%								} 
%							} 
%						} 

%						$warn = "Danger, Will Robinson! You are about to dump all the judges and re-assign them.  Are you sure?";
%						undef $warn unless $m->comp("/funclib/round_judges.mas", round => $round);

%						my $room_warn = "This process will only fill in empty rooms.  To redo all rooms, erase rooms first below.";

%						if ($event->type eq "speech" || $event->type eq "congress" || $event->type eq "wudc") { 
							<a class="yellow halfblock martop"  <& "/funclib/confirm.mas", warn => $warn &>  href="/panel/round/judges.mhtml?round_id=<% $round->id %>">
%						} elsif ($round->judges > 1 && $prefs && ($round->type eq "elim" || $round->type eq "final") ) { 
							<a class="yellow halfblock martop"  <& "/funclib/confirm.mas", warn => $warn &>  href="/panel/round/debate_judge_panel.mhtml?round_id=<% $round->id %>">
%						} else {
							<a class="yellow halfblock martop"  <& "/funclib/confirm.mas", warn => $warn &>  href="/panel/round/debate_judge_assign.mhtml?round_id=<% $round->id %>">
%						} 
							Auto-pair judges
						</a><a class="yellow halfblock"  href="/panel/round/manual_judges.mhtml?round_id=<% $round->id %>">
							Hand-pair judges
						</a>
						<a class="yellow halfblock" <& "/funclib/confirm.mas", warn => $room_warn &> href="/panel/round/rooms.mhtml?round_id=<% $round->id %>">
							Assign rooms
						</a>

%						unless ($preset) { 
							<a class="yellow martop halfblock" href="/panel/manipulate/manual_speech.mhtml?event_id=<% $event->id %>&round_id=<% $round->id %>">
								Manually pair
							</a>
%						}


%						if (2 == 1 && $m->comp('/funclib/round_unbalanced.mas', round => $round) && $event->type eq "speech" ) {
							<a class="martop dkgreen block" href="/panel/pair/rebalance.mhtml?round_id=<% $round->id %>">
								Auto-Rebalance this round
							</a>
%						}
%						if ($m->comp('/funclib/round_unbalanced.mas', round => $round) && $event->type eq "speech" ) {
							<a class="dkgreen block" href="/panel/manipulate/manual_rebalance.mhtml?round_id=<% $round->id %>">
								Manually Rebalance
							</a>
%						}

						<script>
							$(document).ready(function(){
								$("#hide").click(function(){
									$("#eraser").hide();
									$("#hide").hide();
									$("#show").show();
								});
								$("#show").click(function(){
									$("#eraser").show();
									$("#hide").show();
									$("#show").hide();
								});
							});
						</script>

%						if ($round->pool && $round->pool->id) { 
							<a class="martop yellow block" href="/panel/judge/pool.mhtml?pool_id=<% $round->pool->id %>">
								Edit judge pool <% $round->pool->name %> 
							</a>
%						}

						<br />

%						$warn = "You are about to delete all entries from this round.  You cannot get it back.  Please, for the love all that is good and holy, be certain you mean it";
%						my $warn2 = "You are about to delete all judges from this round.  You cannot get them back.  Please, for the love all that is good and holy, be certain you mean this";

						<a class="dkred halfblock " style="margin-top: 16px;" <& "/funclib/confirm.mas", warn => $warn &> href="round_dump_entries.mhtml?round_id=<% $round->id %>">
							Erase entries
						</a><a class="dkred halfblock " style="margin-top: 16px;" <& "/funclib/confirm.mas", warn => $warn2 &> href="round_dump_judges.mhtml?round_id=<% $round->id %>">
							Erase judges
						</a>

%						$warn = "You are about to delete all judges from this round.  You cannot get them back.  Please, for the love all that is good and holy, be certain you mean this";
%						$warn2 = "You are about to delete this ENTIRE ROUND.  You cannot get it back.  Please, for the love all that is good and holy, be certain you mean this";
						<a class="dkred halfblock " style="margin-top: 1px;" <& "/funclib/confirm.mas", warn => $warn &> href="round_dump_rooms.mhtml?round_id=<% $round->id %>">
							Erase rooms
						</a><a class="dkred halfblock " style="margin-top: 1px;" <& "/funclib/confirm.mas", warn => $warn2 &> href="round_dump.mhtml?round_id=<% $round->id %>">
							Erase round
						</a>

%						if ($account->site_admin || $tourn->hidden) { 
%							$warn2 = "You are about to fake the ranks for an entire round.  Existing ranks will be wiped out.  Please be sure.  There is no undo here.";
							<a class="martop dkred halfblock" <& "/funclib/confirm.mas", warn => $warn2 &> href="/tabbing/entry/fake/<% $event->type %>.mhtml?round_id=<% $round->id %>">
								Fake Results
							</a><a class="dkred halfblock" <& "/funclib/confirm.mas", warn => $warn2 &> href="/tabbing/entry/fake/<% $event->type %>.mhtml?event_id=<% $event->id %>">
								Whole Event
							</a>
							<a class="dkred block" href="judge_push.mhtml?round_id=<% $round->id %>">
								Mass Judge Push
							</a>
%						}

						<a class="yellow block" href="/setup/schedule/event.mhtml?event_id=<% $event->id %>&settings=1">
							Edit <% $event->name %> Schedule
						</a>

%					}

				</div>
		
			</div>

			<div class="sidenote">

				<h4>Stats & Data</h4>

%				my @idle = $m->comp("/funclib/round_idle_judges.mas", round => $round);
%				my $idle_string;
%				foreach my $idler (@idle) {  
%					$idle_string .= "\n ".$idler->last.", ".$idler->first; 
%				}

%				if ($event->type eq "wudc") { 
					<a class="blue block" href="/panel/manipulate/wudc_positions.mhtml?round_id=<% $round->id %>">
						Check Team Positions
					</a>
%				}

%				if ($round->type ne "final" || $round->type ne "elim") { 
					<a class="blue block" href="/panel/manipulate/free_judges.mhtml?round_id=<% $round->id %>">
						<% scalar @idle %> Unused Judges
					</a>
%				}

				<a class="<% $done ? "dk" : "" %>blue halfblock" href="show.mhtml?round_id=<% $round->id %>&done=1">
					Show Results
				</a><a class="<% $done ? "dk" : "" %>blue halfblock" href="/tabbing/report/print_pending.mhtml?round_id=<% $round->id %>&done=1">
					Print Pending 
				</a>

%				if ($event->type eq "wudc") {
					<div class="oddrow block">
						<span class="thirdblock">
							Motion
						</span>
						<span class="twothirdblock">
							<% $round->motion ? "Entered" : "Not Entered" %>
						</span>
					</div>
%				}

				<div class="evenrow block padno">
					<span class="halfblock minus rightalign">
						Paired:
					</span>
					<span class="halfblock">
						<% $round->created ? &Tab::niceshortdayt($round->created->set_time_zone($tz)) : "Not recorded" %>
					</span>
				</div>

<%perl>

				Tab::BallotValue->set_sql( last_altered => "
					select ballot_value.*
					from panel, ballot, ballot_value
					where panel.round = ? 
					and panel.id = ballot.panel
					and ballot.id = ballot_value.ballot
					order by ballot_value.timestamp DESC limit 1
				");

				my $last_bv = Tab::BallotValue->search_last_altered($round->id)->first;

</%perl>
				<div class="oddrow block padno">
					<span class="halfblock minus rightalign">
						Blasted:
					</span>
					<span class="halfblock marno">
						<% $round->blasted ? &Tab::niceshortdayt($round->blasted->set_time_zone($tz)) : "Not yet blasted" %> 
					</span>
				</div>

				<div class="evenrow block padno">
					<span class="halfblock minus rightalign">
						Finished:
					</span>
					<span class="halfblock ">
						<% $last_bv && $last_bv->timestamp ? &Tab::niceshortdayt($last_bv->timestamp->set_time_zone($tz)) : "Not recorded" %>
					</span>
				</div>

%				if ($rounds_per > 0 ) { 

%					my ($assigned_judges_past, $paired_panels_current, $assigned_judges_current, $needed_panels_current, $needed_judges_current, $paired_panels_future, $assigned_judges_future, $needed_panels_future, $needed_judges_future, $group_rds_left, $assigned_to_last, $unassigned_burned_already, $unassigned_one_plus_left, $unassigned_one_left, $total_in_group) = $m->comp("/funclib/judge_oblig_count_by_group.mas", current_rd_id => $round->id );				

					<div class="block yellowrow">
						<% $group->abbr %> judge stats
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block ">
						<span class="microspan">
							<% $total_in_group %> 
						</span>
							total judges in <% $group->abbr %>
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block ">
						<span class="microspan">
							<% $assigned_judges_past %> 
						</span>
						assignments before <% $round->realname %>
					</div>

					<div class="block yellowrow">
						Current paired / still needed
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block">
						<span class="microspan">
							<% ($assigned_judges_current - $needed_judges_current) %>
						</span>
						judges assigned
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block ">
						<span class="microspan">
							<% $assigned_to_last %> 
						</span>
							in for last rd of commitment
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block ">
						<span class="microspan">
							<% $unassigned_burned_already %> 
						</span>
							unassigned & burned already
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block ">
						<span class="microspan">
							<% $unassigned_one_left %>
						</span>
							unassigned with 1 round left
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block ">
						<span class="microspan">
							<% $unassigned_one_plus_left %>
						</span>
							unassigned with &gt;1 round left
					</div>

					<div class="block yellowrow">
						Future paired & needed
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block padno marno">
						<span class="halfblock minus rightalign">
							Judges:
						</span>
						<span class="halfblock minus marno">
							<% $assigned_judges_future %>-<% $needed_judges_future %>
						</span>
					</div>
					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block padno marno">
						<span class="halfblock minus rightalign">
							Rds left:
						</span>
						<span class="halfblock minus marno">
							<% $group_rds_left %>
						</span>
					</div>
										<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block padno marno">
						<span class="halfblock minus rightalign">
							Bodies left:
						</span>
						<span class="halfblock minus marno">
							<% $total_in_group-$assigned_to_last-$unassigned_burned_already %>
						</span>
					</div>

%				}
				
%				if ($prefs eq "ordinals") {

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> padno marno">

%						my ($avg_pref, $avg_mut, $worst_pref, $worst_mut) = $m->comp("/funclib/mjp_diagnostics.mas", round => $round );				

						<span class="halfblock minus rightalign">
							MJP diagnostics
						</span>
						<span class="halfblock">
							Avg Pref:<% sprintf("%.1f", $avg_pref) %><br>Avg Mut:<% sprintf("%.1f", $avg_mut) %><br>Worst pref:<% sprintf("%.1f", $worst_pref) %><br>Worst Mut:<% sprintf("%.1f", $worst_mut) %>
						</span>
					</div>

%				}

%				if ($rounds_per > 0) {
					<a class="blue halfblock" href="judge_fits.mhtml?round_id=<% $round->id %>">
						Judge fits
					</a>
					<a class="blue halfblock" href="mjp_diagnostics.mhtml?round_id=<% $round->id %>&event_id=<% $round->event %>">
						Full diagnosis
					</a>
%				}

%				if ($prefs eq "tiered_round") {
					<a class="blue block" href="pref_diagnostics.mhtml?event_id=<% $event->id %>">
						Placement Diagnostics
					</a>
%				} elsif ($prefs eq "ordinals") {
					<a class="blue block" href="pref_diagnostics_mjp.mhtml?event_id=<% $event->id %>">
						Placement Diagnostics
					</a>
%				}


%			}

			<a class="blue block" href="round_entries.mhtml?round_id=<% $round->id %>&done=1">
				List of Entries
			</a>
			
		</div>

	</div>


	<div class="left huge">

		<div class="block padno marno">
		
			<span class="biggishspan padno marno">
				<h2 style="margin-bottom: 3px;">
					<% $event->name %>
				</h2>
			</span>

			<span class="halfspan padno marno">
				<h2 style="margin-bottom: 3px;">
					<% $round->realname %>:
					<% &Tab::nicetime($start) %>
				</h2>
			</span>

			<span class="rightalign right">
				<h5><% scalar $m->comp("/funclib/round_judges.mas", round => $round, not_in => "1") %> not in</h5>
			</span>

		</div>

		<ul id="tabnav">

%			foreach my $allround (@rounds) {

<%perl>

				my $realname = $allround->realname;
				my $eventname = quotemeta $allround->event->name;
				my $eventabbr = quotemeta $allround->event->abbr;
				$realname =~ s/$eventname//g;
				$realname =~ s/$eventabbr//g;
				$realname =~ s/Round\ /Rd/g;
				$realname =~ s/Session\ /Sn/g;
				$realname =~ s/Doubles/Dubs/g;
				$realname =~ s/\s//g;

				my $test = $realname;
				eval { $test = $test + 0; };
				$realname = "R".$realname if $test;
				$realname = substr($realname, 0, 5);

</%perl>

%				if ($m->comp("/funclib/round_unbalanced.mas", round => $allround)) { 
					<li class="<% ($allround->id == $round->id) ? "selected" : "" %>warning">
%				} else { 
					<li class="<% ($allround->id == $round->id) ? "selected" : "" %>">
%				}

					<a href="show.mhtml?round_id=<% $allround->id %>&seeds=<%$seeds%>&show=<% $show %>&settings=<% $settings %>&disp=<% $disp %>"> 
						<% $realname %>
					</a>

				</li>
%			}

		</ul>

%		if ($round && $settings) { 

			<& settings_edit.mas, round => $round &>

%		} elsif ($preset) { 

			<& preset_edit.mas, round => $round &>

%		} elsif ($round) { 

%			if ($done) { 

% 				if ( $event->type eq "debate" || $event->type eq "policy" || $event->type eq "ld" || $event->type eq "pf" || $event->type eq "parli") { 
					<& debate_results.mas, round => $round &>
%				}

% 				if ( $event->type eq "speech" ) { 
					<& speech_results.mas, round => $round &>
%				}

% 				if ( $event->type eq "congress" ) { 
					<& congress_results.mas, round => $round &>
%				}

% 				if ( $event->type eq "wudc" ) { 
					<& wudc_results.mas, round => $round &>
%				}

%			} else { 

%				my $admin++ if $account->id == 1;

%	 			if ( $event->type eq "speech" ) { 
					<& show_speech.mas, entry_only => $entry_only, round => $round, show => $show, admin => $admin &>
%				}

%	 			if ( $event->type eq "congress" ) { 
					<& show_congress.mas, entry_only => $entry_only, round => $round, show => $show, seeds => $seeds &>
%				}

%	 			if ( $event->type eq "wudc" ) { 
					<& show_wudc.mas, entry_only => $entry_only, round => $round, show => $show, seeds => $seeds &>
%				}

% 				if ( $event->type eq "debate" || $event->type eq "policy" || $event->type eq "ld" || $event->type eq "pf" || $event->type eq "parli") { 
					<& show_debate.mas, entry_only => $entry_only, round => $round, seeds => $seeds, admin => $admin, nowarn => $nowarn &>
%				}

%			}

%		} 


	</div>

