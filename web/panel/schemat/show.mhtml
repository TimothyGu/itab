<%args>
	$tourn
	$show => undef
	$event_id => undef
	$round_id => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id) if $event_id;
	my $round = Tab::Round->retrieve($round_id) if $round_id;

	unless ($event || $round) { 
		my $msg = "Please pick an event or a round plz";
		$m->redirect("/register/index.mhtml?msg=$msg");
	}

	$event = $round->event unless $event;

	my @rounds = sort {$a->name <=> $b->name} $event->rounds;

	unless ($round) { 

		unless (@rounds) { 
			my $msg = "There are no rounds scheduled of ".$event->name.".  Try scheduling some?";
			$m->redirect("/setup/schedule/event.mhtml?event_id=$event_id&msg=$msg");
		}

		$round = $m->comp('/funclib/event_round_time.mas', event => $event);
		$round = $m->comp('/funclib/event_round_time.mas', event => $event, when => "tourntime") unless $round;
			
		&Tab::debuglog($round->id);

		$round = $rounds[0] unless $round;

	}

	my $preset = 1 unless $m->comp('/funclib/round_entries.mas', round => $round);

</%init>

	<div class="right small">

	<table cellpadding="2" width="100%">

		<tr>
			<td>
				<form action="print.mhtml">
				<input type="hidden" name="round_id" value="<% $round->id %>">	
				<input  type="submit" value="Print">
				</form>
			</td>

			<td>
				<form action="publish.mhtml">
				<input type="hidden" name="round_id" value="<% $round->id %>">	

%				if ($round->published) { 
					<input type="submit" class="dkred" value="Unpublish">
%				} else { 
					<input type="submit" value="Publish">
%				}
				</form>
			</td>

			<td>
				<form action="/panel/pair/round.mhtml">
				<input type="hidden" name="round_id" value="<% $round->id %>">	
				<input  type="submit" value="Redo">
				</form>
			</td>


%			if ($m->comp('/funclib/round_unbalanced.mas', round => $round) ) {

				<td align="right">
					<form action="/panel/pair/rebalance.mhtml">
					<input type="hidden" name="round_id" value="<% $round->id %>">
					<input class="red" type="submit" value="Rebalance" class="skinny">
					</form>

				</td>
%			}

		</tr>

	</table>

	</div>

	<div class="left huge">

		<h2>
			<% $event->name %>
			<% ($round->label) ? $round->label : "Round ".$round->name %>: 
			<% &Tab::nicetime($round->timeslot->start->set_time_zone($tourn->tz)) %>
		</h2>

	<ul id="tabnav">

%		foreach my $allround (@rounds) {

%			if ($m->comp("/funclib/round_unbalanced.mas", round => $allround)) { 

				<li class="warning"> 

%			} else { 
				
				<li class="<% ($allround->id == $round->id) ? "selected" : "" %>">
%			}

				<a href="show.mhtml?round_id=<% $allround->id %>"> 
					<% ($allround->label) ? $allround->label : "Rnd ".$allround->name %>
					<% $m->comp("/funclib/round_unbalanced.mas", round => $allround) %>
				</a>
			</li>
%		}

	</ul>

%	if ($round && not defined $preset) { 

%	 	if ( $event->type eq "speech" ) { 
			<& show_speech.mas, round => $round, show => $show &>
%		}

%	 	if ( $event->type eq "congress" ) { 
			<& show_congress.mas, round => $round &>
%		}

% 		if ( $event->type eq "debate" ) { 
			<& show_debate.mas, round => $round &>
%		}

%	}

%	if ($preset) { 

		<& /panel/preset_edit.mas, round => $round &>

%	} 	

	</div>

