<%args>
	$round_id
	$type
	$timeslot
	$flighted 
	$tb_set
	$label               => undef
	$motion              => undef
	$judges              => undef
	$pool                => undef
	$ballot_rules        => undef
	$tab_rating_priority => undef
	$offset              => undef
	$starttime			 => undef
</%args>
<%init>

	my $round = Tab::Round->retrieve($round_id);
	my $event = $round->event;
	my $tz = $event->tourn->tz;

	$tz = "UTC" unless $tz;

	$round->type($type);
	$round->timeslot($timeslot);
	$round->flighted($flighted);
	$round->tb_set($tb_set);
	$round->label($label);
	$round->motion($motion);
	$round->judges($judges);
	$round->pool($pool);

	$round->update();

	my $start_date = $round->timeslot->start->set_time_zone($tz);
	my $start = Tab::dtme( $start_date->mdy('/'), $starttime, $tz);

	unless (not defined $round->start_time && $start == $round->timeslot->start) { 
		$round->start_time($start);
	}

	$tab_rating_priority =~ s/\./,/g;
	$tab_rating_priority =~ s/\ /,/g;
	$tab_rating_priority =~ s/\:/,/g;

	$event->setting("tab_rating_priority", $round->id, $tab_rating_priority);
	$event->setting("ballot_rules", $ballot_rules);
	$event->setting("flight_offset", $offset);

	my $msg = "Round ".$round->realname." settings saved";
	my $err = $label ." is a manifestly ridiculous name for an elimination round. It's not even proper Latin.  <br/></br/>If you are going to use weird round names like that, consider using Joy of Tournaments instead in the future." if $label eq "Sextodecimals";

	$m->redirect("show.mhtml?round_id=".$round->id."&settings=1&msg=$msg&err=$err");

</%init>
