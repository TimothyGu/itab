<%args>
	$account
	$session
	$event_id	
	$timeslot_id => undef
	$tourn
	$codes => undef
	$debug => undef
</%args>
<%init>

	$debug = 1;

	my $event = Tab::Event->retrieve($event_id);

	my @entries; 

	if ($timeslot_id) { 

		my $timeslot = Tab::Timeslot->retrieve($timeslot_id);
		@entries = $timeslot->entries_by_event($event);

	} else { 

		@entries = $event->entries( dropped => 0, waitlist => 0);
	}

	system "$Tab::logger I have ".scalar @entries." competitors for cards." if $debug;

	@entries = sort {$a->code <=> $b->code} @entries;

	my $file = $event->abbr."-tab-cards-".$session->id;
	my $filename = $Tab::file_root."/tmp/".$file;
	
	my $garbage = `rm -f $filename.*`;
	
	open (TEXOUT, ">$filename.tex");

	print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{helvet}
\\usepackage{multirow}
\\usepackage{nopageno}
\\usepackage{colortbl}
\\usepackage[hmargin=.5in,vmargin=.5in]{geometry}

\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.2}

\\begin{document}
\\begin{center}

EOF

	close TEXOUT;
	my $switch; 

	foreach my $comp (@entries) { 

		$m->comp("/funclib/comp_tab_card.mas", 
			comp_id => $comp->id, 
			filename => $filename);

	}

	open (TEXOUT, ">>$filename.tex");
	print TEXOUT "\\end{center}\n";
	print TEXOUT "\\end{document}\n";
	close TEXOUT;

$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
`rm -f $filename.tex $filename.log $filename.dvi $filename.aux` unless $debug;
$m->redirect("$Tab::url_prefix/tmp/".$file.".pdf");

</%init>
