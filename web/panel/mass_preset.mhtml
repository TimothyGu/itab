<%args>
	$circuit
	$tourn
	$account
	$timeslot_id => undef
</%args>
<%init> 
	
	my $timeslot = Tab::Timeslot->retrieve($timeslot_id) if $timeslot_id;

	my $switch;

</%init>

<h3>Set up pre-prepared elim rounds</h3>

% 	if ($timeslot) { 

%		my $start = $timeslot->start->set_time_zone($circuit->timezone);
%		my $end = $timeslot->end->set_time_zone($circuit->timezone);

		<table cellpadding="5" cellspacing="1" width="100%">

		<tr class="lirdrow">

			<th style="text-align: center;">
				Timeslot:
			</td>

			<td align="center">
				<% $timeslot->name %>
			</td>

			<td align="center">
				Start: <% $start->hour_12.":".$start->strftime('%M')." ".$start->strftime('%p') %>
			</td>

			<td align="center">
				End: <% $end->hour_12.":".$end->strftime('%M')." ".$end->strftime('%p') %>
			</td>

			<td align="center">
				<form action="mass_preset.mhtml" method="post">
				<input type="submit" value="Change Timeslot">
				</form>
		</tr>

	</table>


%	} else { 

		<form action="mass_preset.mhtml" method="post">
		
			<table cellpadding="5" cellspacing="1" width="100%">
		
			<tr>
				<td align="center">
					Choose a timeslot:
				</td>
		
				<td align="center">
					<select name="timeslot_id">
						<option value="">-------Select Timeslot--------</option>
		
%						foreach my $timeslot (sort {$a->start->epoch <=> $b->start->epoch} $tourn->timeslots) { 
							<option value="<% $timeslot->id %>"><% $timeslot->name %></option>
%						}
					</select>
				</td>
		
				<td>
					<input type="submit" value="Choose Timeslot">
				</td>
		
			</tr>
		
			</table>
		</form> 
					
%	}	


% if ($timeslot) {

	<h4>Pre-panel rounds for these events in <% $timeslot->name %></h4>
	
	<p>Note:  The pre-paneler will create a round in the timeslot you specify
	even if rounds already exist in that event.  This is sometimes useful (MA
	Middle School dual-finals) but be sure that's what you want before doing
	it.  Do not do this for prelims; the prelim paneler will automatically
	create rounds.</p>

	<p>You can then pre-assign elim rooms using the Assign Rooms Manually
	button under Panel->Assign Rooms, and pre-assign judges using Assign
	Judges Manually</p>
	
	<form action="mass_preset_save.mhtml" method="post">
	<input type="hidden" name="timeslot_id" value="<% $timeslot->id %>">

	<table cellpadding="5" cellspacing="1" width="100%">

	<tr>
	<td width="50%" valign="top">
	
		<table cellpadding="5" cellspacing="1" width="100%">
	
		<tr <% ($switch++ % 2) ? "class=\"bluerow\"" : "class=\"liblrow\"" %>>

			<td>Number of sections per round:</td>
	
			<td align="right">
				<input type="text" name="sections" size="5">
			</td>
		</tr>
	
		<tr <% ($switch++ % 2) ? "class=\"bluerow\"" : "class=\"liblrow\"" %>>
			<td>Label for the rounds:</td>
			<td align="right">
				<input type="text" name="label" size="10" value="Finals">
			</td>
		</tr>

		<tr <% ($switch++ % 2) ? "class=\"bluerow\"" : "class=\"liblrow\"" %>>
			<td>Type of round:</td>
	
			<td align="right">
				<select name="type">
					<option value="final">Final</option>
					<option value="elim">Elim</option>
				</select>
			</td>
		</tr>

		<tr <% ($switch++ % 2) ? "class=\"bluerow\"" : "class=\"liblrow\"" %>>

			<td>No first-year out judges</td>

			<td align="right">
				<input type="checkbox" name="no_first_year" value="1">
			</td>

		</tr>

%		my @sites = $m->comp("/funclib/tourn_sites.mas", tourn => $tourn);

%		unless (@sites) {
%			$m->print("<p>Your tournament cannot pre-set elim rounds (or panel) until you've assigned it a location under Setup->Access</p>");
%			$m->abort;
%		}

%		if (scalar (@sites) > 1) {  

			<tr <% ($switch++ % 2) ? "class=\"bluerow\"" : "class=\"liblrow\"" %>>
				<td>Site:</td>
	
				<td align="center">
					<select name="site_id">
%					foreach my $site ($m->comp("/funclib/tourn_sites.mas", tourn => $tourn)) {
						<option value="<% $site->id %>"><% $site->name %></option>
%					}
					</select>
				</td>
			</tr>

%		} else {

%			my $site = shift @sites;

			<input type="hidden" name="site_id" value="<% $site->id %>">
%		}

%		if ($tourn->pools) { 

			<tr <% ($switch++ % 2) ? "class=\"bluerow\"" : "class=\"liblrow\"" %>>
			<td>Judging pool:</td>
	
			<td align="center">
				<select name="pool_id">
					<option value="">None</option>
%					foreach my $pool ($tourn->pools) {
						<option value="<% $pool->id %>"><% $pool->name %></option>
%					}
				</select>
			</td>
			</tr>

%		}

		</table>
	
	</td>
	<td width="50%" valign="top">

		<table cellpadding="5" cellspacing="1" width="100%">

		<tr <% ($switch++ % 2) ? "class=\"bluerow\"" : "class=\"liblrow\"" %>>
			<th>Event</th>
			<th>Entries</th>
			<th>Rounds Now</th>
			<th>Select</th>
		</tr>

%		$switch = 1; 
	
%		foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td><% $event->name %></td>

				<td align="center"><% $event->count_active_comps %></td>

				<td align="center">
					<% scalar ($event->rounds( timeslot => $timeslot->id)) %>
				</td>

				<td align="center">
					<input type="checkbox" name="<% $event->id %>">
				</td>

			</tr>

%		}

		<tr>
			<td colspan="2" align="right">
				<input type="submit" value="Pre-set elim panels and rounds">
				</form>
			</td>
		</tr>
	
		</table>
	
	</td>
	</tr>
	</table>

%	}
	
