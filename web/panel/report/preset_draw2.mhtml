<%args>
	$event_id
</%args>

<%init>
	
	my @rounds = Tab::Round->search( event=> $event_id, type => 'prelim' );
	my @entries = Tab::Entry->search( event => $event_id, dropped => 0, waitlist => 0, unconfirmed => 0);
	my $event = Tab::Event->retrieve($event_id);
	my @events = Tab::Event->search( tourn => $event->tourn );
	
	my $total; my $count;
	
</%init>

	<div class="right small">

		<div class="sidenote">

			<h4>Select Event</h4>

%			foreach $event (@events) {

			<a class="blue block" href="preset_draw.mhtml?event_id=<% $event->id %>">
				<% $event->name %>
			</a>

%			}
		</div>

	</div>
	
	<div class="left huge">
	
		<& /funclib/tablesorter.mas, table => "sortme" &>

		<h2>Preset Draw</h2>

		<table id="sortme">

			<thead>
			
			<tr class="yellowrow">
				<th class="smaller">
					Team
				</th>
				
%				foreach my $round (@rounds) {
				
				<th class="smallish">
					<% $round->label %>
				</th>

%				}				

				<th class="smallish" style="width: 130px;">
					Total
				</th>
				<th class="smallish">
					Avg
				</th>
			</tr>
		
			</thead>
			<tbody>
			
%			foreach my $entry (@entries) {
%				$total=0; $count=0;

			<tr>
<%perl>

			Tab::Panel->set_sql( panels => "
				select panel.*
				from ballot, panel, round
				where panel.id=ballot.panel
				and ballot.entry=$entry
				and round.id=panel.round
				and round.type='prelim'
			");

			my @panels = Tab::Panel->search_panels;


</%perl>
				<td>
					<% $entry->code %>
				</td>

%				foreach my $panel (@panels) {
%				my @ballots=Tab::Ballot->search( panel => $panel->id );
%					foreach my $ballot (@ballots) {	
%						if ($ballot->entry != $entry->id) {
%						$total += $ballot->entry->pair_seed; $count++;
						<td>
							<% $ballot->entry->code %> - <% $ballot->entry->pair_seed %>  							
						</td>
%						}					
%					}				

%				}			

				<td>
					<% $total %>
				</td>
				<td>
%					if ($count>0) {					
					<% $total/$count %>
%					}					
				</td>

			</tr>
			
%			}

			</tbody>
			
		</table>
		
	</div>
