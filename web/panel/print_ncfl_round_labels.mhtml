<%args>
	$circuit
	$session
	$tourn
	$event_id
	$timeslot_id
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);
	my $ts = Tab::Timeslot->retrieve($timeslot_id);

    #Set up the filename and the needed trace files
	my $filename = $event->abbr."-Packet-labels-".$tourn->id."-".$session->id;
	my $filepath = $Tab::file_root."/tmp/";
	my $garbage = `rm -f $filepath"."$filename.*`;
	open (TEXOUT, ">$filepath"."$filename.tex");

    print TEXOUT <<'EOF';
\documentclass[10pt]{report}
\usepackage{helvet}
\usepackage{colortbl}
\usepackage{nopageno}
\renewcommand{\familydefault}{\sfdefault}
\renewcommand{\arraystretch}{1.4}

\setlength{\oddsidemargin}{-.6in}     
\setlength{\textwidth}{6.0in}        

\setlength{\textheight}{10in}       
\setlength{\topmargin}{-0.5in}      
\setlength{\headsep}{0in}         

\setlength{\parskip}{1.4ex}
\setlength{\parindent}{0mm}

\begin{document}
EOF

my $switch;

my @panels = $event->panels_by_timeslot($ts);

@panels = sort {$a->letter cmp $b->letter} @panels;
@panels = sort {$a->event->name cmp $b->event->name} @panels;

foreach my $panel (@panels) { 

	foreach my $judge ($panel->judges) { 

		my $start = $panel->timeslot->start;
		$start->set_time_zone($tourn->tz);

		print TEXOUT "\\begin{tabular}{p{1.5in}p{1.85in}}\n";
		print TEXOUT "\\hline\n";
		print TEXOUT "\\tiny ".&Tab::texify("Round\#")." - Event - Section & Start Time \\\\ \n";

		print TEXOUT "\\multicolumn{2}{l}{\\large ".$panel->round->name." ".$panel->event->name." {\\LARGE \\bf ". $panel->letter."} (".$start->hour_12.":".$start->strftime('%M')." ".$start->strftime('%p').") } \\\\ \n";

		print TEXOUT "\\multicolumn{2}{l}{\\small Speakers in order: ";

		foreach my $entry ($panel->entries) { 
			print TEXOUT $entry->code." ";
		}

		print TEXOUT " } \\\\ \n";

		print TEXOUT " & \\tiny Entryetition Room \\\\ \n";
		print TEXOUT "\\LARGE \\bf ". $judge->school->region->code ." ".$judge->code. " & ";
		print TEXOUT "\\multicolumn{1}{l}{\\Large ".&Tab::texify($panel->room->name)." }\\\\ \n";
		print TEXOUT "\\normalsize ". &Tab::texify(substr($judge->first." ".$judge->last, 0, 20)). " & ";
		print TEXOUT "\\multicolumn{1}{l}{\\tiny Please drop entryleted ballots off to: }\\\\ \n";
		print TEXOUT " & \\multicolumn{1}{l}{\\normalsize  }\\\\ \n";
		print TEXOUT "\\end{tabular}\n";
	
		print TEXOUT "\\hspace{.25in}\n" unless ($switch % 2);
			print TEXOUT "\\vspace{.30in}\n" if ($switch % 2);
		print TEXOUT "\\newline\n" if ($switch++ % 2);

	}
}

	print TEXOUT "\\end{document}\n";
    close TEXOUT;

    $garbage = `cd $filepath; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
	$garbage = `cd $filepath; rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
    $m->redirect("$Tab::url_prefix/tmp/$filename.pdf");

</%init>
