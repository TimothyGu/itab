<%args>
	$round_id
	$num_panels
	$tourn
</%args>
<%perl>

	my $round = Tab::Round->retrieve($round_id);
	my $letter = "A";

#	Get the current largest panel letter, and make our presets the next, if the
#	round already has panels.

	if ($round->panels) { 
		my @panels = sort {$b->letter cmp $a->letter} $round->panels;
		$letter = $panels[0]->letter;
		$letter++;
	}

#	Create the number of preset panels if we're so instructed.

	if ($num_panels > 0) { 

		foreach (1 .. $num_panels) { 

			my $panel = Tab::Panel->create({
				letter => $letter,
				round => $round->id,
				type => $round->type,
				event => $round->event->id
			});
		
			$letter++;
		}

	}

	$m->redirect("$Tab::url_prefix/panel/schemat/show.mhtml?round_id=$round_id");

</%perl>
