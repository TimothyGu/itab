<%args>
	$account
	$tourn
	$event_id 
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);
	my $switch;
	my $ok;
	my $not_ok;

	my @rounds = sort {$a->timeslot->start->epoch <=> $b->timeslot->start->epoch} $event->rounds;

</%init>

	<table cellpadding="0" width="100%">

		<tr>
			<td width="100%">
				<h3>Speaker order report for <% $event->name %></h3>
			</td> 
			
			<td>
				<form action="speakerorder_improve.mhtml">
				<input type="hidden" name="event_id" value="<% $event->id %>">
				<input  type="submit" value="  Improve Ordering  ">
				</form>
			</td> 
		</tr>

	</table>
			
	<table cellpadding="5" cellspacing="1" width="100%"> 
	
		<tr class="bluerow"> 
			
			<th class="center">
				Code
			</th>

%			foreach my $round (@rounds) {

				<th>
					<% ($round->label) ? $round->label : $round->name %>
				</th>

%			}
	
			<th>
				Status
			</th>
			
			<th>
				Early
			</th>
			
			<th>
				Mid
			</th>
			
			<th>
				Late
			</th> 
			
		</tr>

%		foreach my $entry (sort {$a->code <=> $b->code} $event->entries(dropped => 0)) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th class="center">
					(<a href="speaker_order.mhtml?entry_id=<% $entry->id %>"><% $entry->code %></a>)
				</th>

%				foreach my $round (@rounds) { 	
					<td>
						<% $entry->order_by_round($round) %>
					</td>
%				}


%				my ($status, $early, $mid, $late) = $entry->ncfl_speaks_check;

%				$ok++ if $status eq "OK";
%				$not_ok++ if $status eq "NOT OK";

				<td <% ($status eq "OK") ? "" : "class=\"warn\"" %> > 
					<% $status %>	
				</td>

				<td>
					<% $early %>
				</td>

				<td>
					<% $mid %>
				</td>

				<td>
					<% $late %>
				</td> 
				
			</tr>

%		}

		<tr class="redrow">

			<td colspan="3">
				OK:
			</td>

			<td colspan="3">
				<% $ok %>
			</td>

			<td colspan="3">
				NOT OK:
			</td>

			<td colspan="4">
				<% $not_ok %>
			</td>

		</tr>

	</table>

