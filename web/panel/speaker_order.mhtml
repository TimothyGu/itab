<%args>
	$entry_id => undef
	$panel_id => undef
</%args>
<%init>

	my $entry = Tab::Entry->retrieve($entry_id) if $entry_id;
	my $panel = Tab::Panel->retrieve($panel_id) if $panel_id;

	my @panels;

	push (@panels, $panel) if $panel;
	push (@panels, $entry->panels) if $entry;

</%init>

%	if ($entry_id) { 

		<div class="right small">
			<a href="/register/entry_edit.mhtml?entry_id=<% $entry_id %>" class="red block">Edit Entryetitor <% $entry->code %></a>
		</div>

%	}

%	if ($panel) { 

		<div class="right small">
			<a href="/panel/schemat_show.mhtml?round_id=<% $panel->round->id %>" class="blue block"><% $panel->round->realname %> Schematic</a>
			<a href="/panel/panel_view.mhtml?panel_id=<% $panel_id %>" class="red block">View/Edit Panel</a>
		</div>

%	}

	<div class="left huge">

		<h2>Adjust speaker order</h2>

%		foreach my $panel (sort {$a->round->name <=> $b->round->name} @panels) {

			<h4>Round <% ($panel->round->label) ? $panel->round->label : $panel->round->name %> Section <% $panel->letter %></h4>

			<form action="speaker_order_save.mhtml" method="post">
			<input type="hidden" name="panel_id" value="<% $panel->id %>">
			<input type="hidden" name="entry_id" value="<% $entry_id %>">

			<table cellpadding="5" cellspacing="1" width="100%">

				<tr class="liblrow">

					<th>
						Code
					</th>

					<th>
						Entryetitor
					</th>

					<th>
						Position
					</th>

					<th class="smaller" style="text-align: center;">
						Avg Prelim <br />Position
					</th>

%					if ($panel->type ne "prelim") {
						<th class="smaller" style="text-align: center;">
							Positions
							in Elims
						</th>
%					}
				</tr>

%				my $switch;

%				foreach my $o_entry ($panel->entries) { 

%					if ($o_entry->id == $entry_id) {
						<tr class="lirdrow">
%					} else {
						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
%					}

						<td>
							<% $o_entry->code %>
						</td>

						<td>
							<% $o_entry->team_name %>
						</td>

						<td align="center">
							<input type="text" size="3" name="<% $o_entry->id %>" value="<% $o_entry->speakerorder($panel) %>">
						</td>

						<td class="center">
							<% sprintf("%.2f", $o_entry->order_total) %>
						</td>

%						if ($panel->type ne "prelim") {

							<td style="text-align: center;">
%								my $notfirst;
%								foreach my $elim ($o_entry->event->rounds( type => "elim") ) {
%									next unless $elim->type eq "elim";
%									next if $elim->id == $panel->round->id;

									<% ($notfirst) ? "/ " : "" %>
						            <% $o_entry->order_by_round($elim) %>
%									$notfirst++;
%								}

							</td>

%						}

					</tr>

%				}

				<tr class="liblrow">

					<td colspan="6" align="right">
						<input type="submit" value="  Save Speaker Order  " >
						</form>
					</td>

				</tr>

			</table>


%		}

	</div>

	<br style="clear: both;">
