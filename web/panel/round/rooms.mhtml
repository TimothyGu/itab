<%args>
	$account
	$round_id
	$return => undef
</%args>
<%init>

	my $round = Tab::Round->retrieve($round_id);

	my $text = $account->first." ".$account->last." (".$account->email.") has repaneled the rooms in ".$round->realname." of ".$round->event->abbr;

	Tab::TournChange->create({ 
		type => 'tabbing',
		event => $round->event->id,
		tourn => $round->event->tourn->id,
		account => $account->id,
		text => $text
	});

	$m->comp('/funclib/round_clear_rooms.mas', round => $round);

	my @panels = $m->comp('/funclib/round_panels_ada.mas', round => $round);

	foreach my $panel (@panels) { 

		next if $panel->bye;

		my @rooms = $m->comp("/funclib/clean_rooms.mas", panel => $panel);
		my $room = shift @rooms;
		$panel->room($room->id) if $room;
		$panel->update;
	}

	my $msg = "Rooms have been assigned";
	$m->redirect("/panel/schemat/show.mhtml?round_id=$round_id&disp=1&msg=$msg");

</%init>
