<%args>
	$account
	$round_id
	$tourn
	$certain => undef
	$from => undef
</%args>
<%init>

	my $round = Tab::Round->retrieve($round_id);

	unless ($round)  {
		$m->print("That round does not exist or has already been deleted.");
		$m->abort;
	}

	if ($certain eq "I am certain") { 

		my $round = Tab::Round->retrieve($round_id);
		my $event_id = $round->event->id;
		my $timeslot_id = $round->timeslot->id;

		my $err;

		if ($round->event->tournament->id == $tourn->id) {  

			$err = " Round ". $round->name." of ".$round->event->name ." has been deleted.";
			$round->delete;

		} else { 

			$err = "Panel was not deleted: it does not correspond to your tournament.";

		}

	    $m->comp("/funclib/renumber_rounds.mas", event_id => $event_id);

		$m->redirect("$Tab::url_prefix/panel/timeslot_rounds.mhtml?timeslot_id=$timeslot_id&err=$err") if $from eq "ts";

		$m->redirect("$Tab::url_prefix/panel/event_schedule.mhtml?event_id=$event_id&err=$err");

	}

</%init>

<&  "/funclib/warning.mas", account => $account &>

<h3></h3>
<p></p>
<br><br>
<br><br>
<center>
<P><B>
	You are about to permanently delete all <% scalar $round->panels %> 
	panels  of <% $round->event->name  %>
	scheduled in <% $round->timeslot->name %> along
	with the round itself: Round <% ($round->label) ? $round->label : $round->name %></p>

	<p>This cannot be undone.  You can only get it back by re-doing the whole
	thing over again.</p>

	<p>Don't say I didn't warn you.</p>

% if ($certain) {

<p><font color="red">You did not type "I am certain", exactly like that.  Try
again</font></p>

% }

<br><br>
<p>To proceed, type "I am certain" in the box below:</p>
<br><br>
<form action="round_rm.mhtml" method="post">
<input type="hidden" value="<% $round_id %>" name="round_id">
<input type="hidden" value="<% $from %>" name="from">
<p align="center">
<input type="text" name="certain" size="20"></p>
<p align="center">
<input class="blue" type="submit" value="Delete Round"></p>
</center>
</form>

