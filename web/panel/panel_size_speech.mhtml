<%args>
	$circuit
	$tourn
	$event_id
</%args>
<%init>

	use POSIX;
	my $event = Tab::Event->retrieve($event_id);
	my $num_competitors = $event->count;

	my $minpanelsize = $tourn->method->min_panel_size;
	my $maxpanelsize = $tourn->method->max_panel_size;
	my $defaultpanelsize = $tourn->method->default_panel_size;

	unless ($minpanelsize && $maxpanelsize) { 
		my $err = "You cannot panel IE rounds until you set the default panel sizes.";
		$m->redirect("/setup/rules/paneling.mhtml?err=$err");
	}

	my $max_panel_number = ceil($num_competitors / $minpanelsize);
	my $min_panel_number = ceil($num_competitors / $maxpanelsize);

	my $paneler = "panel_speech_large.mhtml" if $num_competitors > 30;
	$paneler = "panel_speech_small.mhtml" if $num_competitors <= 30;
	$paneler = "panel_speech_small.mhtml" if $circuit->diocese_based;

</%init>

<h3>Select size of panels for <% $event->name %></h3>

<h4><% $num_competitors %> Entries:</h4>

<center>
<form action="<% $paneler %>" method="post">
<table cellpadding="5" border="0" cellspacing="0" width="50%">
<input type="hidden" name="event_id" value="<% $event->id %>">

%	my $switch; 

% foreach my $num_panels ($min_panel_number .. $max_panel_number) {

%		next unless $num_panels;

%		my $panel_size = ceil($num_competitors/$num_panels);

%   	my $competitors_if_panels_full = $num_panels * $panel_size;
%   	my $num_short_panels = $competitors_if_panels_full - $num_competitors;
% 		my $num_full_panels = $num_panels - $num_short_panels;
%		next if $num_short_panels < 0 or $num_full_panels <= 0;

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>
<input type="radio" name="number_of_panels" value=" <% $num_panels %> "
<% ($panel_size == $defaultpanelsize) ? 'checked' : '' %>
> </td>

<td><% $num_panels %> Panels:</td>
<td><% $num_full_panels %> of <% $panel_size %></td>
% if ($num_short_panels) {
<td><% $num_short_panels %> of <% $panel_size - 1 %></td>
% }

</td>
</tr>
% }

<tr>
<td></td>
<td><input type="text" name="manual_override" size="5"></td>
<td colspan="2">Manually override the number of panels</td>
</tr> 

% # In case we have fewer than 5

% if ($num_competitors < 5) {
	<tr>
	<td><input type="radio" name="number_of_panels" value="1">
	</td>
	<td>1 panel of <% $num_competitors %></td>
	</tr>
% }


<tr>
<td colspan="5" align="center">
<input class="blue" type="submit" value="<% ($event->panels) ? 'Repanel' : 'Set Panels' %>">
</td>
</tr>

</table>
</center>
</form>
