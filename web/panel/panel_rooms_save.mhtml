<%args>
	$account
	$round_id
	$tourn
</%args>
<%perl>

	my $round = Tab::Round->retrieve($round_id);

	my %rooms_used = ();

	my $err;
	my $msg;
	
	PANEL:
	foreach my $panel (sort {$a->letter cmp $b->letter} $round->panels) { 

		my $key = "room_id_".$panel->id;
		my $room_id = $ARGS{$key};

		unless ($room_id) { 
			$panel->room("");
			$panel->update;
			next PANEL;
		} 

		#Check for duplicate assignments.
		if ($rooms_used{$room_id}) { 

			my $room = Tab::Room->retrieve($room_id);
			$err .= "Room ".$room->name." was assigned twice.  First selected panel got it.";
			$panel->room("");
			$panel->update;
			next PANEL;

		}

		$rooms_used{$room_id}++;

		#Update the room if it clears;
		$panel->room($ARGS{$key});
		$panel->update;

	}

	$m->redirect("$Tab::url_prefix/panel/schemat/show.mhtml?round_id=".$round->id."&msg=$msg&err=$err");


</%perl>
