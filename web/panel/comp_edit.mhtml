<%args>
	$circuit
	$tourn
	$comp_id
	$round_id => undef
	$err => undef
</%args>

<%init>

	my $comp = Tab::Comp->retrieve($comp_id);
	my @comp_panels = $comp->panels;
	my $round = Tab::Round->retrieve($round_id);
	my $this_panel;
	my $this_panel_id;

	foreach my $pan (@comp_panels)  {
		my $pan_round = $pan->round;
		$this_panel = $pan if ($pan_round->id eq $round->id);
	}

	my $school = $comp->school;
	my $region = $school->chapter->region($circuit);
	my $student = $comp->student;
	my $partner = $comp->partner;
	my $event = $comp->event;
	
	my @panels = Tab::Panel->search( event => $event->id, round => $round->id, {order_by => "letter"} );

	foreach my $panel (@panels) { $panel->update_score($comp); }

	@panels = sort{$a->score($comp) <=> $b->score($comp)} @panels;
#	@panels = sort{$a->comps <=> $b->comps} @panels;
#	@panels = sort{$b->clean_judges($comp) <=> $a->clean_judges($comp)} @panels;
	
</%init>

	<div id="rightsmall">

		<a class="blueblock" href="schemat_show.mhtml?round_id=<% $round_id %>">
			Return to Schematic
		</a>

		<a class="blueblock" href="/register/comp_edit.mhtml?comp_id=<% $comp_id %>">
			View
			<% $comp->code %>
			<% $comp->team_name %>
		</a>

		<a class="blueblock" href="/register/registration.mhtml?school_id=<%$school->id%>">
			View <% $school->short_name %>
		</a>

%		if ($circuit->diocese_based) { 
			<a class="blueblock" href="<%$Tab::url_prefix%>/register/diocese/index.mhtml?diocese_id=<%$region->id%>">
				<% $region->name %>
			</a>
%		}


		<hr>

		<a class="redblock" href="comp_remove_from_round.mhtml?comp_id=<% $comp->id %>&round_id=<% $round->id %>" method="post">
			Remove Competitor from Round
		</a>

		<h4>Key:</h4>	

			<a class="redblock">Red: Same school</a>
			<a class="blueblock">Blue: Seen before</a>

%			if ($circuit->diocese_based) { 
				<a class="greenblock">Green: Same Diocese </a>
%			}

%			if ($circuit->region_based) { 
				<a class="greenblock">Green: Same Region</a>
%			}

			<p class="smaller">The "Score" number is a weight given to the panel based on the
			number of mutual-hits and same-school hits that would be created by moving the kid
			into that particular room.  Smaller scores are better.
			</p>



	</div>

	<div id="leftbig">

		<h2>Move Competitor <% $comp->code." ".$comp->team_name %></h2>

		<table cellpadding="2" width="100%" cellspacing="1">
	
			<tr class="liblrow"> 
		
				<th>
					Room
				</th>

				<th>
					Judges
				</th>
			
				<th>
					Competitors
				</th>

				<th class="smaller" colspan="2">
					Score
				</th>
			
			</tr>
	
% 			my $switch;

% 			foreach my $panel (@panels) { 

%				next if $this_panel && $this_panel->id == $panel->id;

%				my $judge_block;

%           	my $block = "whiteblock" if $switch % 2;
%           	$block = "greyblock" unless $switch % 2;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td class="smaller">
						<a class="<% $block %>" href="<% $Tab::url_prefix %>/panel/panel_view.mhtml?panel_id=<% $panel->id %>">
							<% $panel->letter %><% ($panel->room && $panel->room->name) ? "/".$panel->room->name : "" %>
						</a>
					</td>

					<td class="smaller" align="center">

% 						foreach my $judge ($panel->judges) { 

%							if ($judge->cannot_judge($comp)) {
%								$judge_block++;
								<% "<font color=\"brown\">".$judge->code."</font>" %>
%							} else { 
								<% $judge->code %>
%							}
%						} 

					</td>

					<td class="smaller" align="left">

% 					foreach my $o_comp ($panel->comps) { 

% 						if ($circuit->region_based || $circuit->diocese_based) {
							<% ( $o_comp->regionid == $region->id ) ? '<font color="#D6F2D0">':'' %>
%						} 
						<% ( $o_comp->schoolid == $school->id)  ? '<font color="#ffdcdc">' : '' %>
							<% $o_comp->code %>
						</font>

% 					}

					</td>

					<td align="center" class="smaller">
						<% $panel->score($comp) %>
					</td>

					<td class="smaller" align="center">
%						unless ($judge_block) { 
							<a href="comp_move.mas?comp_id=<% $comp->id %>&panel_id=<% $panel->id %>&back=comp_edit" class="blueblock">
								Move
							</a>
%						} else {
							Judge<br />
							Block
%						}

					</td>
				
				</tr>

% 			}

		</table>

	</div>

	<br style="clear: both;">
