<%args>
	$tourn
	$site_id => undef
	$from_id => undef
	$err => undef
	$add => undef
</%args>
<%init> 

	my $site = Tab::Site->retrieve($site_id);
	my $switch;

</%init>

	<& sidebar.mas, tourn => $tourn, mysite => $site &>

	<script>

        function switchme(roomid,state){

            $("#"+roomid).iphoneSwitch(
                state,
                function() { $.post("/setup/rooms/active_switch.mhtml",{ room_id: roomid }); },
                function() { $.post("/setup/rooms/active_switch.mhtml",{ room_id: roomid, inactive:  "1" }); }
            );
        };	

	</script>

	<div class="left huge">

%		if ($site_id) { 
	
		<h2>Rooms at <% $site->name %></h2>

		<& tabbar.mas, site_id => $site_id, add => $add &>

		<table width="100%" cellpadding="4" cellspacing="1">

%			if ($site->rooms && not defined $add) { 

				<tr class="lirdrow">

					<th>
						<form action="site_rooms_save.mhtml" method="post">
						<input type="hidden" name="site_id" value="<% $site->id %>">
						Name
					</th>

					<th class="smaller">
						Quality
					</th>

					<th class="smaller">
						Capacity
					</th>

					<th>
						Notes
					</th>

					<th>
						Active
					</th>

				</tr>

% 				foreach my $room (sort {$a->name cmp $b->name} $site->rooms) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<td align="center">
							<input type="text" name="<% $room->id %>_name" value="<% $room->name %>" size="20">
						</td>

						<td align="center">
							<input type="text" name="<% $room->id %>_quality" value="<% ($room->quality) ? $room->quality : ""%>" size="3">
						</td>

						<td align="center">
							<input type="text" name="<% $room->id %>_capacity" value="<% ($room->capacity) ? $room->capacity : "" %>" size="3">
						</td>

						<td align="center">
							<input type="text" name="<% $room->id %>_notes" value="<% $room->notes %>" size="20">
						</td>

	                    <td >
    	                    <script type="text/javascript"> 
        	                    $(function() { switchme(<% $room->id %>,"<% ($room->inactive) ? "off" : "on" %>"); });
        	                </script>

            	            <div class="phoneswitch" id="<% $room->id %>"></div>
                	    </td>

					</tr>
	
%				}

				<tr class="liblrow">
					<td colspan="6" align="right">
						<input type="submit" value="   Save Room Changes   ">
						</form>
					</td>
				</tr>

%			} else { 

				<tr class="lirdrow">

					<th>
						<form action="site_rooms_add.mhtml" method="post">
						<input type="hidden" name="site_id" value="<% $site->id %>">
						Name
					</th>

					<th class="smaller">
						Quality
					</th>

					<th class="smaller">
						Capacity
					</th>

					<th>
						Notes
					</th>


				</tr>

%				undef($switch);

%				foreach my $room (1 .. 10) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td align="center">
							<input type="text" name="new_<% $room %>_name" size="20">
						</td>

						<td align="center">
							<input type="text" name="new_<% $room %>_quality" size="5">
						</td>

						<td align="center">
							<input type="text" name="new_<% $room %>_capacity" size="5">
						</td>

						<td align="center">
							<input type="text" name="new_<% $room %>_notes" size="20">
						</td>

					</tr>

%				}

				<tr class="liblrow">
					<td colspan="6" align="right">
						<input type="submit" value="   Save New Rooms ">
						</form>
					</td>
				</tr>
%			}

		</table>

%		} else { 

			<h2>Rooms for <% $tourn->name %></h2>
%		}

	</div>
