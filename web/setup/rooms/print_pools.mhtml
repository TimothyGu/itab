<%args>
	$tourn
	$session
</%args>
<%init>

	use POSIX; 

    my $now = DateTime->now;
	$now->set_time_zone($tourn->tz);
	
	my $name = $tourn->name;
	$name =~ s/[\W_]//g;

    my $filename = "RoomPools-".$name."-".$session->id;
	my $filepath = $Tab::file_root."tmp/".$filename;
	`rm -f $filepath.*`; 
	
	$m->comp("/funclib/printout.mas", tourn => $tourn, filename => $filename, head => 1 );

	open (TEXOUT, ">>$filepath.tex");

	print TEXOUT "\\hfill \n";
	print TEXOUT "{\\Large\\bf ".Tab::texify($tourn->name)." Room Pools }\n";
	print TEXOUT "\\bigskip\n";
	print TEXOUT "\\newline\n";
	print TEXOUT "\\noindent\n";

	my $switch;

	foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 

		print TEXOUT "\\begin{tabular}{p{.5in}p{6.0in}}\n";
		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\n" unless ($switch++ % 2);

		print TEXOUT $event->abbr. " & ";

		my $counter;

		foreach my $pool (sort {$a->room->name cmp $b->room->name} $event->room_pools) {
			print TEXOUT "\\parbox{1in}{ \\truncate{1in}{";
			print TEXOUT $pool->room->name;
			print TEXOUT "}} ";
			$counter++;
		}

		while ($counter % 5) { 
			$counter++;
			print TEXOUT "\\parbox{1in}{ \\truncate{1in}{ }} ";
		}

		print TEXOUT "\\parbox{1in}{ \\truncate{1in}{Total: ".$counter." }} \\newline ";

		print TEXOUT "\\end{tabular} \n";
		print TEXOUT "\\newline\n";
	}

	print TEXOUT "\\end{document} \n";
	close TEXOUT;

	$m->comp("/funclib/printout.mas", tourn => $tourn, filename => $filename, tail => 1 );

</%init>
