<%args>
	$tourn
	$type => "place"
</%args>
<%init>

	#Existing sweeps

	foreach my $sweep ($tourn->sweeps) { 

		next if $type eq "place" && $sweep->prelim_cume > 0;
		next if $type eq "prelim_cume" && $sweep->place > 0;

		my $svalue = $ARGS{"value_".$sweep->id};

		my $value;

		if ($type eq "place") { 
			$sweep->place($ARGS{"place_".$sweep->id});
			$value++ if $sweep->place > 0;
		}

		if ($type eq "prelim_cume") { 
			$sweep->prelim_cume($ARGS{"prelim_cume_".$sweep->id});
			$value++ if $sweep->prelim_cume > 0;
		}

		$sweep->delete unless $value > 0 && $svalue > 0;
		next unless $value > 0 && $svalue > 0;

		$sweep->value($svalue);
		$sweep->update;

	}

	my $nvalue = $ARGS{"value_new"};
	my $nplace = $ARGS{"place_new"};
	my $nprelim_cume = $ARGS{"prelim_cume_new"};

	if ($nvalue) { 

		my $sweep =  Tab::Sweep->create({
			tournament => $tourn->id,
			value => $nvalue,
			place => $nplace,
			prelim_cume => $nprelim_cume
		});

	}

	$m->redirect("sweeps.mhtml#end");

</%init>
