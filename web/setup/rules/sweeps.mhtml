<%args>
	$tourn
	$set_id => undef
</%args>
<%init>

	my $switch;
	my (%cume_settings) = $m->comp("/funclib/tourn_cume_sweeps.mas", tourn => $tourn);
	my (%place_settings) = $m->comp("/funclib/tourn_place_sweeps.mas", tourn => $tourn);
    my $numero = keys %cume_settings;
	&Tab::debuglog("There is $numero in the cume hopper ");

</%init>

	<& sidebar.mas, tourn => $tourn, type => "sweeps", set_id => $set_id &>

	<div class="left huge">

		<h2>Team Awards/Sweepstakes </h2>

%		if ($set_id) { 

%			my $set = Tab::SweepSet->retrieve($set_id);

			<div class="left half">

				<h4><% $set->name %> sweep rules</h4>

				<span class="oddrow block">

					<form action="sweep_set_save.mhtml" method="post">
					<span class="medbigspan inline">
						<input type="text" name="name" value="<% $set->name %>" size="22">
					</span>

					<span class="schemat inline" style="margin-top: 1px; margin-left: 15px;">
						<input type="hidden" name="set_id" value="<% $set->id %>">
						<input type="submit" class="thin" value="Save">
					</span>
					</form>

					<br style="clear: both;"> 

				</span>

			</div>

			<div class="right half">

				<h4>Events in ruleset</h4>

%				my %used = ();
%				my $switch;

%				foreach my $event ($set->events) { 
					<span class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> block">
						<span class="medbigspan">
							<% $event->name %>
						</span>
						<span class="smallspan">
							<a class="plain block" href="sweep_event_rm.mthml?event_id=<% $event->id %>&set_id=<% $set->id %>">
								Remove
							</a>
						</span>

					</span>
%				}

				<span class="oddrow block">

					<form action="sweep_event_add.mhtml" method="post">
					<input type="hidden" name="set_id" value="<% $set->id %>">

					<span class="biggishspan inline">
						Add:
						<select name="event_id" onchange='this.form.submit()'>
%							foreach my $event ($m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 
								<option value="<% $event->id %>">
									<% $event->name %>
								</option>
%							}
						</select>
					</span>

					<noscript>
					<span class="schemat inline" style="margin-top: 1px; margin-left: 15px;">
						<input type="hidden" name="set_id" value="<% $set->id %>">
						<input type="submit" class="thin" value="Save">
					</span>
					</noscript>
					</form>

					<br style="clear: both;"> 

				</span>
				
			</div>

			<br style="clear: both;">

			<h4>Rules in set</h4>

				<table cellpadding="4" cellspacing="1" width="100%">

%				foreach my $rule ($set->rules) { 

					<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

						<td class="smaller">
							<% $rule->tag eq "points_per_prelim" ? "Prelim Round" : "" %>
							<% $rule->tag eq "points_per_elim" ? "Elim Round" : "" %>
							<% $rule->tag eq "points_per_final" ? "Final Round" : "" %>
							<% $rule->tag eq "rev_per_prelim" ? "Each Rank in Prelim Rounds" : "" %>
							<% $rule->tag eq "rev_per_elim" ? "Each Rank in Elim Rounds" : "" %>
							<% $rule->tag eq "rev_per_final" ? "Each Rank in the Final Round" : "" %>
							<% $rule->tag eq "rev_per_elim_rank" ? "Placement in Elim Round" : "" %>
							<% $rule->tag eq "rev_per_final_rank" ? "Placement in Final" : "" %>
							<% $rule->tag eq "rev_per_final_rank" ? "Placement Overall" : "" %>
							<% $rule->position ? "Final Placement:" : "" %>
						</td>

%						if ($rule->value) { 


%						} elsif ($rule->position) { 

%						} else { 

%						}

						</td>

							
						</td>

						<td class="smaller">

						</td>

						<td class="smaller">

						</td>

						<td class="smaller">
							<a class="dkred block" href="sweep_rule_rm.mhtml?rule_id=<% $rule->id %>">
								Delete
							</a>
						</td>

					</tr>
%				}

				</table>

				<h4>
					Add new:
				</h4>
				
				<table cellpadding="4" cellspacing="1" width="100%">

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<td>
						<form action="sweep_rule_save.mhtml">
						<input type="hidden" name="set_id" value="<% $set->id %>">
						Points Per Round Participated In
					</td>

					<td>
						Type:
						<select name="tag">
							<option value="points_per_prelim">Prelim Round</option>
							<option value="points_per_elim">Elim Round</option>
							<option value="points_per_final">Final Round</option>
						</select>
					</td>

					<td>
						Points: <input type="number" name="points" size="5" min="1" max="3">
					</td>

					<td>
						<input type="submit" value="Add">
						</form>
					</td>

				</tr>

				<tr>
					<td>
						<form action="sweep_rule_save.mhtml">
						<input type="hidden" name="set_id" value="<% $set->id %>">
						Count reversed points (6-rank) for rounds:
					</td>

					<td colspan="2">
						Type:
						<select name="tag">
							<option value="rev_per_prelim">Each Rank in Prelim Rounds</option>
							<option value="rev_per_elim">Each Rank in Elim Rounds</option>
							<option value="rev_per_final">Each Rank in the Final Round</option>
							<option value="rev_per_elim_rank">Placement in Elim Round</option>
							<option value="rev_per_final_rank">Placement in Final</option>
							<option value="rev_per_final_rank">Placement Overall</option>
						</select>
					</td>

					<td>
						<input type="submit" value="Add">
						</form>
					</td>

				</tr>

				<tr>

					<td>
						Give points for final overall placement:
						<form action="sweep_rule_save.mhtml">
						<input type="hidden" name="set_id" value="<% $set->id %>">
					</td>

					<td>
						Place:
						<input type="number" name="place" max="99" min="1" size="5">
					</td>

					<td>
						Points:
						<input type="number" name="points" max="99" min="1" size="5">
					</td>

					<td>
						<input type="submit" value="Add">
						</form>
					</td>

				</tr>

			</table>


%		} else { 

			<h4>Choose a set at right</h4>

%		}

	</div>

