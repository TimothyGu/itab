<%args> 
	$league
	$tourn
	$tz
	$group_id
</%args>
<%init> 

	my $group = Tab::JudgeGroup->retrieve($group_id);

	my $err;

	foreach my $bin ($group->bins) {

		my $start_dt = Tab::dtme($ARGS{$bin->id."_day"},$ARGS{$bin->id."_start"});
		my $end_dt = Tab::dtme($ARGS{$bin->id."_day"},$ARGS{$bin->id."_end"});

		$start_dt->set_time_zone($tz);
		$end_dt->set_time_zone($tz);

		if ($start_dt > $end_dt) { 

			$err .= "You had the timeblock ".$ARGS{$bin->id."_name"}." starting after it ended.  I'm not big on logical impossibilities.  Try again. <br />"

		} else { 

			$bin->name($ARGS{$bin->id."_name"});
			$bin->fine($ARGS{$bin->id."_fine"});
			$bin->start($start_dt);
			$bin->end($end_dt);
			$bin->update;	

		}
	} 
	
	if ($ARGS{"new_name"}) { 

		my $start_dt = Tab::dtme($ARGS{"new_day"},$ARGS{"new_start"});
		my $end_dt = Tab::dtme($ARGS{"new_day"},$ARGS{"new_end"});

		$start_dt->set_time_zone($tz);
		$end_dt->set_time_zone($tz);

		if ($start_dt > $end_dt) { 

			$err .= "You had the timeblock ".$ARGS{"new_name"}." starting after it ended.  I'm not big on logical impossibilities.  Try again. <br />"

		} else { 

			my $bin = Tab::Bin->create({
				judge_group => $group_id,
				fine => $ARGS{"new_fine"},
				name => $ARGS{"new_name"},
				start => $start_dt,
				end   => $end_dt
			});
		}
	}

	my $msg = "Judge timeblock saved";

	$m->redirect("$Tab::url_prefix/setup/judges/partials.mhtml?group_id=$group_id&err=$err&msg=$msg");		

</%init>
