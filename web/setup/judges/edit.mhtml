<%args>
	$account
	$group_id => undef
	$tourn
	$new => undef
	$page => undef
</%args>
<%perl>

	my $group = Tab::JudgeGroup->retrieve($group_id) if $group_id; 
	my $switch;

	$group = $tourn->groups->first if scalar $tourn->groups == 1;
	$group_id = $group->id if $group;

	if ($page) { 

		$m->redirect("edit.mhtml?group_id=".$group->id) if $page eq "edit";
		$m->redirect("hires.mhtml?group_id=".$group->id) if $page eq "hires";
		$m->redirect("ratings.mhtml?group_id=".$group->id) if $page eq "ratings";
		$m->redirect("scale.mhtml?group_id=".$group->id) if $page eq "scale";
		$m->redirect("partials.mhtml?group_id=".$group->id) if $page eq "partials";
		$m->redirect("pools.mhtml?group_id=".$group->id) if $page eq "pools";
		
	}

</%perl>

	<& menubar.mas, group_id => $group_id, tourn => $tourn, page => "edit" &>

	<div class="left huge">

%	if ($group || $new) { 

		<h2>
			<% ($group) ? "Edit group ".$group->name : "Add Group"%> 
			<% ($group && $account->site_admin) ? " (".$group->id.")" : ""%>
		</h2>

		<table cellpadding="5" cellspacing="1" width="100%">
		
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Judge Group Name:
				</th>

				<td class="rightalign">
					<form action="edit_save.mhtml" method="post">
					<input type="hidden" value="<% $group_id %>" name="group_id">
					<input type="text" name="name" value="<% ($group) ? $group->name : "" %>" size="25">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Abbreviation:
					(max letters: 3)
				</th>

				<td class="rightalign">
					<input type="text" maxlength="3" name="abbr" value="<% ($group) ? $group->abbr : "" %>" size="25">
				</td>

			</tr>
	
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					<label for="no_codes">
						Suppress judge codes (use names only)
					</label>
				</th>

				<td class="rightalign">
					<input type="checkbox" name="no_codes" id="no_codes" value="1" <% ($group) ? ($group->setting("no_codes")) ? "checked" : "" : "" %>>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					<label for="code_start">
						Start codes with
					</label>
				</th>

				<td class="rightalign">
					<input type="number" name="code_start" size="5" value="<% ($group) ? $group->setting("code_start") : "" %>">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Registration sheet instructions:
				</th>

				<td class="rightalign">
					<textarea name="special" rows="3" cols="35"><% ($group) ? $group->setting("special") : ""%></textarea>
				</td>

			</tr>

% 			if ($tourn->setting("ncfl")) { 
			
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						Note on NCFL elim assignment cards:
					</th>
		
					<td class="centeralign">
						<input type="text" value="<% ($group) ? $group->setting("elim_special") : "" %>" size="48" name="elim_special">
					</td>

				</tr>
% 			}

		</table>

		<h4 style="margin-top: 10px;">
			Burden method (use only one)
		</h4>

		<table cellpadding="5" width="100%" cellspacing="1">   

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Number of entries per judge owed
				</td>

				<td class="rightalign">
					<input type="number" min=0 max=99 name="judge_per" value="<% ($group) ? $group->setting("judge_per") : "" %>" size="4">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Number of rounds owed per entry 
				</td>

				<td class="rightalign">
					<input type="number" min=0 max=99 name="rounds_per" value="<% ($group) ? $group->setting("rounds_per") : "" %>" size="4">
				</td>

			</tr>

		</table>

%		if ($group && $group->setting("rounds_per")) { 

			<h4 style="margin-top: 10px;">
				Alter burden
			</h4>

			<table cellpadding="5" width="100%" cellspacing="1">   

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
					<td>
						Maximum number of rounds per judge:
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=99 name="max_rounds" value="<% ($group) ? $group->setting("max_rounds") : "" %>" size="4">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
					<td>
						Free rounds: reduce round burden by
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=99 name="free" value="<% ($group) ? $group->setting("free") : "" %>" size="4">
					</td>

				</tr>

%			} elsif ($group && $group->setting("judge_per")) { 
			
				<h4 style="margin-top: 10px;">
					Alter burden
				</h4>

				<table cellpadding="5" width="100%" cellspacing="1">   

%	 			if ($tourn->setting("ncfl")) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

						<td>
							Flat obligation (even without entries; tab room)
						</td>

						<td align="center">
							<input type="checkbox" name="tab_room" value="1" <% ($group) ? ($group->tab_room) ? "checked" : "" : "" %>>
						</td>
					</tr>
		
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >	

						<td>
							Minimum required per diocese 
						</td>

						<td class="rightalign">
							<input type="number" min=0 max=99 name="dio_min" value="<% ($group) ? $group->dio_min : "" %>" size="4">
						</td>

					</tr>

% 				}  else { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

						<td>
							Minimum judges owed if a school has entries
						</td>

						<td class="rightalign">
							<input type="number" min=0 max=99 name="min_burden" value="<% ($group) ? $group->setting("min_burden") : "" %>" size="4">
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

						<td>
							Maximum judges that a school can owe
						</td>

						<td class="rightalign">
							<input type="number" min=0 max=99 name="max_burden" value="<% ($group) ? $group->setting("max_burden") : "" %>" size="4">
						</td>
	
% 				}

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						Free judges: reduce judge burdens by
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=99 name="free" value="<% ($group) ? $group->setting("free") : "" %>" size="4">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
			
					<td>
						<label for="ask_alts">
						Allow judges to double-register in other judge groups:
						</label>
					</td>

					<td align="center">
						<input type="checkbox" id="ask_alts" name="ask_alts" value="1" <%  ($group && $group->setting("ask_alts")) ? "checked" : "" %>>
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						Maximum number of judges that can count for the alternate group
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=99 name="alt_max" value="<% ($group) ? $group->setting("alt_max") : "" %>" size="4">
					</td>

				</tr>

%			}

			<tr class="liblrow">
				<td  colspan="2" class="rightalign">
					<input type="submit" value="Save group" style="width: 150px;">
					</form>
				</td>
			</tr>

		</table>

%	} else { 

		<h2>Judge Groups</h2>

		<p>
			Add judge groups or edit judge group information.
		</p>

%	}

	</div>
