<%args>
	$league
	$tourn
	$tz
</%args>

%	my $switch;

    <& sidebar.mas, chosen => "schools" &>

	<div id="leftbignb">

		<h2>Per-Student Fee</h2>

		<table width="100%" cellpadding="5" cellspacing="1">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<form action="student_fee_save.mhtml" method="post">
					Fee for each individual student
				</td>

				<td>
					$<input type="number" size="6" name="per_student_fee" value="<% ($tourn->method) ? $tourn->method->per_student_fee : "" %>">
				</td>

				<td align="center">
					<input class="blue" type="submit" value="  Save  ">
					</form>
				</td>

			</tr>

		</table>
	
		<h2>School Fees</h2>

%			undef($switch);
	
			<table cellpadding="5" cellspacing="1" width="100%">

%				my $finez;

%				foreach my $fine ($tourn->fines) { 

%					$finez++;
	
%					next if $fine->school;
%					next if $fine->region;

%					my $finestart = $fine->start;
%					$finestart->set_time_zone($league->timezone) if $finestart;

%					my $fineend = $fine->end;
%					$fineend->set_time_zone($league->timezone) if $fineend;

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td class="smaller">
							$<% $fine->amount %>
						</td>

						<td class="smaller">
							<% $fine->reason %>
						</td>

%						if ($finestart || $fineend) { 

							<td class="smaller">
								<% ($finestart) ? "After ".Tab::niceshortdt($finestart) : "" %>
							</td>

							<td class="smaller">
								<% ($fineend) ? "Before ".Tab::niceshortdt($fineend) : "" %>
							</td>

%						} else { 

							<td class="smaller" colspan="2">
								Fee applies at all times
							</td>

%						}

						<td class="smaller" align="center">
							<a class="whiterow" href="standing_fee_rm.mhtml?fee_id=<% $fine->id %>">Delete</a>
						</td>

					</tr>

% 				}

			</table>

%			if ($finez) {
				<h4>Add a fee</h4>
%			}

			<table cellpadding="5" width="100%">

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th class="smaller">
						Description
					</th>

					<td align="right">
						<form action="standing_fee_save.mhtml" method="post">
						<input type="text" name="reason" size="40">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th class="smaller">
						Amount of fee:
					</th>

					<td align="right">
						$ <input type="number" name="amount" size="10">
					</td>

				</tr>

%				my $reg_start = $tourn->reg_start->set_time_zone($tz);
%				my $reg_end = $tourn->reg_end->set_time_zone($tz);

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th class="smaller">
						Apply only after:
					</th>

            		<& /funclib/datepicker.mas, id => "startdate", min => $reg_start->mdy('/'), max => $reg_end->mdy('/') &>

		    		<td align="right">	

						<input type="text" name="startdate" id="startdate" size="20" value="<% $reg_start->mdy('/') %>">
							at
						<& /funclib/timepicker.mas, name => "starttime", time => $reg_start &>

					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th class="smaller">
						Apply only before
					</th>

        		    <& /funclib/datepicker.mas, id => "enddate",  min => $reg_start->mdy('/') &>
	
				    <td align="right">	

						<input type="text" name="enddate" id="enddate" size="20" value="<% $reg_end->mdy('/') %>">
							at
						<& /funclib/timepicker.mas, name => "endtime", time => $reg_end &>

					</td>
		
				</tr>

				<tr class="liblrow">
					<td colspan="10" align="right">
						<input class="blue" type="submit" value="      Save School Fee        ">
						</form>
					</td>
				</tr>

			</table>
				

	<h2>Add a universal fee</h2>

		<p class="smaller">

			This will add a uniform fee to every school in your tournament.
			Right now, because I'm lazy, the only way to remove said fee is to
			go into each school and manually delete it.  This will be, as they
			say, a Royal Pain.  So make sure you mean it when you do this.

		</p>	

		<table cellpadding="6" cellspacing="1" width="100%">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="smaller">
					<form action="levy_fine_save.mhtml" method="post">
					Description:
				</td>

				<td>
					<input type="text" name="fine_reason" size="20">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="smaller">
					Fee Amount:
				</td>

				<td align="right">
					$<input type="number" name="fine_amount" size="8">
				</td>

			</tr>

			<tr class="lirdrow">

				<td colspan="2" align="right">
					<input class="blue" type="submit" value="Save School Fee">
					</form>
				</td>

			</tr>

		</table>

	</div>
