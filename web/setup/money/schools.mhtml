<%args>
	$circuit
	$tourn
	$tz
</%args>

%	my $switch;

    <& sidebar.mas, chosen => "schools" &>

	<div class="left huge">

		<h3>Per-Student Fee</h3>

		<table width="100%" cellpadding="5" cellspacing="1">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<form action="student_fee_save.mhtml" method="post">
					Fee for each individual student
				</td>

				<td>
					$<input type="number" size="6" name="per_student_fee" value="<% $tourn->setting("per_student_fee") %>">
				</td>

				<td align="center">
					<input  type="submit" value="  Save  ">
					</form>
				</td>

			</tr>

		</table>
	
		<h3>School Fees</h3>

%			undef($switch);
	
			<table cellpadding="5" cellspacing="1" width="100%">

				<tr class="yellowrow">

					<th>
						Description
					</th>

					<th>
						Fee
					</th>

					<th>
						Applies after
					</th>

					<th>
						Applies before
					</th>

					<th>
					</th>

				</tr>

%				my $finez;

%				foreach my $fine ($tourn->tourn_fees) { 

%					$finez++;
	
%					my $finestart = $fine->start;
%					$finestart->set_time_zone($tourn->tz) if $finestart;

%					my $fineend = $fine->end;
%					$fineend->set_time_zone($tourn->tz) if $fineend;

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td class="smaller">
							<% $fine->reason %>
						</td>

						<td class="centeralign">
							$<% $fine->amount %>
						</td>

						<td class="rightalign">
							<% ($finestart) ? Tab::niceshortdt($finestart) : "" %>
						</td>

						<td class="rightalign">
							<% ($fineend) ? Tab::niceshortdt($fineend) : "" %>
						</td>

						<td class="smaller" align="center">
							<a class="dkred block" href="standing_fee_rm.mhtml?fee_id=<% $fine->id %>">Delete</a>
						</td>

					</tr>

% 				}

				<tr>				
					<td colspan="5">
						<h4>Add a fee</h4>
					</td>
				</tr>

				<tr class="liblrow">

					<td align="right">
						<form action="standing_fee_save.mhtml" method="post">
						<input type="text" name="reason" size="15" placeholder="Description">
					</td>

					<td align="right">
						$ <input type="number" name="amount" size="3">
					</td>

%					my $reg_start = $tourn->reg_start->set_time_zone($tourn->tz);
%					my $reg_end = $tourn->reg_end->set_time_zone($tourn->tz);

            		<& /funclib/datepicker.mas, id => "startdate", min => $reg_start->mdy('/'), max => $reg_end->mdy('/') &>

		    		<td align="right">	

						<input type="text" name="startdate" id="startdate" size="8" >
						    @	
						<& /funclib/timepicker.mas, name => "starttime", size => 5 &>

					</td>

        		    <& /funclib/datepicker.mas, id => "enddate",  min => $reg_start->mdy('/') &>
	
				    <td align="right">	

						<input type="text" name="enddate" id="enddate" size="8">
							@	
						<& /funclib/timepicker.mas, name => "endtime", size => 5 &>

					</td>
		
					<td>
						<input  type="submit" class="thin" value="Save">
						</form>
					</td>

				</tr>

			</table>
				

	<h3>Add a universal fee</h3>

		<p class="smaller">

			This will add a uniform fee to every school in your tournament.
			Right now, because I'm lazy, the only way to remove said fee is to
			go into each school and manually delete it.  This will be, as they
			say, a Royal Pain.  So make sure you mean it when you do this.

		</p>	

		<table cellpadding="6" cellspacing="1" width="100%">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="smaller">
					<form action="levy_fine_save.mhtml" method="post">
					Description:
				</td>

				<td>
					<input type="text" name="fine_reason" size="20">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="smaller">
					Fee Amount:
				</td>

				<td align="right">
					$<input type="number" name="fine_amount" size="8">
				</td>

			</tr>

			<tr class="liblrow">

				<td colspan="2" align="right">
					<input  type="submit" value="Save School Fee">
					</form>
				</td>

			</tr>

		</table>

	</div>
