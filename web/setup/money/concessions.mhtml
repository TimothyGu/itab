<%args>
	$tourn
	$session
	$account
</%args>
<%init>

	my @concessions = sort {$a->name cmp $b->name} $tourn->concessions;
	my $switch;
	my $tz = $tourn->tz;

</%init>

    <& sidebar.mas, chosen => "concessions", tourn => $tourn &>

	<div class="left huge">

		<h2><% ($tourn->setting("concession_name")) ? $tourn->setting("concession_name") : "Concessions" %></h2>

		<table cellpadding="6" cellspacing="1" border="0" width="100%">

			<tr class="yellowrow">

				<th>
					<form action="concessions_save.mhtml" method="post">
					Name
				</th>

				<th>
					Price
				</th>
				
				<th>
					Order Deadline
				</th>

				<th colspan="2">
					Full Description
				</th>

			</tr>
	
% 			foreach my $concession (@concessions) { 
	
				<tr <% ($switch % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
					<td>
						<input type="text" name="<% $concession->id %>_name" size="10" value="<% $concession->name %>">
					</td>
	
					<td>
						<input type="text" name="<% $concession->id %>_price" size="3" value="<% $concession->price %>">
					</td>

		            <& /funclib/datepicker.mas, id => $concession->id."_date", max => $tourn->start &>
	
%					my $deadline = $concession->deadline->set_time_zone($tourn->tz) if $concession->deadline;
	
				    <td> 

	                    <input type="text" name="<% $concession->id %>_date" id="<% $concession->id %>_date" size="7" 
							value="<% ($deadline) ? Tab::pickerdate($deadline) : "" %>">
							@
	                    <& /funclib/timepicker.mas, name => $concession->id."_time", size => 5, dt => $tourn->reg_start->set_time_zone($tz) &>

					</td>

					<td>
						<input type="text" name="<% $concession->id %>_description" size="27" value="<% $concession->description %>">
					</td>

					<td>
						<a class="dkred block" href="concessions_rm.mhtml?concession_id=<% $concession->id %>">Delete</a> 
					</td>

				</tr>
%			}

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
				<td>
					<input type="text" name="new_name" size="10" placeholder="Add new item">
				</td>
				
				<td>
					<input type="text" name="new_price" size="3">
				</td>
	
				<td>
		            <& /funclib/datepicker.mas, id => "new_date", max => $tourn->start &>
       	            <input type="text" name="new_date" id="new_date" size="7">
					@
                    <& /funclib/timepicker.mas, name => "new_time", size => "5", dt => $tourn->reg_start->set_time_zone($tourn->tz) &>
				</td> 

				<td>
					<input type="text" name="new_description" size="27" placeholder="Description">
				</td>
				
				<td>
				</td>

			</tr>

			<tr class="liblrow">

				<td colspan="5" align="right">
					<input type="submit" value=" Save Concessions Changes ">
					</form>
				</td>

			</tr>

		</table>

	</div>


