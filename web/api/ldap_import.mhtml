<%args>
	$debug => undef
	$no_prefs => undef
</%args>
<%init>

	use Net::LDAPS;

	$m->abort unless $Tab::ldap_enable eq "yes";

	my @accounts = Tab::Account->retrieve_all;

	$m->print("<h4> Found ".scalar @accounts." accounts </h4>");

	my $limit = 10;
	my $counter;

	foreach my $account (@accounts) { 

		my $shell = "/bin/false";
		$shell = "/bin/tcsh" if $account->site_admin;

		$counter++;
		last if $counter > $limit;

		$m->print("<h4>Adding account ".$account->email."</h4>");

		my $result = $m->comp("/funclib/ldap_account.mas", account => $account);

		$m->print("<p>".$result->code."</p>");
		$m->print("<p> Error:".$result->error."</p>") if $result->error && $result->error ne "Success";

	}


</%init>
