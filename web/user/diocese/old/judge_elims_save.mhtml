<%args>
	$diocese_id
	$group_id
</%args>
<%perl>

	my $diocese = Tab::Region->retrieve($diocese_id);
	my $group = Tab::JudgeGroup->retrieve($group_id);

	my @pools = $group->elim_pools;
	my $tourn = $group->tournament;

	foreach my $judge ($diocese->judges($tourn)) { 

		next if $judge->elim_group && $judge->elim_group != $group->id;

		Tab::Judge->sql_delete_elims->execute($judge->id);

		foreach my $pool (@pools) { 

			if ($ARGS{$judge->id."_".$pool->id}) { 

				Tab::PoolJudge->create({ 
					pool => $pool->id,
					judge => $judge->id
				});
			
			} 

		}

	}

	my $msg = "Pool assignments have been saved";

	$m->redirect("$Tab::url_prefix/user/diocese/judges_enter.mhtml?group_id=".$group->id."&diocese_id=$diocese_id&msg=$msg");

</%perl>
	
