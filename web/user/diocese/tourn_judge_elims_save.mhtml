<%args>
	$region
	$tourn
	$group_id
</%args>
<%perl>

	my $group = Tab::JudgeGroup->retrieve($group_id);

	my @elim_pools = $group->pools( registrant => 1, event_based => 0);

	Tab::Judge->set_sql(delete_pools => "
		delete pool_judge from pool_judge, pool
		where pool_judge.judge = ? 
		and pool_judge.pool = pool.id
		and pool.judge_group = ? 
		and type != \"prelim\" ");

	my @judges = $m->comp("/funclib/region_judges.mas", region => $region, tourn => $tourn, elim => $group);

	foreach my $judge (@judges) { 

		Tab::Judge->sql_delete_pools->execute($judge->id, $group->id);

		foreach my $pool (@elim_pools) { 

			if ($ARGS{$judge->id."_".$pool->id}) { 

				Tab::PoolJudge->create({ 
					pool => $pool->id,
					judge => $judge->id,
					type => "elim"
				});
			
			} 

		}

	}

	my $msg = "Pool assignments have been saved";

	$m->redirect("/user/diocese/tourn_judges.mhtml?group_id=".$group->id."&region_id=".$region->id."&tourn_id=".$tourn->id."&msg=$msg#elims");

</%perl>
	
