<%args>
	$coach_id
	$chapter_id
	$account
</%args>
<%init>

	my $msg;

	if ($account->id == $coach_id) { 
		$msg = "You cannot make your own account have prefs-only access. Otherwise you'll cut yourself off from making further changes.";
		$m->redirect("settings.mhtml?chapter_id=$chapter_id&msg=$msg");
	}

	my $coach = Tab::ChapterAdmin->search( account => $coach_id, chapter => $chapter_id)->first;

	if ($coach) { 

		my $account = $coach->account;

		if ($coach->prefs) { 
			$coach->prefs(0);
			$msg = "Full access enabled for ".$account->first." ".$account->last;
		} else { 
			$coach->prefs(1);
			$msg = $account->first." ".$account->last." limited to prefs only";
		}

		$coach->update;

	}

	$m->redirect("settings.mhtml?chapter_id=$chapter_id&msg=$msg");

</%init>


