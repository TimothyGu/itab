<%args>
	$account
	$chapter_id
	$show_retired => undef
	$err => undef
	$sort_by => "last"
	$from => undef
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	my @chapter_judges;
 
	if ($show_retired) {
		@chapter_judges = $chapter->chapter_judges( retired => 1 );
	} else {
		@chapter_judges = $chapter->chapter_judges( retired => 0 );
	}

	unless (@chapter_judges) {
		$m->redirect("judge_edit.mhtml?newbie=yes&chapter_id=".$chapter_id);
	}

	@chapter_judges = sort {$a->last cmp $b->last} @chapter_judges;
	@chapter_judges = sort {$b->started <=> $a->started } @chapter_judges if $sort_by eq "started";
	@chapter_judges = sort {$b->retired <=> $a->retired } @chapter_judges if $sort_by eq "retired";

	my $message;

</%init>

	<div class="left huge">

		<h2><% $chapter->name %> Judge Roster</h2>

		<& tabbar.mas, chapter => $chapter, whoami => "judges" &>

		<table width="100%" cellpadding="4" cellspacing="1">

			<tr class="yellowrow">

				<th>
					<a class="white block" href="judges.mhtml?chapter_id=<% $chapter_id %>&show_retired=<% $show_retired %>&sort_by=last"> 
						Name 
					</a>
				</th>

				<th class="centeralign">
					<a class="white block" href="judges.mhtml?chapter_id=<% $chapter_id %>&show_retired=<% $show_retired %>&sort_by=cell">
						Cell #
					</a>
				</th>

				<th class="centeralign">
					Account
				</th>

%				if ($show_retired) { 

					<th class="centeralign">
						<a class="white block" href="judges.mhtml?chapter_id=<% $chapter_id %>&show_retired=<% $show_retired %>&sort_by=retired">		
							Active
						</a>
					</th>

%				} else { 

					<th></th>
		
%				}


				</th>

			</tr>

% 			my $switch; 

% 			foreach my $chapter_judge (@chapter_judges) { 

%				next if $chapter_judge->retired &! $show_retired;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<a id="<% $chapter_judge->id %>"></a>
						<a class="white block" href="/user/chapter/judge_edit.mhtml?chapter_judge_id=<% $chapter_judge->id %>">
						<% $chapter_judge->last.", ".$chapter_judge->first %>
						</a>
					</td>

					<td class="centeralign">
						<% $chapter_judge->cell %>
					</td>

					<td class="centeralign">
						<a class="white block" href="mailto:<% ($chapter_judge->account->email) ? $chapter_judge->account->email : "" %>">
							<% ($chapter_judge->account->email) ? $chapter_judge->account->email : "" %>
						</a>
					</td>

%					if ($show_retired) { 
							
						<td class="centeralign">
							<a class="dkred block" href="judge_retire.mhtml?chapter_judge_id=<% $chapter_judge->id %>">
								ACTIVATE
							</a>
						</td>

%					} else { 

						<td class="centeralign smaller">
							<a class="dkgreen block" href="judge_retire.mhtml?chapter_judge_id=<% $chapter_judge->id %>">
								DE-ACTIVATE
							</a>
						</td>

%					}

				</tr>

% 			}

		</table>

	</div>

	<div class="right small">

		<div class="sidenote">

			<h4>Judge Roster</h4>

			<a class="yellow block" href="judge_edit.mhtml?chapter_id=<% $chapter->id %>">
				Add a new judge
			</a>
		
			<a class="<% $show_retired ? "dkred" : "blue" %> block" href="judges.mhtml?show_retired=<% ($show_retired) ? "" : "a" %>&chapter_id=<% $chapter->id %>">
				<% ($show_retired) ? "Hide Inactives" : "Show Inactives" %>
			</a>

		</div>

        <& /user/menu.mas, chapter => $chapter, account => $account &>

	</div>

