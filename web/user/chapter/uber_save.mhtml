<%args>
	$account
	$uber_id => undef
	$first =>  undef
	$last => undef
	$cell => undef
	$gender => undef
	$notes => undef
	$paradigm => undef
	$retired => '0'
	$started => '0'
	$chapter_id => undef
	$twitch => undef
</%args>
<%init> 

	unless ($chapter_id) { 
		my $msg = "You have no defined school or chapter.  Please select one at right before continuing";
		$m->redirect("/user/home.mhtml?msg=$msg");
	}

	my $msg;
	my $err;
	my $uber;
	my $now = DateTime->now;

#	Remove leading spaces
	$first =~ s/^\s+//;
	$last =~ s/^\s+//;

#	Capitalize, bitches
	$first = ucfirst($first);
	$last = ucfirst($last);

	unless ($first) { 
		$err = "WARNING: You have not supplied a first name ";
	}

	unless ($last) { 
		$err = "WARNING: You have not supplied a last name " unless $err;
		$err = $err ." or last name " if $err;
	}

	if ($err) { 

		$err .= ". Judge not saved.";
		$m->redirect("$Tab::url_prefix/user/chapter/uber_edit.mhtml?chapter_id=$chapter_id&err=$err");
	}		

	if ($uber_id) { 

		$uber = Tab::Uber->retrieve($uber_id);
		my $uber_school = $uber->chapter;
		my $uber_school_id = $uber_school->id;

		my @acc = Tab::ChapterAdmin->search( account => $account->id, chapter => $uber_school_id );

		push (@acc, 1) if $account->site_admin;

		if (@acc) { 
			$uber->first($first);
			$uber->last($last);
			$uber->cell($cell);
			$uber->started($started);
			$uber->retired($retired);
			$uber->gender($gender);
			$uber->notes($notes);
			$uber->paradigm($paradigm);
			$uber->chapter($chapter_id);
			$uber->update;
			$err = $err ." Changes have been saved to ". $first." ".$last;
		} else { 

			$msg = "You are not authorized to make that change.  No changes have been saved to ". $first." ".$last;
		}

	} else { 

		$uber = Tab::Uber->create({ 	
			first => $first,
			last => $last,
			cell => $cell,
			gender => $gender,
			notes => $notes,
			paradigm => $paradigm,
			started => $started,
			retired => $retired,
			chapter => $chapter_id
		});

		$msg .= $first." ".$last." has been added to your school.";
	}

	$m->redirect("$Tab::url_prefix/user/chapter/uber_edit.mhtml?chapter_id=".$chapter_id."&msg=$msg") if $twitch;
	$m->redirect("$Tab::url_prefix/user/chapter/judges.mhtml?chapter_id=".$chapter_id."&msg=$msg");

</%init> 


