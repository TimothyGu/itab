<%args>
	$newbie => undef
	$circuit
	$account
	$student_id => undef
	$err => undef;
	$chapter_id => undef;
	$from => undef;
</%args>

<%init>

	my $student = Tab::Student->retrieve($student_id) if $student_id;
	my $chapter = Tab::Chapter->retrieve($chapter_id) if $chapter_id;

	unless ($student || $chapter) { 
		my $err = "You haven't chosen a chapter.  Please choose at right";
		$m->redirect("/user/home.mhtml?err=$err");
	}

	$chapter = $student->chapter unless $chapter;

	unless ($chapter) { 
		my $err = "You haven't chosen a chapter.  Please choose at right";
		$m->redirect("/user/home.mhtml?err=$err");
	}


	my $switch;

</%init>


	<div class="left huge">

        <& /user/tabbar.mas, chapter => $chapter, whoami => "students" &>

%		if ($student) {
			<h2>Edit <%$student->first." ".$student->last %></h2>
% 		} else { 
			<h2>Create a new student</h2>
% 		}

%		if ($newbie) { 

			<p>You now should add the student names for your team into your
			roster by adding their information below.  Add in your entire team,
			not just the students going to your first tournament</p>
			
			<p>You only have to add each student once for their entire
			forensics career; you can then look up an entire student record for
			all the tournaments on tabroom.com that a given student
			attends.</p>

			<p>Begin by adding the first student below.</p>

			<hr />

%		}

		<table cellpadding="4" cellspacing="1" width="100%" >


			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
				
				<td>
					<form action="student_save.mhtml" method="post">
					<input type="hidden" name="student_id" value="<% ($student) ? $student->id : "" %>">
					<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
					<input type="hidden" name="from" value="<% $from %>">
					First Name:
				</td>
				
				<td>
					<input type="text" name="first" size="20" value="<% ($student) ? $student->first : "" %>">
				</td>

			</tr> 
			
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
				<td>
					Last:
				</td>
				
				<td>
					<input type="text" name="last" size="20" value="<% ($student) ? $student->last : ""%>">
				</td>

			</tr> 
			
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
				
				<td class="smaller">
					Phonetic Pronunciation:
				</td>
				
				<td>
					<input type="text" name="phonetic" size="20" value="<% ($student) ? $student->phonetic : ""%>">
				</td> 

			</tr> 
			
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
				<td>
					Grad Year:
				</td>
				
				<td>
					<input type="text" name="grad_year" size="6" value="<% ($student) ?   $student->grad_year : ""%>">
				</td>

			</tr> 
			
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
				<td>
					Novice:
				</td>
				
				<td>
					<input type="checkbox" name="novice" value="1" <% ($student) ?  ($student->novice) ? 'checked' : '': "" %> >
				</td> 

			</tr> 
			
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
				<td>
					Gender:
				</td>
				
				<td>
					<input type="radio" name="gender" value="M" <% ($student) ? ($student->gender eq "M") ? "checked" : "" : "" %>> M
					<input type="radio" name="gender" value="F" <% ($student) ? ($student->gender eq "F" ) ? "checked" : "" : "" %>> F
				</td>
			</tr> 
			
			<tr class="liblrow">
				<td>
					<input  type="submit" value="  Save Student & Return ">
				</td>

				<td align="right">
					<input  type="submit" name="twitch" value="  Save Student & Add Another  ">
					</form>
				</td>
				
			</tr>

		</table>

	</div>

	<div class="right small">

%		if ($student) { 

%			my @results = $student->results;
%			@results = sort {$b->tournament->start->epoch <=> $a->tournament->start->epoch} @results;

			<h3>Tournament Record</h3>

			<table cellpadding="3" cellspacing="1" width="100%">

%			undef $switch;

%	 		foreach my $result (@results) { 
	
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
					<td class="smaller">
						<% $result->tournament->start->year%>
					</td>

					<td class="smaller">
						<%substr($result->tournament->name,0,20) %>
					</td>
					
					<td class="smallctr">
						<%$result->event->abbr%>
					</td>
				
					<td class="smallctr">
						<% ($result->rank) ? Lingua::EN::Numbers::Ordinate::ordinate($result->rank) : "" %><% ($result->bid) ? " Bid" : "" %>
					</td>
				
					<td class="smaller">
						<%$result->results_bar%>
					</td>
				
				</tr>	
% 			}

			</table>

			<hr />

%		}

		<& /user/menu.mas, chapter => $chapter, account => $account &>

	</div>

