<%args>
	$entry_id
	$school_id
</%args>
<%init>

	my $entry = Tab::Entry->retrieve($entry_id);

	my $event = $entry->event;
	my $tourn = $event->tourn;
	my $school = Tab::School->retrieve($school_id);

	my $max = $event->setting("max_entry");
	my $min = $event->setting("min_entry");

	my $switch;

</%init>

	<div class="left huge">

		<h2>Entry Details</h2>

		<form action="details_save.mhtml" method="post">
		<input type="hidden" name="entry_id" value="<% $entry->id %>">
		<input type="hidden" name="school_id" value="<% $school->id %>">

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

				<td>
					Name
				</td>

				<td>
					<input type="text" size="30" name="name" value="<% $entry->name %>" maxlength="30">
				</td>

				<td colspan="2">
				</td>

			</tr>

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

				<td>
					Code
				</td>

				<td>
					<input type="text" size="30" name="code" value="<% $entry->code %>" maxlength="12">
				</td>

				<td colspan="2">
				</td>

			</tr>

%			if ($event->setting("ask_for_titles")) {
			
				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td>
						Piece title (or ISBN):
					</td>

					<td class="rightalign" colspan="3">
						<input type="text" name="title" value="<% $entry->title %>" size="75">
					</td>

				</tr>

%			}

%			foreach my $qual ($tourn->setting("ask_quals")) { 

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td>
						Qualifier <% $qual %>
					</td>

					<td colspan="3">
						<input type="text" name="qual_<% $qual %>" value="<% $entry->title %>" size="25">
					</td>

				</tr>

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td>
						Qualifier <% $qual %> points/placement:
					</td>

					<td class="rightalign">
						<input type="text" name="qualpts_<% $qual %>" value="<% $entry->title %>" size="25">
					</td>

				</tr>

%			}
	
%			my @students = $entry->students;

%			foreach my $count (1 .. $max) { 

%				my $student = shift @students if @students;

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td>
						Student <% $count %>
					</td>

					<td class="<% $student ? "left" : "right" %>align">	
						<% $student ? $student->first." ".$student->last : "Add:" %>
					</td>

					<td class="rightalign">

						<% $student ? "Swap to:" : "" %>

						<select name="<% $count %>">
							<option value=""></option>
%							foreach my $student ($m->comp("/funclib/students_evententer.mas", event => $event, school => $school )) {
								<option value="<% $student->id %>">
									<% $student->first." ".$student->last %>
								</option>
%							}
						</select>

					</td>

					<td class="centeralign">
%						if ($student && $count > $min) { 
							<a class="dkred block" href="entry_student_rm.mhtml?entry_id=<% $entry->id %>&student_id=<% $student->id %>">
								REMOVE
							</a>
%						}
					</td>

				</tr>

%				$count++;

%			}

		</table>

	
		<hr />

		<table cellpadding="5" cellspacing="1" width="100%">
			
			<tr class="liblrow">

				<td align="right">
					<input type="submit" value=" Save Entry Details ">
					</form>
				</td>

			</tr>


		</table>

	</div>

	<div class="right small">
	
		<div class="sidenote">

			<h4>Entry</h4>

			<p class="grey block">
				<% $entry->name %>
			</p>

			<p class="grey block">
				<% $entry->code %>
			</p>

			<p class="grey block">
				<% $event->name %>
			</p>

			<h4><% $event->abbr %></h4>

			<a class="blue block" href="students.mhtml?school_id=<% $school_id %>&event_id=<% $event->id %>">
				Return to Entry
			</a>
		</div>

	</div>

