<%args>
	$session
	$tourn_id
	$account
</%args>
<%init>

	# Make sure the user has access to that tournament through whatever pathway.
	my $tourn = Tab::Tournament->retrieve($tourn_id);

	my $ok;

	if ($tourn) { 


		$ok++ if $account->site_admin;

		$ok++ if grep $_->id eq $tourn->id, $account->tournaments;

		$ok++ if grep $_->id eq $tourn->circuit->id, $account->circuits;

		if ($ok) { 
		

			$session->circuit($tourn->circuit->id);
			$session->tournament($tourn->id);
			$session->update;

			if ($tourn->circuit->diocese_based) { 

				$m->redirect("/register/diocese/dioceses.mhtml");

			} else { 
			
				$m->redirect("/register/registration.mhtml");

			}



		} else { 

			my $err = "You do not have administrative access to that tournament.  Please contact the tournament director";
			$err .= "or your circuit administrators if you think this in error";
			$m->redirect("$Tab::url_prefix/user/home.mhtml?err=$err");
		}


	} else { 

		$m->print("<p>That tournament doesn't exist.  Quit messing around with the system.</p>");
		$m->abort;

	}


</%init>
