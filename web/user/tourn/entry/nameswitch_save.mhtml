<%args>
	$comp_id
	$student_id
	$school_id
	$switch_student_id => undef
	$housing => undef
</%args>
<%perl>

	unless ($switch_student_id) { 
		$m->print("You must select a student to switch this entry to.  Please hit \"back\" and try again");
		$m->abort;
	}

	my $comp = Tab::Entry->retrieve($comp_id);
	my $tourn = $comp->event->tournament;
	my $student = Tab::Student->retrieve($student_id);
	my $switch_student = Tab::Student->retrieve($switch_student_id);

	if ($comp->event->team == 1) { 
		$comp->student($switch_student->id);
		$comp->update();
	}

	if ($comp->event->team == 2) { 
		$comp->student($switch_student->id) if $student->id == $comp->student->id;
		$comp->partner($switch_student->id) if $student->id == $comp->partner->id;
		$comp->update;
	}

	if ($comp->event->team == 3) {
		$comp->rm_student($student);
		$comp->add_student($switch_student);
	}

	my @hrs = Tab::Housing->search( tournament => $tourn->id, student => $student->id);
		
	if ($housing) { 
	
		foreach (@hrs) {  
			$_->student($switch_student_id);   
			$_->update();  
		}

	} else { 

		foreach (@hrs) { 
			$_->delete();
		}
	}

	my $msg = "Entryetitor slot switched to ".$student->first." ".$student->last;

	$m->redirect("$Tab::url_prefix/user/tourn/entry/students.mhtml?school_id=$school_id&event_id=".$comp->event->id."&msg=$msg");

</%perl>
