<%args>
	$comp_id
	$clone_id
	$session
	$account
	$debug => 1
</%args>
<%init>

	my $now = DateTime->now;
	my $comp = Tab::Comp->retrieve($comp_id);
	my $clone = Tab::Comp->retrieve($clone_id);

	unless ($comp->school->id == $clone->school->id) { 

		$m->print("<p>Very freakin' clever.  Trying to clone the ratings of another school's debaters?</p>");
		$m->print("<p>But not clever enough.  Go away, and fear the wrath of Palmer</p>");
		$m->abort("");

	}

	foreach my $rating ($clone->ratings) { 

		system "$Tab::logger Copying ratings for judge ".$rating->judge->id if $debug;

		my $new_rating = $rating->copy;

		$new_rating->comp($comp->id);
		$new_rating->entered($now);
		$new_rating->update;

	}

	my $msg = "Ratings for ".$clone->team_name." have been copied from ".$comp->team_name;

	$m->redirect("/user/tourn/entry/ratings/comp_ratings.mhtml?school_id=".$comp->school->id."&comp_id=".$comp->id."&group_id=".$comp->event->judge_group->id."&style=comp_ratings&msg=".$msg);


</%init>

