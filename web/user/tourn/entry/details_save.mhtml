<%args>
	$entry_id
	$school_id
	$qualifier => undef
	$qualexp => undef
	$qual2 => undef
	$qual2exp => undef
	$title => undef
</%args>
<%init>

	my $entry = Tab::Entry->retrieve($entry_id);

	my $event = $entry->event;
	my $tourn = $event->tournament;

	my $school = Tab::School->retrieve($school_id);

	if ($event->ask_for_titles) {

		unless ($title) { 
			my $err = "You must enter a piece title (and/or ISBN number)";
			$m->redirect("details.mhtml?entry_id=$entry_id&school_id=$school_id&err=$err");
		}

	}

	if ($tourn->method->ask_qualifying_tournament) {

		unless ($qualifier) { 
			my $err = "You must enter qualifying tournament information";
			$m->redirect("details.mhtml?entry_id=$entry_id&school_id=$school_id&err=$err");
		}

	}

	if ($tourn->method->ask_two_quals) {

		unless ($qualifier && $qual2) { 
			my $err = "You must enter qualifying tournaments";
			$m->redirect("details.mhtml?entry_id=$entry_id&school_id=$school_id&err=$err");
		}

		unless ($qualexp && $qualexp) { 
			my $err = "You must enter qualifying tournament placements";
			$m->redirect("details.mhtml?entry_id=$entry_id&school_id=$school_id&err=$err");
		}

	}

	$entry->title($title);
	$entry->qualifier($qualifier);
	$entry->qualexp($qualexp);
	$entry->qual2($qual2);
	$entry->qual2exp($qual2exp);

	$entry->update;

	my $msg = "Entryetitor ".$entry->team_name." entered";

	$m->redirect("students.mhtml?school_id=$school_id&event_id=".$event->id."&msg=$msg");

</%init>
