<%args>
	$account
	$hire_id
	$rounds => undef
</%args>
<%init>

	my $hire = Tab::JudgeHire->retrieve($hire_id);

	my $judge = $hire->judge;

	unless ($judge) { 
		$m->redirect("/user/home.mhtml?err=Either something odd has occurred, or you were doing something you should not have.  Contact us if it is the former");
	}

	unless ($judge->account->id == $account->id) { 
		$m->redirect("/user/home.mhtml?err=You are not authorized to edit that judge hire");
	}

	my $hired = $judge->hired - $hire->rounds;
	$judge->hired($hired);
	$judge->update;

	my $text = "Account ".$account->email." deleted a judge exchange hire arrangement with ".$hire->school->name;

	Tab::TournChange->create({
		type => "exchange",
		tourn => $judge->judge_group->tourn->id,
		judge => $judge->id,
		school => $hire->school->id,
		text => $text
	});

	my $subject = "Judge ".$judge->first." ".$judge->last." rescinded your hire";

	my $body = "

	This is an automated email to inform you that 

	".$judge->first." ".$judge->last." 

	Has rescinded your hire for $rounds rounds of judging at 

	".$judge->judge_group->tourn->name."

	If this is OK, you don't need to do anything.  If this is not OK, you may
	reply to this email to rant at the person who did it to find out why.

	Please note that the expectation is that you'd pre-arrange pay rates and
	arrangements with a hired judge, so if you just hired them willy nilly
	without doing so, chances are they cancelled this hire just as willy and
	every bit as nilly.

	Cheers,
	iDebate Tabroom
	http://tabroom.idebate.org

";

	foreach my $admin ($hire->school->chapter->admins) { 
		$m->comp( "/funclib/send_email.mas", from => $account, to => $admin, subject => $subject, body => $body );
	}

	$hire->delete;
	$m->redirect("hire.mhtml?msg=Judge hire cancelled.  Judge was notified by email.");

</%init>

