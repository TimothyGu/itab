<%args> 
	$req_id
	$circuit
	$account
	$tourn
</%args>
<%init>

	my $hire = Tab::JudgeHire->retrieve($req_id);

	$hire->accepted(1);
	$hire->update;

	#Send the email

	my $subject = " Judge Hire Request Accepted: ". $tourn->name;
	my $message = " The ".$tourn->name." is pleased to notify you\r\n";
	$message = $message." that we have accepted your request to hire judging\r\n";
	$message = $message." to cover entries in ".$hire->judge_group->name.".\r\n\r\n";

	$message = $message." You do not have to take further action; this judge \r\n";
	$message = $message." is now fully entered and has been added to your invoice.\r\n";

	$message = $message."\r\n \r\n";
	$message = $message." Cheers,\r\n ";
	$message = $message." ".$account->first." ".$account->last."\r\n";
	$message = $message." ".$tourn->name."\r\n ";

    $message = $message." \r\n \r\n --- \r\n ";
    $message = $message." This message auto-generated by the Tabroom.com software\r\n
 at ".$Tab::url_prefix.". on behalf of the ". $circuit->name ."\r\n
 Tabroom.com: http://www.tabroom.com.  ";

	my @accounts = $hire->school->chapter->coaches;

    foreach my $sendto (@accounts) {

        my $mail = new Mail::Mailer 'smtp', Server => $Tab::smtp_server;
        my $from = $account->first." ".$account->last." <".$account->email.">";
        my $to = $sendto->first." ".$sendto->last." <".$sendto->email.">";

        $mail->open({   From => $from,
            To => $to,
			Bcc => $account->email,
            Subject => $subject,
        });

        print $mail $message."\r\n \r\n";
        $mail->close();
    }

	$m->redirect("$Tab::url_prefix/register/hire_requests.mhtml?group_id=".$hire->judge_group->id);

</%init>

