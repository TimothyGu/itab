<%args> 
	$tourn
	$entry_id => undef
</%args>
<%init>

	my $switch;
	my $entry = Tab::Entry->retrieve($entry_id);

	my $school = $entry->school;
	my $diocese = $m->comp("/school_region.mas", school => $school) if $tourn->setting("ncfl");

	my $group = $entry->event->judge_group;

 	my @panels = $m->comp('/funclib/entry_panels.mas', entry => $entry);
	
</%init>

   	<& "/register/menubar.mas", school => $school, whoami => "entries", tourn => $tourn &>

	<& "/funclib/tablesorter.mas", table => "sortme" &>

	<h4>Pref Sheet for <% $entry->name %></h4>

		<table cellpadding="5" id="sortme">

%		if ($group->setting("prefs") eq "ordinals") { 
				
				<thead>
				<tr class="yellowrow">

					<th>
						Judge
					</th>

					<th class="centeralign">
						Rounds/Hired
					</th>

					<th class="centeralign">
						Rating
					</th>

				</tr>

				</thead>

				<tbody>

%				my $switch;
%				foreach my $rating (sort {$a->ordinal <=> $b->ordinal} $entry->ratings) { 

					<tr>
						<td>
							<% $rating->judge->first." ".$rating->judge->last %>
						</td>

						<td class="centeralign">
							<% $rating->judge->obligation %>/<% $rating->judge->hired %>
						</td>

						<td class="centeralign">
							<% $rating->ordinal %>
						</td>
					</tr>

%				}

%				foreach my $conflict ($m->comp("/funclib/entry_conflicts.mas", entry => $entry, group => $group)) { 

					<tr>
						<td>
							<% $conflict->judge->first." ".$conflict->judge->last %>
						</td>

						<td class="centeralign">
							<% $conflict->judge->obligation %>/<% $conflict->judge->hired %>
						</td>

						<td class="centeralign">
							Conflict
						</td>
					</tr>

%				}

%				foreach my $conflict ($m->comp("/funclib/school_conflicts.mas", school => $entry->school, group => $group)) {

					<tr>
						<td>
							<% $conflict->judge->first." ".$conflict->judge->last %>
						</td>

						<td class="centeralign">
							<% $conflict->judge->obligation %>/<% $conflict->judge->hired %>
						</td>

						<td class="centeralign">
							Conflict
						</td>
					</tr>

%				}
				
				</tbody>

%			}  if ($group->setting("prefs") eq "tiered") { 

%				my %tier_name = ();

%				foreach my $tier ($group->rating_tiers) { 
%					$tier_name{$tier->id} = $tier->name;
%				}

				<thead>
				<tr class="yellowrow">

					<th>
						Judge
					</th>

					<th class="centeralign">
						Rounds/Hired
					</th>

					<th class="centeralign">
						Rating
					</th>

				</tr>
				</thead>

%				foreach my $rating (sort {$a->rating_tier <=> $b->rating_tier} $entry->ratings) { 

					<tr>

						<td>
							<% $rating->judge->first." ".$rating->judge->last %>
						</td>

						<td class="centeralign">
							<% $rating->judge->obligation %>/<% $rating->judge->hired %>
						</td>

						<td class="centeralign">
							<% $rating->rating_tier->name %>
						</td>

					</tr>

%				}

%				foreach my $conflict ($m->comp("/funclib/entry_conflicts.mas", entry => $entry, group => $group)) { 

					<tr>
						<td>
							<% $conflict->judge->first." ".$conflict->judge->last %>
						</td>

						<td class="centeralign">
							<% $conflict->judge->obligation %>/<% $conflict->judge->hired %>
						</td>

						<td class="centeralign">
							Conflict
						</td>
					</tr>

%				}

%				foreach my $conflict ($m->comp("/funclib/school_conflicts.mas", school => $entry->school, group => $group)) {

					<tr>
						<td>
							<% $conflict->judge->first." ".$conflict->judge->last %>
						</td>

						<td class="centeralign">
							<% $conflict->judge->obligation %>/<% $conflict->judge->hired %>
						</td>

						<td class="centeralign">
							Conflict
						</td>
					</tr>

%				}
%			}

		</table>

	</div>

	<div class="right small">

		<div class="sidenote">

			<h4>Return</h4>
			
			<a class="yellow block" href="edit.mhtml?entry_id=<% $entry_id %>">
				Return to <% $entry->name %>
			</a>

		</div>

		<div class="sidenote">

			<h4>Other Pref Sheets</h4>

%			foreach my $other (Tab::Entry->search( event => $entry->event->id, school => $entry->school->id, waitlist => 0, unconfirmed => 0, dropped => 0)) { 

%				next if $other->id == $entry->id;
			
				<a class="nowrap blue block" href="prefs.mhtml?entry_id=<% $other->id %>">
					<% $other->name %> (<% $other->code %>)
				</a>

%			}
			

		</div>

	</div>


	</div>

