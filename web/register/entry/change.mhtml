<%args>
	$entry_id
	$school_id
	$code => undef
</%args>
<%init>

	my $msg;

	my $entry = Tab::Entry->retrieve($entry_id);

	if ($school_id && $school_id != $entry->school->id) { 
		$entry->school($school_id);
		$entry->update;
		$msg .= "Entry school changed <br />";
	}

	foreach my $student ($m->comp("/funclib/entry_students.mas", entry => $entry)) { 

		if ($ARGS{$student->id} != $student->id) { 
			$entry->rm_student($student->id);
			$entry->add_student($ARGS{$student->id});
			$msg .= $student->first." ".$student->last." swapped out <br />";
		}


	}

	if ($ARGS{"new"}) { 
		$entry->add_student($ARGS{"new"});
	}

	$m->redirect("$Tab::url_prefix/register/entry/edit.mhtml?entry_id=$entry_id&msg=$msg");
		
</%init>
