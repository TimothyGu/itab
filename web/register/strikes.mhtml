<%args>
	$circuit
	$judge_id
	$tourn
</%args>
<%init> 

	my $judge = Tab::Judge->retrieve($judge_id);

    my $start = $tourn->start;
    my $end = $tourn->end;

	$start->set_time_zone($circuit->timezone);
	$end->set_time_zone($circuit->timezone);

	my $morning = DateTime->new(
		hour => 8,
		minute => 00,
		second => 00,
		year => $start->year,
		month => $start->month,
		day => $start->day,
		time_zone => $circuit->timezone
	);

	my $night = DateTime->new(
		hour      = > 20,
		minute    = > 00,
		second    = > 00,
		year      = > $end->year,
		month     = > $end->month,
		day       = > $end->day,
		time_zone = > $circuit->timezone
	);


</%init>

	<div class="right small">

		<a class="red block" href="judge_edit.mhtml?judge_id=<% $judge->id %>">
			Return to view/edit judge
		</a>

		<h3>Existing strikes</h3>
		<p class="smaller">
			Click to delete
		</p>

%		my $switch;

% 		foreach my $strike (sort {$a->type cmp $b->type} $judge->strikes) { 

			<a class="red block" href="strike_rm.mhtml?strike_id=<% $strike->id %>">
				<% $strike->name %>
			</a>
%		}

	</div>

	<div class="left huge"> 
	
		<h2>Strikes for <% $judge->first." ".$judge->last %></h2>

		<h4>Time based strikes</h4>
	
		<table cellpadding="5" width="100%" cellspacing="1">

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="time" name="type">
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
					No rounds between:
				</th>

%   			if (scalar $m->comp("/funclib/tourn_days.mas", tourn => $tourn) > 1) { 

					<td>
%						my $first;
%						foreach my $day ($m->comp("/funclib/tourn_days.mas", tourn => $tourn)) {
							<input type="radio" name="start_date" value="<% $day->mdy('/') %>" id="start_<% $day->ymd %>"  <% ($first++ < 1) ? "checked" : "" %>>
								<label for="start_<% $day->ymd %>">
									<% $day->day_abbr %>
								</label>
%   					}
					</td>

%   			} else { 

					<td>
						<input type="hidden" name="start_date" value="<% $start->mdy('/') %>" >
						<input type="hidden" name="end_date" value="<% $start->mdy('/') %>" >
					</td>

%   			}

				<td>
					at
                    <& /funclib/timepicker.mas, name => "start_time", size => 8, time => $morning &>
				</td> 

				<td>
				</td>
				
			</tr>
			
    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					And
				</th>

%   			if (scalar $m->comp("/funclib/tourn_days.mas", tourn => $tourn) > 1) { 

					<td>
%						my $first;
%						foreach my $day ($m->comp("/funclib/tourn_days.mas", tourn => $tourn)) {
							<input type="radio" name="end_date" value="<% $day->mdy('/') %>" id="end_<% $day->ymd %>"  <% ($first++ < 1) ? "checked" : "" %>>
								<label for="end_<% $day->ymd %>">
									<% $day->day_abbr %>
								</label>
%  						}
					</td>
%				} else { 

					<td>
					</td>
%				}

				<td>
					at
                    <& /funclib/timepicker.mas, name => "end_time", size => 8, time => $night &>
				</td>

				<td align="right">
					<input  type="submit" value="Strike">
					</form>
				</td>
				
			</tr>

		</table>

%		if ($judge->judge_group->bins) {

			<br />
						
						
			<h4>Fine-bearing time blocks:</h4>
			
			<form action="strike_save.mhtml" method="post">
			<input type="hidden" value="bin" name="type"> 
			<input type="hidden" value="<% $judge->id %>" name="judge_id">

			<table cellpadding="5" width="100%" cellspacing="1">


%   			foreach my $bin ( sort {$a->start->epoch <=> $b->start->epoch} $judge->judge_group->bins) {

    				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

        				<td colspan="2">
							<% $bin->name %>
						</td>
						
						<td colspan="2">
							$<% $bin->fine %>
						</td>

        				<td>
							<input type="checkbox" name="bin_<% $bin->id %>" value="1" 
								<% ($judge) ? ($bin->strike($judge) ) ? "checked" : "" : "" %>>
						</td>
    				</tr>
%				}

				<tr class="liblrow">

					<td colspan="5" align="right">
						<input type="submit" value=" Strike ">
						</form>
					</td>

				</tr>

			</table>
%   	}

		<br />
	
		<h4>Event/division strikes:</h4>

		<table cellpadding="5" width="100%" cellspacing="1">

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					No rounds in:
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="event" name="type"> 
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
				</th>

				<td>
					<select name="event">
%						foreach my $event ($judge->judge_group->events) { 
							<option value="<% $event->id %>">
								<% $event->name %>
							</option>
%						}
					</select>
				</td> 
				
				<td align="right">
					<input  type="submit" value="Strike">
					</form>
				</td>

			</tr>

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					Only elims of:
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="elim" name="type"> 
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
				</th>

				<td>
					<select name="event">
%						foreach my $event ($judge->judge_group->events) { 
							<option value="<% $event->id %>">
								<% $event->name %>
							</option>
%						}
					</select>
				</td> 
				
				<td align="right">
					<input  type="submit" value="Strike">
					</form>
				</td>

			</tr>

		</table>

		<br />

		<h4>Per-student strikes</h4>

		<table cellpadding="5" width="100%" cellspacing="1">

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
				<th>
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="student" name="type">
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
					Student (last name):
				</td> 
				
				<td>
					<input type="text" name="name" size="20">
				</td>

				<td align="right">
					<input  type="submit" value="Strike">
					</form>
				</td>
				
			</tr> 

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
				<th>
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="comp" name="type">
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
					Entry code:
				</td> 
				
				<td>
					<input type="number" name="code" size="10">
				</td>

				<td align="right">
					<input  type="submit" value="Strike">
					</form>
				</td>
				
			</tr> 

		</table>

		<br />

		<h4>Schools</h4>

		<table cellpadding="5" width="100%" cellspacing="1">

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="school" name="type">
					<input type="hidden" value="<%$judge->id%>" name="judge_id">

					<select name="school">
%						foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) { 
%							next unless $school->chapter;
							<option value="<% $school->id %>">
								<% $school->truncate_name %>
								<% ($school->region) ? "(".$school->region->code.")" : "" %>
							</option>
%						}
					</select>
				</td>

				<td align="right">
					<input  type="submit" value="Strike">
					</form>
				</td>
				
			</tr>

% 			if ($circuit->region_based) {

    			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						<form action="strike_save.mhtml" method="post">
						<input type="hidden" value="region" name="type">
						<input type="hidden" value="<%$judge->id%>" name="judge_id">
						Region:
					</td> 
				
					<td>
						<select name="region">
%						foreach my $region (sort {$a->name cmp $b->name} $tourn->regions) { 
							<option value="<% $region->id %>">
								<% $region->name %>
							</option>
%						}
						</select>
					</td>

					<td align="right">
						<input  type="submit" value="Strike">
						</form>
					</td>
				
				</tr>

%			}

%			if ($circuit->diocese_based) {

    			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						<form action="strike_save.mhtml" method="post">
						<input type="hidden" value="region" name="type">
						<input type="hidden" value="<%$judge->id%>" name="judge_id">
						Diocese
					</td> 
				
					<td>
						<select name="region">
%						foreach my $region (sort {$a->name cmp $b->name} $tourn->regions) { 
							<option value="<% $region->id %>">
								<% $region->name %>
								<% sprintf("%2s", $region->code) %>
							</option>
%						}
						</select>
					</td>

					<td align="right">
						<input  type="submit" value="Strike">
						</form>
					</td>
				
				</tr>

%			}

		</table>

	</div>

	<br style="clear: both;">


