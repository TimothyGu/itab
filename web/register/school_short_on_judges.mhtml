<%args>
	$tourn
</%args>
<%init>

	my %groups_by_id = ();

	foreach my $group ($tourn->groups) { 
		$groups_by_id{$group->id} = $group;
	}



</%init>

<h3>School judge report</h3>


<table cellspacing="1" cellpadding="5" width="100%" border="0">

<tr>
	<th>School</th>

%	foreach my $group ($tourn->groups) { 

	<th><% $group->name %></th>

% 	}

</tr>


% my $switch;

% foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) { 

<%perl>

	my %obligations = $m->comp("school_judge_obligation.mas", school => $school);
	my %judges_owed = ();
	my %judges_over = ();

	foreach my $group_id (keys %obligations) { 
		my $num_judges = scalar $school->judges(judge_group => $group_id);

		my @hires = Tab::JudgeHire->search( school => $school,
											judge_group => $group_id,
											accepted => 1);

		$num_judges = $num_judges + scalar @hires;

		$judges_owed{$group_id} = $obligations{$group_id} - $num_judges 
			if $obligations{$group_id} - $num_judges > 0;

		$judges_over{$group_id} = $num_judges - $obligations{$group_id}
			if $num_judges - $obligations{$group_id} > 0;

	}

</%perl>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

	<td><a href="<% $Tab::url_prefix %>/register/registration.mhtml?school_id=<% $school->id %>">
	<% $school->name %></a></td>


%	foreach my $group ($tourn->groups) { 

	<td align="center">
		<% $judges_owed{$group->id} ? $judges_owed{$group->id}." <b>owed</b>" : "" %>
		<% $judges_over{$group->id} ? $judges_over{$group->id}." over" : "" %>
	</td>

% 	}

</tr>

% }

</table>
