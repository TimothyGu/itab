<%args>
	$diocese_id	
	$tourn => undef
	$tourn_id => undef
	$codes => undef
</%args>
<%init>
	my $diocese = Tab::Region->retrieve($diocese_id);
	$tourn = Tab::Tourn->retrieve($tourn_id) if $tourn_id;
	$tourn_id = $tourn->id unless $tourn_id;
	my $filename = $Tab::file_root."/tmp/dio-registration-".$diocese_id;
	
	my $garbage = `rm -f $filename.*`;
	
	open (TEXOUT, ">$filename.tex");

	print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{multirow}
\\usepackage{times}
\\renewcommand{\\arraystretch}{1.4}

\\setlength{\\oddsidemargin}{0in}     
\\setlength{\\evensidemargin}{0in}     
\\setlength{\\textwidth}{6.5in}

\\setlength{\\textheight}{9.0in}
\\setlength{\\topmargin}{-0.15in}
\\setlength{\\headsep}{0.15in}

\\setlength{\\parskip}{1.2ex}
\\setlength{\\parindent}{0mm}

\\begin{document}

EOF

	print TEXOUT "\\begin{flushright}\n";
	my $now = DateTime->now;
	print TEXOUT "\\begin{tabular}{p{4.75in}rl}\n";
	print TEXOUT "\\multirow{2}{*}{\\LARGE ". $tourn->name ."}\n";
    print TEXOUT "& Diocese: & ". $diocese->name ."\\\\\n";
    print TEXOUT "& Director: & ". $diocese->director->first." ".$diocese->director->last ."\\\\\n";
	print TEXOUT "\\multirow{2}{*}{\\Large May 24-25th, Appleton, WI}\n";
    print TEXOUT "& Quota: & ". $diocese->quota ."\\\\\n";
    print TEXOUT "& Printed: & ". $now->mdy('/') ."\\\\\n";
	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\end{flushright}\n";
	print TEXOUT "\\medskip\n";


	close TEXOUT;

	$m->comp("/funclib/registration_print.mas", id => $diocese_id, filename => $filename, nocodes => 1, tourn_id => $tourn_id, codes => $codes);
	print TEXOUT "\n\n \\medskip\n";
	$m->comp("/funclib/judges_print.mas", id => $diocese_id, filename => $filename, tourn_id => $tourn_id, codes => $codes);
	print TEXOUT "\\medskip\n";
	$m->comp("/funclib/schools_print.mas", id => $diocese_id, filename => $filename, tourn_id => $tourn_id);

	open (TEXOUT, ">>$filename.tex");
	print TEXOUT "\\end{document}\n";
	close TEXOUT;

$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
#`rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
$m->redirect("$Tab::url_prefix/tmp/dio-registration-$diocese_id.pdf");

</%init>

<div id="content">

<p><% $filename %></p>
