<%args>
	$circuit
	$tourn
	$err => undef
	$sort_by => "name"
</%args>
<%init>

	my @schools = sort {$a->name cmp $b->name} $tourn->schools;

	if ($sort_by eq "state") { 
		@schools = sort {$a->chapter->state cmp $b->chapter->state} @schools;
	}

	if ($sort_by eq "id") { 
		@schools = sort {$a->id <=> $b->id} @schools;
	}

	if ($sort_by eq "code") { 
		@schools = sort {$a->code cmp $b->code} @schools;
		@schools = sort {length($a->code) cmp length($b->code)} @schools;
	}

	if ($sort_by eq "diocode") { 
		@schools = sort {$a->region->code cmp $b->region->code} @schools;
		@schools = sort {length($a->region->code) cmp length($b->region->code)} @schools;
	}

	if ($sort_by eq "dioname") { 
		@schools = sort {$a->region->name cmp $b->region->name} @schools;
	}

</%init>

<table width="100%">

<tr>
	<td width="100%">
		<h3><% scalar $tourn->schools %> Schools registered for <% $tourn->name %></h3>
	</td>
	<td align="center">
		<form action="list_schools_csv.mhtml" method="post">
		<input class="blue" type="submit" value="Download CSV">
		</form>
	</td>
	<td align="center">
		<form action="reports.mhtml" method="post">
		<input class="blue" type="submit" value="Return to Tournament Info">
		</form>
	</td>
</tr>

<center>
<table cellpadding="5" cellspacing="1" width="100%">

<tr>

	<td>
		<form action="list_schools.mhtml" method="post">
		<select name="sort_by">
			<option value="name" 
				<% ($sort_by eq "name") ? "selected" : "" %>>Name</option>

%		if ($circuit->diocese_based) { 
			<option value="id" 
				<% ($sort_by eq "id") ? "selected" : "" %>>School ID</option>
			<option value="dioname" 
					<% ($sort_by eq "dioname") ? "selected" : "" %>>Diocese Name</option>
			<option value="diocode" 
					<% ($sort_by eq "diocode") ? "selected" : "" %>>Diocese Code</option>
%		} else { 
			<option value="code" 
				<% ($sort_by eq "code") ? "selected" : "" %>>School Code</option>
			<option value="state" 
					<% ($sort_by eq "state") ? "selected" : "" %>>State</option>
%		}

		</select>
	</td>

	<td>	
		<input class="blue" type="submit" value="Re-sort Schools">
		</form>
	</td>

		

	<td align="center">
		<form action="random_schoolcodes.mhtml" method="post">
		<input class="blue" type="submit" value="Randomize School Codes">
		</form>
	</td>
</tr>

</table>

<p class="err"><% $err %></p>

<hr style="color: #000066; background-color: #000066;">

<table cellpadding="5" cellspacing="1" width="100%">

%	my $switch;

%	foreach my $school (@schools) { 

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

%	unless ($circuit->diocese_based) { 
		<td><% $school->chapter->state %></td>
%	} else { 
		<td><% $school->chapter->id %></td>
%	}

	<td><% $school->name %></td>

%	unless ($circuit->diocese_based) { 
		<td><% $school->code %></td>
%	}

%	if ($circuit->region_based || $circuit->diocese_based) { 
		<td><% ($school->region) ? $school->region->code : "" %></td>
%	}

%	if ($circuit->diocese_based) { 
		<td><% ($school->region) ? $school->region->name : "" %></td>
%	}

	<td>	
		(<a href="<% $Tab::url_prefix %>/register/registration.mhtml?school_id=<% $school->id %>">Edit</a>)
	</td>

</tr>

%	}

</table>
</center>

