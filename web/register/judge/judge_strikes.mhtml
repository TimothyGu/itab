<%args>
	$judge_id
	$tourn
</%args>
<%init> 

	my $judge = Tab::Judge->retrieve($judge_id);

    my $start = $tourn->start;
    my $end = $tourn->end;

	$start->set_time_zone($tourn->tz);
	$end->set_time_zone($tourn->tz);

	my $morning = DateTime->new(
		hour => 8,
		minute => 00,
		second => 00,
		year => $start->year,
		month => $start->month,
		day => $start->day,
		time_zone => $tourn->tz
	);

	my $night = DateTime->new(
		hour      => 20,
		minute    => 00,
		second    => 00,
		year      => $end->year,
		month     => $end->month,
		day       => $end->day,
		time_zone => $tourn->tz
	);


	my $switch;

</%init>

%  	unless ($judge->hired) {
		<& "/register/menubar.mas", school => $judge->school, whoami => "judges", tourn => $tourn &>
%	} else { 
		<div class="left huge"> 
%	}
	
		<h3 class="padmore">
			Strikes for <% $judge->first." ".$judge->last %>
		</h3>

		<h4>Time based</h4>
	
		<table cellpadding="5" width="100%" cellspacing="1">

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="time" name="type">
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
					No rounds between
				</th>

%   			if (scalar $m->comp("/funclib/tourn_days.mas", tourn => $tourn) > 1) { 

					<td class="rightalign">
%						my $first;
%						foreach my $day ($m->comp("/funclib/tourn_days.mas", tourn => $tourn)) {
							<input type="radio" name="start_date" value="<% $day->mdy('/') %>" id="start_<% $day->ymd %>"  <% ($first++ < 1) ? "checked" : "" %>>
								<label for="start_<% $day->ymd %>">
									<% $day->day_abbr %>
								</label>
%   					}

						at
					</td>

%   			} else { 

						<input type="hidden" name="start_date" value="<% $start->mdy('/') %>" >
						<input type="hidden" name="end_date" value="<% $start->mdy('/') %>" >

%   			}

				<td class="rightalign">
                    <& /funclib/timepicker.mas, name => "start_time", size => 8, time => $morning &>
				</td> 

				<td>
				</td>
				
			</tr>
			
    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					And
				</th>

%   			if (scalar $m->comp("/funclib/tourn_days.mas", tourn => $tourn) > 1) { 

					<td class="rightalign">
%						my $first;
%						foreach my $day ($m->comp("/funclib/tourn_days.mas", tourn => $tourn)) {
							<input type="radio" name="end_date" value="<% $day->mdy('/') %>" id="end_<% $day->ymd %>"  <% ($first++ < 1) ? "checked" : "" %>>
								<label for="end_<% $day->ymd %>">
									<% $day->day_abbr %>
								</label>
%  						}
						
						at
					</td>

%				}

				<td class="rightalign">
                    <& /funclib/timepicker.mas, name => "end_time", size => 8, time => $night &>
				</td>

				<td class="rightalign" width="100px;">
					<input  type="submit" class="thin" value="Strike">
					</form>
				</td>
				
			</tr>

		</table>

%		if ($judge->judge_group->strike_times) { 

			<br />
						
						
			<h4>Fine-bearing time blocks:</h4>
			
			<form action="strike_save.mhtml" method="post">
			<input type="hidden" value="strike_time" name="type"> 
			<input type="hidden" value="<% $judge->id %>" name="judge_id">

			<table cellpadding="5" width="100%" cellspacing="1">


%   			foreach my $strike_time ( sort {$a->start->epoch <=> $b->start->epoch} $judge->judge_group->strike_times) {

    				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

        				<td colspan="2">
							<% $strike_time->name %>
						</td>
						
						<td colspan="2">
							$<% $strike_time->fine %>
						</td>

        				<td>
							<input type="checkbox" name="strike_time_<% $strike_time->id %>" value="1" 
								<% ($judge) ? ($strike_time->strike($judge) ) ? "checked" : "" : "" %>>
						</td>

    				</tr>
%				}

				<tr class="liblrow">

					<td class="rightalign" width="100px;" colspan="6">
						<input type="submit" class="thin" value=" Strike ">
						</form>
					</td>

				</tr>

			</table>
%   	}

		<br />
	
		<h4>Event/division</h4>

		<table cellpadding="5" width="100%" cellspacing="1">

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					No rounds in
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="event" name="type"> 
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
				</th>

				<td class="rightalign">

					<select name="event" style="width: 200px;">
%						foreach my $event ($judge->judge_group->events) { 
							<option value="<% $event->id %>">
								<% $event->name %>
							</option>
%						}
					</select>
				</td> 
				
				<td class="rightalign" width="100px;">
					<input  type="submit" class="thin" value="Strike">
					</form>
				</td>

			</tr>

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					Only elims rounds in
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="elim" name="type"> 
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
				</th>

				<td class="rightalign">

					<select name="event" style="width: 200px;">
%						foreach my $event ($judge->judge_group->events) { 
							<option value="<% $event->id %>">
								<% $event->name %>
							</option>
%						}
					</select>
				</td> 
				
				<td class="rightalign" width="100px;">
					<input  type="submit" class="thin" value="Strike">
					</form>
				</td>

			</tr>

		</table>

		<br />

		<h4>Student conflict</h4>

		<table cellpadding="5" width="100%" cellspacing="1">

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
				<td>
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="student" name="type">
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
					By student (enter last name)
				</td> 
				
				<td class="rightalign">
					<input type="text" name="name" size="30" placeholder="Search by last name">
				</td>

				<td class="rightalign" width="100px;">
					<input  type="submit" class="thin" value="Strike">
					</form>
				</td>
				
			</tr> 

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
				<td>
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="entry" name="type">
					<input type="hidden" value="<%$judge->id%>" name="judge_id">
					Entry code
				</td> 
				
				<td class="rightalign">
					<input type="number" name="code" size="30">
				</td>

				<td class="rightalign" width="100px;">
					<input  type="submit" class="thin" value="Strike">
					</form>
				</td>
				
			</tr> 

		</table>

		<br />

		<h4>School conflict</h4>

		<table cellpadding="5" width="100%" cellspacing="1">

    		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="rightalign">
					<form action="strike_save.mhtml" method="post">
					<input type="hidden" value="school" name="type">
					<input type="hidden" value="<%$judge->id%>" name="judge_id">

					<select name="school">
%						foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) { 
%							next unless $school->chapter;
							<option value="<% $school->id %>">
								<% $school->short_name %>
								<% ($school->region) ? "(".$school->region->code.")" : "" %>
							</option>
%						}
					</select>
				</td>

				<td class="rightalign" width="100px;">
					<input  type="submit" class="thin" value="Strike">
					</form>
				</td>
				
			</tr>

% 			if ($tourn->setting("regions")) {

    			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<form action="strike_save.mhtml" method="post">
						<input type="hidden" value="region" name="type">
						<input type="hidden" value="<%$judge->id%>" name="judge_id">
						Region:
					</td> 
				
					<td>
						<select name="region">
%						foreach my $region (sort {$a->name cmp $b->name} $tourn->regions) { 
							<option value="<% $region->id %>">
								<% $region->name %>
							</option>
%						}
						</select>
					</td>

					<td class="rightalign" width="100px;">
						<input  type="submit" class="thin" value="Strike">
						</form>
					</td>
				
				</tr>

%			}

%			if ($tourn->setting("ncfl")) {

    			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<form action="strike_save.mhtml" method="post">
						<input type="hidden" value="region" name="type">
						<input type="hidden" value="<%$judge->id%>" name="judge_id">
						Diocese
					</td> 
				
					<td>
						<select name="region">
%						foreach my $region (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_regions.mas", tourn => $tourn)) { 
							<option value="<% $region->id %>">
								<% $region->name %>
								<% sprintf("%2s", $region->code) %>
							</option>
%						}
						</select>
					</td>

					<td class="rightalign" width="100px;">
						<input  type="submit" class="thin" value="Strike">
						</form>
					</td>
				
				</tr>

%			}

		</table>
	

	</div>

	<div class="right small">

		<div class="sidenote">

			<a class="yellow block" href="edit.mhtml?judge_id=<% $judge->id %>">
				Return to judge screen
			</a>

		</div>

		<div class="sidenote">

			<h4>
				Existing strikes
			</h4>

			<p>
				Click a strike to delete
			</p>

% 			foreach my $strike (sort {$a->type cmp $b->type} $judge->strikes) { 

				<a class="blue block" href="strike_rm.mhtml?strike_id=<% $strike->id %>">
					<% $strike->name %>
				</a>

%			}

		</div>

	</div>


	<br style="clear: both;">


