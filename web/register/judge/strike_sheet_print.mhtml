<%args>
	$session
	$circuit
	$tourn
	$group_id
</%args>
<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id);

    my $string = $group->abbr;

	my $filename = $Tab::file_root."/tmp/strike_sheet-".$string."-".$session->id;

	my $garbage = `rm -f $filename.*`;
	
open (TEXOUT, ">$filename.tex");

print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{helvet}
\\usepackage{colortbl}
\\usepackage[hmargin=1in,vmargin=1in]{geometry}
\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.3}
\\addtolength{\\textwidth}{1in}
\\addtolength{\\hoffset}{-.1in}
\\begin{document}
EOF

print TEXOUT "{\\LARGE ". &Tab::texify($tourn->name)." ".$group->abbr." Strike Sheet} \\\\ \n";
print TEXOUT "\\begin{tabular}{p{6.0in}}\n";
print TEXOUT "\\end{tabular}\n \\newline \n";

print TEXOUT "\\normalsize\n";

print TEXOUT "\\begin{tabular}{p{2.0in}p{4.0in}}\n";
print TEXOUT "ONE Strike Sheet Per School & School: \\\\ \n";
print TEXOUT "\\hline \n";
print TEXOUT "\\end{tabular}\n \\newline \n";

print TEXOUT "\\begin{tabular}{p{6.0in}}\n";
print TEXOUT "\\end{tabular}\n \\newline \n";

print TEXOUT "\\begin{tabular}{p{1.75in}p{1.75in}p{1.75in}p{.5in}}\n";
print TEXOUT "Judge Name & ";
print TEXOUT "School & ";
print TEXOUT "Notes & ";
print TEXOUT "Strike? \\\\ \n";
print TEXOUT "\\hline \n";
print TEXOUT "\\end{tabular}\n \\newline \n";

my $switch;

foreach my $judge (sort {$a->last cmp $b->last} $group->judges) { 

	next if $judge->active != 1;

	print TEXOUT "\\begin{tabular}{p{1.75in}p{1.75in}p{1.75in}p{.5in}}\n";
	print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\n" if ($switch++ % 2);

	print TEXOUT $judge->last.", ".$judge->first." & ";
	print TEXOUT $judge->school->name if $judge->school->name;
	print TEXOUT "Tournament Hire" unless $judge->school->name;
	print TEXOUT " & ";
	print TEXOUT $judge->special if $judge->special;
	print TEXOUT " &  \\\\ \n";
	print TEXOUT "\\end{tabular}\n \\newline \n";
}

print TEXOUT "\\end{document}\n";
close TEXOUT;

$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

`rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;

$m->redirect("$Tab::url_prefix/tmp/strike_sheet-".$string."-".$session->id.".pdf");

</%init>

<div id="content">

<p><% $filename %></p>
