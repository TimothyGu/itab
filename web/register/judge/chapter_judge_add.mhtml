<%args>
	$account
	$first =>  undef
	$last => undef
	$cell => undef
	$gender => undef
	$notes => undef
	$paradigm => undef
	$retired => '0'
	$started => '0'
	$group_id
	$school_id
	$twitch => undef
</%args>
<%init> 

	my $msg;
	my $err;
	my $uber;
	my $now = DateTime->now;

	my $school = Tab::School->retrieve($school_id);

#	Remove leading spaces
	$first =~ s/^\s+//;
	$last =~ s/^\s+//;

#	Capitalize, bitches
	$first = ucfirst($first);
	$last = ucfirst($last);

	unless ($first) { 
		$err = "WARNING: You have not supplied a first name ";
	}

	unless ($last) { 
		$err = "WARNING: You have not supplied a last name " unless $err;
		$err = $err ." or last name " if $err;
	}

	if ($err) { 

		$err .= ". Judge not saved.";
		$m->redirect("$Tab::url_prefix/judge_add.mhtml?school_id=$school_id&group_id=$group_id&err=$err");
	}		

	$uber = Tab::Uber->create({ 	
		first => $first,
		last => $last,
		cell => $cell,
		gender => $gender,
		notes => $notes,
		paradigm => $paradigm,
		started => $started,
		retired => $retired,
		chapter => $school->chapter->id
	});

	if ($group_id) { 
		$m->redirect("judge_save.mhtml?uber_id=".$uber->id."&school_id=$school_id&group_id=$group_id");
	}

	$m->redirect("/register/school_judges.mhtml?school_id=$school_id");

</%init> 

