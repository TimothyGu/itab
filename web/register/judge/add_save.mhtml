<%args>
	$tourn 
	$email => undef
	$first => undef
	$last => undef
	$school_id => 0
	$obligation => undef
	$hired => undef
	$first_year_out => undef
	$gender => undef
	$group_id => undef
</%args>
<%init>

	my $now = DateTime->now;

	my $group = Tab::JudgeGroup->retrieve( judge_group => $group_id );

	unless ($group->tourn->id == $tourn->id) { 
		$m->print("<p>Just what are you trying to pull?  Quit messing around.  </p>");
		$m->abort;
	}

	my $code;

	unless ($group->setting("no_codes")) { 
		$code = $m->comp("/funclib/group_code.mas", group => $group);
	}

	if ($email) { 

		my $account = Tab::Account->search( email => $email )->first;
		$m->redirect("add.mhtml?group_id=$group_id&err=No account found with email $email") unless $account;

		my Tab::Judge->create({
			first => $account->first,
			last => $account->last,
			gender => $account->gender,
			account => $account->id,
			reg_time => $now,
			active => 1,
			dropped => 0,
			obligation => $obligation,
			hired => $hired,
			school => $school_id,
			judge_group => $judge_group,
			code => $code
		});


	} else { 




	}

	my $regline = $account->first." ".$account->last." entered ".$group->abbr." judge $judge->code (".$judge->first." ".$judge->last.")";

	my $change = Tab::TournChange->create({
	   tourn => $tourn->id,
	   school => $school->id,
	   type => "registration",
		text => $regline
	});
	
</%init>

