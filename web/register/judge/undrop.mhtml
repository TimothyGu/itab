<%args>
	$tourn
	$account
	$session
	$judge_id
	$certain => undef
	$autoassign => undef
	$school_id => undef
</%args>
<%init>

	my $msg;

	my $judge = Tab::Judge->retrieve($judge_id);

	my $group_id = $judge->judge_group->id;

	my $regline = $account->first." ".$account->last." un-dropped judge ".$judge->code;

    my $change = Tab::TournChange->create({
		tourn => $tourn->id,
		school => $judge->school->id, 
		type => "registration",
		text => $regline,
		account => $account->id
	}); 
	
	system "$Tab::eventlogger $regline"; 
	
	$judge->dropped("");
	$judge->update; 

	$m->redirect("$Tab::url_prefix/register/school/judges.mhtml?school_id=$school_id&msg=$msg") if $school_id;
	$m->redirect("$Tab::url_prefix/register/judge/roster.mhtml?group_id=$group_id");
	$m->redirect("$Tab::url_prefix/register/judge/hires.mhtml?group_id=$group_id");

</%init>

