<%args>
	$judge_id
	$school_id
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);
	my $school = Tab::School->retrieve($school_id);
	my $group = $judge->judge_group;
	my $tourn = $group->tournament;


	my $switch;

</%init>

	<div class="left huge"> 

		<h2>Details needed</h2> 

		<h5><% $judge->first." ".$judge->last %> in <% $group->abbr %></h5>
		
		<form action="judge_details_save.mhtml" method="post">
		<input type="hidden" name="judge_id" value="<% $judge->id %>">
		<input type="hidden" name="school_id" value="<% $school->id %>">

%		if ($tourn->method->judge_cells &! $judge->cell) { 

			<h5>Judge contact information</h5>

			<table cellpadding="5" cellspacing="1" width="100%">

				<tr class="evenrow">

					<td>
						Cell Phone Number
					</td>

					<td>
						<input type="text" size="30" name="cellphone" value="<% $judge->cell %>">
					</td>

				</tr>
	
			</table>

%		}

%		if ($group->coach_ratings) { 

			<br />

			<h5>Coach judge ratings</h5>

			<table cellpadding="5" cellspacing="1" width="100%">

%				my $done;

%				foreach my $subset ($group->qual_subsets) { 
%					$done++;

%   	            my $jqual = $judge->rating($subset);
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<% $subset->name %>
						</td>

						<td align="right">
							<select name="<% $subset->id %>">
								<option value="">Please choose a rating</option>
%								foreach my $qual (sort {$a->name cmp $b->name} $tourn->judge_group->quals(type => "qual")) {
									<option value="<% $qual->id %>" <% ($jqual && ($qual->id == $jqual->id)) ? "selected" : "" %>>
										<% $qual->name %>:
										<% $qual->description %>
									</option>
%                           	}
			
							</select>
						</td>

					</tr>

%				}

%				unless ($done) {

%   	            my $jqual = $judge->rating;
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<% $judge->judge_group->name %>
						</td>

						<td align="right">
							<select name="qual">
								<option value="">Please choose a rating</option>
%								foreach my $qual (sort {$a->name cmp $b->name} $judge->judge_group->quals(type => "qual")) {
									<option value="<% $qual->id %>" <% ($jqual && ($qual->id == $jqual->id)) ? "selected" : "" %>>
										<% $qual->name %>:
										<% $qual->description %>
									</option>
%                           	}
			
							</select>
						</td>

					</tr>

%				}

			</table>
			
%		}

%		if ($group->ask_alts) { 

%			undef $switch;

			<br />

			<h5>Alternate judge groups</h5>

			<table cellpadding="5" cellspacing="1" width="100%">
	
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
				
				<td>
					Also judges group:
				</td> 
				
				<td>
					<select name="alt_id">
						
						<option value="">
							None Selected
						</option>

%						foreach my $o_group (sort {$a->name cmp $b->name} $tourn->groups) {

%						   next if $o_group->id == $group->id;
%						   next if $o_group->tab_room;

							<option value="<% $o_group->id %>" <% ($o_group->id eq $judge->alt_group->id) ? 'selected' : '' %> >
								<% $o_group->name %>
							</option>
%					   }

					</select>

				</td>

			</tr>

			</table>

%		}


		<br />
		<br />

		<table width="100%" cellpadding="5">
			
			<tr class="liblrow">

				<td align="right">
					<input type="submit" value="  Save Details   ">
					</form>
				</td>

			</tr>

		</table>
			

	</div>

	<div class="right small">
		
		<h3>Judge Info:</h3>

		<a class="blue block">
			<% $judge->first." ".$judge->last %>
		</a>

		<a class="blue block">
			<% $judge->judge_group->name %>
		</a>

	</div>

