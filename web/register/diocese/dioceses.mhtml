<%args>
	$circuit
	$tourn
	$err => undef
	$diocese_id => undef
	$sort_by => "name"
</%args>
<%init>
	
	my @dioceses = sort {$a->name cmp $b->name} $tourn->regions;

	if ($sort_by eq "code") { 

		@dioceses = sort {$a->code cmp $b->code} @dioceses;
		@dioceses = sort {length($a->code) cmp length($b->code)} @dioceses;

	}

</%init>

	<div class="right small">

		<h3>Select a Diocese:</h3>

		<table cellpadding="6" cellspacing="1" width="100%">
			
			<tr class="liblrow">
			
				<td>
					<form action="dioceses.mhtml" method="post">
					Sort by:
				</td>
			

				<td>
					<select name="sort_by">
						<option value="code" <% ($sort_by eq "code") ? "selected" : "" %>>Codes</option>
						<option value="name" <% ($sort_by eq "name") ? "selected" : "" %>>Names</option>
					</select>
				</td>

			</tr>
			
			<tr>
				<td colspan="2" class="center"> 
					<select name="diocese_id" size="30">

%						foreach my $dio (@dioceses) { 
%								my $dcode = $dio->code;
%								foreach (length($dcode) .. 4) { 
%									$dcode .= "&nbsp;";
%								} 
								
							<option value="<% $dio->id %>" <% ($diocese_id == $dio->id) ? "selected" : ""%> >
								<% $dcode %> <% substr($dio->name,0,20) %>
							</option> 
% 						} 

					</select>
				</td>
			</tr> 
				
			<tr class="liblrow">
				<td colspan="2" align="center">
					<input  type="submit" value="  Show Diocese   " style="width: 150px;">
					</form>
				</td>
			</tr>

		</table>

	</div>

	<div class="left huge">

% 		if ($diocese_id) { 

% 			my $diocese = Tab::Region->retrieve($diocese_id);
%			my $switch;

			<h2>The <% $diocese->arch ? "Archdiocese" : "Diocese " %> of <% $diocese->name %> (<% $diocese->code %>)</h2>

			<table cellpadding="5" cellspacing="1" width="100%" style="padding-top: 1px;"> 
			
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Director:
						<% $diocese->director->first." ".$diocese->director->last %>
					</td> 
					
					<td align="right">
						<form action="director.mhtml" method="post">
						<input type="hidden" name="director" value="<% $diocese->director->id %>">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="    Contact Info    " style="margin-left: 15px; width: 150px;">
						</form>
					</td>
				</tr> 
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
				
					<td>
						<% scalar $diocese->chapters %> schools
					</td>
					
					<td align="right">
						<form action="schools.mhtml" method="post">
						<input type="hidden" name="diocese" value="<% $diocese->id %>">
						<input  type="submit" value="    View Schools   " style="width: 150px;">
						</form>
					</td>
				</tr> 
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
				
					<td>
						<% scalar $diocese->entries($tourn) %> entries
					</td>
					
					<td align="right">
						<form action="entry.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="   View Students   " style="width: 150px;">
						</form>
					</td>

				</tr> 
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<% scalar $diocese->judges($tourn) %> judges
					</td>
					
					<td align="right">
						<form action="judges.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="    View Judges     " style="width: 150px;">
						</form>
					</td>
				</tr> 
				
				<tr>
					<td colspan="3">
						<h3>Money Matters:</h3>
					</td>
				</tr> 
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 

					<td>
						View/Adjust Invoice
					</td>
					
					<td align="right">
						<form action="invoice.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="Adjust Invoice" style="width: 150px;">
						</form>
					</td>
				</tr> 
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
				
					<td>
						Print Invoice/Receipt
					</td>
					
					<td align="right">
						<form action="invoice_print.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="    Print Invoice   " style="width: 150px;">
						</form>
					</td> 

				</tr>
					
				<tr>
					<td colspan="3">
						<h3>Printouts:</h3>
					</td>
				</tr>
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
				
					<td>
						Print Registration
					</td>
					
					<td align="right">
						<form action="entry_print.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input type="hidden" name="codes" value="booyah">
						<input  type="submit" value="  Registration List  " style="width: 150px;">
						</form>
					</td>
					
				</tr> 
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Print Judge List
					</td>
					
					<td align="right">
						<form action="judge_print.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="      Judge List       " style="width: 150px;">
						</form>
					</td>
					
				</tr> 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Print Entry List
					</td>
					
					<td align="right">
						<form action="entries_print.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="     Student List     " style="width: 150px;">
						</form>
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Judge Cards
					</td>

					<td align="right">
						<form action="judge_cards.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="     Judge Cards     " style="width: 150px;">
						</form>
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
					
					<td>
						Student Cards
					</td>
					
					<td align="right">
						<form action="entry_cards.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input  type="submit" value="    Student Cards   " style="width: 150px;">
						</form>
					</td>

				</tr>

			</table>
%		} 

	</div>


