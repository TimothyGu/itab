<%args> 
	$tourn
	$diocese_id
</%args> 
<%init> 

	my $diocese = Tab::Region->retrieve($diocese_id);
	
	my @comps = $diocese->comps($tourn);
	@comps = sort {$a->student->last cmp $b->student->last} @comps;
	@comps = sort {$a->event->abbr cmp $b->event->abbr} @comps;

	my %event_comps = ();

	foreach my $comp (@comps) { 
		push (@{$event_comps{$comp->event->id}}, $comp);
	} 

</%init> 

<div class="left huge">

	<table cellpadding="0" width="100%">

		<tr>
			<td width="100%">
				<h2>Entry for <% $diocese->name %> (Q<% $diocese->quota %>)</h2>
			</td>

			<td>
				<form action="dioceses.mhtml" method="post">
				<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
				<input class="blue" type="submit" value="Return to <% $diocese->name %>">
				</form>
			</td>

		</tr>
		
	</table> 
	
	<table cellpadding="4" cellspacing="1" width="100%"> 
	

%		my $switch;

% 		foreach my $event (sort {$a->name cmp $b->name} $tourn->events) { 

			<tr>
				<td colspan="5">
					<h3><% $event->name %></h3>
				</td>
			</tr>

% 			foreach my $comp (@{$event_comps{$event->id}}) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						<% $comp->code %> <% $comp->dropped ? "DROP" : "" %>
					</td> 
					
%					if ($comp->event->team == 1) { 

						<td colspan="2" class="smaller">
							<% $comp->student->first." ".$comp->student->last %>
						</td>

%					} else {

						<td class="smaller">
							<% $comp->student->first." ".$comp->student->last %>
						</td>
						
						<td class="smaller">
							<% $comp->partner->first." ".$comp->partner->last %>
						</td>

% 					} 

					<td class="smaller">
						<% $comp->school->chapter->name %>
					</td>
	
					<th>
						(<A href="<% $Tab::url_prefix %>/register/comp_edit.mhtml?comp_id=<%$comp->id %>">Edit</a>)
					</td>

				</tr>

% 			} 

%  			if ($diocese->quota > scalar @{$event_comps{$event->id}}) { 

				<tr class="liblrow">
					<td colspan="5" class="right">
						<form action="entry_edit.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input type="hidden" name="event_id" value="<% $event->id %>">
						<input type="submit" class="blue" value="  Add New Entry  "> 
						</form>
					</td>
				</tr>
% 			}

% 		}

	</table>

</div>


<& sidebar.mas, tourn => $tourn, diocese => $diocese &>

