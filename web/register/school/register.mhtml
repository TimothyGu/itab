<%args>
	$school_id
	$fees => undef
	$tourn
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id); 

	my $register = 0;
	$register++ if $school->registered < 1;

	my $now = DateTime->now();
	$now->set_time_zone($tourn->tz);

	$school->registered($register);
	$school->registered_on($now) if $register;

	if ($fees eq "full") { 
		my ($fee, $feline_ref) = $m->comp("/funclib/school_fees.mas", school_id => $school_id);
		$school->paid($fee);
	}

	$school->update;

	my $msg = $school->name." has been marked as registered ";
	$msg .= "and paid in full " if $fees eq "full";

	$m->redirect("/register/school/edit.mhtml?school_id=$school_id&msg=$msg");

</%init>

