<%args> 
	$tourn
	$school_id => undef
	$event_id => undef
	$account
</%args>

<%init>
	use POSIX;

	my $chapter;
	my $school;

	$school = Tab::School->retrieve($school_id);

	my $region = $m->comp('/funclib/school_region.mas', school => $school ) if $tourn->setting("regions");

	my @events;

	if ($event_id) { 

		$events[0] = Tab::Event->retrieve($event_id);

	} else { 

		@events = $m->comp("/funclib/tourn_events.mas", tourn => $tourn);
	}

	my @groups = sort {$a->name cmp $b->name} $tourn->groups;

 	my $switch;

	my %count_by_event = ();

</%init>

	<& /register/menubar.mas, school => $school, whoami => "students", tourn => $tourn &>

		<table cellpadding="2" border="0" width="100%" cellspacing="1">

% 			foreach my $event (@events) { 

% 				my @entries = Tab::Entry->search( event => $event->id, school => $school->id );
%				$count_by_event{$event->id} = scalar @entries;

%				next unless @entries;

				<tr>
					<th colspan="5">
						<h4><% $event->name %></h4>
					</td>
				</tr>

				<tr class="yellowrow">

					<th class="smaller">
						Code
					</th>

					<th class="smaller">
						Name
					</th>

					<th class="smaller">
						Registered
					</th>

					<th class="smaller">
						Dropped
					</th>

					<th class="smaller">
					</th>
				</tr>

% 				foreach my $entry (@entries) { 
				
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td class="smaller">
							<% ($entry->dropped) ? "DROP" : $entry->code %> 
							<% ($entry->waitlist) ? "Waitlist" : "" %>
							<% ($entry->dq) ? "DQ" : "" %>
						</td>
		
						<td <% ($entry->dropped) ? "class=\"strike\"" : "" %> >
							<a class="white block" href="/register/entry/edit.mhtml?entry_id=<% $entry->id %>">
							<% $m->comp("/funclib/entry_name.mas", entry => $entry) %>
							</a>
						</td>

%						if ($tourn->setting("ask_quals")) { 
							<td>
%								my $notfirst;
%								foreach my $qual ($entry->qualifiers) { 
									<% ($notfirst) ? "<br />" : "" %>
									<% $qual->name %> 
									<% ($qual->result) ? "(".$qual->result.")" : "" %> 
%									$notfirst++;
%								}
							</td>
%						}

						<td class="centeralign smaller">
							<% Tab::niceshortdt($entry->reg_time) %>
						</td>

						<td class="centeralign smaller">
							<% ($entry->dropped) ? Tab::niceshortdt($entry->drop_time) : "" %>
						</td>


						<td class="centeralign">
							<a class="<% ($entry->dropped) ? "dkred" : "dkgreen" %> block" href="drop_switch.mhtml?entry_id=<% $entry->id %>">	
								<% ($entry->dropped) ? "Un-Drop" : "Drop" %>
							</a>
						</td>

					</tr>
%   			}

% 			}

		</table>

	</div>

	<& entry_menu.mas, tourn => $tourn, school => $school &>


