<%args> 
	$tourn
	$circuit
	$session
</%args>


<table width="100%">
	<tr>
		<td width="100%">
			<h3>Kids multiple-entered at <% $tourn->name %></h3>
		</td>

		<td>
			<form action="double_entry_print.mhtml" method="post">
			<input type="submit" value="  Print Report ">
			</form>
		</td>
	</tr>
</table>



<table cellpadding="5" cellspacing="0" width="100%">

<%perl>

	SCHOOL:
	foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) { 

	my %student_entries = ();


	foreach my $comp ($school->entries) { 

		next if $comp->dropped;

		if ($comp->event->team == 3) { 

			foreach my $member ($comp->members) { 
				push (@{$student_entries{$member->id}}, $comp);
			}

		} else { 

			push (@{$student_entries{$comp->student->id}}, $comp);
			push (@{$student_entries{$comp->partner->id}}, $comp) if $comp->event->team == 2 && $comp->partner;

		}

	}

	my $switch;

</%perl>


%	my $first;

%	foreach my $student_id (keys %student_entries) { 

%		next unless (scalar @{$student_entries{$student_id}} > 1);

%		unless ($first) { 

			<tr><td colspan="8"><h4><% $school->chapter->name %></h4></td></tr>
%			$first++;

%		}


%		my $student = Tab::Student->retrieve($student_id);

	<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

		<td><% $student->first %>
		<% $student->last  %></td>

%		foreach my $comp (sort {$a->code <=> $b->code} @{$student_entries{$student_id}}) { 
			<td><% $comp->event->abbr %> <% $comp->code %></td>
%		}
	
%	}


%}

</table>

