<%args>
	$account
	$school_id
	$group_id
	$hired_number => undef
	$accepted => undef
	$certain => undef
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id);

	my $tourn_id = $school->tournament->id;

	my $group = Tab::JudgeGroup->retrieve($group_id);

	my $request = $school->requests_by_group($group);

	$hired_number = $hired_number * $group->judge_per 
		if ($group->judge_per && $group->hired_fee);

	$accepted = $accepted * $group->judge_per 
		if ($group->judge_per && $group->hired_fee);

	my $now = DateTime->now();

	if ($request) {
	
		$request->covers($hired_number);
		$request->accepted($accepted);
		$request->update;
		$request->delete if $hired_number < 1;

	} else { 

		$request = Tab::JudgeHire->create({
			tournament => $school->tournament,
			school => 	$school->id,
			judge_group => $group->id,
			request_made => $now,
			covers => $hired_number,
			accepted => $accepted
		});

	}

	$m->redirect("$Tab::url_prefix/register/school_hires.mhtml?school_id=$school_id");

</%init>

