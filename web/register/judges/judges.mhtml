<%args>
	$account
	$tourn
	$err => undef
	$circuit
</%args>
<%init>

	use POSIX;

	my $switch;

	my @groups = $tourn->groups;

	my $hires = 1 if Tab::JudgeGroup->search( tournament => $tourn->id, track_judge_hires => 1);

</%init>

	<& sidebar.mas, tourn => $tourn &>

	<div class="left huge">

	<h2>Judges</h2>

		<table cellpadding="6" width="100%" cellspacing="1" border="0">

			<tr class="liblrow">

				<th>
				</th>

				<th class="smaller">
					Judges
				</th>

%				if ($hires) {

					<th class="smaller">
						Hires
					</th>

					<th class="smaller">
						Total
					</th>

%				}

				<th class="smaller">
					Entries
				</th>

				<th colspan="2">
				</th>

			</tr>


%			foreach my $group (@groups) { 

%				my $kids = scalar $group->entries;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						<% $group->abbr %>
					</th>
	
					<td align="center">
						<% scalar Tab::Judge->search(judge_group => $group->id, spare_pool => 0 ) %>
					</td>

%					if ($hires) {
						<td align="center">
							<% scalar Tab::Judge->search(judge_group => $group->id, spare_pool => 1)%>
						</td>

						<td align="center">
							<% scalar Tab::Judge->search(judge_group => $group->id)%>
						</td>

%					}

					<td align="center">
						<% $kids %>
					</td>

					<td align="center">
						<a class="white block" href="/register/judge/roster.mhtml?group_id=<% $group->id %>">
							Roster
						</a>
					</td>

					<td align="center">
						<a class="white block" href="/register/judge/csv.mhtml?group_id=<% $group->id %>">
							CSV
						</a>
					</td>

				</tr>
	
%			} 

		</table>

%		if ($hires) { 

			<h3>Hired Judging Requests</h3>

			<table cellpadding="5" cellspacing="1" width="100%">

				<tr class="liblrow">

					<th class="smaller">
					</th>

					<th class="smaller">
						Asked
					</th>

					<th class="smaller">
						Accepted
					</th>

					<th colspan="2">

					</th>

				</tr>


%				foreach my $group (@groups) { 

<%perl>
					my $hires_requested;
					my $hires_accepted;

					foreach my $request ($group->hires) { 
						$hires_requested += $request->covers;
						$hires_accepted += $request->accepted;
					}

					$hires_requested = $hires_requested / $group->setting("judge_per") if $group->setting("judge_per");
					$hires_accepted = $hires_accepted / $group->setting("judge_per") if $group->setting("judge_per");

					$hires_requested = ceil($hires_requested);
					$hires_accepted = ceil($hires_accepted);
</%perl>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<th>
							<% $group->abbr %>
						</td>

						<td align="center">
							<% $hires_requested %>
						</td>

						<td align="center">
							<% $hires_accepted %>
						</td>

						<td align="center">
							<a class="white block" href="hires.mhtml?group_id=<% $group->id %>">
								Hires
							</a>
						</td>

						<td align="center">

%							if ($group->track_judge_hires) { 
								<a class="white block" href="hire_requests.mhtml?group_id=<% $group->id %>">
									Requests
								</a>
	
%							} else { 
								No Hires
%							}

						</td>

					</tr>

%				}	

			</table>
%		}

	</div>

	<br style="clear: both;">
