<%args>
	$tourn
	$comp_id
	$event_id
	$certain => undef
	$err => undef
	$account
</%args>
<%init>

my $comp = Tab::Comp->retrieve($comp_id);
my $event = Tab::Event->retrieve($event_id);

if ($certain eq "I am certain") { 

	# First, clear out any existing ballots
	foreach my $ballot ($comp->ballots) {
		$ballot->delete();
	}

	# Change the event
	$comp->event($event_id);

	# Change the speaker code
	my $new_code = $event->code;
	while (defined $tourn->comp_with_code($new_code)) { $new_code++; }
	$comp->code($new_code);

	# Save the changes
	$comp->update;
		
	my $err = "Competitor event changed to ".$comp->event->name.".  Speaker Code is now $new_code.";
	$m->redirect("$Tab::url_prefix/register/entry/edit.mhtml?err=$err&comp_id=$comp_id");

}
		
</%init>

%	 if ($comp->event->team != $event->team) {

%		$m->print("<p class=\"err\">What are you trying to pull here?  You can't move an entry with a different number of kids than the event you are trying to move into.  Teamwork is great and all, but a policy team cannot compete in LD.  Drop the initial entry and re-add the kid you want into the new event</p>");
%		$m->abort;

%	}

<p><font color="red"><% $err %></font></p>
<center>

<&  "/funclib/warning.mas", account => $account &>

<h4></h4>

<p style="width : 550px; padding-top: 15px;">

You are about to change speaker <% $comp->code %>'s event from <% $comp->event->name
%> to <% $event->name %>.  If you do this, the competitor's speaker code will
change, any and all panel assignments and ballots/scores will be deleted
forever.  

</p>

<br><br>

<table width="50%" cellpadding="5" style="border: 1px dotted black;">

<tr>
	<td colspan="2" align="center">
	<form action="event_change.mhtml" method="post">
	<input type="hidden" name="comp_id" value="<% $comp_id %>">
	<input type="hidden" name="event_id" value="<% $event_id %>">
	Type "I am certain" in the box to continue:
	</td>
</tr>

<tr>
	<td>
		<input type="text" name="certain" size="30">
		</form>
	</td>

	<td>
		<input  type="submit" value=" Switch event ">
	</td>

</tr>

</table>

</center>



