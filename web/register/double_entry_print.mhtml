<%args>
	$session
	$tourn
	$circuit
</%args>
<%perl>

	my $filename = $Tab::file_root."/tmp/double-entries-".$tourn->id."-".$session->id;
	my $garbage = `rm -f $filename.*`;
	
	open (TEXOUT, ">$filename.tex");




print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{helvet}
\\usepackage{colortbl}
\\usepackage[hmargin=1in,vmargin=1in]{geometry}
\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.3}
\\addtolength{\\textwidth}{1in}
\\addtolength{\\hoffset}{-.1in}
\\begin{document}
EOF

	print TEXOUT "{\\LARGE ". &Tab::texify($tourn->name)." double entered contestants} \\\\ \n";
	print TEXOUT "\\normalsize\n";

	print TEXOUT "\\begin{tabular}{p{.5in}p{1.5in}p{.75in}p{.75in}p{.75in}p{.75in}}\n";

	print TEXOUT "Schcode & ";
	print TEXOUT "Name & ";
	print TEXOUT "Entries & & & \\\\ \n";
	print TEXOUT "\\hline \n";
	print TEXOUT "\\end{tabular}\n\\\\ \n";


	my $switch; 

	foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) { 
	
		my %student_entries = ();

		foreach my $entry (sort {$a->code <=> $b->code} $school->entries) { 

			next if $entry->dropped;
			next if $entry->waitlist;

			foreach my $member ($entry->members) { 
				push (@{$student_entries{$member->id}}, $entry);
			}
		}

		foreach my $student_id (keys %student_entries) { 

			next unless (scalar @{$student_entries{$student_id}} > 1);

			print TEXOUT "\\begin{tabular}{p{.5in}p{1.5in}p{.75in}p{.75in}p{.75in}p{.75in}}\n";
			print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch % 2);

			print TEXOUT ${$student_entries{$student_id}}[0]->school->code. " & ";
	
			my $student = Tab::Student->retrieve($student_id);

			print TEXOUT $student->first." ".$student->last;

			my $entry_count;

			foreach my $entry (sort {$a->code <=> $b->code} @{$student_entries{$student_id}}) { 

				if ($entry_count > 2) {
					print TEXOUT "\\\\ \n \\end{tabular}\n";
					print TEXOUT "\\begin{tabular}{p{.5in}p{1.5in}p{.75in}p{.75in}p{.75in}p{.75in}}\n";
					print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch % 2);
					print TEXOUT " & \n";
					$entry_count = 0;
				}
		
				print TEXOUT " & ".$entry->event->abbr." ".$entry->code;
				$entry_count++;
			}

			foreach ($entry_count .. 3){   print TEXOUT " & "; } 
			$switch++;
			print TEXOUT "\\\\ \n \\end{tabular}\n \\newline";
		}	
	}

	print TEXOUT "\\end{document}\n";
	close TEXOUT;

	$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

	`rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;

	$m->redirect("$Tab::url_prefix/tmp/double-entries-".$tourn->id."-".$session->id.".pdf");

</%perl>

<div id="content">

<p><% $filename %></p>

