<%args>
	$tourn
	$err => undef
</%args>
<%init>

	use POSIX;
	my @events = $m->comp("/funclib/tourn_events.mas", tourn => $tourn);
	@events = sort {$a->name cmp $b->name} @events;

	my $total_max;
	my $total_min;
	my $total_entries;

	my $class = "stats";

</%init>

	<div class="right small">

		<a class="blue block" href="room_needs_print.mhtml">
			Print Room Needs
		</a>

	    <& "reports_menu.mas", class => $class, circuit => $tourn->circuit, nodiv => "true" &>

	</div>

	<div class="left huge">
				
		<h2>Rooms needed for <% $tourn->name %></h2>

		<table cellpadding="5" cellspacing="1" width="100%" border="0">
	
			<tr class="liblrow">

			<th class="smaller">
				Event
			</th>

			<th class="smaller">
				Entries
			</th>
			
			<th class="smaller">
				Minimum
			</th>

			<th class="smaller">
				Maximum
			</th>

			<th class="smaller">
				Panels
			</th> 
			
		</tr>

<%perl> 

		my $switch;

		foreach my $event (@events) { 

 			my $num_entries  = $event->count_active_entries;
 			my $waitlisted = $event->count_waitlist_entries;
</%perl>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th> 
					<a href="<%$Tab::url_prefix%>/register/event_listing.mhtml?event_id=<% $event->id %>"> 
						<% $event->name %>
					</a>
				</th>
				
				<td class="rightalign">
					<% $num_entries %>
				</td>

<%perl>

				my $max_panel_number;
				my $min_panel_number;

				if ($event->type eq "speech" &&  $tourn->method->min_panel_size &&  $tourn->method->max_panel_size) { 
    				$max_panel_number = ceil($event->count / $tourn->method->min_panel_size);
    				$min_panel_number = ceil($event->count / $tourn->method->max_panel_size);
				}

				if ($event->type eq "congress" &&  $tourn->method->min_chamber_size &&  $tourn->method->max_chamber_size) { 
    				$max_panel_number = ceil($event->count / $tourn->method->min_chamber_size);
    				$min_panel_number = ceil($event->count / $tourn->method->max_chamber_size);
				} 
				
				if ($event->type eq "debate") { 

					#Unflighted
					$max_panel_number = floor($event->count / 2);
					
					#Flighted
					$min_panel_number = ceil($max_panel_number /2); 
					
				} 
				
				$total_max += $max_panel_number;
				$total_min += $min_panel_number;
				$total_entries += scalar $event->entries;

</%perl>

				<td class="rightalign">
					<% $min_panel_number %>
				</td>
				
				<td class="rightalign">
					<% $max_panel_number %>
				</td>

%				my @rounds = $event->rounds;
%				my $round = shift @rounds if @rounds;

				<td class="rightalign">
					<% ($round) ? scalar $round->panels : "" %>
				</td> 
				
			</tr>

% 		} 

			<tr class="lirdrow">
		
				<th>
					TOTALS:
				</th>
			
				<th class="rightalign">
					<% $total_entries %>
				</td>

				<th class="rightalign">
					<% $total_min %>
				</td>
			
				<th class="rightalign">
					<% $total_max %>
				</td>
	
				<td></td>
	
			</tr>

		</table>


	</div>


