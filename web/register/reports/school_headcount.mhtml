<%args>
	$tourn
	$err => undef
	$sort_by => "name"
</%args>
<%init>

	my @schools = sort {$a->name cmp $b->name} $tourn->schools;

	my $switch;

</%init>

	<& "reports_menu.mas", tourn => $tourn, whoami => "school_headcount" &>

	<div class="left huge">

		<h2>Headcounts for each school</h2>

		<table cellpadding="3" cellspacing="1" width="100%">

			<tr class="yellowrow">
				
				<th class="smaller">
					School	
				</th>

				<th class="smaller">
					Locale
				</th>

				<th class="smaller">
					Judges
				</th>

				<th class="smaller">
					Entered
				</th>

				<th class="smaller">
					Total
				</th>

			</tr>

%			my $total_judge;
%			my $total_student;

%			foreach my $school (@schools) { 

%				my @students = $m->comp("/funclib/school_students.mas", school => $school);
%				my @judges = $school->judges;

%				$total_judge += scalar @judges;
%				$total_student += scalar @students;

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			
					<td>
						<a class="white block" href="/register/school/edit.mhtml?school_id=<% $school->id %>">
							<% $school->name %>
						</a>
					</td> 
					
					<td>
						<% $school->chapter->country %><% ($school->chapter->state) ? "/".$school->chapter->state : ""%>
					</td>

					<td class="rightalign">
						<% scalar (@judges) %>
					</td>

					<td class="rightalign">
						<% scalar (@students) %>
					</td>
			
					<td class="rightalign">
						<% scalar @students + scalar @judges %>
					</td>

				</tr>

%			}

			<tr class="liblrow">

				<th colspan="2">
					<a class="white block">
					Total
					</a>
				</th>

				<th class="rightalign">
					<% $total_judge %>
				</th>

				<th class="rightalign">
					<% $total_student %>
				</th>

				<th class="rightalign">
					<% $total_judge + $total_student %>
				</th>

			</tr>

		</table>

	</div>

