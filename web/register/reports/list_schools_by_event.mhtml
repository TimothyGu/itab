<%args>
	$circuit
	$tourn
	$err => undef
	$sort_by => "name"
	$event_id => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id) if $event_id;

	my @schools;

	if ($event) { 

		@schools = sort {$a->name cmp $b->name} $event->schools;

		if ($sort_by eq "state") { 
			@schools = sort {$a->chapter->state cmp $b->chapter->state} @schools;
		}

		if ($sort_by eq "id") { 
			@schools = sort {$a->id <=> $b->id} @schools;
		}

		if ($sort_by eq "code") { 
			@schools = sort {$a->code cmp $b->code} @schools;
			@schools = sort {length($a->code) cmp length($b->code)} @schools;
		}

		if ($sort_by eq "diocode") { 
			@schools = sort {$a->region->code cmp $b->region->code} @schools;
			@schools = sort {length($a->region->code) cmp length($b->region->code)} @schools;
		}

		if ($sort_by eq "dioname") { 
			@schools = sort {$a->region->name cmp $b->region->name} @schools;
		}

	}

</%init>

%		if ($event) { 

			<h2>
				<% scalar @schools %> Schools registered for <% $event->name %>
			</h2>

			<div class="left huge">

%			my $switch;

			<table cellpadding="5" cellspacing="1" width="100%"> 
			
%				foreach my $school (@schools) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<% $school->name %>
						</td>

						<td>
							<% $school->code %>
						</td>

						<td>
							<% $school->chapter->state %>
						</td>
						
					</tr>

%				}

			</table>

%		} else { 

			<div class="left huge">
				<h2> Choose an event at right</h2>
%		}

	</div>

	<div class="right small">

%		foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 

			<a class="blue block" href="list_schools_by_event.mhtml?event_id=<% $event->id %>">
				<% $event->name %>
			</a>

%		}

	</div>
