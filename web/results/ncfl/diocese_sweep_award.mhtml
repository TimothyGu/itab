<%args>
	$tourn
	$session
	$type => "see"
	$cooke => undef
</%args>
<%init>

	my @dioceses;
	my %sweeps_by_diocese = ();
	my $sweeps_points_ref;

	my @dios = $tourn->regions;

	my %dios_by_id = ();

	foreach my $dio (@dios) {
		$dios_by_id{$dio->id} = $dio;
	}

	if ($type eq "Print") { 

		$m->redirect("$Tab::url_prefix/results/ncfl/awards_diocesan_sweeps.mhtml");

	} elsif ($type eq "CSV") { 

		$m->redirect("$Tab::url_prefix/results/ncfl/csv_diocesan_sweeps.mhtml");

	} else { 

		($sweeps_points_ref, @dioceses) = $m->comp("/results/ncfl/diocese_sweeps.mas", tourn => $tourn, cooke => $cooke);

		%sweeps_by_diocese = %$sweeps_points_ref;

</%init> 

	<h2>Cardinal Wright Award</h2>

	<table width="100%" cellpadding="5" cellspacing="1">

		<tr class="liblrow"> 

			<th>
				Place
			</th>

			<th>
				Diocese
			</th>

			<th>
				Code
			</th>

			<th>
				Sweeps Points <% $tourn->start->year %>
			</th>

		</tr>

%		my $rank = 1;
%		my $switch;

%		foreach my $diocese (@dioceses) { 

%		   my $block = "whiteblock";

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th style="text-align: center;">
					<% $rank++ %>
				</th>
	
				<td>
					<a class="<% $block %>" href="/register/diocese/index.mhtml?diocese_id=<% $diocese->id %>"><% $diocese->name %></a>
				</td>

				<td align="center">
					<% $diocese->code %>
				</td>

				<th style="text-align: center;">
					<% $sweeps_by_diocese{$diocese->id} %>
				</th>

			</tr>
%		}

	</table>

%	@dioceses = sort { ($b->cooke_pts + $sweeps_by_diocese{$b->id})  <=>
%			 		   ($a->cooke_pts + $sweeps_by_diocese{$a->id}) } @dioceses;

	<h2>Cardinal Cooke Award</h2>

	<table width="100%" cellpadding="5" cellspacing="1">

		<tr class="lirdrow"> 

			<th>
				Place
			</th>

			<th>
				Diocese
			</th>

			<th>
				Code
			</th>

			<th>
				Existing Points
			</th>

			<th>
				Cumulative Sweeps Points
			</th>

		</tr>

%		$rank = 1;
%		$switch = 0;

%		foreach my $diocese (@dioceses) { 

%		   my $block = "whiteblock";

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th style="text-align: center;">
					<% $rank++ %>
				</th>
	
				<td>
					<a class="<% $block %>" href="/register/diocese/index.mhtml?diocese_id=<% $diocese->id %>"><% $diocese->name %></a>
				</td>

				<td align="center">
					<% $diocese->code %>
				</td>

				<th style="text-align: center;">
					<% $diocese->cooke_pts %>
				</th>

				<th style="text-align: center;">
					<% $diocese->cooke_pts + $sweeps_by_diocese{$diocese->id} %>
				</th>

			</tr>

%		}

		</table>

%	}
