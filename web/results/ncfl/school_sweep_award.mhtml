<%args>
	$tourn
	$session
	$view
	$type => "see"
	$extemp => undef
	$oratory => undef
</%args>
<%init>

	my @schools;
	my %sweeps_by_school = ();
	my $sweeps_points_ref;

	my @dios = $tourn->regions;

	my %dios_by_id = ();

	foreach my $dio (@dios) {
		$dios_by_id{$dio->id} = $dio;
	}

	if ($type eq "Print") { 

		$m->redirect("$Tab::url_prefix/results/ncfl/awards_speech_sweeps.mhtml") if $view eq "speech";
		$m->redirect("$Tab::url_prefix/results/ncfl/awards_debate_sweeps.mhtml") if $view eq "debate";
		$m->redirect("$Tab::url_prefix/results/ncfl/awards_combined_sweeps.mhtml?extemp=$extemp&oratory=$oratory") if $view eq "overall";

	} elsif ($type eq "CSV") { 

		$m->redirect("$Tab::url_prefix/results/ncfl/csv_speech_sweeps.mhtml") if $view eq "speech";
		$m->redirect("$Tab::url_prefix/results/ncfl/csv_debate_sweeps.mhtml") if $view eq "debate";
		$m->redirect("$Tab::url_prefix/results/ncfl/csv_combined_sweeps.mhtml?extemp=$extemp&oratory=$oratory") if $view eq "overall";

	} else { 

		($sweeps_points_ref, @schools) 
			= $m->comp("/results/ncfl/speech_sweeps.mas", tourn => $tourn) if $view eq "speech";

		($sweeps_points_ref, @schools) 
			= $m->comp("/results/ncfl/debate_sweeps.mas", tourn => $tourn) if $view eq "debate";
 
		($sweeps_points_ref, @schools) 
			= $m->comp("/results/ncfl/combined_sweeps.mas", tourn => $tourn, extemp => $extemp, oratory => $oratory) if $view eq "overall";

		%sweeps_by_school = %$sweeps_points_ref;

</%init> 

	<h2><% ucfirst($view) %> Sweepstakes</h2>

	<center>

	<table width="75%" cellpadding="5" cellspacing="1">

		<tr class="lirdrow"> 
			<th>Place</th>
			<th>School</th>
			<th colspan="2">Diocese</th>
			<th>Points</th>
		</tr>

%		my $rank = 1;
%		my $switch;

%		foreach my $school (@schools) { 

%			last if $rank == 50;

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th style="text-align: center;">
					<% $rank++ %>
				</th>
	
				<td>
					<a class="white block" href="/register/registration.mhtml?school_id=<% $school->id %>"><% $school->name %></a>
				</td>

				<td>
					<% $dios_by_id{$school->region->id}->name %>
				</td>

				<td>
					<% $dios_by_id{$school->region->id}->code %>
				</td>

				<th style="text-align: center;">
					<% $sweeps_by_school{$school->id} %>
				</th>
			</tr>
%		}

	</table>


%	}
