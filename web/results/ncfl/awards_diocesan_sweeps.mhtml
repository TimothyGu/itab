<%args>
	$tourn
	$session
</%args>
<%init>

	my @dioceses;
	my %sweeps_by_diocese = ();
	my $sweeps_points_ref;

	($sweeps_points_ref, @dioceses) 
		= $m->comp("/results/ncfl/diocese_sweeps.mas", tourn => $tourn);

	%sweeps_by_diocese = %$sweeps_points_ref;

    my $filename = "DiocesanSweeps-".$tourn->id."-".$session->id;
    my $filepath = $Tab::file_root."/tmp/".$filename;
	my $garbage = `rm -f $filepath.*`;

	open (TEXOUT, ">$filepath.tex");

print TEXOUT <<"EOF";
	\\documentclass[11pt]{report}
	\\usepackage{fullpage}
	\\usepackage{colortbl}
	\\usepackage{helvet}
	\\usepackage{nopageno}
	\\renewcommand{\\familydefault}{\\sfdefault}
	\\renewcommand{\\arraystretch}{1.7}
	\\begin{document}

	\\setlength{\\oddsidemargin}{-.5in}     
	\\setlength{\\textwidth}{6.5in}        

	\\setlength{\\textheight}{9in}       
	\\setlength{\\topmargin}{-.25in}      
	\\setlength{\\headsep}{0in}         

	\\setlength{\\parskip}{1.4ex}
	\\setlength{\\parindent}{0mm}

	\\begin{center}
	\\normalsize
EOF

	print TEXOUT "\\bigskip \n";
	print TEXOUT "\\Large The Cardinal Wright Memorial Diocesan Award \\\\ \n";
	print TEXOUT "\\bigskip \n";
	print TEXOUT "\\large ".$tourn->name."\\\\ \n";
	print TEXOUT "\\bigskip \n";
	print TEXOUT "\\normalsize\n";

	my $switch;
	print TEXOUT "\\bigskip \n";
	print TEXOUT "\\begin{tabular}{p{.5in}p{3.5in}p{1.5in}}\n";

	foreach my $diocese (@dioceses) { 
		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n"  if ($switch++ % 2);
		print TEXOUT $switch." & ";
		print TEXOUT "The Diocese of " unless $diocese->arch;
		print TEXOUT "The Archdiocese of " if $diocese->arch;
		print TEXOUT $diocese->name." & ";
		print TEXOUT $sweeps_by_diocese{$diocese->id}." pts \\\\ \n";
		last if $switch == 10;
	}

	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\newline\n";

	@dioceses = sort { 	($b->cooke_pts + $sweeps_by_diocese{$b->id})  <=>
						($a->cooke_pts + $sweeps_by_diocese{$a->id}) } @dioceses;


	print TEXOUT "\\bigskip \n";
	print TEXOUT "\\Large The Cardinal Cooke Memorial Diocesan Award \\\\ \n";
	print TEXOUT "\\bigskip \n";
	print TEXOUT "\\large ".$tourn->name."\\\\ \n";
	print TEXOUT "\\bigskip \n";
	print TEXOUT "\\normalsize\n";

	undef $switch;
	print TEXOUT "\\begin{tabular}{p{.5in}p{3.5in}p{1.5in}}\n";

	foreach my $diocese (@dioceses) { 
		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n"  if ($switch++ % 2);
		print TEXOUT $switch." & ";
		print TEXOUT "The Diocese of " unless $diocese->arch;
		print TEXOUT "The Archdiocese of " if $diocese->arch;
		print TEXOUT $diocese->name." & ";
		print TEXOUT ($diocese->cooke_pts + $sweeps_by_diocese{$diocese->id})." pts \\\\ \n";
		last if $switch == 10;
	}

	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\end{center}\n";
	print TEXOUT "\\end{document}\n";

	close TEXOUT;

	$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filepath.tex; $Tab::dvipdfm_path $filepath.dvi`;
#	$garbage = `rm -f $filepath.tex $filepath.log $filepath.dvi $filepath.aux`;
	$m->redirect("$Tab::url_prefix/tmp/$filename.pdf");

</%init>
