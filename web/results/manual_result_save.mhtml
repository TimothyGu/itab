<%args>
	$tourn
	$code
	$results_bar => undef
	$bid => undef
	$rank => undef
</%args>
<%init>

	my @entries = Tab::Entry->search( code => $code, tournament => $tourn->id );

	my $entry = shift @entries if @entries;

	$m->print("<p>Error: competitor $code does not exist</p>");
	$m->abort unless $entry;

	if ( $entry->event->team == 2 || $entry->event->team == 1 ) { 
	
		my $student_result = Tab::StudentResult->create({
			student => $entry->student->id,
			entry => $entry->id,
			event => $entry->event->id,
			results_bar => $results_bar,
			bid => $bid,
			rank => $rank,
			tournament => $entry->tournament->id,
			chapter => $entry->school->chapter->id
		});
	}

	if ($entry->event->team == 2) { 
	
		my $student_result = Tab::StudentResult->create({
			student => $entry->partner->id,
			entry => $entry->id,
			event => $entry->event->id,
			results_bar => $results_bar,
			bid => $bid,
			rank => $rank,
			tournament => $entry->tournament->id,
			chapter => $entry->school->chapter->id
		});
	}

	if ($entry->event->team == 3) { 
	
		my $student_result = Tab::StudentResult->create({
			entry => $entry->id,
			event => $entry->event->id,
			results_bar => $results_bar,
			bid => $bid,
			rank => $rank,
			tournament => $entry->tournament->id,
			chapter => $entry->school->chapter->id
		});
	} 	

	my $err = "Results were added for $code";

	$m->redirect("$Tab::url_prefix/results/manual_result.mhtml?err=$err");

</%init>
