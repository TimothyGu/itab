<%args>
	$tourn
	$code
	$results_bar => undef
	$bid => undef
	$rank => undef
</%args>
<%init>

	my @comps = Tab::Comp->search( code => $code, tournament => $tourn->id );

	my $comp = shift @comps if @comps;

	$m->print("<p>Error: competitor $code does not exist</p>");
	$m->abort unless $comp;

	if ( $comp->event->team == 2 || $comp->event->team == 1 ) { 
	
		my $student_result = Tab::StudentResult->create({
			student => $comp->student->id,
			comp => $comp->id,
			event => $comp->event->id,
			results_bar => $results_bar,
			bid => $bid,
			rank => $rank,
			tournament => $comp->tournament->id,
			chapter => $comp->school->chapter->id
		});
	}

	if ($comp->event->team == 2) { 
	
		my $student_result = Tab::StudentResult->create({
			student => $comp->partner->id,
			comp => $comp->id,
			event => $comp->event->id,
			results_bar => $results_bar,
			bid => $bid,
			rank => $rank,
			tournament => $comp->tournament->id,
			chapter => $comp->school->chapter->id
		});
	}

	if ($comp->event->team == 3) { 
	
		my $student_result = Tab::StudentResult->create({
			comp => $comp->id,
			event => $comp->event->id,
			results_bar => $results_bar,
			bid => $bid,
			rank => $rank,
			tournament => $comp->tournament->id,
			chapter => $comp->school->chapter->id
		});
	} 	

	my $err = "Results were added for $code";

	$m->redirect("$Tab::url_prefix/results/manual_result.mhtml?err=$err");

</%init>
