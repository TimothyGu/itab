<%args> 
	$tourn
	$circuit
	$event_id => undef 
</%args> 
<%init> 
	my @events = sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn); 
	my $event = Tab::Event->retrieve($event_id);

</%init> 

	<h2>Re-enter an event's results: <% ($event) ? $event->name : "select event" %></h2>

	<table cellpadding="3" width="100%" cellspacing="1">

		<tr class="evenrow">

			<td>
	 			<form action="re_enter.mhtml" method="post">
				Event:
			</td>

			 <td>
				<select name="event_id">
				<option value="">Select one:</option>

%				foreach my $ev (@events) { 
					<option value="<% $ev->id %>" <% ($ev->id == $event_id) ? "selected" : "" %>>
						<% $ev->name %>
					</option>
% 				} 

				</select>	
			</td>

			 <td align="right">
				<input  type="submit" value="View">
				</form>
			</td>
		</tr>

	 </table>

% if ($event) { 

<h3><% $event->name %></h3>

% my @rounds = sort {$a->name <=> $b->name} $event->rounds;
% my @entries = sort {$a->code <=> $b->code} $event->entries(dropped => 0);
% my @ballots = $event->ballots;

%	my %ballots_by_round_entry = ();

%	foreach my $ballot (@ballots) { 
%		push (@{$ballots_by_round_entry{$ballot->panel->round->id."-".$ballot->entry->id}}, $ballot);
% }


<form action="re_enter_save.mhtml" method="post">
<input type="hidden" name="event_id" value="<% $event->id %>">

	<table width="100%" cellpadding="5">

	<tr>
		<th>
			Code
		</th>
		
		<th>
			Name
		</th>

%	foreach my $round (@rounds) { 
		<th>
			<% ($round->label) ? $round->label : $round->name %>
		</th>
% }
	
	</tr>

% my $switch;

% foreach my $entry (@entries) { 

	<tr <% ($switch++% 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		<td>
			<% $entry->code %>
		</td>

		<td class="smaller">
			<% $entry->team_name %>
		</td>

%	foreach my $round (@rounds) { 

		<td>

%		foreach my $ballot (@{$ballots_by_round_entry{$round->id."-".$entry->id}}) { 

			<% (scalar @{$ballots_by_round_entry{$round->id."-".$entry->id}} > 1) ? $ballot->judge->code : "" %> 
			<input type="text" size="3" maxlength="1" onKeyUp="return autoTab(this, 1, event);" name="rank_<% $ballot->id %>" value="<% ($ballot->real_rank > 0) ? $ballot->real_rank : "" %>">

			<input type="text" size="5" maxlength="3" onKeyUp="return autoTab(this, 2, event);" name="points_<% $ballot->id %>" value="<% ($ballot->real_points > 0) ? $ballot->real_points : "" %>">

			<br />

% 		}

% 	}

	</tr>

% }

	<tr class="liblrow">
		<td colspan="10" align="right"> 
			<input  type="submit" value="  Save  Manual Results ">
			</form>
		</td>
	</tr>

</table>

% }

