<%args>
	$account
	$circuit
	$logo => undef
</%args>
<%init>


	my @is_admin = Tab::CircuitAdmin->search( account => $account->id, circuit => $circuit->id );

	unless ($account->site_admin || @is_admin) { 
		$m->print("
			<h4>Error:</h4><p><b>Only site admins or circuit 
				officials may edit the website. </b></p>");
		$m->abort;
	}

    if ($logo) {
        my $req = Apache2::Request->new($r);
        my $upload = $req->upload("logo");
        my $filename  = $upload->filename;
        $filename =~ s/.*[\/\\](.*)/$1/;
        $filename =~ s/\ //g;
        $filename =~ s/\'//g;  # '  stupid vim
        my $filepath = "$Tab::file_root/files/".$circuit->id."/logo/";
        my $garbage = `rm -f $filepath`;
        $garbage = `mkdir -p $filepath`;
        my $filetemp = $upload->tempname;
        $garbage = `cp $filetemp $filepath/$filename`;
        $circuit->logo_file($filename);
        $circuit->update;
	}

	my $err = "Logo file uploaded";

	$m->redirect("$Tab::url_prefix/circuit/website.mhtml?err=$err");

</%init>

