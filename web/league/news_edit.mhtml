<%args> 
	$account
	$news_id => undef
	$link => undef
	$league
</%args>
<%init>

	my $news = Tab::News->retrieve($news_id) if $news_id;

	$link = $news->link if $news;
	$link = Tab::Link->retrieve($link) unless $news;

	my $switch;

</%init>


	<table width="100%">

		<tr>
			<td width="100%" valign="top">
				<h2><% ($news) ? $news->title : "Create New Article" %></h2>
			</td>

			<td>
				<form action="website.mhtml" method="get">
				<input class="grey" type="submit" value="Return to Website">
				</form>
			</td>
		</tr>

	</table>

	<table cellpadding="3" width="100%">

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

			<td>
				Category
			</td>

			<td>
				<% $link->name %>
			</td>

		</tr>


		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

			<td>
				Title:
			</td>

			<td>
				<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="attach" action="news_save.mhtml" method="post"> 
				<input type="hidden" name="news_id" value="<% $news_id %>">
				<input type="hidden" name="link" value="<% $link %>">
				<input type="text" name="title" value="<% ($news) ? $news->title : "" %>" size="46">
			</td>

		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

			<td>
				Put on Front Page
			</td>

			<td>
				<input type="checkbox" name="main_site" value="1" <% ($news) ? ($news->main_site == 1) ? "checked" : "" : "" %>>
			</td>

		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

			<td>
				Published Article:
			</td>

			<td>
				<input type="checkbox" name="active" value="1" <% ($news) ? ($news->active == 1) ? "checked" : "" : "checked" %>>
			</td>

		</tr>

		<tr>
			<td colspan="2">
				<h4>Article Text:</h4>
			</td>
		</tr>

		<tr>
			<td colspan="3" class="center">
				<textarea name="text" rows="15" cols="55"><% ($news) ? $news->text : "" %></textarea>
			</td>
		</tr>


% 		if ($news && $news->file) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Attached File:
				</td>

				<td class="right">
					(<a href="<% $Tab::url_prefix %>/files/<% $league->id %>/articles/<% $news->id %>/<% $news->file %>"><% $news->file %></a>)
				</td>

			</tr>
% 		}

		<tr>

			<th>
				Attach a file:
			</th>

			<td colspan="2" class="right">
				<input type="file" name="attach" size="20">
			</td>
		</tr>

		<tr class="liblrow">
			<td colspan="3" align="right">
				<input class="grey" type="submit" value="   Save and Publish Article  ">
				</form>
			</td>
		</tr>

%	if ($news) { 

		<tr>
			<td colspan="3">
				<h4>Article Information:</h4>
			</td>
		<tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

			<th>
				Posted by:
			</th>

			<td>
				<% ($news) ? $news->author->first." ".$news->author->last : $account->first." ".$account->last %>
			</td>

		</tr>

		<tr>

			<th>
				Posted on:
			</th>

			<td>
				<% Tab::nicedt($news->posted->set_time_zone($league->timezone)) %>
			</td>

		</tr>

% 		if ($news && $news->edited_by && $news->edited_by->id != $news->author->id) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<th>
					Last edited by:
				</th>

				<td>
					<% $news->edited_by->first." ".$news->edited_by->last%>
				</td>

			</tr>

			<tr>
	
				<th>
					Last edited on:
				</th>

				<td>
					<% ($news->edited_on) ? Tab::nicedt($news->edited_on->set_time_zone($league->timezone)) : Tab::nicedt($news->posted) %>
				</td>

			</tr>

% 		}



		<tr class="lirdrow">

			<td colspan="3" align="right">
				<form action="news_rm.mhtml" method="post"> 
				<input type="hidden" name="news_id" value="<% $news->id %>">
				<input class="blue" type="submit" value="Delete News Article">
				</form>
			</td>

		</tr>

% 	}

	</table>
