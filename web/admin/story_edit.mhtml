<%args> 
	$account
	$story_id => undef
	$err => undef
</%args>
<%init>

	my $switch;

	my $story = Tab::News->retrieve($story_id) if $story_id;

	my $now = DateTime->now;

	my $posted = $story->posted if $story;

</%init>

	<div id="leftbig">

		<h2><% ($story) ? "Edit ".$story->title : "Create New Article" %></h2>

		<table width="100%" cellpadding="8" cellspacing="1">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th class="oddrow">
					Title:
				</th>
			
				<td>
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="attach" action="story_save.mhtml" method="post"> 
					<input type="hidden" name="story_id" value="<% $story_id %>">
					<input type="text" name="title" value="<% ($story) ? $story->title : "" %>" size="41">
				</td>
	
			</tr>

			 <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
				<th>
					Posted By:
				</th>

				<td>
					<% ($story) ? $story->author->first." ".$story->author->last : $account->first." ".$account->last %>
				</td>
			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
				<th>
					Posted On:
				</th>
	
				<td>
					<% ($story) ? Tab::nicedate($story->posted) : Tab::nicedate($now) %>
				</td>
	
			</tr>

%	 		if ($story && $story->edited_by->id > 0 && $story->edited_by->id != $story->author->id) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						Edited By:
					</th>

					<td>
						<% $story->edited_by->first." ".$story->edited_by->last%>
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						Edited On:
					</th>

					<td>
						<% &Tab::nicedate($story->edited_on) %> 
					</td>

				</tr>

%			}

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					Publish:
				</th>

				<td>
					<input type="radio" name="active" value="1" <% ($story) ? ($story->active == 1) ? "checked" : "" : "checked" %>>Yes
					<input type="radio" name="active" value="" <% ($story) ? ($story->active == 1) ? "" : "checked" : "" %>>No
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					Pinned:
				</th>

				<td>
					<input type="radio" name="pinned" value="1" <% ($story) ? ($story->pinned == 1) ? "checked" : "" : "" %>>Yes
					<input type="radio" name="pinned" value="" <% ($story) ? ($story->pinned == 1) ? "" : "checked" : "checked" %>>No
				</td>
			</tr>

% 			if ($story && $story->file) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						File Attached:
					</th>

					<td>
						(<a href="<% $Tab::url_prefix %>/files/sitewide/articles/<% $story->id %>/<% $story->file %>">File</a>)
					</td>

				</tr>
	
% 			}

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					Attach File:
				</th>

				<td>
					<input type="file" name="attach" size="12">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th colspan="2">
					Article Text:
				</th>
			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td colspan="3">
					<textarea name="text" rows="15" cols="57"><% ($story) ? $story->text : "" %></textarea>
				</td>
			</tr>

			<tr class="liblrow">

				<td colspan="2" align="right">
					<input class="blue" type="submit" value="Save News Story">
					</form>
				</td>

			</tr>

		</table>

	</div>

	<div id="rightsmall">

% 		if ($story) { 

			<a href="story_rm.mhtml?story_id=<% $story->id %>" class="redblock">
				Delete News Story
			</a>

% 		}

		<a href="news_edit.mhtml" class="blueblock">
			Return to Website
		</a>

		<hr>

        <& /user/menu.mas,  account => $account &>

	</div>

