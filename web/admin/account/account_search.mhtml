<%args>
	$account	
	$search_value => undef
	$search_field => "last"
	$err => undef
	$sort_by => "name"
</%args>
<%init>

	my @accounts;

	my $switch;

	my $search = "%".$search_value."%";

	@accounts = Tab::Account->search_like( last => $search) if $search_field eq "last";
	@accounts = Tab::Account->search_like( first => $search) if $search_field eq "first";
	@accounts = Tab::Account->search_like( email => $search) if $search_field eq "email";

    #uniq
    my %seen = ();
    @accounts = grep { ! $seen{$_->id} ++ } @accounts;

	@accounts = sort {$a->id <=> $b->id} @accounts;
	@accounts = sort {$a->last cmp $b->last} @accounts;

</%init>

	<div class="left huge">

	<h2>Accounts matching <% $search_value %></h2>

	<table cellpadding="5" cellspacing="1" width="100%">

%		foreach my $acc (@accounts) {

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					<% $acc->first %>
				</td>
				
				<td>
					<% $acc->last %>
				</td>

				<td class="smaller">
					<% $acc->email %>
				</td>

				<td class="center">
					<form action="account_edit.mhtml" method="post">
						<input type="hidden" name="edit_id" value="<% $acc->id %>">
						<input type="submit" value="  Edit  ">
					</form>
				</td>

				<td class="center">
					<form action="account_become.mhtml" method="post">
						<input type="hidden" name="become_id" value="<% $acc->id %>">
						<input type="submit" value="  Log In As  ">
					</form>
				</td>


			</tr>
%		}

	</table>

	</div>

	<& account_menu.mas &>
