<%args>
	$round
</%args>
<%init>
		
	Tab::debuglog("Prefs are set to ".$round->event->judge_group->setting("prefs"));

	if ($round->event->judge_group->setting("prefs") eq "ordinals") { 

		Tab::Judge->set_sql(by_round_with_prefs => "
			select distinct judge.*, panel.id as panelid, ballot.chair as chair, 
			group_concat(rating.ordinal separator ', ') as prefs
				from panel,ballot,judge,rating
				where panel.round = ? 
				and panel.id = ballot.panel
				and ballot.judge = judge.id
				and ballot.entry = rating.entry
				and judge.id = rating.judge
				group by judge.id
				order by judge.code
		");

		return Tab::Judge->search_by_round_with_prefs($round->id);

	} else { 

		Tab::Judge->set_sql(by_round => "
			select distinct judge.*, panel.id as panelid, ballot.chair as chair
				from panel,ballot,judge
				where panel.round = ? 
				and panel.id = ballot.panel
				and ballot.judge = judge.id
				order by judge.code
		");
	
		return Tab::Judge->search_by_round($round->id);
	}


</%init>
