<%args>
	$school_id
	$filename
	$nocodes => undef
</%args>
<%init>

	use POSIX;

	my $school = Tab::School->retrieve($school_id);
	my $tourn  = $school->tournament;

	open (TEXOUT, ">>$filename.tex");

	my @comps = Tab::Comp->search( school => $school->id );
	@comps = sort { $a->code <=> $b->code } @comps;
	@comps = sort { $a->event->name cmp $b->event->name } @comps;

	my $switch;

	print TEXOUT "\\begin{tabular}{p{6.9in}}\n";
	print TEXOUT "\\rowcolor[rgb]{1,.96,.95}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);
	print TEXOUT "{\\bf Entries: ".$school->name." }\\\\ \n";
	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\newline\n";

	foreach my $comp (@comps) { 

		print TEXOUT "\\begin{tabular}{p{.65in}p{1.75in}p{4.15in}}\n";
		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);

		print TEXOUT "Waitlist & " if $comp->waitlist &! $comp->dropped;
		print TEXOUT "{\\bf DROP} & " if $comp->dropped;

		print TEXOUT $comp->code unless $comp->waitlist || $nocodes || $comp->dropped || $comp->event->no_codes;
		print TEXOUT " & " unless $comp->waitlist || $nocodes || $comp->dropped;

		print TEXOUT Tab::texify($comp->event->name)." & ";

		print TEXOUT $comp->student->first." ".$comp->student->last unless $comp->event->team == 3;
		print TEXOUT " and ".$comp->partner->first." ".$comp->partner->last if $comp->event->team == 2 && $comp->partner;

		if ($comp->event->team == 3 ) { 

	 		my $team_name = $comp->name." (";

			my $notfirst;
		
			foreach my $stu ($comp->members) { 
				$team_name .= ", " if $notfirst;
				$team_name .= $stu->first." ".$stu->last;
				$notfirst++;
			}

	 		$team_name .= ") ";

			print TEXOUT Tab::texify($team_name);

		}

	
		print TEXOUT "\\\\ \n";
		print TEXOUT "\\end{tabular}\n";
		print TEXOUT "\\newline\n";

	}
	
	close TEXOUT;


</%init>
