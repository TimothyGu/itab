<%flags>
	inherit => undef
</%flags>
<%init>

	my $err;

	if ($Tab::hostname eq "www.tabroom.com") { 

		my $base_url = $r->hostname;
		Tab::debuglog("base url is $base_url");
		my ($base, @rest) = split (/\./, $base_url);

		while ($rest[0] ne "tabroom") { 
			$base = shift @rest;
		}

		unless ($base eq "www") { 
			my $tourn = Tab::Tourn->search( webname => $base, {order_by => "start DESC"} )->first;
			$m->redirect("$Tab::url_prefix/index/tourn/index.mhtml?tourn_id=".$tourn->id) if $tourn;
			$err = "No tournament named $base could be found.  Search with the search box to find the tournament";
		}

	}

	$m->redirect("$Tab::url_prefix/index/tourn/index.mhtml?tourn_id=".$tourn_id) if $tourn_id;

	$m->redirect("$Tab::url_prefix/index/index.mhtml?err=$err") if $err;
	$m->redirect("$Tab::url_prefix/index/index.mhtml");


</%init>

