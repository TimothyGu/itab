<%args>
	$pool_id
	$round_id
</%args>
<%init>
	
	my $round = Tab::Round->retrieve($round_id);
	$round->pool($pool_id);
	$round->update;

	my @schools = $m->comp("/funclib/round_schools.mas", round => $round);

	my %use_schools = map{$_->id => 1} @schools; 

	my @judges = $round->event->judge_group->judges( active => 1 ); 
	my $group_id = $round->event->judge_group->id;

	foreach my $judge (@judges) { 

		next if $judge->school > 0 && not defined $use_schools{$judge->school->id}; 
		next if Tab::PoolJudge->search( judge => $judge->id, pool => $pool_id )->first;

		Tab::PoolJudge->create({
			judge => $judge->id,
			pool => $pool_id
		});
	}

	my $msg = "All judges with schools in ".$round->realname." have been added to pool";
	$m->redirect("pool.mhtml?pool_id=$pool_id&group_id=$group_id&msg=$msg");

</%init>

