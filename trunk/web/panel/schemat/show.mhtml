<%args>
	$tourn
	$show => undef
	$event_id => undef
	$round_id => undef
	$done => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id) if $event_id;
	my $round = Tab::Round->retrieve($round_id) if $round_id;

	unless ($event || $round) { 
		my $msg = "Please pick an event or a round plz";
		$m->redirect("/register/index.mhtml?msg=$msg");
	}

	$event = $round->event unless $event;

	my @rounds = sort {$a->name <=> $b->name} $event->rounds;

	unless ($round) { 

		unless (@rounds) { 
			my $msg = "There are no rounds scheduled of ".$event->name.".  Try scheduling some?";
			$m->redirect("/setup/schedule/event.mhtml?event_id=$event_id&msg=$msg");
		}

		$round = $m->comp('/funclib/event_round_time.mas', event => $event);
		$round = $m->comp('/funclib/event_round_time.mas', event => $event, when => "tourntime") unless $round;
		$round = $rounds[0] unless $round;

	}

	my $preset = 1 unless $m->comp('/funclib/round_entries.mas', round => $round);

</%init>

	<div class="right small">

		<div class="sidenote">

			<h4>Share & Enjoy</h4>

			<a class="blue block" href="show.mhtml?round_id=<% $round->id %>">
				Show Pairing
			</a>

			<a class="blue block" href="/panel/print/schematic.mhtml?round_id=<% $round->id %>&event_id=<% $round->event->id %>">	
				Print Pairing
			</a>

			<a class="blue block" href="print_ballots.mhtml?round_id=<% $round->id %>">	
				Print Ballots
			</a>

			<a class="<% $round->published ? "dkgreen" : "blue"  %> block" href="publish.mhtml?round_id=<% $round->id %>">	
				Web: <% $round->published ? "PUBLISHED" : "NOT PUBLISHED" %>
			</a>

%			if ($round->type eq "elim" || $round->type eq "final") { 
				<a class="<% $round->listed ? "dkgreen" : "blue"  %> block" href="clearing.mhtml?round_id=<% $round->id %>">	
					Clearing list: <% $round->listed ? "PUBLISHED" : "NOT PUBLISHED" %>
				</a>
%			}

			<a class="blue block" href="blast.mhtml?round_id=<% $round->id %>">
				Send Email/text blast
			</a>

		</div>

		<div class="sidenote">
			
			<h4>Change & Destroy</h4>

				<a class="yellow block" href="/panel/pair/round_entries.mhtml?round_id=<% $round->id %>">
					Re-pair this round entirely
				</a>

				<a class="yellow block" href="/panel/pair/round_judges.mhtml?round_id=<% $round->id %>">
					Re-pair this round's judges
				</a>

				<a class="yellow block" href="/panel/pair/round_rooms.mhtml?round_id=<% $round->id %>">
					Re-pair this round's rooms
				</a>

%			if ($m->comp('/funclib/round_unbalanced.mas', round => $round) ) {

				<a class="yellow block" href="/panel/pair/rebalance.mhtml?round_id=<% $round->id %>" style="margin-top: 8px;">
					Rebalance this round
				</a>

%			}

			<a class="dkred block" style="margin-top: 8px;" href="/panel/pair/round_dump.mhtml?round_id=<% $round->id %>">
				Dump this round
			</a>
	
		</div>

		<div class="sidenote">

			<h4>Stats & Data</h4>

			<a class="<% $done ? "dk" : "" %>blue block" href="show.mhtml?round_id=<% $round->id %>&done=1">
				Show Results
			</a>

			<span class="thirdblock">
				Paired:
			</span>
			<span class="twothirdblock">
				<% $round->created ? &Tab::nicedt($round->created->set_time_zone($tourn->tz)) : "Not recorded" %>
			</span>

			<span class="thirdblock">
				Finished: 
			</span>
			<span class="twothirdblock">
				<% $round->completed ? &Tab::nicedt($round->completed->set_time_zone($tourn->tz)) : "Not recorded" %>
			</span>

			<span class="thirdblock">
				Blasted:
			</span>
			<span class="twothirdblock">
				<% $round->blasted ? &Tab::nicedt($round->blasted->set_time_zone($tourn->tz)) : "Not yet blasted" %>
			</span>

		</div>

	</div>

	<div class="left huge">

		<h2>
			<% $event->name %>
			<% ($round->label) ? $round->label : "R".$round->name %>: 
			<% &Tab::nicetime($round->timeslot->start->set_time_zone($tourn->tz)) %>
		</h2>

		<ul id="tabnav">

%			foreach my $allround (@rounds) {

%				my $realname = $allround->realname;
%				my $eventname = quotemeta $allround->event->name;
%				my $eventabbr = quotemeta $allround->event->abbr;
%				$realname =~ s/$eventname//g;
%				$realname =~ s/$eventabbr//g;

%				if ($m->comp("/funclib/round_unbalanced.mas", round => $allround)) { 
					<li class="warning"> 
%				} else { 
					<li class="<% ($allround->id == $round->id) ? "selected" : "" %>">
%				}

					<a href="show.mhtml?round_id=<% $allround->id %>"> 
						<% $realname %>
						<% $m->comp("/funclib/round_unbalanced.mas", round => $allround) %>
					</a>

				</li>
%			}

		</ul>

%		if ($round && not defined $preset) { 

%			if ($done) { 

% 				if ( $event->type eq "debate" || $event->type eq "policy" || $event->type eq "ld") { 
					<& debate_results.mas, round => $round &>
%				}

%			} else { 

%	 			if ( $event->type eq "speech" ) { 
					<& show_speech.mas, round => $round, show => $show &>
%				}

%	 			if ( $event->type eq "congress" ) { 
					<& show_congress.mas, round => $round &>
%				}

% 				if ( $event->type eq "debate" || $event->type eq "policy" || $event->type eq "ld") { 
					<& show_debate.mas, round => $round &>
%				}

%			}

%		}

%		if ($preset) { 
			<& /panel/preset_edit.mas, round => $round &>
%		} 	


	</div>

