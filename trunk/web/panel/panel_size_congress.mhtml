<%args>
	$circuit
	$tourn
	$event_id
</%args>

<%init>
#/
my $event = Tab::Event->retrieve($event_id);

my @comps = Tab::Comp->search( event => $event->id, dropped => 0, waitlist => 0);
my $num_competitors = scalar @comps;

my $minpanelsize = $tourn->method->min_chamber_size;
my $maxpanelsize = $tourn->method->max_chamber_size;
my $defaultpanelsize = $tourn->method->default_chamber_size;


unless ($minpanelsize && $maxpanelsize) { 
	my $err = "You must set minimum and maximum panel sizes for Congress before paneling it";
	$m->redirect("$Tab::url_prefix/setup/method_edit.mhtml?err=$err");
}

</%init>

<h3>Select size of chambers for <% $event->name %> (<% $num_competitors %> entries)</h3>

%	 if ($circuit->diocese_based) { 
	<form action="panel_congress_ncfl.mhtml" method="post">
%	} else {
	<form action="panel_congress.mas" method="post">
%	}
<center>
<table cellpadding="6" width="100%">
<input type="hidden" name="event_id" value="<% $event->id %>">

% my $switch; 

% use POSIX;

%	foreach my $panel_size ($minpanelsize .. $maxpanelsize) {

%		my $num_panels = ceil($num_competitors / $panel_size);
%   	my $competitors_if_panels_full = $num_panels * $panel_size;

%   	my $num_short_panels = $competitors_if_panels_full - $num_competitors;
% 		my $num_full_panels = $num_panels - $num_short_panels;

%		if ($panel_size >= $num_competitors) { 
%			$num_full_panels = 1;
%			$defaultpanelsize = 1; 
%			$panel_size = $num_competitors;
%			$num_short_panels = 0;	
%		}

%	next if $num_short_panels < 0;
%	next if $num_full_panels < 0;

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>
<input type="radio" name="number_of_panels" value=" <% $num_panels %> "
<% ($panel_size == $defaultpanelsize) ? 'checked' : '' %>
> </td>


<th style="text-align: center">Panel Size: <% $panel_size %></th>
<th style="text-align: center"><% $num_panels %> Chambers:</th>

<td><% $num_full_panels %> chambers of <% $panel_size %>
% if ($num_short_panels) {
, <% $num_short_panels %> chambers of <% $panel_size - 1 %>
% }
</td>
</tr>

% }
	
% # In case we have fewer than 5

% if ($num_competitors < 5) {
	<tr>
	<td><input type="radio" name="number_of_panels" value="1">
	</td>
	<td>1 panel of <% $num_competitors %></td>
	</tr>
% }


<tr>
<td colspan="2">
<input class="blue" type="submit" value="<% ($event->panels) ? '   Re-assign Chambers   ' : '   Schedule Chambers   ' %>">
</td>

</table>
</center>

<br>
<br>

