<%args> 
	$tourn
	$panel_id
	$session
</%args>
<%perl>

	my $panel = Tab::Panel->retrieve($panel_id);

	#Set up the filename and the needed trace files
    my $name = $panel->round->event->name."-".$panel->letter."-".$panel->round->realname;
    $name =~ s/[\W_]//g;

    my $filename = "MasterBallots-".$name."-".$session->id;
    my $filepath = $Tab::file_root."tmp/".$filename;
    `rm -f $filepath.*`;

    $m->comp("/funclib/printout.mas", filename => $filename, head => 1 );

	foreach my $judge ($m->comp("/funclib/panel_judges.mas", panel => $panel)) {

		$m->comp("/funclib/print_master.mas", judge_id => $judge->id, panel_id => $panel_id, filename => $filename);

    	open (TEXOUT, ">>$filepath.tex");
		print TEXOUT "\\pagebreak \n";
		close TEXOUT;
	}

    $m->comp("/funclib/printout.mas", filename => $filename, tail => 1 );

</%perl>
