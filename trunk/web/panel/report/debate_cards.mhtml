<%args>
	$session
	$event_id	
	$tourn
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);

    unless ($event) { 
		my $err =  "You did not specify an event to print debate cards.  Please try again";
		$m->redirect("/panel/printouts.mhtml&err=$err");
	}

	my $name = $event->name;
	$name =~ s/[\W_]//g;

	my $filename = "DebateCards-$name-".$session->id;
	my $filepath = $Tab::file_root."tmp/".$filename;
	`rm -f $filepath.*`;

	$m->comp("/funclib/printout.mas", filename => $filename, head => 1 );

	my @prelims;
	my @elims;
	my @finals;

	foreach my $round ($event->rounds) { 
		push @prelims, $round if $round->type ne "final" && $round->type eq "elim";
		push @elims, $round if $round->type eq "elim";
		push @finals, $round if $round->type eq "final";
	}

	open (TEXOUT, ">>$filepath.tex");
	print TEXOUT "\\smallskip\n";

	foreach my $entry (sort{$a->code <=> $b->code} $event->entries( dropped => 0, waitlist => 0, unconfirmed => 0)) {

		my @panels = sort {$a->round->timeslot->start->epoch <=> $b->round->timeslot->start->epoch} $m->comp("/funclib/entry_panels.mas", entry => $entry);

		print TEXOUT "\\begin{tabular}{p{1.5in}p{3.25in}p{1.5in}}\n";
		print TEXOUT "\\hline\n";
		print TEXOUT "\\it ".$event->name." & & \\multirow{3}{*}{\\Huge \\bf ".$entry->school->code." ".$entry->code." }\\\\ \n";

		print TEXOUT "Name: & ".&Tab::texify($entry->name )." & \\\\ \n";

		print TEXOUT "School: & ".&Tab::texify($entry->school->name)." \\\\ \n";

		print TEXOUT "\\end{tabular}\n";
		print TEXOUT "\\vspace{.03in}\n";
		print TEXOUT "\\newline\n";

		my @prelims = sort {$a->round->name <=> $b->round->name} @prelims;
		my @elims = sort {$a->name <=> $b->name} @elims;
		my @finals = sort {$a->name <=> $b->name} @finals;

		print TEXOUT "\\raggedright\n";
		print TEXOUT "\\renewcommand{\\arraystretch}{1.6}\n";

		print TEXOUT "\\begin{tabular}{|p{.5in}|p{.75in}|p{1.75in}|p{1.75in}|p{.5in}|p{.75in}|} \n";

		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\n";

		print TEXOUT "\\hline \n";
		print TEXOUT "Round & Side & Opponent & Judge & W/L & Points \\\\ \n";

		foreach my $round (1 .. 7) { 

			print TEXOUT "\\hline \n";
			print TEXOUT "\\rowcolor[rgb]{1,.9,.9}\n" unless ($round % 2);
			print TEXOUT " $round & & & & & \\\\ \n";

		}

		print TEXOUT "\\hline \n";

		print TEXOUT "\\end{tabular}\n";
		
		print TEXOUT "\\vspace{.5in}\n";
		print TEXOUT "\\newline\n";

		print TEXOUT "\\renewcommand{\\arraystretch}{1.2}\n";

	}

	print TEXOUT "\\end{center}\n";
	print TEXOUT "\\end{document}\n";
	close TEXOUT;

	$m->comp("/funclib/printout.mas", filename => $filename, tail => 1 );

</%init>
