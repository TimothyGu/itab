<%args>
	$tourn
	$event_id => undef
	$timeslot_id => undef
	$num_panels => 1
	$num_judges => 3
	$site_id => undef
</%args>

%	 my @sites = $m->comp("/funclib/tourn_sites.mas", tourn => $tourn);

<h3>Pre-select judges and rooms for elim rounds</h3>


<form action="prepanel_elim.mhtml" method="post">

<table cellpadding="6" cellspacing="0" width="100%">

<tr>
<td align="center">
<select name="event_id">

%	foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)) {
		<option value="<% $event->id %>"
			<% ($event->id == $event_id) ? "selected" : "" %> >
		<% $event->name %>
		</option>
%	}

</select>
</td>

<td align="center">
<select name="timeslot_id">

%	foreach my $timeslot (sort {$b->start->epoch <=> $a->start->epoch} $tourn->timeslots) {
		<option value="<% $timeslot->id %>"
			<% ($timeslot->id == $timeslot_id) ? "selected" : "" %> >
		<% $timeslot->name %>
		</option>
%	}

</select>
</td>

%	if (scalar @sites > 1) { 

<td align="center">
<select name="event_id">

%	foreach my $site (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_sites.mas", tourn => $tourn)) {
		<option value="<% $site->id %>"
			<% ($site->id == $site_id) ? "selected" : "" %> >
		<% $site->name %>
		</option>
%	}

</select>
</td>

% } else { 

<input type="hidden" name="site_id" value="<% $sites[0]->id %>">

% }

<td align="center">
<input type="text" name="num_panels" size="5" value="<% $num_panels %>">
</td>

<td align="center">
<input type="text" name="num_judges" size="5" value="<% $num_judges %>">
</td>


<td align="center">
<input  type="submit" value="Create Panels">
</td>

</table>

</form>

% if ($event_id && $timeslot_id && $num_panels && $num_judges) { 

%	my $event = Tab::Event->retrieve($event_id);
%	my $site = Tab::Site->retrieve($site_id);

%	my @rounds = Tab::Round->search( timeslot => $timeslot_id,
%									 event    => $event->id);

%	my $round = shift @rounds if @rounds;

<br>

<form action="prepanel_round_save.mhtml" method="post">
	<input type="hidden" name="event_id" value="<% $event->id %>">
	<input type="hidden" name="round_id" value="<% ($round) ? $round->id : "" %>">

	<h4></h4>

	<center>
	<table cellpadding="5" cellspacing="0" width="75%">
	<tr>



%	if (scalar @sites > 1) { 

		<th>Site:</th>

		<td>
		<select name="site_id">
		<option value="<% $site->id%>"
		<% ($round) ? ($site->id == $round->site->id) ? "selected" : "" : "" %> >
		<% $site->name %>
		</option>
		</td>

%	} else { 

		<input type="hidden" name="site_id" value="<% $sites[0]->id %>">

%	}

	<th>
		Name the round:   
	</th>

	<td>
		<input type="text" name="round_name" size="30"
			value="<% ($round) ? $round->name : "" %>">
	</td>

	<th>Timeslot:</th>
	<td>
		<select name="timeslot_id">
%		foreach my $timeslot (sort {$a->start->epoch <=> $b->start->epoch} $tourn->timeslots) { 

			<option value="<% $timeslot->id%>"
			<% ($timeslot_id == $timeslot->id) ? "selected" : "" %> >
			<% $timeslot->name %>
			</option>
%		}
		</select>
	</td>

%	if ($tourn->pools) { 

	<th>
		Judge Pool:
	</th>
		
	<td>
	<select name="pool_id">
		<option value="pool_id" value="">No Pool</option>

%		foreach my $pool ($tourn->pools) { 
			<option value="<% $pool->id%>"
				<% ($round) ? ($pool->id == $round->pool->id) ? "selected" : "" : "" %> >
				<% $pool->name %>
			</option>
%		}
	</select>

	</td>

%	}

	</tr>
	</table>
	</center>

%	if ($round) { 

%	my $letter = "A";
%	my $switch;

<table cellpadding="6" cellspacing="0" width="100%">

%	foreach my $panelnum (1 .. $num_panels) { 

<tr>
<td colspan="6">
<h4>Panel <% $letter %></h4>
</td>


<tr <% ($switch % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
%	$switch++;
	<th> Room:</th>

	<td>
	<select name="room_<% $letter %>">
		<option value="">Select Room</option>

%		foreach my $room (sort {$a->name cmp $b->name} 
%									$round->rooms($site_id)) { 

		<option value="<% $room->id %>">
			<% $room->name %>
		</option>


%		}


	</select>
	</td>
</tr>


% 	foreach my $judgenum (1 .. $num_judges) { 

	<tr <% ($switch % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

	<th>Judge <% $judgenum %>:</th>
	
	<td>
		<select name="judge_<% $judgenum %>_panel_<% $panelnum %>">
		<option value="">Select Judge</option>
		</select>

	</td>

	</tr>

%	$switch++;

%	}

%	$letter++;
% } #end of foreach panelnum

</table>

</form>

%	}  #end of if $round

% }	# end of if we were called

