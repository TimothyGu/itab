<%args>
	$tourn
	$event_id 
</%args>
<%perl>

	my $event = Tab::Event->retrieve($event_id);

	unless ($ARGS{"add_new"}) { 

		foreach my $round ($event->rounds) {

			my $preset = $ARGS{$round->id."_preset"};
			$preset = 0 unless $preset;

			$round->label($ARGS{$round->id."_label"});
			$round->type($ARGS{$round->id."_type"});
			$round->preset($preset);
			$round->published($ARGS{$round->id."_published"});
			$round->no_first_year($ARGS{$round->id."_no_first_year"});
			$round->timeslot($ARGS{$round->id."_timeslot_id"});
			$round->site($ARGS{$round->id."_site_id"});
			$round->pool($ARGS{$round->id."_pool_id"});
			$round->update;

			foreach my $panel ($round->panels) { 
				$panel->type($round->type);
				$panel->update;
			}

		} 

	}

	if ($ARGS{"add_new"}) { 

		my $preset = $ARGS{"new_preset"};
		$preset = 0 unless $preset;

		my $round = Tab::Round->create({
			name => $ARGS{"new_next_round"},
			label => $ARGS{"new_label"},
			type => $ARGS{"new_type"},
			preset => $preset,
			pool => $ARGS{"new_pool_id"},
			published => $ARGS{"new_published"},
			no_first_year => $ARGS{"new_no_first_year"},
			timeslot => $ARGS{"new_timeslot_id"},
			event => $ARGS{"event_id"},
			site => $ARGS{"new_site_id"}
		});

		if ($ARGS{"new_type"} ne "prelim") {
			$round->preset(1);
			$round->update;
		}

		unless ($ARGS{"new_preset"}) { 
			$round->preset(0);
			$round->update;
		}
	
	} # end of if round

	$m->comp("/funclib/renumber_rounds.mas", event_id => $event_id);

	my $msg = "Round information saved";
	
	$m->redirect($Tab::url_prefix."/panel/event_schedule.mhtml?event_id=".$event_id."&msg=".$msg);

</%perl>

