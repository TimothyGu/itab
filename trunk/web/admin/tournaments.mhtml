<%args>
	$tourn_id => undef
	$search_value => undef
	$league_id => undef
</%args>
<%init>

	my @leagues = sort {$a->name cmp $b->name} Tab::League->search(active => 1);

	my @tourns;

	if ($search_value) { 

		$search_value = "%".$search_value."%";

		@tourns = Tab::Tournament->search_like(name => $search_value);

		# I wish ClassDBI had an easy way to do this.

		if ($league_id) {

			my @clean_tourns;

			foreach my $tourn (@tourns) { 
				push(@clean_tourns, $tourn) if $tourn->league->id == $league_id;
			}

			@tourns = @clean_tourns;

		}

	}

	@tourns = sort {$b->start->epoch <=> $a->start->epoch} @tourns;

	my $switch;

</%init>

	<div id="leftbig">

		<h2>Tournaments</h2>

%		if (@tourns) { 

			<table cellpadding="4" cellspacing="1" width="100%">

				<tr>
					<th>	
						Tourn	
					</th>

					<th>
						League
					</th>

					<th>
						Start
					</th>

					<th>
					</th>
				</tr>

%				foreach my $tourn (@tourns) {

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
			   				<a href="/user/tourn/select.mhtml?tourn_id=<% $tourn->id %>" class="whiteblock">
							<% $tourn->name %>
							</a>
						</td>
	
						<td>
							<% $tourn->league->short_name %>
						</td>

						<td>
							<% $tourn->start->mdy('/') %>
						</td>


					</tr>
	
%				}

			</table>

%		}



	</div>

	<div id="rightsmall">

		<h3>Search:</h3>

		<table cellpadding="3" width="100%">

			<tr>
				<td>
					<form action="tournaments.mhtml" method="post">
					<input type="text" name="search_value" size="30">
				</td>
			</tr>

			<tr class="oddrow">
				<td>
					<select name="league_id">
						<option value="">All Leagues</option>
%						foreach my $league (@leagues) {
							<option value="<% $league->id%>"><% substr($league->name,0,25) %></option>
%						}
					</select>
				</td>
			</tr>

			<tr class="liblrow">
				<td align="right">
					<input type="submit" value="Search Tournaments">
					</form>
				</td>
			</tr>

		</table>

		<& /admin/menu.mas &>

	</div>

