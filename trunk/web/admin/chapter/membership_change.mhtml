<%args>
	$circuit_mem_id => undef
	$account
</%args>
<%init>

	my $membership = Tab::ChapterCircuit->retrieve($circuit_mem_id);

	unless ($membership) { 

		my $err = "There is an error.  That chapter does not exist in that circuit";
		$m->redirect("/circuit/circuit_view.mhtml?err$err");
	}

	my $circuit = $membership->circuit;
	my $chapter = $membership->chapter;
	
	my @regions = $circuit->regions if $circuit->region_based;

	my $switch;

</%init>

	<div class="left huge">

		<h2>Membership details</h2>

		<p align="right">
			<% $membership->chapter->name %>
		</p>

		<p align="right">
			<% $membership->circuit->name %>
		</p>

		<form action="membership_change_save.mhtml" method="post">
		<input type="hidden" name="circuit_mem_id" value="<% $circuit_mem_id %>">

		<h3>Membership type</h3>

			<table cellpadding="5" cellspacing="1" width="100%">

%				if ($circuit->memberships && scalar $circuit->memberships > 1) { 

%					foreach my $mem ($circuit->memberships) { 

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td>
								<% $mem->name %>
							</td>

							<td>
								<% ($mem->dues) ? "Dues: \$".$mem->dues : "" %>
							</td>

							<td align="center">
								<input type="radio" name="type" value="<% $mem->id %>" 
									<% ($membership->membership && $membership->membership->id == $mem->id) ? "checked" : "" %>>
							</td>

						</tr>

%					}

%				} elsif ($circuit->full_members) {

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Full membership
						</td>

						<td colspan="2" align="center">
							<input type="radio" name="type" value="full" <% ($membership->full_member) ? "checked" : "" %>>
						</td>

					</tr>

%				}

%				if ($circuit->tourn_only) {

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Tournaments Only
						</td>

						<td colspan="2" align="center">
							<input type="radio" name="type" value="to" <% ($membership->full_member) ? "" : "checked" %>>
						</td>

					</tr>

%				}

			</table>

%			if ($circuit->region_based) { 

				<h3>Region</h3>

				<table cellpadding="5" cellspacing="1" width="100%">

%					foreach my $region ($circuit->regions) { 
							
						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td class="smaller">
								<% $region->name %>
							</td>

							<td class="smaller">
								<% $region->code %>
							</td>

							<td class="smaller">
								<% ($region->director) ? "Director: ".$region->director->first." ".$region->director->last : "" %>
							</td>

							<td align="center">
								<input type="radio" name="region_id" value="<% $region->id %>"
									<% ($membership->region && $membership->region->id == $region->id) ? "checked" : "" %> >
							</td>
			
						</tr>

%					}

				</table>

%			}
				
		<table cellpadding="5" cellspacing="1" width="100%">
			
			<tr class="liblrow">

				<td align="right">
					<input type="submit" value="   Save Membership Details ">
					</form>
				</td>

			</tr>

		</table>

	</div>
