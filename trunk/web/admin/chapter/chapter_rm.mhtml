<%args> 
	$chapter_id => undef
	$search => undef
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id) if $chapter_id;

	if ($chapter->schools || $chapter->students) {

		my $err = "You may not delete chapters with tournament entries or students.";
		$err .= "  Merge it first into another chapter.";

		$m->redirect("$Tab::url_prefix/admin/chapter/chapter_merge.mhtml?chapter_id=".$chapter->id."&err=$err");

	}

	my $err = "Chapter id ".$chapter->id." named ".$chapter->name." deleted";

	my @chapter_access = Tab::ChapterAdmin->search( chapter => $chapter_id );

	my @credits = Tab::Coach->search( chapter => $chapter_id );

	foreach (@chapter_access, @credits, $chapter) {
		$_->delete;
	}

	$m->redirect("$Tab::url_prefix/admin/chapter/chapters_search.mhtml?search_field=name&search_value=".$search."&err=$err") if $search;

	$m->redirect("$Tab::url_prefix/admin/chapter/index.mhtml?chapter_id=".$chapter_id."&err=$err");

</%init>
