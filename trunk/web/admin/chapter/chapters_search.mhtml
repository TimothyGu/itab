<%args>
	$account	
	$search_value => undef
	$league_id => undef
	$err => undef
	$sort_by => "name"
</%args>
<%init>

	my $league = Tab::League->retrieve($league_id) if $league_id;

	my @chapters;

	my $search = "%".$search_value."%";
	@chapters = Tab::Chapter->search_like( name => $search) unless $league;
	@chapters = Tab::Chapter->search_league_and_name( $league_id, $search ) if $league;

    #uniq
    my %seen = ();
    @chapters = grep { ! $seen{$_->id} ++ } @chapters;

	@chapters = sort {$a->id <=> $b->id} @chapters;
	@chapters = sort {$a->name cmp $b->name} @chapters;

	if ($sort_by eq "state") { 
		@chapters = sort {$a->state cmp $b->state} @chapters;
	}

</%init>

%	if ($league) { 

		<& "display_league.mas", chapters => \@chapters, league => $league, search_value => $search_value, sort_by => $sort_by &>

%	} else { 

		<& "display_name.mas", chapters => \@chapters, search_value => $search_value &>
%	}

	<& chapter_menu.mas &>
