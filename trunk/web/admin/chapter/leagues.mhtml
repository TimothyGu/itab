<%args>
	$chapter_id
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	my $switch;

	my @cls = Tab::ChapterCircuit->search( chapter => $chapter->id );

	my %memberships = ();

	foreach my $cl (@cls) { 

		$memberships{$cl->circuit->id} = $cl;

	}

</%init>

	<div id="leftbig">
	
		<table cellpadding="5" cellspacing="1" width="100%">
			<tr>
				<td width="100%">
					<h2>Memberships for <% $chapter->name %></h2>
				</td>
				<td>
					<form action="/admin/chapter/chapter_edit.mhtml" method="post">
					<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
					<input type="submit" value="Back">
					</form>
				</td>

		</table>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="lirdrow">

				<th>
					Name
				</th>

				<th>
					Active
				</th>

				<th>
					Full
				</th>

				<th>
					Class/Region
					<form action="circuit_save.mhtml" method="post">
					<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
				</th>

			</tr>

%			foreach my $circuit (sort {$a->name cmp $b->name} Tab::Circuit->search( active => 1) ) { 

%				my $cl = $memberships{$circuit->id};

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						<% $circuit->name %>
					</td>

					<td>
						<input type="checkbox" name="<% $circuit->id %>_active" value="1" <% ($cl && $cl->active) ? "checked" : "" %>>
					</td>

					<td>
						<input type="checkbox" name="<% $circuit->id %>_full_member" value="1" <% ($cl && $cl->full_member) ? "checked" : "" %>>
					</td>

					<td>
%						if ($circuit->memberships) { 
							<select name="<% $circuit->id %>_membership">

%								foreach my $mem ($circuit->memberships) { 
									<option value="<% $mem->id %>" <% ($cl && $cl->membership && $cl->membership->id == $mem->id) ? "selected" : "" %>>
										<% $mem->name %>
									</option>
%								}

							</select>
%						}

%						if ($circuit->regions) { 
							<select name="<% $circuit->id %>_region">

%								foreach my $region ($circuit->regions) { 
									<option value="<% $region->id %>" <% ($cl && $cl->region && $cl->region->id == $region->id) ? "selected" : "" %>>
										<% $region->name %>
									</option>
%								}

							</select>
%						}

					</td>
		
				</tr>

%			}

			<tr class="lirdrow">
				
				<td colspan="5" class="right">

					<input type="submit" value="  Save Memberships  ">
					</form>

				</td>

			</tr>

		</table>

	</div>


	<& chapter_menu.mas, chapter_id => $chapter_id &>



