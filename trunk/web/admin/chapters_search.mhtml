<%args>
	$account	
	$search_field
	$search_value => undef
	$err => undef
</%args>
<%init>

	$search_field = lcfirst($search_field);

	my @chapters;

	if ($search_field eq "all") { 
		@chapters = Tab::Chapter->retrieve_all;
	}

	if ($search_field eq "name") { 
		$search_value = $search_value."%";
		@chapters = Tab::Chapter->search_like( name => $search_value);
	}

    #uniq
    my %seen = ();
    @chapters = grep { ! $seen{$_->id} ++ } @chapters;

</%init>

	<h2>Search chapters</h2>

	<table cellpadding="5" cellspacing="1" width="100%">

%		my $switch;

		<tr class="lirdrow">

			<th>
				Name:
			</th>

			<th>
				Code:
			</th>

			<th>
				State:
			</th>

			<th>
				Active:
			</th>

			<th>
				<form action="chapters_save.mhtml" method="post">
			</th>

		</tr>

% 		@chapters = sort {$a->name cmp $b->name} @chapters;

% 		foreach my $chapter (sort {$a->state cmp $b->state} @chapters) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<input type="text" name="name_<% $chapter->id %>" value="<% $chapter->name %>" size="20">
				</td>

				<td>
					<input type="text" name="code_<% $chapter->id %>" value="<% $chapter->code($circuit) %>" size="5">
				</td>

				<td>
					<input type="text" name="state_<% $chapter->id %>" value="<% $chapter->state %>" size="5">
				</td>

				<td class="centeralign">
					<input type="checkbox" value="1" name="full_<% $chapter->id %>" 
					<% ($chapter->full_member($circuit)) ? "checked" : "" %>>
				</td>

				<td class="centeralign">
					(<a href="<% $Tab::url_prefix %>/circuit/chapter_edit.mhtml?chapter_id=<% $chapter->id %>">Edit</a>)
				</td>

			</tr>

% 		} # end of foreach chapter. 

		<tr class="liblrow">
			<td colspan="5" class="rightalign">
				<input  type="submit" value="Save All Changes">
				</form>
			</td>
		</tr>

	</table>
