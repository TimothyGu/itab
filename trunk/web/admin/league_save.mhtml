<%args>
	$account
	$league_id => undef
	$name
	$short_name
	$state => undef
	$active => undef
	$url
	$timezone 
	$hosted_site => undef
	$full_members => 0
	$tourn_only => 0
	$public_email => undef	
	$apda_seeds => undef	
	$track_bids => undef
	$region_based => undef
	$diocese_based => undef
</%args>
<%init>

	my $err;

	# Check if the user is a site admin or is an admin of that league. 

	my @league_access = Tab::LeagueAdmin->search( league => $league_id, account => $account->id) if $league_id;

	unless ($account->site_admin || @league_access) { 

		$err = "Only site admins or league administrators may make changes to leagues";
		$m->redirect("$Tab::url_prefix/accounts/index.mhtml?err=$err");

	}

	#Save new information if it is a league that exists

	if ($league_id) { 

		my $league = Tab::League->retrieve($league_id);

		$league->name($name);
		$league->short_name($short_name);
		$league->state($state);
		$league->active($active);
		$league->approved($active);
		$league->url($url);
		$league->hosted_site($hosted_site);
		$league->full_members($full_members);
		$league->tourn_only($tourn_only);
		$league->timezone($timezone);
		$league->public_email($public_email);
		$league->apda_seeds($apda_seeds);
		$league->track_bids($track_bids);
		$league->region_based($region_based);
		$league->diocese_based($diocese_based);
		$league->update;

		$err = "League information has been updated";
		$m->redirect("$Tab::url_prefix/league/league_view.mhtml?league_id=$league_id&err=$err");

	} else {   # Create a new league. 

		my $league = Tab::League->create({
			name => $name,
			short_name => $short_name,
			url => $url,
			approved => '1',
			hosted_site => $hosted_site,
			full_members => $full_members,
			tourn_only => $tourn_only,
			timezone => $timezone,
			public_email => $public_email,
			apda_seeds => $apda_seeds,
			track_bids => $track_bids,
			region_based => $region_based,
			diocese_based => $diocese_based
		});

		$league_id = $league->id;

		$err = "League $name has been created";
		$m->redirect("$Tab::url_prefix/league/league_view.mhtml?league_id=$league_id&err=$err");


	}  # end of if league_id


</%init>


