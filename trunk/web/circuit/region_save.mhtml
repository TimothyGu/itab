<%args> 
	$circuit
	$account
	$region_id => undef
	$name
	$arch => undef
	$code => undef
	$quota => undef
	$director_email => undef
</%args>
<%init>

	my $region;

	$region = Tab::Region->retrieve($region_id) if $region_id;


	my @accounts = Tab::Account->search( email => $director_email );

	my $director = shift @accounts if @accounts;


	if ($region_id) { 

		$region->name($name);
		$region->code($code);
		$region->arch($arch);
		$region->quota($quota);

		$region->director($director->id) if $director;

		$region->update;	

	} else {

		$region = Tab::Region->create({ 
			name => $name,
			code => $code,
			arch => $arch,
			circuit => $circuit->id,
			quota => $quota
		});

		$region->director($director->id) if $director;
		$region->update;

	}

	my $msg = "Information saved";

	$m->redirect("$Tab::url_prefix/circuit/region_edit.mhtml?region_id=$region_id&msg=$msg");
		
</%init>
