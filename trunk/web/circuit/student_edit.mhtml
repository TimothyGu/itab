<%args>
	$account
	$student_id => undef
	$err => undef;
	$chapter_id => undef;
</%args>
<%init>

	my $student = Tab::Student->retrieve($student_id) if $student_id;
	$chapter_id = $student->chapter->id if $student;

	my @entries = $student->entries if $student;
	push (@entries, Tab::Entry->search( partner => $student_id ));

	@entries = sort {$b->tournament->start->epoch <=> $a->tournament->start->epoch} @entries;
	
</%init>

	<table width="100%">
		<tr>
			<td width="100%">
				<h2>Edit <%$student->first." ".$student->last %></h2>
			</td>

			<td>
				<form action="students_view.mhtml" method="post">
				<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
				<input type="submit" class="grey" value=" Return to Student Roster">
				</form>
			</td>
		</tr>
	</table>

%	if ($account->site_admin) {
		 <p>Student ID: <% $student->id %></p>
%	}

	<table cellpadding="5" cellspacing="1" width="100%">


% 	my $switch;

	<tr <% ($switch++ % 2) ? "class=\"evenrow\"" : "class=\"oddrow\"" %>>

		<td>
			First:
		</td>

		<td>
			<form action="student_save.mhtml" method="post">
			<input type="hidden" name="from" value="edit">
			<input type="hidden" name="student_id" value=<% ($student) ? $student->id : "" %>>
			<input type="hidden" name="chapter_id" value=<% $chapter_id %>>
			<input type="text" name="first" size="20" value="<% ($student) ? $student->first : "" %>">
		</td>

	</tr>

<tr <% ($switch++ % 2) ? "class=\"evenrow\"" : "class=\"oddrow\"" %>>
<td>Last:</td>
<td colspan="2"><input type="text" name="last" size="20" value="<% ($student) ? $student->last : ""%>"></td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"evenrow\"" : "class=\"oddrow\"" %>>
<td>Grad Year:</td>
<td><input type="text" name="grad_year" size="6" value="<% ($student) ?   $student->grad_year : ""%>"></td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"evenrow\"" : "class=\"oddrow\"" %>>
<td>Gender:</td>
<td>
<input type="radio" name="gender" value="M" <% ($student) ? ($student->gender eq "M") ? "checked" : "" : " " %>> Male
<input type="radio" name="gender" value="F" <% ($student) ? ($student->gender eq "F" ) ? "checked" : "" :  "" %>> Female
</td>
</tr>

		<tr <% ($switch++ % 2) ? "class=\"evenrow\"" : "class=\"oddrow\"" %>>

			<td>
				Novice:
			</td>

			<td>
				<input type="checkbox" name="novice" value="1" <% ($student) ?  ($student->novice) ? 'checked' : '': "" %> >
			</td> 

		</tr>

		<tr <% ($switch++ % 2) ? "class=\"evenrow\"" : "class=\"oddrow\"" %>>

			<td>
				Retired:
			</td>

			<td>
				<input type="checkbox" name="retired" value="1" <% ($student) ?  ($student->retired) ? 'checked' : '': "" %> >
			</td> 

		</tr>

		<tr class="liblrow">

			<td colspan="3" class="right" >
				<input  type="submit" value="Save">
				</form>
			</td>

		</tr>

	</table>

	<table cellpadding="3" width="100%" border="0"> 

		<tr>
			<td colspan="5">
				<h3>Tournament Entries</h3>
			</td>
		</tr>

% 	undef $switch;

% 	foreach my $entry (@entries) { 

		<tr <% ($switch++ % 2) ? "class=\"evenrow\"" : "class=\"oddrow\"" %>>

			<td>
				<% $entry->tournament->name %>
			</td>

			<td>
				<% $entry->tournament->start->mdy('/') %>
			</td>

			<td>
				<% $entry->event->name %>
			</td>

			<td>
				<% $entry->code %>
			</td>

			<td>
				<% ($account->site_admin) ? $entry->id : "" %>
			</td>

		</tr>

% 	} 

	</table>

