<%args>
	$tourn
</%args>
<%init>
	
	my @panels = $tourn->panels;

	foreach my $panel (@panels) { 

		next if $panel->done;

		my @judges = $panel->judges;
	
		foreach my $judge (@judges) { 
	
			my @ballots = Tab::Ballot->search( 
				real_rank => 0, panel => $panel->id, judge => $judge->id );
			my $n = @ballots;

			foreach (reverse 0..$n) {
				my $draw = splice(@ballots, rand $n, 1);
				push @ballots, $draw;
			}

		my $rank = 1;

		foreach my $ballot (@ballots) { 
			next unless $ballot;
			next if $ballot->real_rank;
			my $quality_points = int(rand(30)) + 70;
			$ballot->real_rank($rank);
			$ballot->real_points($quality_points);
			$ballot->audit(1);
			$ballot->update;
			$rank++;
		}
	}


	}
	
	$m->redirect("$Tab::url_prefix/tabbing/rank.mhtml");


</%init>
