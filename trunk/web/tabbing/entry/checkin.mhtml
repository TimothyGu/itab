<%args>
	$tourn
	$account
	$session
	$timeslot_id => undef
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $timeslot = Tab::Timeslot->retrieve($timeslot_id) if $timeslot_id;

</%init>

	<div class="left huge">

%		if ($timeslot) { 

%			my @outstanding = $m->comp("/funclib/timeslot_judges.mas", timeslot => $timeslot, status => "uncollected");
%			my @in = $m->comp("/funclib/timeslot_judges.mas", timeslot => $timeslot, status => "collected");
%			my @panels = $m->comp('/funclib/timeslot_panels.mas', timeslot => $timeslot);

%			my %panels_by_id =();
%			foreach my $panel (@panels) { 
%				$panels_by_id{$panel->id} = $panel;
%			}

		<h2>Ballots in timeslot <% $timeslot->name %></h2>

			<div class="half left">

				<h4>Out:</h4>

%				foreach my $judge (@outstanding) { 
					<a class="noline yellow block smallish nowrap" href="checkin_switch.mhtml?judge_id=<% $judge->id %>&panel_id=<% $judge->panelid %>">

						<span class="evensmallerspan padno inline">
							<% $panels_by_id{$judge->panelid} ? $panels_by_id{$judge->panelid}->round->event->abbr : "" %>
						</span>
						<span class="smallspan padno inline ">
							<% $judge->school && $judge->school->code ? $judge->school->code : "XX" %> <% $judge->code %>
						</span>
						<span class="editspan padno inline " style="margin-left: 6px;">
							<% $judge->first." ".$judge->last %>
						</span>
						<span class="schemat padno inline  nowrap" style="margin-left: 6px; width: 80px;">
							<% $panels_by_id{$judge->panelid} ?  $panels_by_id{$judge->panelid}->room->name : "" %>
						</span>
					</a>
%				}

			</div>

			<div class="half right">

				<h4>In:</h4>

%				foreach my $judge (@in) { 
					<a class="noline green block smallish nowrap" href="checkin_switch.mhtml?judge_id=<% $judge->id %>&panel_id=<% $judge->panelid %>">

						<span class="evensmallerspan padno inline">
							<% $panels_by_id{$judge->panelid} ? $panels_by_id{$judge->panelid}->round->event->abbr : "" %>
						</span>
						<span class="smallspan padno inline ">
							<% $judge->school && $judge->school->code ? $judge->school->code : "XX" %> <% $judge->code %>
						</span>
						<span class="editspan padno inline " style="margin-left: 6px;">
							<% $judge->first." ".$judge->last %>
						</span>
						<span class="schemat padno inline  nowrap" style="margin-left: 6px; width: 80px;">
							<% $panels_by_id{$judge->panelid} ?  $panels_by_id{$judge->panelid}->room->name : "" %>
						</span>
					</a>
%				}

			</div>

%		}

	</div>

	<div class="right small">
	
		<div class="sidenote">

			<h4>Timeslots:</h4>

%			foreach my $ts (sort {$a->start->epoch <=> $b->start->epoch} $tourn->timeslots) {

%				my @outstanding = $m->comp("/funclib/timeslot_judges.mas", timeslot => $ts, status => "uncollected");

				<a href="checkin.mhtml?timeslot_id=<% $ts->id %>" 
					class="<% (@outstanding) ? "yellow block" : "green block" %>">
					<% $ts->name %>:
					<% scalar @outstanding %> left
				</a>

%			}
		</div>

	</div>

