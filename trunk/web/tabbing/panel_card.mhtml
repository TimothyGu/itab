<%args>
	$circuit
	$tourn
	$panel_id => undef
</%args>
<%init>

	my $panel;

	if ($panel_id) { 
		$panel = Tab::Panel->retrieve($panel_id);
	}

	$m->abort unless $panel;

    my $points++ if $tourn->method->tiebreaks(tiebreaker => "points");
	
</%init>

	<div class="right small">

		<a href="/round/schemat_show.mhtml?round_id=<% $panel->round->id %>" class="blue block">
			View <% $panel->round->realname %> Schematic 
		</a>
		
		<hr>

		<a href="/panel/panel_view.mhtml?panel_id=<% $panel->id %>" class="red block">
			View/Edit Panel <% $panel->letter %>
		</a>

		<hr>

	</div>

	<div class="left huge">

		<h2>Panel Card</h2>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="liblrow">

				<th>
					<% $panel->event->abbr %>
				</th>

				<th>
					Section <% $panel->letter %>
				</th>

				<th>
					<% $panel->round->realname %>
				</th>

				<th>
					Room <% ($panel->room) ? $panel->room->name : "" %>
				</th>

			</tr>

		</table> 

		<hr>

		<table cellpadding="4" cellspacing="1" width="100%">

%			my $switch;

%			foreach my $judge (sort {$a->code <=> $b->code} $panel->judges) { 

				<tr>
					<td colspan="5">

						<h3>
							Judge <% $judge->code ." ".$judge->last %>
						</h3>

						<form action="panel_card_save.mhtml" method="post">
						<input type="hidden" name="panel_id" value="<% $panel->id %>">
						<input type="hidden" name="judge_id" value="<% $judge->id %>">
					</td>

				</tr>
				
				<tr class="lirdrow">
						
					<th>
						Competitor
					</th>

					<th>
						Rank
					</th>

%					if ($points) { 
						<th>
							Points
						</th>
%					}

%              		if ($tourn->method->mfl_time_violation > 0) {
						<th>
							Overtime
						</th>
%					}

%					if ($tourn->method->noshows_never_break > 0) {

						<th>
							Noshow
						</th>
%					}

				</tr>

%				my $ballot_sample;

%				foreach my $comp ($panel->comps) { 

%					my @ballots = Tab::Ballot->search( judge => $judge->id, comp => $comp->id, panel => $panel->id );
%					next unless @ballots;
%					my $ballot = shift @ballots;
%					$ballot_sample = $ballot;

%          			my $block = "whiteblock";
                    	
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td style="padding-left: 15px;">
							<a href="/register/comp_edit.mhtml?comp_id=<% $comp->id %>" class="<% $block %>">
								<% $comp->code %> <% $comp->team_name %>
							</a>
						</td>

						<td>
							<input type="number" name="rank_<% $ballot->id %>" size="5" value="<% $ballot->real_rank %>">
						</td>

%						if ($points) { 
							<td>
								<input type="number" name="points_<% $ballot->id %>" size="5" value="<% $ballot->real_points %>">
							</td>
%						}

%                  		if ($tourn->method->mfl_time_violation > 0) {
							<td>
								<input type="checkbox" name="tv_<% $ballot->id %>" value="1" <% ($ballot->tv) ? "checked" : "" %>>
							</td>
%						}

%						if ($tourn->method->noshows_never_break > 0) {
							<td align="center">
								<input type="checkbox" name="noshow_<% $ballot->id %>" value="1" <% ($ballot->noshow) ? "checked" : "" %>>
							</td>
%						}

					</tr>


%				}

				<tr class="liblrow">
	
					<td align="center">
						Entry complete?
						<input type="checkbox" name="audit_<% $judge->id %>" value="1" 
							<% ($ballot_sample && $ballot_sample->audit) ? "checked" : "" %>>
					</td>

					<td colspan="2" align="right">
						<input type="submit" value="  Save Changes  " class="blue">
						</form>
					</td>

				</tr>
%			}	

		</table>

	</div> 

	<br style="clear: both;">
