<%args>
	$tourn
</%args>
<%init>

	my @types;

</%init>

	<div class="left huge">

		<h2>Web Publish Final Results</h2>

		<& "/funclib/tablesorter.mas", table => "sortable" &>

		<table cellpadding="4" id="sortable">

			<thead>

				<tr class="yellowrow">

					<th class="smallish">
						Event
					</th>

					<th class="smallish">
						Status
					</th>

					<th class="smallish">
						Generated
					</th>

					<th class="smallish">
						Public
					</th>

				</tr>

			</thead>

			<tbody>

%			foreach my $event (sort {$a->type cmp $b->type} $tourn->events) { 

%				push @types, $event->type;
% 				my $generated = $event->setting("results_generated");
% 				my $published = $event->setting("results_published");

				<tr>

					<td>
						<% $event->name %>
					</td>

					<td>
					</td>

					<td class="centeralign">
						<% $generated ? "Not Generated" : Tab::shortdate($generated) %>
					</td>

					<td class="centeralign smallish">

%						if ($published) { 
							<a class="dkgreen block centeralign" href="publish_switch.mhtml?event_id=<% $event->id %>">
								PUBLIC
							</a>
%						} else { 
							<a class="dkred block centeralign" href="publish.mhtml?event_id=<% $event->id %>">
								NOT PUBLIC
							</a>
%						} 

					</td>

				</tr>

%			}

			</tbody>

		</table>

	</div>

	<div class="right small">

		<div class="sidenote">

			<h4>Calcuate results</h4>

			<form action="generate_results.mhtml" method="post">

			<div class="block evenrow">

				<span class="evensmallerspan">
					Event
				</span>

				<span class="huntwofive righalign">

					<select name="event_id" class="fixedsmaller">

						<option value="type">
							All events
						</option>

%						foreach my $type (@types) { 
							<option value="type_<% $type %>">
								All <% ucfirst($type) %> events
							</option>
%						}
					</select>

				</span>
		
			</div>

			<div class="block">

				<span class="evensmallerspan">
					Type
				</span>

				<span class="huntwofive righalign">
					<select name="result_type" class="fixedsmaller">
						<option value="final">Final Placements</option>
						<option value="prelim_seed">Prelim Seeding</option>
						<option value="speakers">Speakers</option>
						<option value="sweepstakes">Sweepstakes</option>
					</select>
				</span>
		
			</div>

			<div class="block evenrow">

				<span class="evensmallerspan">
					Label
				</span>

				<span class="huntwofive righalign">
					<input type="text" name="label" size="15" class="thin">
				</span>
		
			</div>

			<div class="block">

				<span class="evensmallerspan">
					Public
				</span>

				<span class="huntwofive rightalign">
					<input type="radio" name="publish" value="1" class="padno marleft" id="one"> <label for="one">Yep</label>
					<input type="radio" name="publish" value="0" class="padno marleft" id="non"> <label for="non">Nope</label>
				</span>
		
			</div>

			<div class="block liblrow rightalign">
				<input type="submit" value="Calculate" class="thin">
				</form>
			</div>

		</div>

	</div>


