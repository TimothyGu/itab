<%args>
	$circuit
	$tourn
	$timeslot_id => undef
	$event_id => undef
	$err => undef
</%args>
<%init>
	
	my @timeslots = Tab::Timeslot->search( 
			tournament => $tourn->id, {order_by => "start"});

	my @sites = $tourn->sites;

	my $timeslot = Tab::Timeslot->retrieve($timeslot_id) if $timeslot_id;
	my @panels;

	if ($timeslot_id) {
		@panels = $timeslot->panels unless $event_id;
		@panels = $timeslot->panels($event_id) if $event_id;
	}

	@panels = sort {$a->letter cmp $b->letter } @panels;
	@panels = sort {$a->event->abbr cmp $b->event->abbr } @panels;

</%init>

<center>
<table cellpadding="5" >

<tr>
<td colspan="5">
<h3>Manual room assignment</h3>
</td>
</tr>

<form action="rooms.mhtml" method="post">

<tr>
	<td>For timeslot:</td>
	<td>
	<select name="timeslot_id">
% 	foreach my $ts (@timeslots) {
		<option value="<% $ts->id %>" <% ($ts->id == $timeslot_id) ? "selected" : "" %> >
		<% $ts->name %>
		</option>
% 	}	
	</td>

	<td>Event:</td>
		<td>
		<select name="event_id">
		<option value="">All Events</option>
%		foreach my $event (sort {$a->name cmp $b->name} $tourn->events(type => "speech") ) {
			<option value="<% $event->id %>" <% ($event->id == $event_id) ? "selected" : "" %> >
			<% $event->name %></option>
% 		}
		</select></td>

	<td><input  type="submit" value="Show"></td>
	</tr>
	

</form>
<tr><td colspan="5"><h4></h4></td></tr>
</table>
<table cellpadding="5" cellspacing="1" width="55%" >
<form action="rooms_save.mhtml" method="post">
<input type="hidden" name="timeslot_id" value="<% $timeslot_id %>">
<input type="hidden" name="event_id" value="<% $event_id %>">

% my $switch;

%foreach my $panel (@panels) { 

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

	<td align="center">
		<% $panel->event->abbr %>
	</td>

	<td align="center">
		<% ($panel->round->label) ? $panel->round->label : $panel->round->name %> <% $panel->letter %>
	</td>

	<% (scalar @sites > 1) ? "<td>".$panel->round->site->name."</td>" : ""%>

	<td align="center">
		<select name="room_id_<%$panel->id%>">

%	if ($panel->room) {
		<option value="<% $panel->room->id %>" selected>	
			<% $panel->room->name %>
		</option>
%  }

% 	foreach my $room (sort {$a->name cmp $b->name} $panel->round->rooms) { 
		<option value="<% $room->id %>" >
		<% $room->name %>
		</option>
% }
	</select>
	</td>

% }
</tr>

% if (@panels) { 

	<tr>
	<td colspan="5" align="center">
	<input  type="submit" value="Save Assignments">
	</td>
	</tr>

% }

</table>
</form>
</center>

