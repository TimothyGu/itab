<%args>
	$league_id
	$chapter_id
	$account
	$session
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	$m->comp("/user/chapter/auth.mas", chapter => $chapter, session => $session, account => $account);

	my $league = Tab::League->retrieve($league_id);

	my $cl = Tab::ChapterLeague->create({
		active => 1,
		full_member => 1,
		league => $league_id,
		chapter => $chapter_id
	});

	my $err = "Choose a region " if $league->region_based;

	$err .= "Choose a membership class " if $league->memberships;

	$m->redirect("/user/chapter/chapter_league.mhtml?chapter_id=$chapter_id&league_id=$league_id&err=$err") if $err;

	$err = "You may now register for tournaments in the ".$league->name;

	$m->redirect("/user/home.mhtml?chapter_id=$chapter_id&err=$err");

</%init>
