<%args>
	$oldpass
	$newpass
	$repeatpass
	$account
	$league
</%args>
<%init>

	use Crypt::PasswdMD5;
	my $md5_salt = $m->comp("/funclib/generate_randomstring.mas");

	my $err;

	$err = "The two passwords you listed did not match" unless $newpass eq $repeatpass;


    my $db_password = $account->passhash;
    my $verify_password = unix_md5_crypt($oldpass,$db_password);

	$err = "Old password was not correct" unless $db_password eq $verify_password;

	if ($err) { 
		$m->redirect("$Tab::url_prefix/user/account/profile.mhtml?err=$err");
	}

	$account->password($newpass);
	
	my $passhash = unix_md5_crypt($newpass,$md5_salt);

	$account->passhash($passhash);
	$account->update;
	
	my $msg = "Your password has been changed";

	$m->redirect("$Tab::url_prefix/user/account/profile.mhtml?msg=$msg");


</%init>


