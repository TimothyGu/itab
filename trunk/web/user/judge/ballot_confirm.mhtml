<%args>
	$account
	$panel_id
	$judge_id
</%args>
<%init>

    unless ($panel_id && $judge_id) { 
        my $err = "I didn't get both a judge and a ballot record";
        $m->redirect("/user/home.mhtml?err=$err");
    }   

    my $panel = Tab::Panel->retrieve($panel_id);
    my $judge = Tab::Judge->retrieve($judge_id);

    unless ($panel && $judge) { 
        my $err = "No ballots found for that judge and that panel.";
        $m->redirect("/user/home.mhtml?err=$err");
    }   

    unless ($judge->account->id == $account->id) { 
        my $err = "You are not authorized to enter ballots for that judge.";
        $m->redirect("/user/home.mhtml?err=$err")
    }   

    my @ballots = Tab::Ballot->search( panel => $panel->id );

    unless (@ballots) { 
        my $err = "That judge does not judge in that room.";
        $m->redirect("/user/home.mhtml?err=$err");
	}

	foreach my $ballot (@ballots) { 
		$ballot->audit(1);
		$ballot->update;
	}

	my $msg = "Thank you for entering your ballot.  If you come to believe you screwed up, please contact the tournament staff";
	$m->redirect("/user/home.mhtml?msg=$msg");

</%init>
