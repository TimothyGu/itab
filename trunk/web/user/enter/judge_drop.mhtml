<%args>
	$judge_id	
	$account
	$school
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);

	unless ($judge) { 
		my $err = "That judge could not be found.  Did you already delete him/her?";
		$m->redirect("judges.mhtml?school_id=".$school->id."&err=$err");
	}

	my $tourn = $judge->tournament;
	my $chapter = $school->chapter;
	my $group = $judge->judge_group;

	my $err = $account->first." ".$account->last." dropped judge ".$judge->first." ".$judge->last." in ".$group->name;

    my @requests = Tab::Housing->search( tournament => $tourn->id, judge => $judge->id);

	$err .= ". Housing requests were also deleted" if @requests;

	foreach my $request (@requests) { 
		$request->delete;
	}

	if ($tourn->method->track_reg_changes) {

		my $change = Tab::Change->create({
   			tournament => $tourn->id,
       		school => $judge->school->id,
			type => "registration",
       		regline => $err
       	});
	}


	$judge->delete;

	my $chapter_id = $chapter->id;
	my $tourn_id = $tourn->id;

	$m->redirect("$Tab::url_prefix/user/tourn/entry/judges.mhtml?err=$err&group_id=".$group->id."&school_id=".$school->id);


</%init>
