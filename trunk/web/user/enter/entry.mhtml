<%args>
	$account
	$school
	$disclaimed => undef
</%args>
<%init>

	use POSIX;

	$school->disclaimed($account->id) if $disclaimed;
	$school->update;

	my $tourn = $school->tourn;
	my $tz = $tourn->tz;

    my $now = DateTime->now(time_zone => $tourn->tz);

	my $switch;

	my $adult++ if ( $school->contact_number && $school->contact_name);
	$adult++ unless $tourn->setting("require_adult_contact");

</%init>

	<h2><% $tourn->name %></h2>

%	if ($adult) { 
		<& menubar.mas, school => $school, whoami => "tourn" &>
%	}

	<div class="left huge">

%	unless ($adult) { 

		<h3>This tournament requires an adult contact</h2>

		<p>
			Before you can register further, you must supply the name and phone
			number for the responsible adult who is attending the tournament.
		</p>
%	}


	<h3>Adult Contact Information:</h3>

	<table cellpadding="5" cellspacing="1" width="100%">

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			<td>
				<form action="contact_save.mhtml" method="post">
				<input type="hidden" name="school_id" value="<% $school->id %>">
				<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
				Adult attending the tournament:
			</td>
	
			<td>
				<input size="25" type="text" name="contact_name" 		
					value="<% ($school->contact_name) ? $school->contact_name : "" %>">
			</td>
		
		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			<td>
				That adult's cell number:
			</td>
		
			<td>
				<input size="25" type="text" name="contact_number" 
					value="<% ($school->contact_number) ? $school->contact_number : "" %>">
			</td>

		</tr>

		<tr class="liblrow">

			<td colspan="2" align="right">
				<input  type="submit" value="Save Contact Info">
				</form>
			</td>

		</tr>

	</table>

%	if ($adult) { 

		<h3>Deadlines:</h3>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="smaller">
					You must add entries by
				</td>

				<td class="smaller">
                    <% ($tourn->reg_end) ? Tab::nicedt($tourn->reg_end->set_time_zone($tz)) : "Not Set" %>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="smaller">
					Your registration fees/obligations are frozen on
				</td>

				<td class="smaller">
%					my $freeze_deadline = $tourn->setting("freeze_deadline");
					<% ($freeze_deadline) ? Tab::nicedt($freeze_deadline->set_time_zone($tz)) : "Not Set" %>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
				<td class="smaller">
					You can drop entries or change names yourself online until
				</td>
			
				<td class="smaller">
%					my $drop_deadline = $tourn->setting("drop_deadline");
					<% ($drop_deadline) ? Tab::nicedt($drop_deadline->set_time_zone($tz)) : "Not Set" %>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
				<td class="smaller">
					Judge entries and changes are due by
				</td>

				<td class="smaller">
%					my $judge_deadline = $tourn->setting("judge_deadline");
					<% ($judge_deadline) ? Tab::nicedt($judge_deadline->set_time_zone($tz)) : "Not Set" %>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
				<td class="smaller">
					Nuisance fines in addition to reg fees for changes start at
				</td>

				<td class="smaller">
%					my $fine_deadline = $tourn->setting("fine_deadline");
					<% ($fine_deadline) ? Tab::nicedt($fine_deadline->set_time_zone($tz)) : "Not Set" %>
				</td>
			
			</tr>
		
			<tr>
				<td colspan="2">
					<h3></h3>
				</td>
			</tr>
	
%			foreach my $group ($tourn->groups) {
	
%				if ($group->setting("deadline")) { 
	
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<td class="smaller">	
							<% $group->name %> judges are due by:
						</td>
	
						<td class="smaller">
							<% &Tab::nicedt($group->setting("deadline")->set_time_zone($tourn->tz)) %>
						</td>
	
					</tr>
	
%				}

%				if ($group->setting("strike_reg_opens")) { 
	
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<td class="smaller">	
							<% $group->name %> strikes/ratings open:
						</td>
	
						<td class="smaller">
							<% &Tab::nicedt($group->setting("strike_reg_opens")->set_time_zone($tourn->tz)) %>
						</td>
	
					</tr>
	
%				}

%				my $strike_end = $group->setting("strike_reg_closes");

%				if ($strike_end) { 
	
%					Tab::debuglog("$strike_end");	
	
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<td class="smaller">	
							<% $group->name %> strikes/ratings due by:
						</td>
	
						<td class="smaller">
							<% &Tab::nicedt($strike_end->set_time_zone($tourn->tz)) %>
						</td>

					</tr>

%				}


%			}

			<tr>
				<td colspan="2">
					<h3></h3>
				</td>
			</tr>

%			foreach my $concession ($tourn->concessions) {

%				next unless $concession->deadline;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td class="smaller">	
						<% $concession->name %> orders are due by:
					</td>

					<td class="smaller">
						<% &Tab::nicedt($concession->deadline->set_time_zone($tourn->tz)) %>
					</td>

				</tr>
%			}
	
		</table>

%	}


	</div>

	<div class="right small">
	
		<div class="sidenote">

%		if ($adult) { 

			<h4>Printouts</h4>

			<a href="entry_print.mhtml?school_id=<% $school->id %>" class="blue block">
				Print Registration
			</a>

			<a href="invoice_print.mhtml?school_id=<% $school->id %>" class="blue block">
				Print Tournament Invoice
			</a>
			
			<hr />

%		}

%		unless ( $now > $tourn->setting("freeze_deadline") ) { 


			<a href="drop_school.mhtml?school_id=<% $school->id %>" class="dkred block">
				Drop Entire Entry
			</a>

%		}

		</div>

	</div>

