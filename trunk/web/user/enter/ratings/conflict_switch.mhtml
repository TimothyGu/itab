<%args>
	$judge_id
	$school_id
	$entry_id => undef
</%args>
<%init>

	my $msg;

	my $judge = Tab::Judge->retrieve($judge_id);
	my $school = Tab::School->retrieve($school_id);

	my $entry = Tab::Entry->retrieve($entry_id) if $entry_id;

	if ($entry) { 

		my $conflict = $entry->is_conflicted($judge);

		if ($conflict) { 

			$conflict->delete;
			$msg = "Conflict against ".$judge->first." ".$judge->last." removed";

		} else { 

			Tab::Strike->create({
				judge => $judge_id,
				type => "entry",
				entry => $entry_id,
				tournament => $school->tournament->id,
				strike => 0
			});
	
			$msg = $entry->team_name."'s Conflict against ".$judge->first." ".$judge->last." saved";

		}

	} else { 

		my $conflict = $school->is_conflicted($judge);

		if ($conflict) { 

			$conflict->delete;
			$msg = "School conflict against ".$judge->first." ".$judge->last." removed";

		} else { 

			Tab::Strike->create({
				judge => $judge_id,
				type => "school",
				school => $school_id,
				tournament => $school->tournament->id,
				strike => 0
			});
	
			$msg = "Conflict against ".$judge->first." ".$judge->last." saved";

		}

	}


	$m->redirect("/user/tourn/entry/ratings/conflicts.mhtml?entry_id=$entry_id&school_id=$school_id&group_id=".$judge->judge_group->id."&style=conflicts&msg=$msg");


</%init>

