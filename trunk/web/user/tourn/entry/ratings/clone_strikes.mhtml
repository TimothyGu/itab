<%args>
	$comp_id => undef
	$clone_id
	$session
	$account
	$debug => 1
</%args>
<%init>

	my $now = DateTime->now;

	my $msg;

	my $clone = Tab::Entry->retrieve($clone_id);

	if ($comp_id) { 

		my $comp = Tab::Entry->retrieve($comp_id);

		unless ($comp->school->id == $clone->school->id) { 

			$m->print("<p>Very freakin' clever.  Trying to clone the ratings of another school's debaters?</p>");
			$m->print("<p>But not clever enough.  Go away, and fear the wrath of Palmer</p>");
			$m->abort("");

		}

		foreach my $strike ($clone->strikes) { 

			next if $strike->judge->cannot_judge($comp);

			my $new_strike = $strike->copy;
			$new_strike->comp($comp->id);
			$new_strike->update;

		}

		$msg = "Strikes for ".$clone->team_name." have been copied to ".$comp->team_name;

	} else { 

		foreach my $comp ($clone->school->group_entries($clone->event->class->judge_group)) { 

			next if $comp->id == $clone->id;
 
			foreach my $strike ($clone->strikes) { 

				my $new_strike = $strike->copy;
				$new_strike->comp($comp->id);
				$new_strike->update;

			}

		}
	
		$msg = "Strikes for ".$clone->team_name." have been copied to ".$clone->school->name;

	}

	$m->redirect("/user/tourn/entry/ratings/comp_strikes.mhtml?school_id=".$clone->school->id."&clone_id=".$clone->id."&group_id=".$clone->event->judge_group->id."&comp_id=$comp_id&msg=".$msg);


</%init>

