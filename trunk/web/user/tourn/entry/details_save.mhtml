<%args>
	$comp_id
	$school_id
	$qualifier => undef
	$qualexp => undef
	$qual2 => undef
	$qual2exp => undef
	$title => undef
</%args>
<%init>

	my $comp = Tab::Comp->retrieve($comp_id);

	my $event = $comp->event;
	my $tourn = $event->tournament;

	my $school = Tab::School->retrieve($school_id);

	if ($event->ask_for_titles) {

		unless ($title) { 
			my $err = "You must enter a piece title (and/or ISBN number)";
			$m->redirect("details.mhtml?comp_id=$comp_id&school_id=$school_id&err=$err");
		}

	}

	if ($tourn->method->ask_qualifying_tournament) {

		unless ($qualifier) { 
			my $err = "You must enter qualifying tournament information";
			$m->redirect("details.mhtml?comp_id=$comp_id&school_id=$school_id&err=$err");
		}

	}

	if ($tourn->method->ask_two_quals) {

		unless ($qualifier && $qual2) { 
			my $err = "You must enter qualifying tournaments";
			$m->redirect("details.mhtml?comp_id=$comp_id&school_id=$school_id&err=$err");
		}

		unless ($qualexp && $qualexp) { 
			my $err = "You must enter qualifying tournament placements";
			$m->redirect("details.mhtml?comp_id=$comp_id&school_id=$school_id&err=$err");
		}

	}

	$comp->title($title);
	$comp->qualifier($qualifier);
	$comp->qualexp($qualexp);
	$comp->qual2($qual2);
	$comp->qual2exp($qual2exp);

	$comp->update;

	my $msg = "Competitor ".$comp->team_name." entered";

	$m->redirect("students.mhtml?school_id=$school_id&event_id=".$event->id."&msg=$msg");

</%init>
