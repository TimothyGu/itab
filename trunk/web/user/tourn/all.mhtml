<%args>
	$account
	$session
</%args>
<%init>

	Tab::Tourn->set_sql( by_director => "
		select distinct tourn.* 
		from tourn, tourn_admin
		where tourn.id = tourn_admin.tourn
		and tourn_admin.account = ? 
		order by tourn.end DESC");

	my @tourns = Tab::Tourn->search_by_director($account->id);

	my $now = DateTime->now;

</%init>

	<& /user/menu.mas, account => $account &>

	<div class="left huge">

		<h2>All Tournaments</h2>

		<table cellpadding="5" cellspacing="1" width="100%">

  			<tr class="dkgreen"> 
			
				<th>
					Dates
				</th>

				<th>
					Year
				</th>

				<th>
					Circuit
				</th>

				<th>
					Tournament
				</th>

				<th>
					Location
				</th>

			</tr>

%			my $switch;

%			foreach my $tourn (@tourns) { 

%			   my $open++ if ($tourn->reg_start && $tourn->reg_end && $tourn->reg_start->epoch < $now->epoch &&  
%					$tourn->reg_end->epoch > $now->epoch);

				<tr class="<% ($switch++ % 2) ? "evenrow" : "oddrow" %>">
			
					<td>
						<% Tab::niceshortdate($tourn->start) %>
						<% ($tourn->start->day != $tourn->end->day) ? " - ".Tab::niceshortdate($tourn->end) : "" %>
					</td>

					<td>
						<% $tourn->start->year %>
					</td>

					<td>
%					   foreach my $circuit ($m->comp("/funclib/tourn_circuits.mas", tourn => $tourn)) {
							<% $circuit->abbr %>
%					   }
					</td>

					<td>
						<a class="white block nowrap" href="select.mhtml?tourn_id=<% $tourn->id %>">
					   		<% $tourn->name %>
						</a>
					</td>

					<td>
						<% $tourn->location %>
					</td>

				</tr>

%			}

		</table>

	</div>

