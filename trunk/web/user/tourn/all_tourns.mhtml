<%args>
	$account
	$session
</%args>
<%init>

	Tab::Tourn->set_sql( by_director => "
		select distinct tourn.* 
		from tourn, tourn_admin
		where tourn.id = tourn_admin.tourn
		and tourn_admin.account = ? 
		order by tourn.end DESC");

	my @tourns = Tab::Tourn->search_by_director($account->id);

	my $now = DateTime->now;

</%init>

	<div class="right small">

		<& /user/chapter/chapter_list.mas, account => $account &>

		<& /user/tourn/tourn_list.mas, account => $account &>

		<& /user/circuit/circuit_list.mas, account => $account &>

        <& /admin/menu.mas, account => $account &>

	</div>

	<div class="left huge">

		<h2>Tournaments</h2>

		<table cellpadding="5" cellspacing="1" width="100%">

        <a class="dkgreen block">
    
            <span class="medspan">
                Dates
            </span>

            <span class="smallspan">
				Year
            </span>

            <span class="medspan">
                Circuit
            </span>

            <span class="bigspan">
                Tournament
            </span>

            <span class="smallspan">
                Location
            </span>


            <br style="clear: both;">

        </a>


%		my $switch;
%		foreach my $tourn (@tourns) { 

%           my $open++ if ($tourn->reg_start && $tourn->reg_end && $tourn->reg_start->epoch < $now->epoch &&  
%                               $tourn->reg_end->epoch > $now->epoch);


            <a class="<% ($switch++ % 2) ? "white" : "grey" %> block" href="select.mhtml?tourn_id=<% $tourn->id %>">

                <span class="medspan">
                    <% Tab::niceshortdate($tourn->start) %>
                    <% ($tourn->start->day != $tourn->end->day) ? " - ".Tab::niceshortdate($tourn->end) : "" %>
                </span>

                <span class="smallspan">
                    <% $tourn->start->year %>
                </span>

                <span class="medspan">
%                   foreach my $circuit ($m->comp("/funclib/tourn_circuits.mas", tourn => $tourn)) {
                        <% $circuit->abbr %>
%                   }
                </span>

                <span class="bigspan">
                    <% $tourn->name %>
                </span>

                <span class="smallspan">
                    <% $tourn->location %>
                </span>

                <br style="clear: both;">

            </a>

%		}

	</div>

