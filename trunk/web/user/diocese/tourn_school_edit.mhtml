<%args>
	$tourn
	$region
	$account
	$school_id => undef
	$chapter_id => undef
</%args>
<%init>

	my $switch;

	my $tz = $account->tz;
	$tz = "UTC" unless $tz;
	my $now = DateTime->now->set_time_zone($tz);

	my $school;

	if ($chapter_id) { 

		my $chapter = Tab::Chapter->retrieve($chapter_id);

		unless ($chapter) { 
			$m->print("That school was not found.  Hit back and try again");
			$m->abort;
		}

		$school = Tab::School->search({ chapter => $chapter->id, tourn => $tourn->id })->first;

		$school = Tab::School->create({
			tourn => $tourn->id,
			chapter => $chapter->id,
			name => $chapter->name,
			region => $region->id,
			entered_on => $now,
			contact => $account->id
		}) unless $school;

	} else { 

		$school = Tab::School->retrieve($school_id);

	}

	unless ($school) { 
		$m->print("School was not found.  Hit back and try again");
		$m->abort;
	}

</%init>

	<div class="huge left">

		<h2><% $region->arch ? "Archdiocese" : "Diocese" %> of <% $region->name %> at <% $tourn->name %></h2> 

		<& menubar.mas, tourn => $tourn, region => $region, whoami => "schools" &>

		<div class="block padless">
			<span class="bigspan padless">
				<h4>Edit <% $school->short_name %>'s details</h4>
			</span>
			<span class="halfspan padless rightalign">	
				<p class="explain required"> denotes required field</p>
			</span>
		</div>

		<form action="tourn_school_save.mhtml" method="post">
		<input type="hidden" name="region_id" value="<% $region->id %>">
		<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
		
		<div class="block <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			<span class="required smallish medbigspan rightalign">
				School Name:
			</span>

			<span class="bigspan">
				<input type="text" name="name" value="<% $school->name %>" size="35">
			</span>
		</div>

		<div class="block <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			<span class="required smallish medbigspan rightalign">
				Name of contact at Nationals
			</span>

			<span class="bigspan">
				<input type="text" name="contact_name" value="<% $school->contact_name %>" size="35">
			</span>
		</div>

		<div class="block <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			<span class="required smallish medbigspan rightalign">
				Contact email
			</span>

			<span class="bigspan">
				<input type="email" name="contact_email" value="<% $school->contact_email %>" size="35">
			</span>
		</div>

		<div class="block <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			<span class="required smallish medbigspan rightalign">
				Contact phone number
			</span>

			<span class="bigspan">
				<input type="tel" name="contact_number" value="<% $school->contact_number %>" size="35">
			</span>
		</div>

		<div class="block <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			<span class="required smallish medbigspan rightalign">
				School's hotel
			</span>

			<span class="bigspan">
				<select name="hotel" class="fixedbig">
%					foreach my $hotel ($tourn->hotels) { 
						<option value="<% $hotel->id %>">	
							<% $hotel->name %> <% $hotel->multiple > 1 ? "(Entry fee surcharge of ".$hotel->multiple."X applies)" : "" %>
						</option>
%					}
				</select>
			</span>
		</div>

		<div class="block bluerow rightalign">
			<input type="submit" value="Save School">
		</div>

	</div>

	<div class="right small">
	
		<div class="sidenote">

			<h4>School Info</h4>

		</div>

	</div>

