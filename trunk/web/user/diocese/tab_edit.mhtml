<%args> 
	$judge_id => undef
	$group_id => undef
	$diocese_id => undef
	$account
</%args>
<%init>

	my @tab_jobs = (
		"Congress",
		"Declamation",
		"Dramatic",
		"Duo",
		"Extemp",
		"Extemp Prep",
		"LD",
		"Ombudsman",
		"Oral Interp",
		"Oratory",
		"Policy",
		"Postings",
		"Public Forum",
		"Sweepstakes"
	);

	my $judge = Tab::Judge->retrieve($judge_id);

	my $group = Tab::JudgeGroup->retrieve($group_id) unless $judge;
	$group = $judge->judge_group if $judge;

	my $diocese = Tab::Region->retrieve($diocese_id) unless $judge;
	$diocese = $judge->school->region if $judge;

	my @classes = sort {$a->name cmp $b->name} $group->classes;

	my $tourn = $group->tournament;

	my @chapters = sort {$a->name cmp $b->name} $diocese->chapters;

	my @quals = $tourn->quals;

	unless ($diocese->director->id eq $account->id || $account->site_admin) { 

		$m->redirect("$Tab::url_prefix/account/access_denied.mhtml");
	}

	my $switch;

</%init>

	<div id="leftbig">

		<h2><% ($judge) ? "Edit tab staff " : "Add tab staff " %> </h2>

		<table cellpadding="5" cellspacing="1" width="98%" border="0" style="margin-left: 5px;">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					First Name:*
				</td>

				<td colspan="3">
					<form action="tab_save.mhtml">
					<input type="hidden" name="judge_id" value="<% $judge_id %>">
					<input type="hidden" name="group_id" value="<% $group->id %>">
					<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
					<input type="text" name="first" value="<% ($judge && $judge->first) ?  $judge->first : "" %>" size="25">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					Last Name:*
				</td>

				<td colspan="3">
					<input type="text" name="last" value="<% ($judge && $judge->last) ?  $judge->last : "" %>" size="25">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					School:
				</td>

				<td colspan="3">
					<select name="chapter_id" style="font-size: 90%;">
%						foreach my $chapter (@chapters) { 
							<option value="<% $chapter->id %>" 
									<% ($judge && $judge->school->chapter->id == $chapter->id) ? "selected" : "" %> >
								<% substr($chapter->name,0,30) %>
							</option>
%						}

					</select>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					Cell Phone Number:*
				</td>

				<td colspan="3">
					<input type="text" name="cell" value="<% ($judge && $judge->cell) ?  $judge->cell : "" %>" size="25">
				</td>

			</tr>

	        <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					Notes/Comments
				</td>

				<td>
					<input type="text" name="notes" value="<% ($judge && $judge->notes) ?  $judge->notes : "" %>" size="25">
				</td>

			</tr>

	        <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					First Choice:
				</td>

				<td>
					<select name="cfl_tab_first">

%						foreach my $job (@tab_jobs) { 
							<option value="<% $job %>"  <% ($judge && $judge->cfl_tab_first eq $job) ? "selected" : "" %>>
								<% $job %>
							</option>
%						}

					</select>
				</td>

			</tr>

	        <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					Second Choice:
				</td>

				<td>
					<select name="cfl_tab_second">

%						foreach my $job (@tab_jobs) { 
							<option value="<% $job %>"  <% ($judge && $judge->cfl_tab_second eq $job) ? "selected" : "" %>>
								<% $job %>
							</option>
%						}


					</select>
				</td>

			</tr>

	        <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					Third Choice:
				</td>

				<td>
					<select name="cfl_tab_third">

%						foreach my $job (@tab_jobs) { 
							<option value="<% $job %>"  <% ($judge && $judge->cfl_tab_third eq $job) ? "selected" : "" %>>
								<% $job %>
							</option>
%						}

					</select>
				</td>

			</tr>

			<tr class="liblrow">

				<td colspan="1" align="center">

					<input type="submit" name="save" value="Save and Add Another" 
								style="padding-left: 10px; padding-right: 10px;">

				</td>

				<td colspan="1" align="right">

					<input type="submit" name="save" value="Save and Return" 
								style="padding-left: 15px; padding-right: 15px;">
				</td>
			</tr>

		</table>


		<p style="padding-left: 10px;">Be warned:  If you fill in fewer than 3 preferences, and you don't
		know for sure (i.e. from Roland) that you're doing one of those jobs,
		you might be assigned to just about anything if your first choice isn't
		available.</p>

	</div>

	<& sidebar.mas, group => $group, tourn => $tourn, diocese => $diocese &>
