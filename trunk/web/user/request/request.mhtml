<%args>
	$account
	$name => undef
	$webname => undef
	$start => undef
	$end => undef
	$error => undef
</%args>
<%init>

	my $switch;
	my @tourns = $m->comp("/funclib/account_tourns.mas", account => $account);

</%init>

	<div class="left huge">

		<h2>Manage a tournament with tabroom.com</h2>

%		if ($error) { 
			<p class="warning">
				<% $error %>
			</p>
%		}

		<table cellpadding="5" cellspacing="1" width="100%">


			<tr <% ($name || not defined $error) ? ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" : "class=\"lirdrow\""%> >

				<th>
					Tournament Name:
				</th>

				<td class="rightalign">
					<form action="deadlines.mhtml" method="post">
					<input type="text" name="name" size="35" value="<% $name %>">
				</td>

			</tr>

			<& /funclib/datepicker.mas, from => "tournfrom", to => "tournto" &> 
		
			<tr <% ($start || not defined $error) ? ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" : "class=\"lirdrow\""%> >

				<th>
					Start Date:
				</th>

				<td class="rightalign">

					<input type="text" name="start" id="tournfrom" size="15" value="<% $start %>">

				</td>

			</tr>
		
			<tr <% ($end || not defined $error) ? ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" : "class=\"lirdrow\""%> >

				<th>
					End Date:
				</th>

				<td class="rightalign">
					<input type="text" name="end" id="tournto" size="15" value="<% $end %>">
				</td>

			</tr>

			<tr <% ($webname || not defined $error) ? ($switch % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" : "class=\"lirdrow\""%> >

				<th>
					Web Name
				</th>

				<td class="rightalign">
					<input type="text" name="webname" size="15" value="<% $webname %>">
				</td>

			</tr>

			<tr <% ($name || not defined $error) ? ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" : "class=\"lirdrow\""%> >

				<td class="explain" colspan="2">
					* Webname must be all lowercase letters, no spaces, and unused by others' tournaments
				</td>

			</tr>

%			if (@tourns) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<th>
						Clone tournament:
					</th>

					<td class="rightalign">

						<select name="clone">
							
							<option value="">None: Create tournament from scratch</option>

%							foreach my $tourn (@tourns) { 
								<option value="<% $tourn->id %>">
									<% $tourn->start->year %> <% substr($tourn->name,0,40) %>
								</option>
%							}
						</select>
					</td>

				</tr>

%			}

			<tr class="liblrow">
				<td colspan="2" class="rightalign">
					<input  type="submit" style="width: 175px;" value="  Next: Set Deadlines  ">
					</form>
				</td>
			</tr>
		
		</table>

        <h3 style="margin-top: 25px;">Or, upload a tournament from an iTab XML File:</h3>

			<div style="width: 97%; padding: 10px;" class="evenrow">

                <div style="width: 45%; display: inline-block; float: left;">
            		<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="xml" action="upload_xml.mhtml" method="post">
                    <input name="xml" type="file" class="button">
                </div>

                <div style="width: 45%; display: inline-block; float: right; text-align: right; padding-right: 10px;">
                    <input type="submit" style="width: 175px;" value=" Upload Saved Data ">
					</form>
                </div>

				<br style="clear: both;">

			</div>

	</div>

	<div class="right small">

		<div class="sidenote">

		<h4>Don't register here</h4>

		<p>This area is for tournament directors.  Do not use this form if you
		are trying to register for someone else's tournament.  Go back to your
		<a href="/user/home.mhtml">home screen</a> and if the tournament does not
		appear, join the circuit the tournament is in.  Or find the tournament
		on the <a href="/">iTab home page</a>.</p>

		<h4>Tournament directors:</h4>

		<p>Once you set up your online tournament, a request will be sent to the
		administrators of your circuit for approval.  After they approve the
		tournament, it'll appear on the schedule for the circuit and be open
		for entries on this website on the date you set.</p>

		<p>Not all options are covered by the pre-approval forms; be sure to go
		into the admin pages once it's approved and create
		divisions and judge groups and suchforth.</p>

		</div>

	</div>

