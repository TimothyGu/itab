<%args>
	$tourn_id
	$round_id => undef
	$event_id => undef
	$tz
</%args>
<%init>

	my $tourn =  Tab::Tourn->retrieve($tourn_id);

	my @rounds = $tourn->published_rounds;
	push (@rounds, $tourn->listed_rounds);

	@rounds = sort {$a->name <=> $b->name} @rounds;

    #uniq 
	my %seen = ();
    @rounds = grep { ! $seen{$_->id} ++ } @rounds;

	my %events_with_rounds = ();

	foreach my $round (@rounds) { 
		push (@{$events_with_rounds{$round->event->id}}, $round);
	}


    my @newses = Tab::News->search( tournament => $tourn_id, special => "postings");
	my $news = shift @newses if @newses;

	my $switch;

</%init>

	<div id="lefthuge">

%		my $round = Tab::Round->retrieve($round_id) if $round_id;

%		if ($round) { 

<%perl>
			my $event = $round->event;
			$event_id = $event->id;

			unless ($round->published) { 

				$m->print("<p class=\"err\">This round has not been published.  Quit trying to mess around</p>");
				$m->abort;
		
			}
</%perl>

			<h4><% $round->event->name %> <% ($round->label) ? $round->label : "Round ".$round->name %>
				(<% Tab::niceshortdt($round->timeslot->start->set_time_zone($tz)) %>)
			</h4>
			
			<table cellpadding="5" cellspacing="1" width="100%"> 
			
				<tr>
					<th>
						Room
					</th>
					
					<th style="border-right: 1px solid brown;">
						Judge(s)
					</th>
					
					<th colspan="7">
						Entryetitors
					</th> 
					
				</tr> 

%				my $switch;

% 				foreach my $panel (sort {$a->letter cmp $b->letter} $round->panels) { 

				    <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
					
						<td class="smaller">
							<% ($panel->room) ? $panel->room->name : "" %>
						</td>	
						
						
						<td class="smaller" style="border-right: 1px solid brown;"> 
%							foreach my $judge ($panel->judges) { 
								<% ($judge->school->id ) ? ($judge->school->code) ? $judge->school->code : "" : "" %>
								<% $judge->code %>
% 							}
						</td>

% 						my @comps = $panel->comps unless $tourn->circuit->diocese_based;
%						@comps = $panel->comps_region if $tourn->circuit->diocese_based;
%						my $count;

% 						foreach my $comp (@comps) { 

%							if ( ($event->type eq "speech" && $count == 7) 
%									|| ($event->type eq "congress" && $count == 4)
%	  								|| ($tourn->method->schemat_display eq "full_names" && $count == 4)
%	 	 							|| ($tourn->method->schemat_display eq "last_names" && $count == 5)) {
								
						</tr>

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
									
							<td class="smaller" style="border-right: 1px solid brown;" colspan="3">
								<br />
							</td>

%								$count = 0;
%							}

							<td class="smaller">
%								if ($event->type eq "speech") { 
		
%									if ($tourn->method->schemat_school_code) { 
										<% $comp->school->code %>
%									}

%									if ($tourn->method->schemat_display eq "last_names") { 

										<% $comp->student->last %>

%										if ($event->team == 2) { 
											& <% $comp->partner->last %>
%										}
%									}

%									if ($tourn->method->schemat_display eq "full_names") { 

										<% $comp->student->first." ".$comp->student->last %>

%										if ($event->team == 2) { 
											<% $comp->partner->first." ".$comp->partner->last %>
%										}
%									}

%									if ($tourn->method->schemat_display eq "codes") { 
										<% $comp->code %>
%									}

%								}

%								if ($event->type eq "congress") { 
									<% $comp->student->first." ".$comp->student->last."<br /> ".$comp->school->name %> 
%								}
	
								</td>
%								$count++;

%							} # end of foreach comp

%							foreach my $count ($count .. 6) {
								<td></td>
%							}

						</tr>

%					} #end of foreach panel  

			</table>

%		} elsif ($news) { 

			<p>
				<% $news->text %>
			</p>

%		} else { 

%		}

	</div>

	<& sidebar.mas, tourn_id => $tourn_id, event_id => $event_id, round_id => $round_id &>

