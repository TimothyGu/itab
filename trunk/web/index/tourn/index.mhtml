<%args> 
	$tourn_id
	$site_id => undef
	$news_id => undef
</%args>
<%init> 

    my $tourn = Tab::Tournament->retrieve($tourn_id);

	my $circuit = $tourn->circuit;

	my $tz = $circuit->timezone;

	my $news = Tab::News->retrieve($news_id);

	unless ($news) { 
		my @newses = Tab::News->search(tournament => $tourn->id, special => "main" );
		$news = shift @newses if @newses;
	}

	my $site = Tab::Site->retrieve($site_id) if $site_id;

</%init> 

	<div id="leftbig">

%		if ($site) { 

			<h3><% $site->name %></h3>

			<p>Host: <% ($site->host) ? $site->host->first." ".$site->host->last : "None Listed"%></p>

			<p><% $site->directions %></p>


%		} else { 

%			if ($news) { 
				<% ($news && $news->title ne "main") ? "<h2>".$news->title."</h2>" : "" %>
				<p><% ($news) ? $news->text : "" %></p>
%			} else { 

				<p>The <% $tourn->name %> is hosted on Tabroom.com, an online
				registration and tabulation website run for the community for free.
				The tournament officials have not yet posted information in this
				space; but click the tabs above, and see the details & contact
				information at right, to see more information about the tournament
				as it comes available.  </p>

				<p>If registration is open, there will be a tab above to register.
				You will need to have <a href="/user/login/new_user.mhtml">created a tabroom.com account</a>
				before you can register for this tournament.

%			}

%		}

	</div>


	<div id="rightsmall">
		
			<a class="redblock" href="/index/circuit/index.mhtml?circuit_id=<% $circuit->id %>">Circuit: <% $circuit->name %></a>

			<hr />

%   	if ($tourn->invitename) {

			<a class="redblock" href="/files/<% $tourn->circuit->id %>/tournaments/<% $tourn->id."/".$tourn->invitename %>">
				Tournament Invitation (Download)
			</a>

%   	}

%   if ($tourn->bill_packet) {

			<a class="redblock" href="/files/<% $tourn->circuit->id %>/tournaments/<% $tourn->id."/bills/".$tourn->bill_packet %>">
				Congress Legislation (Download)
			</a>
%   }

		<h3>Contacts:</h3> 

%			my $c = $tourn->director;

			<a class="blueblock" href="mailto:<% $c->email %>">
				<% $c->first." ".$c->last %>
			</a>

%			foreach my $ca ($tourn->accounts) {

%       		next unless $ca->contact;
%       		my $c = $ca->account;

				<a class="blueblock" href="mailto:<% $c->email %>">
					<% $c->first." ".$c->last %>
				</a>

%			}

%		my $switch;

		<h3>Dates & Deadlines</h3>

		<table cellpadding="3" cellspacing="1" width="100%">
		
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th class="smaller">
					Tournament:
				</th>

				<td class="smaller">
					<% Tab::niceshortdate($tourn->start->set_time_zone($tz)) %>
					<% ($tourn->start->mdy ne $tourn->end->mdy) ? " to ".Tab::niceshortdate($tourn->end->set_time_zone($tz)) : "" %>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th class="smaller">
					Registration Opens
				</th>

				<td class="smaller">
					<% ($tourn->reg_start) ? Tab::niceshortdt($tourn->reg_start->set_time_zone($tz)) : "Not Set" %>
				</td>
			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th class="smaller">
					New Entries Due
				</th>

				<td class="smaller">
					<% ($tourn->reg_end) ? Tab::niceshortdt($tourn->reg_end->set_time_zone($tz)) : "Not Set" %>
				</td>
			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th class="smaller">
					Entry Fees Frozen
				</th>

				<td class="smaller">
					<% ($tourn->freeze_deadline) ? Tab::niceshortdt($tourn->freeze_deadline->set_time_zone($tz)) : "Not Set" %>
				</td>
			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th class="smaller">
					Judging Due
				</th>

				<td class="smaller">
					<% ($tourn->judge_deadline) ? Tab::niceshortdt($tourn->judge_deadline->set_time_zone($tz)) : "Not Set" %>
				</td>
			</tr>

	        <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

	            <th class="smaller">
					Drop online until
	            </th>

	            <td class="smaller">
	                <% ($tourn->drop_deadline) ?  &Tab::niceshortdt($tourn->drop_deadline->set_time_zone($tz)) : "Not Set" %>
	            </td>
	
	        </tr> 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
			
				<th class="smaller">
                	Penalty fines after
	            </th>

	            <td class="smaller">
     	           <% ($tourn->fine_deadline) ? &Tab::niceshortdt($tourn->fine_deadline->set_time_zone($tz)) : "Not Set" %>
       		    </td>

	        </tr>

		</table>

		<h3>Location<% (scalar $tourn->sites > 1) ? "s" : ""%></h3>

%		foreach my $site ($tourn->sites) {

				<a class="<% ($site_id == $site->id) ? "chosenblock" : "blueblock" %>" href="index.mhtml?site_id=<% $site->id %>&tourn_id=<% $tourn_id %>">
					<% $site->name %>
				</a>
%		}


	</div>

