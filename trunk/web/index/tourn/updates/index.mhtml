<%args>
	$account => undef
	$tourn_id
	$event_id => undef
	$group_id => undef
	$tz
</%args>
<%init>

	use POSIX;

	my $tourn =  Tab::Tourn->retrieve($tourn_id);
	my $event = Tab::Event->retrieve($event_id) if $event_id;  
	my $group = Tab::JudgeGroup->retrieve($group_id) if $group_id;

	my ($entref, $judgeref, $schref) = $m->comp("/funclib/account_follows.mas", tourn => $tourn, account => $account)  if $account;

	my $switch;

</%init>

	<& sidebar.mas, tourn_id => $tourn_id, event_id => $event_id, group_id => $group_id &>

	<div class="left huge">

		<span class="hugespan">

			<h2>
				<% $tourn->name %> 
			</h2>

		</span>

		<span class="medspan">
			<h4 style="text-align: right;">
				<% $tourn->location %>  
			</h4>
		</span>

		<br style="clear: both;">

		<& /index/tourn/tourn_header.mas, tourn => $tourn, account => $account &>

		<h3>Who you are following:</h3>

		<p>Tap to remove</p>

%		foreach my $entry (@{$entref}) { 
			<a class="halfspan blue block smallish padmore" href="update_remove.mhtml?entry_id=<% $entry->id %>&tourn_id=<% $tourn_id %>">
				Entry: <% $entry->code.": ".$entry->name %>
			</a>
%		}

%		foreach my $judge (@{$judgeref}) { 
			<a class="halfspan blue block smallish padmore" href="update_remove.mhtml?judge_id=<% $judge->id %>&tourn_id=<% $tourn_id %>">
				Judge: <% $judge->code.": ".$judge->first." ".$judge->last %>
			</a>
%		}

%		foreach my $school (@{$schref}) { 
			<a class="halfspan blue block smallish padmore" href="update_remove.mhtml?school_id=<% $school->id %>&tourn_id=<% $tourn_id %>">
				School: <% $school->code.": ".$school->name %>
			</a>
%		}

%		if ($event) { 

			<h3><% $event->name %> entries</h3>

			<p>Click on a student to follow their live updates</p>

%				my @entries = sort {$a->school->name cmp $b->school->name} $event->entries ( dropped => 0, waitlist => 0);
%				my $total = scalar @entries;
%				my $count;

				<div style="width: 20em; float: left; margin-right: 10px; margin-left: 10px;">

%				foreach my $entry (@entries) {

%					if ($count == ceil($total /2)) {
						</div>
						<div style="width: 20em; float: left;">
%					}

%					$count++;

					<a class="smallish blue block" href="entry.mhtml?entry_id=<% $entry->id %>&tourn_id=<% $tourn_id %>">
						<span class="medspan nowrap" style="width: 100px;">
						<% $entry->code %> 
						</span>
						<% $m->comp("/funclib/entry_students.mas", entry => $entry, name => "last") %>
					</a>

%				}

				</div>


%		}


%		if ($group) { 

			<h3><% $group->name %> judges</h3>
 
			<p>Click on a judge to follow their live updates</p>

%				my @judges = sort {$a->school->short_name cmp $b->school->short_name} $group->judges( active => 1);
%				my $total = scalar @judges;
%				my $count;

				<div style="width: 20em; float: left; margin-right: 10px; margin-left: 10px;">

%				foreach my $judge (@judges) {

%					if ($count == ceil($total /2)) {
						</div>
						<div style="width: 21em; float: left;">
%					}

%					$count++;

					<a class="smallish blue block" href="judge.mhtml?judge_id=<% $judge->id %>&tourn_id=<% $tourn_id %>">

						<% $judge->last." ".$judge->first %>
						<span class="medspan nowrap" style="width: 100px; margin-right: 10px;">
							<% ($judge->school && $judge->school->id) ? $judge->school->short_name : "Hired"  %>
						</span>
					</a>

%				}

				</div>


%		}

	</div>


