<%args>
	$account => undef
	$circuit => undef
	$circuit_id => undef
	$startdate => undef
	$enddate => undef
</%args>
<%init>
	
	use Time::HiRes qw( time );
	use Data::Dumper;

	if ($circuit_id) { $circuit = Tab::Circuit->retrieve( $circuit_id ); }
	unless ($circuit) { $circuit = Tab::Circuit->retrieve( 43 ); $circuit_id=43; }
	
#Load tournaments

	Tab::Tourn->columns(TEMP => qw/event_name/);	
	Tab::Tourn->columns(TEMP => qw/event_id/);	
	Tab::Tourn->columns(TEMP => qw/tourney_id/);	
	Tab::Tourn->set_sql(pull_tourneys => "
		select tourn.*, event.id, event.name as event_name, event.id as event_id, tourn.id as tourney_id
		from tourn, event, tourn_circuit
		where event.tourn=tourn.id
		and tourn.id=tourn_circuit.tourn 
		and tourn_circuit.circuit = $circuit_id
		order by tourn.id, tourn.start
	");
	
	my @tourn = Tab::Tourn->search_pull_tourneys;

</%init>

	<& menu.mas, circuit_id => $circuit_id &>
	
	<div class="left huge">
	
	<h2>Tourney results for <% $circuit->name %></h2>

		<div>

			<form action="circuit_stats.mhtml?circuit_id=<% $circuit_id %>&startdate=<% $startdate %>">
				<Strong>Date range: </strong>
				Start date <input type="text" name="startdate" size="10" value=<% $startdate %>>
				End date <input type="text" name="enddate" size="10" value=<% $enddate %>>
				<input type="submit" value="Recalculate">
			</form>

		</div>

		<& /funclib/tablesorter.mas, table => "Stats" &>

		<table cellpadding="3" width="100%" id="Stats" class="tablesorter">

		<thead>
			<tr class="dkgreen">
				<th class="smaller">Tourn</th>
				<th class="smaller">Date</th>
				<th class="smaller">Event</th>
				<th class="smaller">Records by team (virtual cume sheet)</th>
				<th class="smaller">Final Places</th>
				<th class="smaller">Cume Sheet</th>
				<th class="smaller">Elim Bracket</th>				
			</tr>
		</thead>

%		foreach my $tourney (@tourn) {
		<tr>
			<td> <% $tourney->name %> </td>
			<td> <% Tab::pickerdate($tourney->start) %> </td>
			<td> <% $tourney->event_name %></td>
			<td>
				<a class="plain fullblock padless" href="/index/tourn/results/ranked_list.mhtml?event_id=<% $tourney->event_id %>&tourn_id=<% $tourney->tourney_id %>">Virtual tab</a>
			</td>
			<td>
				<a class="plain fullblock padless" href="/index/tourn/results/ranked_list.mhtml?event_id=<% $tourney->event_id %>&tourn_id=<% $tourney->tourney_id %>">Virtual tab</a>
			</td>
			<td>
				<a class="plain fullblock padless" href="/index/circuit/calendar.mhtml?circuit_id=<% $circuit->id %>">Cume Sheet</a>
			</td>
			<td>
				<a class="plain fullblock padless" href="/index/circuit/calendar.mhtml?circuit_id=<% $circuit->id %>">Elim Bracket</a>
			</td>
		</tr>
%		}		

		</table>
		
%# my $end = time(); print "<br>Load time ";
%# printf("%.2f\n", $end - $start);

	</div>
