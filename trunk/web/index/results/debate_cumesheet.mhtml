<%args>
	$event_id    => 24885

</%args>

<%init>

	use Data::Dumper;
	
	my @ballots;
	Tab::BallotValue->columns(TEMP => qw/panel_bye/);						
	Tab::BallotValue->columns(TEMP => qw/ballot_bye/);
	Tab::BallotValue->columns(TEMP => qw/judge/);	
	Tab::BallotValue->columns(TEMP => qw/panel/);	
	Tab::BallotValue->columns(TEMP => qw/entry/);
	Tab::BallotValue->columns(TEMP => qw/tag/);
	Tab::BallotValue->columns(TEMP => qw/score /);
	Tab::BallotValue->columns(TEMP => qw/round /);
	Tab::BallotValue->columns(TEMP => qw/round_label /);
	Tab::BallotValue->set_sql(pull_entry => "
		SELECT ballot_value.*, entry.id as entry, ballot.judge as judge, panel.id as panel, round.name as round, round.label as round_label, panel.bye as panel_bye, ballot.bye as ballot_bye
		FROM ballot, entry, ballot_value, panel, round
		WHERE entry.event=24885
		and ballot.entry=entry.id
		and ballot_value.ballot=ballot.id
		and ballot_value.tag != 'rfd'
		and panel.id=ballot.panel
		and round.id=panel.round
		order by entry.id asc, round.name asc
	");
	@ballots = Tab::BallotValue->search_pull_entry;

	#So it stores all the ballot_values in a hash, one for scores, one for judges
	#For %team_scores, it goes {entry.id}{round.id}{student}, and note that if it stores a zero for student it's a team score
	my %team_scores;
	my %team_judges;
	foreach my $ballot (@ballots) {
		$team_scores{$ballot->entry}{$ballot->round}{$ballot->student} .= $ballot->value;
		if ( $ballot->panel_bye or $ballot->ballot_bye ) { 
			$team_scores{$ballot->entry}{$ballot->round}{$ballot->student} .= "bye/fft";
		}
		$team_judges{$ballot->entry}{$ballot->round} = $ballot->judge;
	}

	my @decision;
	$decision[0]="Loss";	
	$decision[1]="Win";	
</%init>

	<& menu.mas &>

	<h2> A table </h2>

	<a onclick="showall();" >Show All</a> <a onclick="hideall();" >Hide All</a> 
	
	<div class="left huge">

	<script>
		
		functiontest = function() {
			var MasterTable = document.getElementById("table_body");
			var TableRows = MasterTable.getElementsByTagName("tr");
			for (var i = 0; i < TableRows.length; i++) {
				TableRows[i].style.display = (TableRows[i].style.display === "none") ? "table-row" : "none" ;
			}
			
		}

		showall = function() {
			var MasterTable = document.getElementsByTagName("tr");
			for (var i = 0; i < MasterTable.length; i++) {
				MasterTable[i].style.display = "table-row";
			}
			
		}

		hideall = function() {
			var MasterTable = document.getElementsByClassName("none");
			for (var i = 0; i < MasterTable.length; i++) {
				MasterTable[i].style.display = "none";
			}
			
		}

		var row_name ="team1";
		functiontest2 = function(row_name) {
//			var TableRows = document.getElementsByName("team1");
//			window.alert("Received variable is:" + row_name);
			var TableRows = document.getElementsByName(row_name);
			for (var i = 0; i < TableRows.length; i++) {
				TableRows[i].style.display = (TableRows[i].style.display === "none") ? "table-row" : "none" ;
			}
			
		}
		
	</script>
	
	<table cellpadding="3" width="100%" id="WUDC" class="tablesorter">

		<tbody id="table_body">

			<tr class="dkgreen" > 
				<td>Cal State Fullerton</td>
				<td>Josh Clark & Cameron Ward</td>
				<td>7-1</td>
				<td>367.2 pts/1st seed</td>
				<td align="right"><a onclick="functiontest2('team1');">hide/show</a></td>
			</tr>	

			<tr class="none" style="display:none" name="team1" bgcolor="GreenYellow" > 
				<td>Round</td>
				<td>Judge</td>
				<td>Decision</td>
				<td>Clark</td>
				<td>Ward</td>
			</tr>	

			<tr class="none" style="display:none" name="team1" > 
				<td>1</td>
				<td>Shanahan</td>
				<td>Win</td>
				<td>28.5</td>
				<td>29.1</td>
			</tr>	

			<tr class="none" style="display:none" name="team1" > 
				<td>2</td>
				<td>Hall</td>
				<td>Win</td>
				<td>28.8</td>
				<td>29.7</td>
			</tr>	
		

			<tr class="dkgreen" > 
				<td>Cal State Fullerton</td>
				<td>Amy Dempster & Josh Pang</td>
				<td>5-3</td>
				<td>380.2 pts/12th seed</td>
				<td align="right"><a onclick="functiontest2('team2');">hide/show</a></td>
			</tr>	

			<tr class="none" style="display:none" name="team2" bgcolor="GreenYellow" > 
				<td>Round</td>
				<td>Judge</td>
				<td>Decision</td>
				<td>Dempster</td>
				<td>Pang</td>
			</tr>	

			<tr class="none" style="display:none" name="team2" > 
				<td>1</td>
				<td>Shanahan</td>
				<td>Win</td>
				<td>28.5</td>
				<td>29.1</td>
			</tr>	

			<tr class="none" style="display:none" name="team2" > 
				<td>2</td>
				<td>Hall</td>
				<td>Win</td>
				<td>28.8</td>
				<td>29.7</td>
			</tr>	

		</tbody>

		</table>

		<table>
			<tbody id="table_body">


%			foreach my $entry_key ( keys %team_scores) {

%			my $entry_names = Tab::Entry->retrieve($entry_key);
%			my @temp_array = Tab::EntryStudent->search( entry=>$entry_key);				

			<tr class="dkgreen" >
				<td><% $entry_names->school->name %></td>
				<td><% $entry_names->name %></td>
				<td></td>
%				foreach my $entry_student (@temp_array) {
				<td><% $entry_student->student->first  %> <% $entry_student->student->last %></td>
%				}
				<td align="right"><a onclick="functiontest2('team<% $entry_key %>');">hide/show</a></td>
			</tr>

			<tr class="none" style="display:none" name="team<% $entry_key %>" bgcolor="GreenYellow" >
				<td>Round</td>
				<td>Opponent</td>
				<td>Judge</td>
				<td>Decision</td>				
%				foreach my $entry_student (@temp_array) {
				<td><% $entry_student->student->first  %> <% $entry_student->student->last %></td>
%				}
			</tr>

%			foreach my $round_key ( sort keys %{$team_scores{$entry_key}} ) {			

			<tr class="none" style="display:none" name="team<% $entry_key %>" >
			
				<td>
				<% $round_key %>
				</td>
				<td>Those Guys</td>
				<td><% $team_judges{$entry_key}{$round_key} %></td>

				<td>
%					if ($decision[$team_scores{$entry_key}{$round_key}{0}] eq 'bye/fft') { print "bye/fft" }; 
%					if ($decision[$team_scores{$entry_key}{$round_key}{0}] ne 'bye/fft') { print $decision[$team_scores{$entry_key}{$round_key}{0}] };
				</td>								
%				foreach my $entry_student (@temp_array) {
				<td><% $team_scores{$entry_key}{$round_key}{$entry_student->student} %></td>
%				}

			</tr>
%				}

%			}	

			</tbody>
		</table>	
	</div>
