<%args>
	$round => undef
	$round_id => undef
</%args>
<%init>


	Tab::Ballot->set_sql( audit_round => "
		update ballot, ballot_value, panel
		set ballot.audit = 1
		where panel.round = ?
		and panel.id = ballot.panel
		and ballot.id = ballot_value.ballot
		and ballot_value.value > 0
		and ballot_value.value is not null");

	Tab::Ballot->set_sql( zero_round => "
		update ballot, panel
		set ballot.audit = 0
		where panel.round = ?
		and panel.id = ballot.panel
		and not exists ( 
			select ballot_value.id 
			from ballot_value
			where ballot_value.ballot = ballot.id
			and ballot_value.value > 0
			and ballot_value.value is not null)");
	
	
	Tab::Ballot->sql_audit_round->execute($round->id) if $round;
	Tab::Ballot->sql_audit_round->execute($round_id) if $round_id;

	Tab::Ballot->sql_zero_round->execute($round->id) if $round;
	Tab::Ballot->sql_zero_round->execute($round_id) if $round_id;

	return;


</%init>
