<%args>
	$account
	$league_id
	$email => undef
</%args>
<%init>

	my $err;

	my $league = Tab::League->retrieve($league_id);

	 my @league_access = Tab::LeagueAdmin->search( league => $league_id, account => $account->id) if $league_id;

    unless ($account->site_admin || @league_access) {
        $err = "Only site or league admins may make changes to leagues";
        $m->redirect("$Tab::url_prefix/league/league_view.mhtml?err=$err&league_id=$league_id");
    }

	my @accounts = Tab::Account->search( email => $email);

	unless (@accounts) { 
		$err = "No accounts with the email address $email were found";
        $m->redirect("$Tab::url_prefix/league/league_view.mhtml?err=$err&league_id=$league_id");
	}

	my $admin = $accounts[0];

	my @existing = Tab::LeagueAdmin->search( account => $admin->id, league => $league_id );

	foreach (@existing) { $_->delete; }

	my $league_admin = Tab::LeagueAdmin->create({
		league => $league_id,
		account => $admin->id
	});

	$err = $admin->first." ".$admin->last." is now an admin for ".$league->short_name;
	$m->redirect("$Tab::url_prefix/league/league_view.mhtml?err=$err&league_id=".$league_id);

</%init>
