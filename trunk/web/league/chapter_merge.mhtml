<%args>
	$chapter_id
	$name => undef
	$switch => undef
</%args>
<%init>

	my @ncfls = Tab::League->search(diocese_based => 1);

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	unless ($name) { 
		$name = $chapter->name;
		$name =~ s/High School//g;
		$name =~ s/HS//g;
		$name =~ s/Academy//g;
		$name =~ s/School//g;
		$name =~ s/Prep//g;
	}

	$name = "\%".$name."\%";

	my @others = Tab::Chapter->search_like( name => $name );

</%init>

	<h2>Merge <% $chapter->id %> <% $chapter->name %> <% $chapter->state %> into:</h2>

	<table cellpadding="5" cellspacing="1" width="100%">

%		OTHER:
% 		foreach my $other (@others) { 

%			foreach my $ncfl (@ncfls) {
%				next OTHER if $other->league_membership($ncfl);
%			}

%			next if $other->id == $chapter_id;

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<% $other->name %>
				</td>

				<td>
					<% $other->id %>
				</td>

				<td>
					<% $other->state %>
				</td>

				<td>
					<% scalar ($other->students) %>
				</td>

				<td class="explain">
%					foreach my $league ($other->leagues) {
						<% $league->short_name %>
%					}
				</td>

				<td class="center">
					<form action="chapter_merge_save.mhtml" method="post">
					<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
					<input type="hidden" name="other_id" value="<% $other->id %>">
					<input type="submit" class="red" value=" Merge Into ">
					</form>
				</td>

			</tr>

% 		} # end of foreach other. 


		<tr>
			<td style="padding-top: 15px;">
			</td>
		</tr>


		<tr class="lirdrow">

			<td>
				Merge search:
			</td>

			<td colspan="4">
				<form action="chapter_merge.mhtml" method="post">
				<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
				<input type="text" name="name" size="20">
			</td>

			<td class="center">
				<input type="submit" value=" Search ">
				</form>
			</td>

		</tr>

	</table>
