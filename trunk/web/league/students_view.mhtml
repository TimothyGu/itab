<%args>
	$account
	$chapter_id
	$circuit
	$show_graduated => undef
</%args>

<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);
	my @students;
 
	if ($show_graduated) { 

		@students = $chapter->students;

	} else {

		@students = $chapter->nongrads;

	}

	@students = sort {$a->last cmp $b->last} @students;

</%init>


	<table width="100%" cellpadding="3" cellspacing="1">

		<tr>

			<td width="100%">
				<h2>Students in <% $chapter->name %></h2>
			</td>

			<td class="right">
				<form action="chapter_edit.mhtml" method="post">
				<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
				<input class="blue" type="submit" value="Return to Chapter">
				</form>
			</td>

		</tr>

	</table>

	<table width="100%" cellpadding="5" cellspacing="1">

%		my $switch;

		<tr class="lirdrow">

			<th colspan="2">
				Student
			</th>

			<th>
				Grad Year
			</th>

			<th>
				Novice
			</th>

%			if ($show_graduated) { 

				<th>
					Retired
				</th>

%			}

			<th colspan="2" class="center">
				<form action="students_view.mhtml" method="post">
				<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
				<input type="hidden" name="show_graduated" value="<% ($show_graduated) ? "" : "boomshika" %>">
				<input class="grey" type="submit" value="<% ($show_graduated) ? "Hide Inactives" : "Show Inactives" %>">
				</form>
			</td>
			</th>

		</tr>

% 		foreach my $student (@students) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<% $student->first %>
				</td>

				<td>
					<% $student->last  %>
				</td>
				
				<td>
					<% $student->grad_year %>
				</td>

				<td class="center">
					<% ($student->novice) ? "*" : "" %>
				</td>

%				if ($show_graduated) { 

					<td class="center">
						<% ($student->retired) ? "*" : "" %>
					</td>

%				}

				<td class="right">
					<a class="whiteblock" href="student_edit.mhtml?student_id=<% $student->id %>">
						Edit
					</a>
				</td>

%				if ($account->site_admin) { 
				
					<td class="right">
						<% $student->id %>
					</td>

%				}

			</tr>

% 		}

	</table>
	
	<table width="100%" cellpadding="5" cellspacing="1">

%		undef $switch;

		<tr>
			<td colspan="5">
				<h4 style="padding-top: 15px;">Add new student</h4>
			</td>
		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			<td>
				First Name:
			</td>
	
			<td colspan="3">
				<form action="student_save.mhtml" method="post"> 
				<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
				<input type="text" name="first" size="30">
			</td>
		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			<td>
				Last Name:
			</td>

			<td colspan="3">
				<input type="text" name="last" size="30">
			</td>

		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			<td>
				Gender:
			</td>

			<td>
				<input type="radio" name="gender" value="M">M
			</td>
			
			<td colspan="2">
				<input type="radio" name="gender" value="F">F
			</td>
			
		</tr>

		<tr>
			<td>
				Graduation Year:
			</td>

			<td>
				<input type="text" name="grad_year" size="10">
			</td>
			
			<td>
				Novice:
			</td>

			<td>
				<input type="checkbox" name="novice" value="1">
			</td>
		</tr>

		<tr class="bluerow">
			<td class="right" colspan="4">
				<input class="blue" type="submit" value="Save Student">
				</form>
			</td>
		</tr>

	</table>

