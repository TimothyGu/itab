<%args>
	$circuit
	$basis
	$search_title => undef
	$link_id => undef
</%args>
<%init>

	my @news;

	if ($basis eq "title")  {
		my $search_title = "%".$search_title."%";
		@news = Tab::News->search_like( title => $search_title, circuit => $circuit->id);	
	}

	if ($basis eq "link") { 
		my $link = Tab::Link->retrieve($link_id);
		@news = $link->news;
	}

	my $switch;

</%init>

	<table width="100%">

		<tr>

			<td width="100%">
				<h2><% (@news) ? scalar @news." articles found: " : "No articles found " %></h2>
			</td>

			<td>
				<form action="website.mhtml" method="post">
				<input  type="submit" value="Return to Site Admin">
				</form>
			</td>

	</table>

	<table cellpadding="4" cellspacing="1" width="100%">

% 		foreach my $new (sort {$b->posted->epoch <=> $a->posted->epoch} @news) { 

%	 		my $posted = $new->posted;
%			$posted->set_time_zone($circuit->timezone);

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td class="smaller">
					<% $posted->mdy('/') %>
				</td>

				<td class="smaller">
					<% $new->title %>
				</td>

				<td class="smaller">
					<% $new->link->name %>
				</td>

				<td class="smaller">
					<% substr($new->author->first,0,1)." ".$new->author->last %>
				</td>

				<td class="smallctr">
					<a class="whiteblock" href="news_edit.mhtml?news_id=<% $new->id %>">
					Edit
					</a>
				</td>

			</tr>

% 		}

	</table>

