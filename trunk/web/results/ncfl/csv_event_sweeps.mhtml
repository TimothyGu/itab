<%args>
	$event
	$filepath
</%args>
<%init>

	my @entries = $event->entries( dropped => 0, waitlist => 0); 

	my %sweeps_points = ();
	my %ballot_string = ();

	open (CSV, ">>$filepath.csv");

	if ($event->type eq "speech") { 

		my ($sweeps_points_ref, $ballot_string_ref) = $m->comp("/results/ncfl/speech_sweep_kids.mas", event => $event);
		%sweeps_points = %$sweeps_points_ref;
		%ballot_string = %$ballot_string_ref;

		foreach my $entry (@entries) { 
			my $ballots = $ballot_string{$entry->id};
			chop $ballots;

			print CSV "\"";
			print CSV $entry->code."\",\"";
			print CSV $entry->student->first." ".$entry->student->last;
			print CSV " & ".$entry->partner->first." ".$entry->partner->last if $event->team == 2;
			print CSV "\",\"";
			print CSV $entry->school->name."\",\"";
			print CSV $entry->school->region->code."\",\"";
			print CSV $ballots."\",\"";
			print CSV "\",\"";
			print CSV "\",\"";
			print CSV $sweeps_points{$entry->id}."\"\r\n";
		}
	
	} else { 

		foreach my $entry (@entries) { 
			print CSV "\"";
			print CSV $entry->code."\",\"";
			print CSV $entry->student->first." ".$entry->student->last;
			print CSV " & ".$entry->partner->first." ".$entry->partner->last if $event->team == 2;
			print CSV "\",\"";
			print CSV $entry->school->name."\",\"";
			print CSV $entry->school->region->code."\",\"";
			print CSV "\",\"";
			print CSV $entry->wins."\",\"";
			print CSV $entry->losses."\",\"";
			print CSV $entry->sweeps_points."\"\r\n";
		}
	}

	close CSV;

</%init> 

