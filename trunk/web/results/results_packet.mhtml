<%args>
	$tourn
</%args>
<%init>
	my $tourn_name = $tourn->name;
	my @events = $m->comp("/funclib/tourn_events.mas", tourn => $tourn);
	@events = sort { $a->name cmp $b->name } @events;

	my $tourn_id = $tourn->id;
	my $filename = $Tab::file_root."/tmp/results-".$tourn_id;
	my $garbage = `rm -f $filename.*`;
    my @tab_method = Tab::Setting->search( tournament => $tourn->id, name => "tabbing");
    my $tabbing_method = $tab_method[0]->value;
	my $results_path = "/results/".$tabbing_method."/print_results.mas";
    my @double_entries = Tab::Setting->search( tournament => $tourn->id, name => "natick_double_entry" );
    my $double_entry = $double_entries[0]->value if @double_entries;
	
open (TEXOUT, ">$filename.tex");

print TEXOUT <<"EOF";
\\documentclass[landscape,10pt]{article}
\\usepackage{fullpage}
\\usepackage{helvet}
\\usepackage{nopageno}
\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.1}
\\begin{document}

\\begin{center}
\\large Results: $tourn_name \\\\
\\normalsize
EOF


close TEXOUT;

foreach my $event (@events) { 
	next unless $event->entries;
	next if $event->type eq "congress";
	$m->comp( $results_path , event_id => $event->id, filename => $filename); 
}

if ($double_entry == 1) { 

	open (TEXOUT, ">>$filename.tex");

	print TEXOUT <<'EOF'; 
\begin{tabular*}{1.0\textwidth}{|l|l|l|l} 
\multicolumn{4}{c}{\Large Double Entry Awards } \\
\hline
Rank & School & Student & Points \\ 
\hline
EOF
	close TEXOUT;
	
	$m->comp( "mfl/natick_double_entry.mas", tourn_id => $tourn->id, filename => $filename, print => "tex", limit => 25);

	open (TEXOUT, ">>$filename.tex");
	print TEXOUT "\\end{tabular*} \n";
	close TEXOUT;

}


open (TEXOUT, ">>$filename.tex");

print TEXOUT "\\end{center}\n";
print TEXOUT "\\end{document}\n";
close TEXOUT;

$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
$garbage = `rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
$m->redirect("$Tab::url_prefix/tmp/results-$tourn_id.pdf");

</%init>
