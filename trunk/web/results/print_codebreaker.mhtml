<%args>
	$circuit
	$tourn
	$session
</%args>
<%init>

    my $basename = "/tmp/codebreaker-".$tourn->id."-".$session->id;
    my $filename = $Tab::file_root."".$basename;
    my $garbage = `rm -f $filename.*`;

    open (TEXOUT, ">$filename.tex");

    print TEXOUT <<"EOF";

\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{colortbl}
\\usepackage[hmargin=.75in,vmargin=.5in]{geometry}
\\pagestyle{empty}
\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.1}
\\begin{document}

\\addtolength{\\textwidth}{1in}
\\addtolength{\\hoffset}{0in}
\\addtolength{\\voffset}{.25in}

\\begin{center}
\\small

EOF

	my $tabular = "\\begin{tabular}{|p{.3in}p{.3in}|}\n";
	my $switch;

	print TEXOUT $tabular;
	print TEXOUT "\\hline\n";

	foreach my $comp (sort {$a->code <=> $b->code} $tourn->entries) { 

		if ($switch > 55) { 
			print TEXOUT "\\hline\n";
			print TEXOUT "\\end{tabular}\n";
			print TEXOUT $tabular;
			print TEXOUT "\\hline\n";
			$switch = 1;
		}

		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n"  if ($switch++ % 2);

		print TEXOUT $comp->code." & ";
		
		if ($circuit->diocese_based) { 
			print TEXOUT $comp->school->region->code
		} else { 
			print TEXOUT $comp->school->code
		}

		print TEXOUT "\\\\ \n";

	}

print TEXOUT "\\hline\n";
print TEXOUT "\\end{tabular}\n";

print TEXOUT "\\end{center}\n";
print TEXOUT "\\end{document}\n";
close TEXOUT;

    $garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
    $garbage = `rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
    $m->redirect($Tab::url_prefix."".$basename.".pdf");

</%init>
