<%args>
	$account
	$judge_id
	$tourn
	$debug => undef
</%args>
<%perl>

	my $judge = Tab::Judge->retrieve($judge_id);

	my %already;

	my $msg;

    foreach my $pool ($judge->judge_group->pools) {

		my $in_pool = $ARGS{$pool->id};

		if ($in_pool &! $judge->in_pool($pool)) { 

			Tab::PoolJudge->create({
				pool => $pool->id,
				judge => $judge->id
			});

			$msg .= "Judge added to pool ".$pool->name." <br />";

		} elsif ($judge->in_pool($pool) && not defined $in_pool) { 

			my @pools = Tab::PoolJudge->search({
				pool => $pool->id,
				judge => $judge->id
			});

			foreach (@pools) { $_->delete; }

			$msg .= "Judge removed from pool ".$pool->name." <br />";

		}

	}

	$m->redirect("$Tab::url_prefix/register/judge_edit.mhtml?judge_id=$judge_id&msg=$msg");

</%perl>
