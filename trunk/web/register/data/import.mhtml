<%args>
	$tourn
	$err => undef
	$save_file => undef;
</%args>

	<& sidebar.mas, whoami => "import", tourn => $tourn &>

	<div class="leftbig">

	<h2>Import data into tournament</h2>

	<table cellpadding="5" cellspacing="1" width="75%">

		<tr class="evenrow">

			<td align="center">
				<form action="import.mhtml" method="post">
				File format
			</td>

			<td align="center">

				<select name="save_file">

					<option value="tab" <% ($save_file eq "tab") ? 'selected' : '' %> >
						Tabroom.com export file
					</option>

					<option value="import" <% ($save_file eq "import") ? 'selected' : '' %> >
						Imported text files
					</option>

					<option value="ncfl" <% ($save_file eq "ncfl") ? 'selected' : '' %> >
						NCFL Access Data
					</option>
			
					<option value="fake" <% ($save_file eq "fake") ? 'selected' : '' %> >
						Create Fake Tournament (testing)
					</option>

				</select>

			</td>

			<td align="center">

				<input class="blue" type="submit" value="Set">
				</form>

			</td>

		</tr>

	</table>

%	if ($save_file eq "tab") { 

		<p>Uploading a saved tabroom.com file tournament will completely
		overwrite any events, schools, students, or results in the current
		tournament.  Be careful here.  Life will be awfully miserable if you
		overwrite the tournament with all the results in it, with a tabfile
		that contains nothing.</p>
	
		<table cellpadding="5" cellspacing="1" width="75%">
	
			<tr class="evenrow">

				<td>
					<form enctype="multipart/form-data" action="import_tab.mhtml" method="post">
					Upload Saved Tournament:
				</td>

				<td align="center">
					<input name="tab_file" type="file" class="button">
				</td>

				<td>
					<input class="blue" type="submit" value="  Upload Saved Tournament  ">
					</form>
				</td>

			</tr>

		</table>

%	}

% 	if ($save_file eq "import") {

		<h3>Upload from text files</h3>

			<p>The computer is only so smart; the file you upload must be
			formatted precisely.  All files must be in raw ASCII text.  If you
			save in Excel into CSV format, that will be acceptable as long as
			the fields are in the proper order.</p>

		<h4>Schools file:</h4>

			<p>If you are using regions, you must first load the schools into
			the system in a file separated by commas of the format
			Schoolname,Region.  You may skip this step if you are not using
			regions.</p>

		<table cellpadding="5" cellspacing="1" width="75%">
	
			<tr class="evenrow">
				<td>
					<form enctype="multipart/form-data" action="import_schools.mas" method="post">
					Upload Schools File:
				</td>

				<td align="center">
					<input name="userfile" type="file" class="button">
				</td>

				<td align="center">
					<input class="blue" type="submit" value="Upload">
					</form>
				</td>
			</tr>

		</table>

		<h4>Entry file:</h4>
		
			<ul>

				<li>The fields must be separated by commas in this order:
				Event, Firstname, Lastname, School.  In the case of a paired
				event, the format is Event, Firstname1, Lastname1, Firstname2,
				Lastname2, School.  For a multiple event, the format is Event,
				Teamname, School.  </li>

				<li>The school names must be spelled the same as they were in
				the Schools file.  The events must be spelled the same as it
				was entered into the system. </li>

				<li>Each entry must be on a separate line.</li>

				<li>Entries with the same name from the same school will be
				assumed to be a single double-entered competitor.</li>

				<li><b>If any of the above information is missing or improperly
				formatted, the entry will be skipped and not entered.</b></li>

			</ul>

		<table cellpadding="5" cellspacing="1" width="75%">

			<tr>
				<td>
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="upload" 
						action="import_entry.mas" method="post">
					Upload Entry File:
				</td>

				<td align="center">
					<input name="userfile" type="file" class="button">
				</td>

				<td align="center">
					<input class="blue" type="submit" value="Upload">
					</form>
				</td>

			</tr>

		</table>

<h4>Judge file:</h4>

<p>The judge listing must be in the format Firstname,Lastname,School,Group,Qualification.
The groupname must be spelled the same as the corresponding group in the
system.  All judge qualifications will be set to the default qualification
if it is missing.  If the judge has different qualifications for different
event classes, they must be set manually afterwards in the system. <b>You must
load all schools before loading any judges -- judges with a blank/nonexistent
school will be marked as neutral judges.</b></p>

<center>
<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="upload" 
action="import_judges.mas" method="post">

<p>Upload Judges File:
<input name="userfile" type="file" class="button">
<input class="blue" type="submit" value="Upload"></p>

</form>
</center>

<h4>Rooms file</h4>

<p>The rooms file must be in the format Name,Quality.  If Quality is missing,
a Quality of 3 will automatically be set. </p>

<center>
<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="rooms" 
action="import_rooms.mas" method="post">

<p>Site: <select name="site_id">

% foreach my $site ($tourn->sites) {
	<option value="<% $site->id %>"><% $site->name %></option>

%}
</select></p>

<p>Upload Rooms File:
<input name="rooms" type="file" class="button">
<input class="blue" type="submit" value="Upload"></p>

</form>

</center>


%}

% if ($save_file eq "ncfl") {

<h3>Registered Speaker Codes and Changes:</h3>

<center>
<form enctype="multipart/form-data" 
		onsubmit="return uploadThis()" name="import_file"
		action="import_cfl_codes.mhtml" method="post">

	<p>Upload qryRegisteredSpeakers query result in CSV format:</p>

	<p>
	<input name="userfile" type="file" class="button">
	<input class="blue" type="submit" value="Upload"></p>
	</form>

</center>


<h3>Registered Judge Codes:</h3>

<center>
<form enctype="multipart/form-data" 
		onsubmit="return uploadThis()" name="upload"
		action="import_cfl_judges.mhtml" method="post">

	<p>Upload qryRegisteredJudges query result in CSV format:</p>

	<p>
	<input name="userfile" type="file" class="button">
	<input class="blue" type="submit" value="Upload"></p>
	</form>
</center>

<h3>Judge Pools:</h3>

<center>
<form enctype="multipart/form-data" 
		onsubmit="return uploadThis()" name="upload"
		action="import_cfl_pools.mhtml" method="post">

	<p>Upload qryRegisteredJudges query result in CSV format:</p>

	<p>
	<input name="userfile" type="file" class="button">
	<input class="blue" type="submit" value="Upload"></p>
	</form>
</center>

<h3>Judge Pools:</h3>

<center>
<form enctype="multipart/form-data" 
		onsubmit="return uploadThis()" name="upload"
		action="import_cfl_panels.mhtml" method="post">
		

	<p>Upload Schematics in CSV format:</p>

	<p>Round:
		<select name="round_id">
%	foreach my $round ($tourn->rounds) { 
		<option value="<% $round->id %>"><%$round->event->abbr." ".$round->name %></option>
% 	}	
	</select>
	</p>

	<p>
	<input name="userfile" type="file" class="button">
	<input class="blue" type="submit" value="Upload"></p>
	</form>
</center>

%	}

% if ($save_file eq "fake") { 

<form action="create_fake.mhtml" method="post"> 
<h3>Make a bogus tournament</h3>

<center>
<table cellpadding="3">

	<tr>
	<th>Number of fake schools:</th>
	<td><input type="text" name="num_schools" size="5"></td>
	</tr>

	<tr>
	<th>Number of fake kids per event:</th>
	<td><input type="text" name="num_kids" size="5"></td>
	</tr>

	<tr>
	<td align="center" colspan="2"><input class="blue" type="submit" value="Shake and Fake"></td>
	</tr>

</table>
</center>


% }

