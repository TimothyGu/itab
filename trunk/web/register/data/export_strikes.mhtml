<%args>
	$circuit
	$tourn
	$session
	$group_id
	$dome => undef
	$err => undef
	$debug => 1
</%args>
<%init>

	my $count;

	my $group = Tab::JudgeGroup->retrieve($group_id);

	my @judges = $group->judges(active => 1);

	my @strikes = $m->comp("/funclib/group_strikes.mas", group => $group);

	my %strikes_entry = ();
	my %strikes_school = ();

	my %conflicts_entry = ();
	my %conflicts_school = ();

	foreach my $strike (@strikes) {

		if ($strike->registrant) { 
			$strikes_entry{$strike->entry->id."-".$strike->judge->id}++ if $strike->type eq "entry";
			$strikes_school{$strike->school->id."-".$strike->judge->id}++ if $strike->type eq "school";
		} else { 
			$conflicts_entry{$strike->entry->id."-".$strike->judge->id}++ if $strike->type eq "entry";
			$conflicts_school{$strike->school->id."-".$strike->judge->id}++ if $strike->type eq "school";
		}
	}

	my @entries;

	open (EXPORT, ">$Tab::file_root/tmp/TRPC-Strikes-".$group->abbr.".txt");

	foreach my $event ($group->events) { 

		foreach my $entry ($event->entries) { 

			next if $entry->school->noprefs;

			print EXPORT "-------------------------------------\r";

			print EXPORT "\$".$group->abbr." \*".$entry->code."    ".$entry->school->name."   ".$entry->name."\r\r";

			foreach my $judge (@judges) { 

				print EXPORT "\% ".$judge->code."\ \ \ ";
				print EXPORT "[";

				if ($strikes_entry{$entry->id."-".$judge->id} || $strikes_school{$entry->school->id."-".$judge->id}) { 
					print EXPORT "6";
				} elsif ($conflicts_entry{$entry->id."-".$judge->id} || $conflicts_school{$entry->school->id."-".$judge->id}) { 
					print EXPORT "5";
				} else { 
					print EXPORT "1";
				}

				print EXPORT "]";
				print EXPORT " ".sprintf('%-30s',$judge->last.", ".$judge->first);
				print EXPORT $judge->school->name if $judge->school;
				print EXPORT "Tournament Hire" unless $judge->school;
				print EXPORT "\r";

			}

		}

	}

	close EXPORT;

	$m->redirect("$Tab::url_prefix/tmp/TRPC-Strikes-".$group->abbr.".txt");

</%init>
