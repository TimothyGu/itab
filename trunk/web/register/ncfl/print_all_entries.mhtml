<%args>
	$tourn
	$session
</%args>
<%init>

    my $filename = $Tab::file_root."/tmp/NCFL-all-entries-".$tourn->id."-".$session->id;

    my $filename = "dio-registrations-".$tourn->id."-".$session->id;
    my $filepath = $Tab::file_root."/tmp/";
    system "/bin/rm -rf $filepath"."$filename.*";
    open (TEXOUT, ">>$filepath"."$filename.tex");

    print TEXOUT <<"EOF";

\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{colortbl}
\\usepackage{helvet}
\\usepackage{nopageno}
\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.0}

\\setlength{\\oddsidemargin}{0in}     % default=0in
\\setlength{\\textwidth}{9.5in}       % default=9.5in

\\setlength{\\textheight}{7.0in}      % default=5.15in
\\setlength{\\topmargin}{-0.15in}     % default=0.20in
\\setlength{\\headsep}{0.15in}        % default=0.35in

\\setlength{\\parskip}{1.2ex}
\\setlength{\\parindent}{0mm}

\\begin{document}
EOF


	my @dioceses = sort {$a->code cmp $b->code} $tourn->regions;
	@dioceses = sort {length($a->code) <=> length($b->code)} @dioceses;

	foreach my $diocese (@dioceses) { 

	next if $diocese->code eq "B";

	close TEXOUT;

    $m->comp("/funclib/ncfl/entry_print.mas",
            id => $diocese->id,
            tourn_id => $tourn->id,
            filename => $filename,
            filepath => $filepath
			);

    open (TEXOUT, ">>$filepath"."$filename.tex");
	print TEXOUT "\\newpage\n";
	close TEXOUT;

    $m->comp("/funclib/judges_matrix_print.mas",
            id => $diocese->id,
            tourn_id => $tourn->id,
            filename => $filename,
            filepath => $filepath
			);

    open (TEXOUT, ">>$filepath"."$filename.tex");
	print TEXOUT "\\newpage\n";
	close TEXOUT;

}

    open (TEXOUT, ">>$filepath"."$filename.tex");
	print TEXOUT "\\end{document}\n";
	close TEXOUT;

    `cd $filepath; $Tab::latex_path $filename.tex;`;
    `cd $filepath; $Tab::latex_path $filename.tex;`;
    `cd $filepath; $Tab::dvipdfm_path -l $filename.dvi;`;
    system "cd $filepath; /bin/rm -rf $filename.tex $filename.log $filename.dvi $filename.aux" unless $debug;
    $m->redirect("$Tab::url_prefix/tmp/$filename.pdf");

</%init>

<div id="content">

<p><% $filename %></p>
