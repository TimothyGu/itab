<%args>
	$circuit
	$tourn
	$session
	$judge_id
	$debug => 1
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);

	my $filename = $Tab::file_root."/tmp/judge-card-".$judge->code."-".$session->id;
	my $garbage = `rm -f $filename.*`;
	
	open (TEXOUT, ">$filename.tex");

	print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{times}
\\usepackage{nopageno}
\\usepackage{colortbl}
\\usepackage[hmargin=.5in,vmargin=.75in]{geometry}
\\renewcommand{\\arraystretch}{1.4}
\\begin{document}
\\begin{center}

EOF

	close TEXOUT;

    $m->comp("/funclib/judge_info_card.mas",
            judge_id => $judge_id,
            filename => $filename);

    open (TEXOUT, ">>$filename.tex");
    print TEXOUT "\\end{center}\n";
    print TEXOUT "\\end{document}\n";
    close TEXOUT;

	$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

	`rm -f $filename.tex $filename.log $filename.dvi $filename.aux` unless $debug;

	$m->redirect("$Tab::url_prefix/tmp/judge-card-".$judge->code."-".$session->id.".pdf");

</%init>
