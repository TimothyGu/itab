<%args>	
	$tourn
	$circuit
	$account
	$group_id => undef
	$school_id => undef
</%args>
<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id);
	my $school = Tab::School->retrieve($school_id);

	my $switch;

</%init>

    <& menubar.mas, school => $school, whoami => "judges", tourn => $tourn &>


	<div class="left huge">

	<h4>Add Judge to <% $group->name %></h4>

%		my @ubers = $school->free_ubers;
%		my $now = DateTime->now;

%		if (@ubers) { 

			<div style="float: left;">

				<h5>Existing judge:</h5>

				<table cellpadding="5" cellspacing="1" width="100%">

					<tr>
						<td>
							<form action="judge_save.mhtml" method="post">
							<input type="hidden" name="group_id" value="<% $group->id %>">
							<input type="hidden" name="school_id" value="<% $school->id %>">
		
							<select name="uber_id" size="17">
%								foreach my $uber (sort {$a->last cmp $b->last} @ubers) { 
									<option value="<% $uber->id %>"><% substr($uber->last.", ".$uber->first,0,18) %></option>
%								}
							</select>
						</td>
					</tr>

					<tr class="liblrow">

						<td class="rightalign">
							<input type="submit" value=" Enter Judge ">
							</form>
						</td>
	
					</tr>

				</table>

			</div>
%		} 

		<div style="float: right; padding-left: 2px;">

			<h5>New judge:</h5>

			<table cellpadding="6" cellspacing="1" style="margin-top: 10px;">

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<form action="uber_create.mhtml" method="post">
						<input type="hidden" name="group_id" value="<% $group->id %>">
						<input type="hidden" name="school_id" value="<% $school->id %>">
						First
					</td>

					<td>
						<input type="text" name="first" size="22">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Last
					</td>

					<td>
						<input type="text" name="last" size="22">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Cell #
					</td>

					<td>
						<input type="text" name="phone" size="22">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Gender
					</td>

					<td>
						<span style="float: left; width: 75px;">
							<input type="radio" name="gender" value="F">F
						</span>

						<input type="radio" name="gender" value="M">M

					</td>
				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						First judged (year)
					</td>

					<td>
						<input type="text" name="year" size="22">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Email
					</td>

					<td>
						<input type="text" name="email" size="22">
					</td>

				</tr>


				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Notes
					</td>

					<td>
						<input type="text" name="notes" size="22">
					</td>

				</tr>

				<tr class="liblrow">

					<td colspan="2" align="right">
						<input type="submit" value=" Save & Enter New Judge ">
						</form>
					</td>

				</tr>

			</table>

		</div>

		<br style="clear: both;">

		<hr />

	</div>

	<div class="right small">

		<a class="white block">Categories in red are below obligation:</a>

%		foreach my $ogroup (sort {$a->name cmp $b->name} $tourn->groups) {

%			my $uncovered = $m->comp("/funclib/judgemath/uncovered_burden_by_group.mas", school => $school, group => $ogroup); 
%			my (@useful_judges, @dontcount) = $m->comp("/funclib/judgemath/judges_useful_by_group.mas", school => $school, group => $ogroup);
%			my $obligation = $m->comp("/funclib/judgemath/judges_needed_by_group.mas", school => $school, group => $ogroup);

				<a href="judge_add.mhtml?school_id=<% $school->id %>&group_id=<% $ogroup->id %>" 
					class="<% ($ogroup->id == $group->id) ? "chosenblock" : ($uncovered < 1) ? "blue block" : "red block" %>">

					<span style="float: left;  width: 160px;">
						Add <% substr($ogroup->name,0,15) %> judge 
					</span>

					<% scalar @useful_judges %>/<% $obligation %>
					<% ($uncovered < 1) ? " " : "Unmet" %> 
					<% ($uncovered < 1 && (scalar @useful_judges < $obligation) ) ? "+ Hires " : "" %> 
				</a>

%			if ($ogroup->deadline) {
				<a href="/user/tourn/entry/judge_add.mhtml?school_id=<% $school->id %>&group_id=<% $ogroup->id %>" class="white blockind">
					**<% $ogroup->abbr %> Judges due: <% &Tab::niceshortdt($ogroup->deadline->set_time_zone($tourn->tourn->tz)) %>
				</a>

%			}

%		} 

		<hr />

		<a class="red block" href="school_hires.mhtml?school_id=<% $school->id %>">Judge Hires</a>

	</div>
