<%args> 
	$tourn
	$all => undef
	$event_id => undef
	$school_id => undef
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $school = Tab::School->retrieve($school_id);
	my $event = Tab::Event->retrieve($event_id) if $event_id;

 	my $switch;

</%init>

	<& /register/menubar.mas, school => $school, whoami => "students", tourn => $tourn &>

%	if ($event_id) { 
		<& event_show.mas,  event => $event, school => $school &>
		<& entry_add.mas,  event => $event, school => $school &>
%	} else { 

		<p>Choose an division/event at right to add entries</p>

		<h4>Entry roster:</h4>

		<& /funclib/tablesorter.mas, table => 'sortme' &>

		<table cellpadding="4" cellspacing="1" id="sortme">

			<thead>
			<tr class="yellowrow">

				<th class="smaller">
					Event
				</th>

				<th class="smaller">
					Code
				</th>

				<th class="smaller">
					Name
				</th>

				<th class="smaller">
					Registered
				</th>

				<th class="smaller">
				</th>

				<th class="smaller">
				</th>
			</tr>
		</thead>
		<tbody>

%		foreach my $event ($m->comp("/funclib/school_events.mas", school => $school)) { 

% 			my @entries = Tab::Entry->search( event => $event->id, school => $school->id );
%			my @hybrids = $m->comp("/funclib/school_hybrids.mas", event => $event, school => $school);

% 			foreach my $entry (@entries) { 
				
				<tr>

					<td>
						<% $event->abbr %>
					</td>

					<td class="smallish centeralign">
%						if ($entry->dropped) { 
							<a class="dkred block" href="/register/entry/delete.mhtml?entry_id=<% $entry->id %>">
								DELETE
							</a>
%						} else {
							<a class="white block" href="/register/entry/edit.mhtml?entry_id=<% $entry->id %>">
								<% ($entry->waitlist) ? "Waitlist" : "" %>
								<% ($entry->dq) ? "DQ" : "" %>
								<% $entry->code %>
							</a>
%						} 
					</td>
	
					<td <% ($entry->dropped) ? "class=\"strike\"" : "" %> >
						<a class="white block" href="/register/entry/edit.mhtml?entry_id=<% $entry->id %>">
						<% $entry->name %>
						</a>
					</td>

%					if ($event->tourn->setting("ask_quals")) { 
						<td>
%							my $notfirst;
%							foreach my $qual ($entry->qualifiers) { 
								<% ($notfirst) ? "<br />" : "" %>
								<% $qual->name %> 
								<% ($qual->result) ? "(".$qual->result.")" : "" %> 
%									$notfirst++;
%							}
						</td>
%					}

					<td class="centeralign smaller">
						<% $entry->reg_time ? Tab::niceshortdt($entry->reg_time->set_time_zone($tz)) : "" %>
					</td>

					<td class="centeralign smaller">
						<% $entry->dropped ? "Dropped" : "" %>
						<% ($entry->dropped && $entry->drop_time) ? "at: ".Tab::niceshortdt($entry->drop_time->set_time_zone($tz)) : "" %>
						<% ($entry->title) ? $entry->title : "" %>
					</td>


					<td class="centeralign">
						<a class="<% ($entry->dropped) ? "dkgreen" : "dkred" %> block" href="drop_switch.mhtml?entry_id=<% $entry->id %>">	
							<% ($entry->dropped) ? "Un-Drop" : "Drop" %>
						</a>
					</td>

				</tr>
%   		}

%			foreach my $entry (@hybrids) { 
			
				<tr>

					<td class="smaller centeralign">

%						if ($entry->dropped) { 
							<a class="dkred block" href="/register/entry/delete.mhtml?entry_id=<% $entry->id %>">
								DELETE
							</a>
%						} else {
							<% ($entry->waitlist) ? "Waitlist" : "" %>
							<% ($entry->dq) ? "DQ" : "" %>
%						} 
					</td>
	
					<td <% ($entry->dropped) ? "class=\"strike\"" : "" %> >
						<a class="white block" href="/register/entry/edit.mhtml?entry_id=<% $entry->id %>">
						<% $m->comp("/funclib/entry_name.mas", entry => $entry) %>
						</a>
					</td>

%					if ($event->tourn->setting("ask_quals")) { 

						<td>
%							my $notfirst;
%							foreach my $qual ($entry->qualifiers) { 
								<% ($notfirst) ? "<br />" : "" %>
								<% $qual->name %> 
								<% ($qual->result) ? "(".$qual->result.")" : "" %> 
%								$notfirst++;
%							}
						</td>
%					}

					<td class="centeralign smaller">
						<% Tab::niceshortdt($entry->reg_time->set_time_zone($tz)) %>
					</td>

					<td class="centeralign smaller">
						(<% $entry->school->name %> Hybrid) <br/>
						<% ($entry->dropped) ? "Dropped at: ".Tab::niceshortdt($entry->drop_time->set_time_zone($tz)) : "" %>
						<% ($entry->title) ? $entry->title : "" %>
					</td>

					<td class="centeralign">
						<a class="<% ($entry->dropped) ? "dkgreen" : "dkred" %> block" href="drop_switch.mhtml?entry_id=<% $entry->id %>">	
							<% ($entry->dropped) ? "Un-Drop" : "DROP" %>
						</a>
					</td>

				</tr>
%   		}
%   	}

		</tbody>

		</table>
%	} 

	</div>

	<& entry_menu.mas, tourn => $tourn, school => $school, event_id => $event_id &>

