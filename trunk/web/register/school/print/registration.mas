<%args>
	$school_id
	$filename
</%args>
<%init>

	use POSIX;

	my $school = Tab::School->retrieve($school_id);
	my $tourn  = $school->tourn;

	my @entries = Tab::Entry->search( school => $school->id );
	@entries = sort { $a->code <=> $b->code } @entries;
	@entries = sort { $a->event->name cmp $b->event->name } @entries;

	my $filepath = $Tab::file_root."/tmp/".$filename;
	open (TEXOUT, ">>$filepath.tex");

	my $switch;

	print TEXOUT "\\begin{tabular}{p{6.9in}}\n";
	print TEXOUT "\\rowcolor[rgb]{1,.96,.95}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);
	print TEXOUT "{\\bf Entries: ".$school->name." }\\\\ \n";
	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\newline\n";

	foreach my $entry (@entries) { 

		print TEXOUT "\\begin{tabular}{p{.65in}p{1.75in}p{4.15in}}\n";
		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);

		if ($entry->waitlist) { 
			print TEXOUT "Waitlist ";
		} elsif ($entry->dropped) { 
			print TEXOUT "{\\bf DROP} ";
		} else { 
			print TEXOUT $m->comp("/funclib/entry_code.mas", entry => $entry);
		}

		print TEXOUT " & ";

		print TEXOUT Tab::texify($entry->event->name)." & ";
		print TEXOUT Tab::texify($m->comp("/funclib/entry_students.mas", entry => $entry, name => "full"));

		print TEXOUT "\\\\ \n";
		print TEXOUT "\\end{tabular}\n";
		print TEXOUT "\\newline\n";

	}

	unless ($school->judges) { 
		return;
	}

    print TEXOUT "\\begin{tabular}{p{6.9in}}\n";
	print TEXOUT "\\\\ \n";
    print TEXOUT "\\end{tabular}\n";
    print TEXOUT "\\newline\n";

    print TEXOUT "\\newline\n";
    print TEXOUT "\\begin{tabular}{p{6.9in}}\n";
	print TEXOUT "\\rowcolor[rgb]{1,.96,.94}\[5.5pt\]\[5.5pt\]\n";
    print TEXOUT "{\\bf Judges: ". &Tab::texify($school->chapter->name) ."}\\\\\n" if $school->judges;
    print TEXOUT "{\\bf *No judges listed* }\\\\\n" unless $school->judges;
    print TEXOUT "\\end{tabular}\n";
    print TEXOUT "\\newline\n";


	my @judges = sort { $a->last cmp $b->last } $school->judges;

	undef $switch;

	foreach my $judge (@judges) {

		print TEXOUT "\\begin{tabular}{p{.50in}p{.25in}p{1.25in}p{2.1in}p{2.15in}}\n";
		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);

		print TEXOUT &Tab::texify($school->code) if $school->code;
		print TEXOUT &Tab::texify($judge->code) ." & ";
		print TEXOUT &Tab::texify($judge->judge_group->abbr)." & ";
		print TEXOUT &Tab::texify($judge->last.", ".$judge->first)." & ";
		print TEXOUT &Tab::texify($judge->notes)." & ";

		foreach my $pool ($m->comp("/funclib/judge_pools.mas", judge => $judge, registrant => 1)) { 
			print TEXOUT &Tab::texify($pool->name)." ";
		}

		print TEXOUT "\\\\ \n";
		print TEXOUT "\\end{tabular}\n";
		print TEXOUT "\\newline\n";

	}
	
	close TEXOUT;

</%init>

