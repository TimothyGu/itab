<%args>
	$tourn
	$circuit
	$chapter_id => undef
	$school_id => undef
	$account
</%args>
<%init>

	use POSIX;

	my $chapter;
	my $school;

	unless ($school_id || $chapter_id) { 
		my $err = "You have accessed the registration page incorrectly.  Please try again.";
		$m->redirect("$Tab::url_prefix/register/registration.mhtml?err=$err");
	}

	if ($chapter_id) { 
		$chapter = Tab::Chapter->retrieve($chapter_id);
	}

	if ($school_id) {
		$school = Tab::School->retrieve($school_id);
		$chapter = $school->chapter;
	}

	my $switch;

</%init>

	<& /register/menubar.mas, school => $school, whoami => "judges", tourn => $tourn &>


		<table cellpadding="5" cellspacing="1" width="100%">

%			foreach my $group ($tourn->groups) { 

%				my @judges = $school->judges( judge_group =>  $group->id );
%				push (@judges, $school->judges( alt_group => $group->id));

%				next unless @judges;

				<tr>
					<td colspan="5">
						<h4><% $group->name %></h4>
					</td>
				</tr>

% 				foreach my $judge (@judges) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<a class="normal white block" href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>">
								<% $judge->code %>
							</a>
						</td>

						<td>
							<a class="normal white block" href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>">
								<% $judge->first." ".$judge->last%>
							</a>
						</td>

						<td class="centeralign">
							<% ($judge->covers && $judge->covers->id > 0 && $judge->covers->id != $judge->judge_group->id) ? "Counts as ".$judge->covers->abbr : "" %>
						</td>

%						if ($group->setting('coach_ratings')) { 

							<td class="centeralign">
								<% $m->comp("/funclib/judge_rating.mas", judge => $judge, print => 1) %>
							</td> 

%						} else { 
	
							<td></td>

%						}

						<td class="centeralign">
							<a class="dkgreen block" href="/register/judge/drop.mhtml?judge_id=<% $judge->id %>&school_id=<% $school->id %>">
								Drop
							</a>
						</td>
	
					</tr>

% 				} 

%			} 

		</table>

	</div>

	<& judge_menu.mas, school => $school &>

