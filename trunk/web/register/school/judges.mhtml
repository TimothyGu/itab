<%args>
	$tourn
	$circuit
	$chapter_id => undef
	$school_id => undef
	$account
</%args>
<%init>

	use POSIX;

	my $chapter;
	my $school;

	unless ($school_id || $chapter_id) { 
		my $err = "You have accessed the registration page incorrectly.  Please try again.";
		$m->redirect("$Tab::url_prefix/register/index.mhtml?err=$err");
	}

	if ($chapter_id) { 
		$chapter = Tab::Chapter->retrieve($chapter_id);
	}

	if ($school_id) {
		$school = Tab::School->retrieve($school_id);
		$chapter = $school->chapter;
	}

	my $switch;

</%init>

	<& /register/menubar.mas, school => $school, whoami => "judges", tourn => $tourn &>

%		foreach my $group ($tourn->groups) { 

%			my @judges = $school->judges( judge_group =>  $group->id );
%			push (@judges, $school->judges( alt_group => $group->id));
%			next unless @judges;
		
			<h4><% $group->name %></h4>

			<table cellpadding="5" cellspacing="1" width="100%">

				<tr class="yellowrow">

%					unless ($group->setting("no_codes")) { 
						<th>
							Code
						</th>
%					}

					<th>
						Name
					</th>

					<th>
						Counts as
					</th>

%					if ($group->setting('rounds_per')) { 
						<th>
							Rounds
						</th>
%					}
					
%					if ($group->setting('coach_ratings')) { 
						<th>
							Rating
						</th>
%					}

					<th>
					</th>

				</tr>


% 				foreach my $judge (@judges) { 

					<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"  %>">

%						unless ($group->setting("no_codes")) { 
							<td class="<% ($judge->dropped) ? "strike" : "" %>">
								<a class="normal white block" href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>">
									<% $judge->code %>
								</a>
							</td>
%						}

						<td class="<% ($judge->dropped) ? "strike" : "" %>">
							<a class="normal white block" href="/register/judge/edit.mhtml?judge_id=<% $judge->id %>">
								<% $judge->first." ".$judge->last%>
							</a>
						</td>

						<td class="centeralign">
%							if ($judge->dropped) { 
								DROP
%							} else { 
								<% ($judge->covers && $judge->covers->id > 0 && $judge->covers->id != $judge->judge_group->id) ? $judge->covers->name : $judge->judge_group->name %>
%							}  
						</td>

%						if ($group->setting('rounds_per')) { 

							<td class="centeralign">
%								if ($judge->dropped) { 
									0
%								} else { 
									<% $judge->obligation %>
%								}  
							</td>

%						}

%						if ($group->setting('coach_ratings')) { 

							<td class="centeralign">
								<% $m->comp("/funclib/judge_rating.mas", judge => $judge, print => 1) %>
							</td> 

%						} 

						<td class="centeralign">

%							if ($judge->dropped) { 

								<a class="dkred block" href="/register/judge/undrop.mhtml?judge_id=<% $judge->id %>&school_id=<% $school->id %>">
									Un-Drop
								</a>

%							} else { 

								<a class="dkgreen block" href="/register/judge/drop.mhtml?judge_id=<% $judge->id %>&school_id=<% $school->id %>">
									Drop
								</a>

%							}

						</td>
	
					</tr>

% 				} 

			</table>

%		} 

	</div>

	<& judge_menu.mas, school => $school &>

