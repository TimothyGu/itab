<%args> 
	$tourn
	$diocese_id
</%args> 
<%init> 

	my $diocese = Tab::Region->retrieve($diocese_id);
	
	my @entries = $diocese->entries($tourn);
	@entries = sort {$a->student->last cmp $b->student->last} @entries;
	@entries = sort {$a->event->abbr cmp $b->event->abbr} @entries;

	my %event_entries = ();

	foreach my $entry (@entries) { 
		push (@{$event_entries{$entry->event->id}}, $entry);
	} 

</%init> 

<div class="left huge">

	<table cellpadding="0" width="100%">

		<tr>
			<td width="100%">
				<h2>Entry for <% $diocese->name %> (Q<% $diocese->quota %>)</h2>
			</td>

			<td>
				<form action="dioceses.mhtml" method="post">
				<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
				<input  type="submit" value="Return to <% $diocese->name %>">
				</form>
			</td>

		</tr>
		
	</table> 
	
	<table cellpadding="4" cellspacing="1" width="100%"> 
	

%		my $switch;

% 		foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 

			<tr>
				<td colspan="5">
					<h3><% $event->name %></h3>
				</td>
			</tr>

% 			foreach my $entry (@{$event_entries{$event->id}}) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						<% $entry->code %> <% $entry->dropped ? "DROP" : "" %>
					</td> 
					
%					if ($entry->event->team == 1) { 

						<td colspan="2" class="smaller">
							<% $entry->student->first." ".$entry->student->last %>
						</td>

%					} else {

						<td class="smaller">
							<% $entry->student->first." ".$entry->student->last %>
						</td>
						
						<td class="smaller">
							<% $entry->partner->first." ".$entry->partner->last %>
						</td>

% 					} 

					<td class="smaller">
						<% $entry->school->chapter->name %>
					</td>
	
					<th>
						(<A href="<% $Tab::url_prefix %>/register/entry/edit.mhtml?entry_id=<%$entry->id %>">Edit</a>)
					</td>

				</tr>

% 			} 

%  			if ($diocese->quota > scalar @{$event_entries{$event->id}}) { 

				<tr class="liblrow">
					<td colspan="5" class="right">
						<form action="entry_edit.mhtml" method="post">
						<input type="hidden" name="diocese_id" value="<% $diocese->id %>">
						<input type="hidden" name="event_id" value="<% $event->id %>">
						<input type="submit"  value="  Add New Entry  "> 
						</form>
					</td>
				</tr>
% 			}

% 		}

	</table>

</div>


<& sidebar.mas, tourn => $tourn, diocese => $diocese &>

