<%args>
	$tourn
	$remaining_comps => undef
	$account
	$comp_id	
	$league
</%args>
<%init>

	my $comp = Tab::Comp->retrieve($comp_id);
    my @tourn_acc = Tab::AccountAccess->search( account => $account->id, tournament => $tourn->id);

	if ($account->id == $comp->student->chapter->region($league)->director->id 
			|| $account->site_admin || @tourn_acc ) { 

		my $chapter = $comp->student->chapter;
		my $tourn = $comp->tournament;
		my $school = $comp->school;	
		my $name = $comp->student->last;
		my $student = $comp->student;
		my $event = $comp->event;
		my $partner = $comp->partner;

        my $regline = $account->first." ".$account->last." dropped entry ".$entry->code;

        my $change = Tab::Change->create({
            tournament => $tourn->id,
            school => $school_id,
            type => "registration",
            regline => $regline
        }); 
    
        system "$Tab::eventlogger $regline";

		$comp->delete;

		if ($event->team == 2) { 
			$name = $name." and ".$partner->last;
			$partner->delete if $partner && $partner->id != 0;
		}

		$student->delete;

		$remaining_comps = scalar $school->comps;
		
		if ($remaining_comps == 0) { 

			$school->delete;
		}

		my $err = "Competitor $name deleted";

		$m->redirect("$Tab::url_prefix/register/entry.mhtml?id=".$chapter->region($league)->id."&tourn_id=".$tourn->id."&err=$err");

	}


</%init>

<p><font color="red">You are not authorized to delete that competitor</font></p>

