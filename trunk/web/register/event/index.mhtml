<%args>
	$tourn
</%args>
<%init>

	my $switch;

	my @events = $tourn->events;

	if (scalar @events == 1) { 
		$m->redirect("roster.mhtml?event_id=".$events[0]->id);
	}

</%init>

	<& event_menu.mas, tourn => $tourn &>

	<div class="left huge">

		<h2>Divisions at <% $tourn->name %></h2>

		<table cellpadding="1" cellspacing="1" width="100%">

			<tr class="yellowrow">

				<th class="smaller">
					Event
				</th>

				<th class="smaller">
					Entries
				</th>

				<th class="smaller">
					Waitlist
				</th>

			</tr>

%			my $total;
%			my $total_waitlist;

%			foreach my $event (sort {$a->name cmp $b->name} @events) { 

%				my @entries = Tab::Entry->search( event => $event->id, waitlist => 0 );
%				my @waitlist_entries = Tab::Entry->search( event => $event->id, waitlist => 1 );

%				$total += scalar @entries;
%				$total_waitlist += scalar @waitlist_entries;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<a class="white block" href="roster.mhtml?event_id=<% $event->id %>">
							<% $event->name %>
						</a>
					</td>

					<td class="smallish rightalign">
						<% scalar @entries %>
					</td>

					<td class="smallish rightalign">

%						if ($event->setting("waitlist")) { 
							<a class="white block" href="roster.mhtml?waitlist=1&event_id=<% $event->id %>">
								<% scalar @waitlist_entries %>
							</a>
%						}

					</td>

				</tr>

%			}

			<tr class="liblrow">

				<th>
					<span class="white block">
					Total
					</span>
				</th>

				<th class="smaller rightalign">
					<% $total %>
				</th>

				<th class="smaller rightalign">
					<% $total_waitlist %>
				</th>

			</tr>

		</table>

	</div>


