<%args>
	$tourn
	$event_id
	$code
</%args>
<%init>

	my @comps = Tab::Comp->search( code => $code, tournament => $tourn->id );

	my @students;
	my %schools_by_student;

	foreach my $comp (@comps)  {

		STUDENT:
		foreach my $student ($comp->members) { 

			my @entries = $student->entries($tourn);

			foreach my $entry (@entries) { 

				next STUDENT if $entry->event->id == $event_id;

			}

			push (@students, $student);
			$schools_by_student{$student->id} = $comp->school->id;
		}
	}

	if (scalar @students == 1) { 

		my $student = shift @students;
		$m->redirect("$Tab::url_prefix/register/comp_save.mas?student_id=".$student->id."&from=entry&event_id=$event_id&school_id=".$schools_by_student{$student->id});

	}

	my $event = Tab::Event->retrieve($event_id);
	my $switch; 

	unless (@students) { 
	 	my $err = "No eligible students with code $code found";
	    $m->redirect("$Tab::url_prefix/register/event_listing.mhtml?err=$err&event_id=$event_id&show_schools=1");
	}

</%init>


<h3>Choose student to enter into <% $event->name %></h3>

    <center>

    <table cellpadding="6" cellspacing="1" width="75%">

%	foreach my $student (@students) { 

        <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			<td align="center">
				<form action="comp_save.mas" method="post">
					<input type="hidden" name="school_id" value="<% $schools_by_student{$student->id }%>">
					<input type="hidden" name="from" value="entry">
					<input type="hidden" name="event_id" value="<% $event->id %>">
					<input type="hidden" name="student_id" value="<% $student->id %>">
					<input type="submit" value="   Choose   " >
				</form>
			</td>

			<td align="center">
			<% $student->first." ".$student->last %></td>

			<td align="center">
			<% $student->chapter->name %></td>

		</tr>

%	}

	</table>
