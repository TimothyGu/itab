<%args>
	$circuit
	$last_name
	$tourn
</%args>
<%init>

	$last_name = "%".$last_name."%";

	my @entries = Tab::Entry->search_mult_last_name($last_name, $tourn->id);
	push (@entries, Tab::Entry->search_stud_last_name($last_name, $tourn->id));
	push (@entries, Tab::Entry->search_part_last_name($last_name, $tourn->id));
	push (@entries, Tab::Entry->search_team_last_name($last_name, $tourn->id));

	#uniq
	my %seen = ();
	@entries = grep { ! $seen{$_->id} ++ } @entries;

	if (scalar @entries == 1) { 

		$m->redirect("$Tab::url_prefix/register/entry/edit.mhtml?entry_id=".$entries[0]->id);

	}

</%init>


	<div class="left huge">

	<h3>Entryeitors with last name <% $last_name %></h3>

	<table cellpadding="7" cellspacing="1" width="100%">

%	my $switch;

%	foreach my $entry (@entries) { 

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
		
			<th style="text-align: center;"> 
				<a href="<% $Tab::url_prefix %>/register/entry/edit.mhtml?entry_id=<% $entry->id %>"> 
					<% $entry->code." in ".$entry->event->abbr %>
				</a> 
			</td> 
			
			<td>
%				if ($entry->event->team == 1) { 
					<% $entry->student->first." ".$entry->student->last %>
%				}

%				if ($entry->event->team == 2) { 
					<% $entry->student->last." ".$entry->partner->last %>
%				}

%				if ($entry->event->team == 3) { 
					<% $entry->name %> (
%						foreach my $stud ($entry->members) { 
							<% $stud->first." ".$stud->last %>, 
%						}
					)
%				}
			</td> 
			
			<td>
				<% $entry->school->name %>
			</td>

%			if ($tourn->setting("ncfl") || $tourn->setting("regions")) { 

				<td>
					<% $entry->school->region->name %>
				</td>
%			}

		</tr>

% 	}

	</table>



