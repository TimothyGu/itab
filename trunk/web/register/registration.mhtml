<%args>
	$league
	$tourn
	$session
	$account
	$school_id => undef
	$err => undef
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id) if $school_id;

	my $switch;

</%init>

	<& menubar.mas, school => $school, whoami => "tourn", tourn => $tourn &>

% 	if ($school) { 

		<div id="rightsmall">

			<h4 style="text-align: center; border: 0;">

%				if ($school->registered) { 
					Registered!
%				} else { 
					NOT REGISTERED
%				}

			</h4>

			<hr>

				<center>

				<form action="register.mhtml" method="post">
					<input type="hidden" name="school_id" value="<% $school->id %>">
					<input style="width: 225px;" type="submit" value="<% ($school->registered) ? "Mark as Not Registered" : "Mark as Registered" %>">
				</form>


%			unless ($school->registered) { 

				<hr />

				<form action="register.mhtml" method="post">
					<input type="hidden" name="school_id" value="<% $school->id %>">
					<input type="hidden" name="fees" value="paid">
					<input style="width: 225px;" type="submit" value=" Mark as Registered & Fully Paid " >
				</form>
%			}

				</center>

			<hr>

			<a class="redblock" href="print_invoice_and_reg.mhtml?school_id=<% $school->id %>" method="post">
				Print Registration Packet
			</a>

			<hr>

			<a class="redblock" href="invoice_print.mas?school_id=<% $school->id %>" method="post">
				Print Invoice
			</a>


			<hr>


			<a class="blueblock" href="reg_print.mas?print=both&no=secretive&school_id=<% $school->id %>" method="post">
				Print Registration without Rooms
			</a>

			<a class="blueblock" href="reg_print.mas?print=both&school_id=<% $school->id %>" method="post">
				Print Registration with Rooms
			</a>

			<a class="blueblock" href="dance_cards.mhtml?school_id=<% $school->id %>" method="post">
				Print Student Dance Cards
			</a>

%			if ($account->site_admin) { 

				<hr>

				<a class="redblock" href="/user/tourn/director.mhtml?school_id=<% $school->id %>&tourn_id=<% $tourn->id %>" method="post">
					View Online Registration
				</a>

%			}


			<hr>

			<a class="redblock" href="drop_school.mas?school_id=<% $school->id %>&tourn_id=<% $tourn->id %>" >
				Drop Entire Entry for <% $school->short_name %>
			</a>

			<hr />

% 			if ($account->site_admin) { 

				<a class="greenblock">
					School: <% $school->id %>, Chapter: <% $school->chapter->id %>
				</a>

				<hr>
% 			}	


		</div>

		<div id="leftbignb">

			<table cellpadding="6" cellspacing="1" border="0" width="100%">

% 				undef $switch;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						<form action="school_save.mhtml" method="post">
						<input type="hidden" name="school_id" value="<% $school->id %>">
						School Name:
					</td>

					<td align="right">
						<input type="text" name="name" size="30" value="<% $school->name %>">
					</td>
	
				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

		 			<th width="25%">
						School Code:
					</td>
			
					<td align="right">
						<input type="text" name="code" size="6" value="<% $school->code %>">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						State
					</th>
			
					<td align="right" width="25%">
						<input type="text" name="state" size="6" value="<% $school->chapter->state %>">
					</td>

				</tr>

%				if ($league->region_based || $league->diocese_based) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<th width="25%">
							<% ($league->region_based) ? "Region" : "Diocese" %>:
						</td>

						<td align="right">

							<select name="region_id">
	
								<option value=""></option>

%								foreach my $region ($league->regions) {
									<option value="<% $region->id %>" <% ($school->region) && ($region->id == $school->region->id) ? "selected" : ""  %>>
										<% $region->name %> (<% $region->code %>)
									</option>
%								}

							</select>
						</td>
				
					</tr>
%				}

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						Contact Name
					</td>

					<td align="right">
						<input type="text" name="contact_name" size="30" value="<% $school->contact_name %>">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						Contact Phone:
					</td>	

					<td align="right">
						<input type="text" name="contact_number" size="30" value="<% $school->contact_number %>"> 
					</td> 
			
				</tr>

% 				my ($fee, $feline_ref) = $m->comp("/funclib/school_fees.mas", school_id => $school_id);

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 

					<th>
						Fees:
					</td> 
			
					<td align="right">
						$<%  sprintf ("%.2f", $fee) %>
					</td> 

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
			
					<th>
						Paid:
					</th>
			
					<td align="right">
						<input type="text" name="paid_amount" value="<%  sprintf ("%.2f", $school->paid_amount) %>" size="7">
					</td> 
			
				</tr>

%				if ($tourn->items && $school->concession_total) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<th>
							Concession Fees:
						</td> 
				
						<td align="center">
							$<%  sprintf ("%.2f", $school->concession_total) %>
						</td> 
					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
				
						<th>
							Paid:
						</th> 
				
						<td align="right">
							<input type="text" name="concession_paid_amount" value="<%   sprintf ("%.2f", $school->concession_paid_amount ) %>" size="7">
						</td> 
				
					</tr>
%				}


				<tr class="liblrow">

					<td colspan="2" align="right">
						<input class="blue" type="submit" value=" Save School Info " name="register">
						</form>
					</td>

				</tr>
		
			</table>

%			undef $switch;

% 			if ($school->chapter->coaches) {

				<h3>Coach Access:</h3>

				<table cellpadding="6" width="100%" cellspacing="0">

% 					foreach my $coach ($school->chapter->coaches) {

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td class="smaller">
								<% $coach->first." ".$coach->last %>
							</td>

							<td class="smaller">
								<a href="mailto:<% $coach->email %>"><% $coach->email %></a>
							</td>

							<td class="smaller">
								<% $coach->phone %> <% ($coach->is_cell) ? "(Cell)" : "" %>
							</td>

						</tr>
% 					} 
		
				</table> 

% 			}

		</div>

	
% 	} #	end of if $school


<br style="clear:both"/>
