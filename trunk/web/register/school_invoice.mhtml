<%args>
	$tourn
	$school_id
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id);
	my ($total, $feline_ref) = $m->comp("/funclib/school_fees.mas", school_id => $school_id);
	my @felines = @{$feline_ref};
	my $switch; 

</%init>

    <& menubar.mas, school => $school, whoami => "money", tourn => $tourn &>

	<div class="left huge">

		<h4>Invoice for <% $school->name %></h4>

		<table cellpadding="4" cellspacing="1" width="100%">
	
%			foreach my $line (@felines) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

%					if ($line->{'fee'}) { 

						<td class="smaller">
							<%$line->{'name'} %>
						</td>
			
						<td align="right">
							$<% sprintf ("%.2f", $line->{'fee'}) %>
						</td>

%					} else { 
						
						<td class="smaller" colspan="2">
							<%$line->{'name'} %>
						</td>
%					}

					<td>

%						if ($line->{'fine_id'}) {
							<a href="fine_forgive.mas?fine_id=<% sprintf ("%.2f", $line->{'fine_id'}) %>" class="whiteblock">
								Forgive
							</a>
%						}
					</td>

				</tr>

%			} 

			<tr>
				<td colspan="3">
					<hr />
				</td>
			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
				
				<th>
					Total
				</th>
				
				<th class="right">
					$<% sprintf ("%.2f", $total) %>
				</th>
				
				<td></td>
				
			</tr> 
			
		</table>


	</div>

	<div class="right small"> 

		<a href="invoice_print.mas?school_id=<% $school->id %>" class="blue block">
			Print <% $school->name %>'s invoice
		</a>


		<hr />
	
		<h4>Add a charge or credit:</h4>

		<table cellpadding="4" cellspacing="1" width="100%">
		
			<tr>
				<td colspan="2">
					Use negative values for credits
				</td>
			</tr>


			<tr class="evenrow">
				<th>
					Reason:
				</th> 
				
				<td align="right">
					<form action="fine_save.mas" method="post">
					<input type="hidden" name="school_id" value="<% $school_id %>">
					<input type="text" name="reason" size="20">
				</td>
			</tr>

			<tr class="oddrow">

				<th>
					Amount:
				</th>
				
				<td align="right">
					$<input type="text" name="amount" size="10">
				</td>

			</tr> 
			
			<tr class="liblrow">

				<td align="right" colspan="2">
					<input class="blue" type="submit" value="Add Fine">
					</form>
				</td>
			</tr>
			
		</table>

	</div>


