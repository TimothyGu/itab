<%args>
	$event_id
	$tourn
	$account
	$league
	$debug => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id); 

	my $log;

	my $count;

	foreach my $school ($event->waitlist_schools) { 

		my @comps = Tab::Comp->search( event => $event->id,  waitlist => 1, school => $school->id );

		@comps = sort {$a->registered_at->epoch <=> $b->registered_at->epoch} @comps;

		my $comp = shift @comps;
		
		$count++;
		$log .= $school->code." ".$comp->code." ";

		$m->comp("unwaitlist_comp.mas", comp => $comp, tourn => $tourn, account => $account);

	}

	my $msg = "Admitted $count competitors <br />";

	$msg .= $log;

	$m->redirect("waitlist.mhtml?event_id=$event_id&msg=$msg");

</%init>
