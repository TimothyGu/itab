<%args> 
	$req_id
	$league
	$account
	$tourn
</%args>
<%init>

	my $hire = Tab::JudgeHire->retrieve($req_id);

	$hire->accepted(0);
	$hire->update;

	#Send the email

	my $subject = "Judge Hire Request Revoked: ". $tourn->name;
	my $message =       "The ".$tourn->name." wishes to notify you that it has\r\n";
	$message = $message."revoked acceptance of your request to hire a judge\r\n";
	$message = $message."to cover entries in ".$hire->judge_group->name.".\r\n\r\n";

	$message = $message."This email covers one judge request; one email will be\r\n";
	$message = $message."sent for each additional hire request accepted or revoked.\r\n";

	$message = $message."You may need to supply judges to cover your entries now; \r\n";
	$message = $message."with luck, the tournament directors know what they are doing\r\n";
	$message = $message."and will send you a separate note explaining why.\r\n";

	$message = $message."\r\n \r\n";
	$message = $message."\tCheers,\r\n ";
	$message = $message."\t".$account->first." ".$account->last."\r\n";
	$message = $message."\t".$tourn->name."\r\n ";

    $message = $message."\r\n \r\n --- \r\n ";
    $message = $message."This message auto-generated by the Tabroom.com software\r\n";
    $message = $message."at ".$Tab::url_prefix.". on behalf of the ". $league->name ."\r\n"; 
    $message = $message."Tabroom.com: http://www.tabroom.com.  ";

	my @accounts = $hire->school->chapter->coaches;

    foreach my $sendto (@accounts) {

        my $mail = new Mail::Mailer 'smtp', Server => $Tab::smtp_server;
        my $from = $account->first." ".$account->last." <".$account->email.">";
        my $to = $sendto->first." ".$sendto->last." <".$sendto->email.">";

        $mail->open({   From => $from,
            To => $to,
			Bcc => $account->email,
            Subject => $subject,
        });

        print $mail $message."\r\n \r\n";
        $mail->close();
    }

	$m->redirect("$Tab::url_prefix/register/hire_requests.mhtml?group_id=".$hire->judge_group->id);

</%init>


</%init>
