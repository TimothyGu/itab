<%args>
	$tourn
</%args>
<%init>

	use POSIX;

	my $switch;

	my @judge_groups = $tourn->groups;

	if (scalar @judge_groups == 1) { 
		$m->redirect("roster.mhtml?group_id=".$judge_groups[0]->id);
	}


</%init>

	<& sidebar.mas, tourn => $tourn &>

	<div class="left huge">

		<h2>Judge Groups at <% $tourn->name %></h2>

		<table cellpadding="4" cellspacing="1" width="100%">

			<tr class="yellowrow">

				<th class="smaller">
					Group
				</th>

				<th class="smaller">
					Judges/Rounds
				</th>

				<th class="smaller">
					Hire Requests
				</th>

			</tr>

%			my $total;
%			my $total_hires;

%			foreach my $group (sort {$a->name cmp $b->name} @judge_groups) { 

%				my $judge_per = $group->setting("judge_per");
%				my $round_per = $group->setting("round_per");
%				my $by_entry++ if $group->setting("uncovered_entry_fee");

%				my @judges = Tab::Judge->search( judge_group => $group->id );
%				my @hires = Tab::JudgeHire->search( judge_group => $group->id );

%				my $hire_total;
%				my $hire_rounds_total;

%				foreach my $hire (@hires) {
%					if ($by_entry) { 
%						$hire_total += $hire->covers;
%					} else { 
%						$hire_total += ceil($hire->covers / $judge_per) if $judge_per;
%						$hire_rounds_total += $hire->rounds;
%					}
%				}

%				$total += scalar @judges;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<a class="white block" href="roster.mhtml?group_id=<% $group->id %>">
							<% $group->name %>
						</a>
					</td>

					<td class="smallish rightalign">
						<% scalar @judges %>

					<td class="smallish rightalign">
						<a class="white block" href="hire_requests.mhtml?group_id=<% $group->id %>">
							<% $hire_total ? $by_entry ? $hire_total." entries " : $hire_total." judges " : "" %>
							<% $hire_rounds_total ? $hire_rounds_total." rounds" : "" %>
						</a>
					</td>

				</tr>

%			}

			<tr class="liblrow">

				<th>
					<span class="white block">
					Total
					</span>
				</th>

				<th class="rightalign smallish">
					<% $total %>
				</th>

				<th class="rightalign smallish">
					<% $total_hires %>
				</th>

			</tr>

		</table>

	</div>


