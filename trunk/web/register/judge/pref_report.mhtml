<%args>
	$group_id
	$tourn
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $group = Tab::JudgeGroup->retrieve($group_id);
	my $rounds_per = $group->setting("rounds_per");

	my @judges = $group->judges;
	my %judge_prefs = $m->comp("/funclib/judges_by_pref.mas", group => $group);

	@judges = sort {$judge_prefs{$b}{"stdv"} <=> $judge_prefs{$a}{"stdv"} } @judges;
	@judges = sort {$judge_prefs{$a}{"avg"} <=> $judge_prefs{$b}{"avg"} } @judges;

</%init>

	<& sidebar.mas, tourn => $tourn, whoami => "prefs", group => $group &>

	<div class="left huge">

		<h4><% $group->abbr %> pref averages</h4>
	
		<& /funclib/tablesorter.mas, table => "sortme" &>
	
%		my $switch;

		<table cellpadding="5" cellspacing="1" width="100%" id="sortme">

			<thead>

				<tr class="yellowrow">

					<th>
						First
					</th>

					<th>
						Last
					</th>

%					if ($rounds_per) { 
						<th>
							Rounds
						</th>
%					}

					<th>
						Avg Pref
					</th>

					<th>
						StDev
					</th>

				</tr>

			</thead>

			<tbody>

%			foreach my $judge (@judges) { 

%				next unless $judge_prefs{$judge}{"avg"};

				<tr>

					<td>
						<% $judge->first %>
					</td>

					<td>
						<% $judge->last %>
					</td>

%					if ($rounds_per) { 
						<td>
							<% ($judge->obligation + $judge->hired) %>
						</td>
%					}

					<td>
						<% $judge_prefs{$judge}{"avg"} %>
					</td>

					<td>
						<% $judge_prefs{$judge}{"stdv"} %>
					</td>

				</tr>

%			} #end of foreach judge

			</tbody>

		</table>

	</div>

