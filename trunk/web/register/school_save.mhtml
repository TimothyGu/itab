<%args>
	$account
	$school_id
	$register
	$paid_amount => undef
	$concession_paid_amount => undef
	$contact_number => undef
	$contact_name => undef
	$name
	$code => undef
	$state => undef
	$region_id => undef
	$league
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id); 
	my $registered = 1 if $register eq "Save/Check In";

	$school->registered($registered);
	$school->paid_amount($paid_amount);
	$school->concession_paid_amount($concession_paid_amount);
	$school->contact_number($contact_number);
	$school->contact_name($contact_name);
	$school->code($code);

	my $chapter = $school->chapter;

	if ($name ne $school->name) {
		$school->name($name);

		if ($account->site_admin) { 
			$chapter->name($name);
			$chapter->update;
		}
	}

	if ($state ne $school->chapter->state) {
		$chapter->state($state);
		$chapter->update;
	}

	if ($region_id) { 
		my @chapter_mem = Tab::ChapterLeague->search( chapter => $chapter->id, league => $league->id);
		my $cm = shift @chapter_mem;
		$cm->region($region_id);
		$school->region($region_id);
		$cm->update;
	}

	$school->update;
	$m->redirect($Tab::url_prefix."/register/registration.mhtml?school_id=$school_id");

</%init>

