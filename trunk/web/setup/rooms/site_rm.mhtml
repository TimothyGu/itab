<%args>
	$site_id
	$tourn
</%args>
<%init>

	my $site = Tab::Site->retrieve($site_id);

	foreach my $round ($m->comp("/funclib/site_rounds.mas", site => $site, tourn => $tourn)) { 
		$round->site("");
		$round->update;
	}

	foreach my $room ($site->rooms) { 
		foreach my $rp (Tab::RoomPool->search( room => $room->id ))  {
			$rp->delete;
		}
	}

	foreach my $ts (Tab::TournSite->retrieve( tournament => $tourn->id, site => $site->id)) { 
		$ts->delete;
	}

	my $msg = "Site ".$site->name." removed from your tournament.";

	$m->redirect("/setup/rooms/manage_sites.mhtml?msg=$msg");

</%init>
