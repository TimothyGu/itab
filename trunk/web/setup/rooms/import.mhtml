<%args>
	$tourn
</%args>

    <& sidebar.mas, tourn => $tourn, import => "youbetcha" &>

	<div class="left huge">
	
		<h2>Import Rooms from a text file</h2>

		<p>
			I'm going to level with you: computers are really stupid.  It takes
			a lot of effort to make them smart.  Therefore, the file you upload
			must be formatted precisely.  All files must be in raw ASCII text.
			If you save in Excel into CSV format, that will be acceptable as
			long as the fields are in the proper order.  Do not put single or
			double quotes or commas into the text fields; all kinds of bad will
			happen if you do.  Do not upload a Word doc or a PDF or anything
			other than a text file or a CSV file.
		</p>

		<p>
			The rooms file must be in the format Name,Quality,Capacity,Notes.
			One room per line.  Only the room name is required; you do not have
			to specify a quality, capacity or notes.  Leave fields blank but mark
			them with commas if you want to use later ones; so if you want to set
			capacity but not quality, put an extra comma in to leave the Quality
			field "blank" like this:
			
			<code>Room 214,,100,</code>
			
			Ratings for quality and capacity must be numerical; there's no
			upper bound.  Lower numbers for "quality" will be used first.  The
			other fields will be left blank if missing.
		</p>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="evenrow">

				<th>
					Site:
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" 
						name="rooms" action="import_save.mhtml" method="post">
				</th>

				<td>
%					if (scalar $m->comp("/funclib/tourn_sites.mas", tourn => $tourn) > 1) { 

						<select name="site_id">
%							foreach my $site (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_sites.mas", tourn => $tourn)) { 
								<option value="<% $site->id %>">
									<% $site->name %> (<% scalar $site->rooms %> rooms)
								</option>
%							}
						</select>

%					} elsif (scalar $m->comp("/funclib/tourn_sites.mas", tourn => $tourn) == 1) { 

%						my @sites = $m->comp("/funclib/tourn_sites.mas", tourn => $tourn);
%						my $site = shift @sites;

						<% $site->name %> (<% scalar ($site->rooms) %> rooms)
						<input type="hidden" name="site_id" value="<% $site->id %>">

%					} else { 

%						my $err = "You cannot add or import rooms before naming or choosing your tournament site.  Please set up a site or sites and then add your rooms";
%						$m->redirect("manage.sites.mhtml?err=$err");

%					}

				</td>

			</tr>

			<tr class="oddrow">

				<th>
					Upload Rooms File:
				</th>

				<td> 
					<input name="rooms" type="file" class="button"> 
				</td>

			</tr>

			<tr class="liblrow">

				<td colspan="2" align="right">
					<input  type="submit" value="Upload"> 
					</form>
				</td>

			</tr>

		</table>

	</div>

