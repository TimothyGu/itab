<%args>
	$circuit
	$tourn
	$session
</%args>
<%init>

	use POSIX;

	my $filename =  "room_pools-".$tourn->id."-".$session->id;

    my $now = DateTime->now;
    $now->set_time_zone($circuit->timezone);

	open (TEXOUT, ">>$Tab::file_root/tmp/$filename.tex");

    print TEXOUT <<"EOF";
\\documentclass[11pt]{report}
\\usepackage{fullpage}
\\usepackage{nopageno}
\\usepackage{colortbl}
\\usepackage{times}
\\renewcommand{\\arraystretch}{1.3}

\\begin{document}
\\normalsize

EOF


print TEXOUT "\\begin{center} \n";
print TEXOUT "\\bigskip \n";
print TEXOUT "{\\Large\\bf ".Tab::texify($tourn->name)." Room Pools }\\\\ \n";
print TEXOUT "\\medskip\n";

print TEXOUT <<'EOF';

\end{center}
\medskip

\begin{center}

\small

EOF

my $switch;

foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 

	print TEXOUT "\\begin{tabular}{p{.5in}p{6.0in}}\n";
	print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\n" if ($switch++ % 2);

	print TEXOUT $event->abbr." & ";

	my $not_first;

	foreach my $room (sort {$a->name cmp $b->name} $event->room_pool) {
		print TEXOUT "," if $not_first;
   		print TEXOUT " ".$room->name;
		$not_first++;
	}

	print TEXOUT "\\\\ \n";
	print TEXOUT "\\end{tabular} \n";
	print TEXOUT "\\newline\n";
}

print TEXOUT "\\end{center} \n";
print TEXOUT "\\end{document} \n";
close TEXOUT;


my $garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

#`rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;

$m->redirect("$Tab::url_prefix/tmp/$filename.pdf");

</%init>
