<%args>
	$err => undef
	$tourn
	$account
</%args>
<%init>

	my @admins = $m->comp("/funclib/tourn_admins.mas", tourn => $tourn);

	my @tourn_admins = Tab::TournAdmin->search( tourn => $tourn->id );

	my %admin_joins = ();

	foreach my $ta (@tourn_admins) { 
		$admin_joins{$ta->account->id} = $ta;
	}

	@admins = sort { $admin_joins{$a->id}->director <=> $admin_joins{$b->id}->director }  @admins;

</%init>

	<div class="left huge">
	
		<h2>Tournament Access</h2>

		<table cellpadding="5" width="100%" cellspacing="1"> 

%			if (@admins) { 

				<tr class="liblrow">
				
					<th>	
						Name
					</th>

					<th class="smaller">
						List as Contact
					</th> 

					<th class="smaller">
						Setup Access
					</th>

					<th class="smaller">
						Data Entry Only
					</th> 

				
					<th>
					</th> 

				</tr>

%				my $switch;

% 				foreach my $account (@admins) { 

%					my $staff = $admin_joins{$account->id};

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
						<td align="left">
							<% $account->first." ".$account->last %>
						</td>

						<td align="center">
							<a href="contact_switch.mhtml?staff_id=<% $staff->id %>" class="white block">
								<% ($staff->contact) ? "Yes" : "No" %>
							</a>
						</td>

						<td align="center">
							<a href="settings_switch.mhtml?staff_id=<% $staff->id %>" class="white block">
								<% ($staff->no_setup) ? "No" : "Yes" %>
							</a>
						</td>

						<td align="center">
							<a href="limited_switch.mhtml?staff_id=<% $staff->id %>" class="white block">
								<% ($staff->entry_only) ? "Yes" : "No" %>
							</a>
						</td>

						<td align="center">
							<a class="white block" href="staff_rm.mhtml?staff_id=<% $staff->id %>">
								Revoke
							</a>
						</td>

					</tr>
%				}

%			}

		</table>

	</div>

	<div class="right small">

		<h3>Add New Staff:</h3>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="evenrow">
		
				<th>	
					Email:
					<form action="staff_add.mhtml" method="post">
					<input type="hidden" name="tourn_id" value="<% $tourn %>">
				</th>

				<td>
					<input type="text" name="email" size="20">
				</td>

			</tr>

			<tr class="liblrow">

				<td align="right" colspan="2">
					<input  type="submit" value="  Grant Access  ">
					</form>
				</td>
			</tr>

		</table>

	</div>

