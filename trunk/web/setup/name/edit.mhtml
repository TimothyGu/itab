<%args>
	$tourn
	$account
</%args>
<%init>

	my $switch;
	my $tz = $tourn->tz;
	$tz = "America/New_York" unless $tz;

</%init>

	<div class="left huge">

	<h2>Tournament Name & Invitations</h2>

		<h4>Name & Location</h4>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<td>
					Tournament Full Name 
				</td>

				<td>
					<form action="save.mhtml" method="post">
					<input type="text" name="name" size="35" value="<% $tourn->name %>">
				</td>

			</tr>

			<tr class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<td>
					Tournament Web name
				</td>

				<td>
					http://<input type="text" name="webname" size="16" value="<%  $tourn->webname  %>">.tabroom.com
				</td>

			</tr>

			<tr class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<td>
					Time Zone
				</td>

				<td>
					<select name="timezone" class="fixedsmall" style="width: 285px;">
					<& "/funclib/timezones.mas", tz => $tz &>
					</select>
				</td>

			</tr>

			<tr class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<td>
					Location Country
				</td>

				<td>
					<select name="country" style="width: 285px;">
					<& /funclib/country_select.mas, country => $tourn->country &>
					</select>
				</td>

			</tr>

			<tr class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<td>
					Location State (if applicable)
				</td>

				<td>
					<select name="state" style="width: 285px;">
					<& /funclib/state_select.mas, state => $tourn->state &>
					</select>
				</td>

			</tr>

			<tr class="liblrow"> 

				<td colspan="2" class="rightalign">
					<input  type="submit" class="tiny" value=" Save ">
					</form>
				</td>
			</tr>

		</table>

		<h4>Circuits</h4>

%		if ($tourn->circuits) { 
			<p>Tournament is listed on the following circuit calendars:</p>
%		}

		<table cellpadding="5" cellspacing="1" width="100%">

%			my %circuit_used;

%			foreach my $circuit ($m->comp("/funclib/tourn_circuits.mas", tourn => $tourn)) { 

%				$circuit_used{$circuit->id}++;

				<tr class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

					<td class="centeralign">
						<% $circuit->abbr %>
					</td>

					<td>
						<% $circuit->name %>
					</td>
						
					<td class="centeralign">
						<% $circuit->location %>
					</td>

					<td>
						Approved
					</td>

					<td class="centeralign">
						<a class="dkred block" href="circuit_rm.mhtml?circuit_id=<% $circuit->id %>">
							Remove
						</a>
					</td>
	
				</tr>
%			}

%			foreach my $circuit ($m->comp("/funclib/tourn_circuits.mas", tourn => $tourn, unapproved => 1)) { 

%				$circuit_used{$circuit->id}++;

				<tr class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

					<td class="centeralign">
						<% $circuit->abbr %>
					</td>

					<td>
						<% $circuit->name %>
					</td>
						
					<td class="centeralign">
						<% $circuit->location %>
					</td>

					<td>
						Approval Pending
					</td>

					<td class="centeralign">
						<a class="dkred block" href="circuit_rm.mhtml?circuit_id=<% $circuit->id %>">
							Remove
						</a>
					</td>
	
				</tr>

%			}

			<tr class="liblrow">

				<td colspan="4">

					<form action="circuit_add.mhtml" method="post">

					<select name="circuit_id">
%						foreach my $circuit (sort {$a->name cmp $b->name} Tab::Circuit->search( active => 1)) { 
%							next if $circuit_used{$circuit->id};
							<option value="<% $circuit->id %>">
								<% $circuit->name %>
							</option>
%						}
					</select>

				</td>

				<td>
					<input type="submit" value=" Add ">
					</form>
				</td>
				
			</tr>

		</table>

		<h4>Invitation</h4>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="oddrow">

				<td>
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="invite" action="invite_upload.mhtml" method="post">
					<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
					<input type="file" name="invite" size="20">
				</td>

				<td class="rightalign">
					<input  type="submit" class="tiny" value="  Upload  ">
					</form>
				</td>

			</tr>

		</table>

		<h4>Congress Legislation Packet</h4>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="evenrow">

				<td>
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="bills" action="bills_upload.mhtml" method="post">
					<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
					<input type="file" name="bills" size="20">
				</td>

				<td class="rightalign">
					<input  type="submit" class="tiny" value="  Upload  ">
					</form>
				</td>

			</tr>

		</table>

	</div>

	<div class="right small">

% 		if ($tourn->setting("invite") || $tourn->setting("bills")) { 
			<div class="sidenote"> 

				<h4>Files posted:</h4>

%	 			if ($tourn->setting("invite")) {
    	    		<a class="blue block" href="/files/tourns/<% $tourn->id %>/<% $tourn->setting("invite") %>">
						Posted Invitation
					</a>
%				}

%  				if ($tourn->setting("bills")) {
    	    	 	<a class="blue block" href="/files/tourns/<% $tourn->id."/bills/".$tourn->setting("bills") %>">
						Posted Legislation
					</a>
%   			} 

			</div>
% 		} 

		<div class="sidenote"> 

			<h4>Notes</h4>

			<p>
				Your webname must be unique to your tournament, and in all
				lowercase letters or numbers, no punctuation.  Don't include
				the year; web names can be re-used by the same tournament
				each year.
			</p>

			<p>
				Don't make your tournament name too long; long names will be
				truncated on many online listings.  Also, don't include
				the year of the tournament; archives and results pages will
				include the year automatically.
			</p>

			<p>
				Your tournament invitations and the bill packets will
				immediately appear on your public website as download
				links.  Please make sure the files are in a common format, such
				as DOC or PDF, and it's best if the file names did not include
				characters besides numbers and letters
			</p>

	
		</div>

	</div>
