<%args>
	$tourn
	$session
	$account
	$new_name => undef
	$new_date => undef
	$new_time => undef
	$new_price => undef
	$new_deadline => undef
	$new_description => undef
</%args>
<%perl>

	my @concessions = sort {$a->name cmp $b->name} $tourn->concessions;
	my $switch;

	my $msg;

	foreach my $concession (@concessions) { 

	    my $deadline = Tab::dtme($ARGS{$concession->id."_date"},$ARGS{$concession->id."_time"});

		$deadline->set_time_zone($tourn->circuit->timezone);

		$concession->name( $ARGS{$concession->id."_name"} );
		$concession->price( $ARGS{$concession->id."_price"} );
		$concession->description( $ARGS{$concession->id."_description"} );
		$concession->deadline($deadline);
		$concession->update;
	
	}

	$msg = "Updates saved";


   if ($new_name && $new_price) { 
   
 	  my $deadline = Tab::dtme($new_date,$new_time);
	
 		my $new_concession = Tab::Concession->create({
			tourn => $tourn->id,
			name => $new_name,
			price => $new_price,
			description => $new_description,
		});

		$new_concession->deadline($deadline) if $deadline;
		$new_concession->update;

		$msg .= " and new concession $new_name created";

	}

	$m->redirect("concessions.mhtml?msg=$msg");

</%perl>

