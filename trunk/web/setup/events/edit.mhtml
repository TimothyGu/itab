<%args>
	$circuit
	$tourn
	$event_id => undef
	$add => undef
	$err => undef
</%args>

% 	my @groups = sort{$a->name cmp $b->name}  $tourn->groups;

%	my $event = Tab::Event->retrieve($event_id) if $event_id;

%	my $switch = 1;

	<div class="right small">

		<& menu.mas, tourn => $tourn, event_id => $event_id  &>		

	</div>

	<div class="left huge">

%		unless (@groups) {
		
			<p>Events are organized into judge groups.  Events in the same
			group will share judges, same judge obligations, and judge rating
			systems.</p>

			<p>Create judge group(s) under Setup -> Judge Groups before creating
			events here.</p>

%		}

%		if ($event_id || $add ) { 

			<table cellpadding="5" cellspacing="1" border="0" width="100%"> 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="ballot" action="event_save.mhtml" method="post">
						<input type="hidden" value="<% $event_id %>" name="event_id">
						Event Name:
					</td>
				
					<td align="right">
						<input type="text" name="name" value="<% ($event) ? $event->name : "" %>" size="50">
					</td>
					
				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Judge Group:
					</td>
				
					<td align="right">
						<select name="judge_group_id">
							<option></option>
%							foreach my $group (sort {$a->name cmp $b->name} $tourn->groups) { 
								<option value="<% $group->id %>" <% ($event && $event->judge_group && $group->id == $event->judge_group->id) ? "selected" : "" %>>
									<% $group->name %>
								</option>
%							}

						</select>
					</td>
					
				</tr>

			</table>

			<hr />

			<div class="half" style="width: 49%; float: left;">

				<table cellspacing="1" width="100%"> 
				
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
					
						<td class="maller">
							Abbreviation
						</td> 
						
						<td>
							<input type="text" name="abbr" value="<% ($event) ? $event->abbr : "" %>" size="5">
						</td> 

					</tr> 
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Entry Fee
						</td>

						<td>
							<input type="text" name="fee" value="<% ($event) ? $event->fee : "" %>" size="5">
						</td>

					</tr>


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Field Cap 
						</td>

						<td>
							<input type="text" name="cap" value="<% ($event) ? $event->cap : ""%>" size="5">
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<td >
							School Cap 
						</td>

						<td>
							<input type="text" name="school_cap" value="<% ($event) ? $event->school_cap : "" %>" size="5">
						</td> 
						
					</tr> 
	
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Students per entry
						</td> 

						<td>
							<select name="team">

								<option value="1" <% ($event && $event->team == 1) ? "selected" : "" %>>
									1
								</option>

								<option value="2" <% ($event && $event->team == 2) ? "selected" : "" %>>
									2
								</option>

								<option value="3" <% ($event && $event->team == 3) ? "selected" : "" %>>
									3+
								</option>
							</select>
						</td> 

					</tr> 

					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							1st Speaker Code
						</td>

						<td>
							<input type="text" name="code" value="<% ($event) ? $event->code : ""%>" size="5">
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							School & initials for codes
						</td>

						<td>
							<input type="checkbox" name="initial_codes" value="1" <% ($event) ? ($event->initial_codes) ? 'checked' : '' : '' %>>
						</td>

					</tr>
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Registrant picks codes
						</td>

						<td>
							<input type="checkbox" name="reg_codes" value="1" <% ($event) ? ($event->reg_codes) ? 'checked' : '' : '' %>>
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Hide codes
						</td>

						<td>
							<input type="checkbox" name="no_codes" value="1" <% ($event) ? ($event->no_codes) ? 'checked' : '' : '' %>>
						</td>

					</tr> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Ask for Piece Titles
						</td>

						<td>
							<input type="checkbox" name="ask_for_titles" value="1" <% ($event) ? ($event->ask_for_titles) ? 'checked' : '' : '' %>>
						</td>
				
					</tr>

				</table>



			</div>

			<div class="half" style="width: 49%; float: right;">

				<table cellspacing="1" width="100%">



					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Allow judges to enter
						</td>

						<td>
							<input type="checkbox" name="alumni" value="1" <% ($event) ? ($event->alumni) ? 'checked' : '' : '' %>>
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>		
					
						<td>
							Waitlist entries over cap
						</td> 
						
						<td align="left">
							<input type="checkbox" name="waitlist" value="1" <% ($event) ? ($event->waitlist) ? 'checked' : '' : '' %>>
						</td> 

					</tr> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>		
					
						<td>
							Waitlist all entries
						</td> 
						
						<td align="left">
							<input type="checkbox" name="waitlist_all" value="1" <% ($event) ? ($event->waitlist_all) ? 'checked' : '' : '' %>>
						</td> 

					</tr>
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>			
					
						<td>
							No sweepstakes credit
						</td> 
						
						<td>
							<input type="checkbox" name="omit_sweeps" value="1" <% ($event) ? ($event->omit_sweeps) ? 'checked' : '' : '' %>> 
						</td> 
						
					</tr> 
					
% 					unless ($tourn && $tourn->method && $tourn->method->allow_judge_own) { 

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td>
								Allow same-school judges
								
							</td>

							<td>
								<input type="checkbox" name="allow_judge_own" value="1" <% ($event) ? ($event->allow_judge_own) ? 'checked' : '' : '' %>>
							</td>

						</tr>

%					}


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							No judge obligations
						</td>

						<td>
							<input type="checkbox" name="no_judge_burden" value="1" <% ($event) ? ($event->no_judge_burden) ? 'checked' : '' : '' %>>
						</td>
			
					</tr>
		
% 					if ($circuit->track_bids) { 

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td>
								Award Bids
							</td>

							<td>
								<input type="checkbox" name="bids" value="1" <% ($event) ? ($event->bids) ? 'checked' : '' : '' %>>
							</td>
				
						</tr>

%  					}


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
						<td>
							Supplemental Event:
						</td>

						<td>
							<input type="checkbox" name="supp" value="1" <% ($event) ? ($event->supp) ? 'checked' : '' : '' %>>
						</td>

					</tr>
		
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
						<td>
							Publish web field report
						</td>

						<td>
							<input type="checkbox" name="field_report" value="1" <% ($event) ? ($event->field_report) ? 'checked' : '' : '' %>>
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
						<td>
							Enable Live Updates
						</td>

						<td>
							<input type="checkbox" name="live_updates" value="1" <% ($event) ? ($event->live_updates) ? 'checked' : '' : '' %>>
						</td>
					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Event Type
						</td> 

						<td class="smaller">
							<select name="type">

								<option value="speech" <% ($event && $event->type eq "speech") ? "selected" : "" %>>
									Speech
								</option>

								<option value="debate" <% ($event && $event->type eq "debate") ? "selected" : "" %>>
									Debate	
								</option>

								<option value="congress" <% ($event && $event->type eq "congress") ? "selected" : "" %>>
									Congress
								</option>

							</select>
						</td> 

					</tr> 


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
						
						<td >
							Master Ballot
						</td> 
						
						<td>
							<select name="ballot_type">
								<option value="normal" <% ($event && $event->ballot_type eq "normal") ? "selected" : "" %>>
									Plain
								</option>

								<option value="cfl" <% ($event && $event->ballot_type eq "cfl") ? "selected" : "" %>>
									Rules
								</option>
							</select>
						</td>

					</tr> 

				</table>

			</div>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			    <td >
					Early Deadline
				</td>

%				my $deadline = $event->deadline->set_time_zone($circuit->timezone) if $event && $event->deadline;
%				my $deadlinetime = Tab::pickertime($deadline) if $deadline;

				<& /funclib/datepicker.mas, id =>"deadline" , max => $tourn->end &>

				<td align="right">
   		            <input type="text" name="deadline" id="deadline" size="15" value="<% ($deadline) ?  $deadline->mdy('/') : "" %>">
						@
					<& /funclib/timeselect.mas, name => "deadlinetime", time => $deadlinetime &>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td align="center" colspan="2" valign="top">
					<h5>Event Rules</h5>
					<textarea name="text" id="text" rows=5 cols="58" wrap="virtual"><% ($event) ? $event->text : "" %></textarea>
				</td>

			</tr>

			<tr class="liblrow">
				<td colspan="2" class="right">
					<input type="submit" class="blue" value="  Save Event  ">
					</form>
				</td>
			</tr>

		</table>

%	}  else {

		<h2>Add & Edit Events</h2>

		<p>Use the functions at right to add events & divisions to your tournament</p>



%	}

	</div>
			
