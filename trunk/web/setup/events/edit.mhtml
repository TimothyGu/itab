<%args>
	$tourn
	$event_id => undef
	$add => undef
	$err => undef
	$tz => undef
</%args>
<%init>

	$tz = $tourn->tz unless $tz;
 	my @groups = sort{$a->name cmp $b->name}  $tourn->groups;
	my $event = Tab::Event->retrieve($event_id) if $event_id;
	my $switch = 1;

</%init>

	<div class="right small">
		<& menu.mas, tourn => $tourn, event_id => $event_id  &>		
	</div>

	<div class="left huge">

%		unless (@groups) {
		
			<p>Events are organized into judge groups.  Events in the same
			group will share judges, same judge obligations, and judge rating
			systems.</p>

			<p>Create judge group(s) under Setup -> Judge Groups before
			creating events here.</p>

%		}

%		if ($event_id || $add ) { 

			<table cellpadding="5" cellspacing="1" border="0" width="100%"> 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="ballot" action="event_save.mhtml" method="post">
						<input type="hidden" value="<% $event_id %>" name="event_id">
						Event Name:
					</td>
				
					<td align="right">
						<input type="text" name="name" value="<% ($event) ? $event->name : "" %>" size="50">
					</td>
					
				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Judge Group:
					</td>
				
					<td align="right">
						<select name="judge_group_id">
							<option></option>
%							foreach my $group (sort {$a->name cmp $b->name} $tourn->groups) { 
								<option value="<% $group->id %>" <% ($event && $event->judge_group && $group->id == $event->judge_group->id) ? "selected" : "" %>>
									<% $group->name %>
								</option>
%							}

						</select>
					</td>
					
				</tr>

			</table>

			<hr />

			<div class="half" style="width: 49%; float: left;">

				<table cellspacing="1" width="100%"> 
				
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
					
						<td class="maller">
							Abbreviation
						</td> 
						
						<td>
							<input type="text" name="abbr" value="<% ($event) ? $event->abbr : "" %>" size="5">
						</td> 

					</tr> 
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Entry Fee
						</td>

						<td>
							<input type="text" name="fee" value="<% ($event) ? $event->fee : "" %>" size="5">
						</td>

					</tr>


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Field Cap 
						</td>

						<td>
							<input type="text" name="cap" value="<% ($event) ? $event->setting("cap") : ""%>" size="5">
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<td >
							School Cap 
						</td>

						<td>
							<input type="text" name="school_cap" value="<% ($event) ? $event->setting("school_cap") : "" %>" size="5">
						</td> 
						
					</tr> 
	
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Minimum students per entry
						</td> 

						<td>
							<input type="text" name="min_entry" value="<% ($event) ? $event->setting("min_entry") : "" %>" size="5">
						</td> 

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Maximum students per entry
						</td> 

						<td>
							<input type="text" name="max_entry" value="<% ($event) ? $event->setting("max_entry") : "" %>" size="5">
						</td> 

					</tr> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>Schemat code style:</th>

						<td class="smaller">

							<select name="code_style">

								<option value="numbers" <% ($event && $event->setting("code_style") eq "numbers") ? "selected" : "" %>>
									Numbers only
								</option>

								<option value="school_number" <% ($event && $event->setting("code_style") eq "school_number") ? "selected" : "" %>>
									School code + number code
								</option>

								<option value="initials" <% ($event && $event->setting("code_style") eq "initials") ? "selected" : "" %>>
									School name + entry's initials	
								</option>

								<option value="register" <% ($event && $event->setting("code_style") eq "register") ? "selected" : "" %>>
									Ask at registration
								</option>

								<option value="names" <% ($event && $event->setting("code_style") eq "names") ? "selected" : "" %>>
									Full names
								</option>

							</select>

						</td>

					</tr>
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							1st Numeric Speaker Code
						</td>

						<td>
							<input type="text" name="code_start" value="<% ($event) ? $event->setting("code_start") : ""%>" size="5">
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Hide codes at registration
						</td>

						<td>
							<input type="checkbox" name="code_hide" value="1" <% ($event) ? ($event->setting("code_hide")) ? 'checked' : '' : '' %>>
						</td>

					</tr> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Ask for Piece Titles
						</td>

						<td>
							<input type="checkbox" name="ask_for_titles" value="1" <% ($event) ? ($event->setting("ask_for_titles")) ? 'checked' : '' : '' %>>
						</td>
				
					</tr>

				</table>



			</div>

			<div class="half" style="width: 49%; float: right;">

				<table cellspacing="1" width="100%">



					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Allow judges to enter
						</td>

						<td>
							<input type="checkbox" name="alumni" value="1" <% ($event) ? ($event->setting("alumni")) ? 'checked' : '' : '' %>>
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>		
					
						<td>
							Waitlist entries over cap
						</td> 
						
						<td align="left">
							<input type="checkbox" name="waitlist" value="1" <% ($event) ? ($event->setting("waitlist")) ? 'checked' : '' : '' %>>
						</td> 

					</tr> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>		
					
						<td>
							Waitlist all entries
						</td> 
						
						<td align="left">
							<input type="checkbox" name="waitlist_all" value="1" <% ($event) ? ($event->setting("waitlist_all")) ? 'checked' : '' : '' %>>
						</td> 

					</tr>
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>			
					
						<td>
							No sweepstakes credit
						</td> 
						
						<td>
							<input type="checkbox" name="omit_sweeps" value="1" <% ($event) ? ($event->setting("omit_sweeps")) ? 'checked' : '' : '' %>> 
						</td> 
						
					</tr> 
					
% 					unless ($tourn->setting("allow_judge_own")) { 

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td>
								Allow same-school judges
								
							</td>

							<td>
								<input type="checkbox" name="allow_judge_own" value="1" <% ($event) ? ($event->setting("allow_judge_own")) ? 'checked' : '' : '' %>>
							</td>

						</tr>

%					}


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							No judge obligations
						</td>

						<td>
							<input type="checkbox" name="no_judge_burden" value="1" <% ($event) ? ($event->setting("no_judge_burden")) ? 'checked' : '' : '' %>>
						</td>
			
					</tr>
		
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							Award Bids/Quals
						</td>

						<td>
							<input type="checkbox" name="bids" value="1" <% ($event) ? ($event->setting("bids")) ? 'checked' : '' : '' %>>
						</td>
				
					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
						<td>
							Supplemental Event:
						</td>

						<td>
							<input type="checkbox" name="supp" value="1" <% ($event) ? ($event->setting("supp")) ? 'checked' : '' : '' %>>
						</td>

					</tr>
		
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
						<td>
							Publish web field report
						</td>

						<td>
							<input type="checkbox" name="field_report" value="1" <% ($event) ? ($event->setting("field_report")) ? 'checked' : '' : '' %>>
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
						<td>
							Enable Live Updates
						</td>

						<td>
							<input type="checkbox" name="live_updates" value="1" 
								<% ($event) ? ($event->setting("live_updates")) ? 'checked' : '' : '' %>>
						</td>
					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Event Type
						</td> 

						<td class="smaller">
							<select name="type">

								<option value="speech" <% ($event && $event->type eq "speech") ? "selected" : "" %>>
									Speech
								</option>

								<option value="debate" <% ($event && $event->type eq "debate") ? "selected" : "" %>>
									Debate	
								</option>

								<option value="congress" <% ($event && $event->type eq "congress") ? "selected" : "" %>>
									Congress
								</option>

							</select>
						</td> 

					</tr> 


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
						
						<td >
							Master Ballot
						</td> 
						
						<td>
							<select name="ballot_type">
								<option value="normal" <% ($event && $event->setting("ballot_type") eq "normal") ? "selected" : "" %>>
									Plain
								</option>

								<option value="cfl" <% ($event && $event->setting("ballot_type") eq "cfl") ? "selected" : "" %>>
									Rules
								</option>
							</select>
						</td>

					</tr> 

				</table>

			</div>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			    <td >
					Early Deadline
				</td>

%				my $deadline = $event->setting("deadline");
%				$deadline->set_time_zone($tz) if $deadline;
%				my $deadlinetime = Tab::pickertime($deadline) if $deadline;

				<& /funclib/datepicker.mas, id =>"deadline" , max => $tourn->end &>

				<td align="right">
   		            <input type="text" name="deadline" id="deadline" size="15" value="<% ($deadline) ?  $deadline->mdy('/') : "" %>">
						@
					<& /funclib/timeselect.mas, name => "deadlinetime", time => $deadlinetime &>
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td align="center" colspan="2" valign="top">
					<h5>Event Rules</h5>
					<textarea name="text" id="text" rows=5 cols="58" wrap="virtual"><% ($event) ? $event->setting("text") : "" %></textarea>
				</td>

			</tr>

			<tr class="liblrow">
				<td colspan="2" class="right">
					<input type="submit"  value="  Save Event  ">
					</form>
				</td>
			</tr>

		</table>

%	}  else {

		<h2>Add & Edit Events</h2>

		<p>Use the functions at right to add events & divisions to your tournament</p>

%	}

	</div>
			
