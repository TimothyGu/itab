<%args>	
	$session
	$circuit
	$tourn
	$group_id
</%args>
<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id);
	my $switch;

</%init>

    <& menubar.mas, group_id => $group_id, tourn => $tourn, page => "partials" &>

	<div class="left huge">

		<h2>Judge time-based blocks</h2>

		<p>
			These timeblocks allow registering coaches to mark judges as unavailble
			during the blocks you specify.  The fees will be charged if a school is
			under their burden during that timeblock; so if a school owes 2 judges
			and only 1 judge is free on Friday night, the Friday night fine will be charged.
			However, if the school brings 3 judges, of which 2 are always available,
			the fine will not be charged.
		</p>
		
		<form action="partials_save.mhtml" method="post">
		<input type="hidden" name="group_id" value="<% $group->id %>">

		<table cellpadding="5" width="100%" cellspacing="1">

			<tr class="yellowrow">

				<th class="smaller">
					Name
				</th>

				<th class="smaller">
					Fee
				</th>

%				if (scalar $m->comp("/funclib/tourn_days.mas", tourn => $tourn) > 1) { 
					<th class="smaller">
						Day
					</th>
%				}

				<th class="smaller">
					Start Time
				</th>

				<th class="smaller">
					End Time
				</th>

				<td>
				</td>

			</tr>

%			foreach my $strike_time (sort {$a->start->epoch <=> $b->start->epoch} $group->strike_times) {

%				my $strike_time_start = $strike_time->start->set_time_zone($tourn->tz);
%				my $strike_time_end = $strike_time->end->set_time_zone($tourn->tz);
	
				 <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						<input type="text" name="<% $strike_time->id %>_name" value="<% $strike_time->name %>" size="10">
					</th>

					<td>
						<input type="text" name="<% $strike_time->id %>_fine" value="<% $strike_time->fine %>" size="4">
					</td>

%					if (scalar $m->comp("/funclib/tourn_days.mas", tourn => $tourn) > 1) { 
				
						<td class="smaller">
%							foreach my $day ($m->comp("/funclib/tourn_days.mas", tourn => $tourn)) { 
								<span style="padding-right: 3px;">
									<input type="radio" id="<% $strike_time->id."-".$day->epoch %>" name="<% $strike_time->id %>_day" 
									value="<% Tab::pickerdate($day) %>" <% ($strike_time->start->day == $day->day) ? "checked" : "" %>>

									<label for="<% $strike_time->id."-".$day->epoch %>">
										<% $day->day_abbr %>
									</label>

								</span>
%							}

						</td>
%					} else { 
						<input type="hidden" name="<% $strike_time->id %>_day" value="<% Tab::pickerdate($tourn->start) %>">
%					}

					</td>

					<td>
						<& /funclib/timepicker.mas, name => $strike_time->id."_start", time => $strike_time->start, size => "6" &> 
					</td>

					<td>
						<& /funclib/timepicker.mas, name => $strike_time->id."_end", time => $strike_time->end, size => "6" &> 
					</td> 

					<td align="center">
						<a class="dkred block" href="partial_rm.mhtml?partial_id=<% $strike_time->id %>">
							Delete
						</a>
					</td>



				</tr>
% 			}

			 <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<input type="text" name="new_name" size="10" placeholder="Add new...">
				</td>

				<td>
					<input type="text" name="new_fine" size="4">
				</td>

%				if (scalar $m->comp("/funclib/tourn_days.mas", tourn => $tourn) > 1) { 

					<td class="smaller">
%						foreach my $day ($m->comp("/funclib/tourn_days.mas", tourn => $tourn)) { 
							<span style="padding-right: 3px;">
								<input type="radio" id="<% $day->epoch %>" name="new_day" value="<% Tab::pickerdate($day) %>">
									<label for="<% $day->epoch %>">
										<% $day->day_abbr %>
									</label>
							</span>
%						}

					</td>
%				} else { 

					<input type="hidden" name="new_day" value="<% Tab::pickerdate($tourn->start) %>">
%				}

				<td>
					<& /funclib/timepicker.mas, name => "new_start", size => "6" &> 
				</td>

				<td>
					<& /funclib/timepicker.mas, name => "new_end", size => "6" &> 
				</td>

				<td>
				</td>

			</tr>


			<tr class="liblrow">

				<td colspan="6" align="right">
					<input type="submit" value=" Save Timeblocks"> 
					</form>
				</td>

			</tr>

		</table>

	</div>
