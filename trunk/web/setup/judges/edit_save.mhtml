<%args>
	$circuit
	$tourn
	$group_id => 0
	$name => 0
	$abbr => 0
	$special => 0
	$elim_special => 0
	$tab_room => 0
	$dio_min => 0
	$min_burden => 0
	$max_burden => 0
	$free => 0
	$neutrals => 0
	$judge_per => 0
	$rounds_per => 0
	$max_rounds => 0
	$first_year_outs => 0
	$no_codes => 0
	$field_report => 0
	$double_entry => 0
	$code_start => 0
	$ask_alts => 0
	$live_updates => 0
	$alt_max => 0
</%args>
<%init>

	my $msg;

	my $group;

	if ($rounds_per > 0 && $judge_per > 0) { 

		my $err = "You must EITHER use number of entries per judge, OR number of rounds owed.  Both methods don\'t work together";
		$m->redirect("edit.mhtml?group_id=$group_id&err=$err");

	}

	if ($group_id) { 

		$group = Tab::JudgeGroup->retrieve($group_id);

		$group->name($name);
		$group->abbr($abbr);
		$group->update();

	} else { 

        $group = Tab::JudgeGroup->create({
            tourn => $tourn->id,
            name => $name,
            abbr => $abbr,
        });

		$msg = "Group $name created";

	}

	$max_rounds = 8 if $max_rounds < 1;

	$group->setting("judge_per", $judge_per);
	$group->setting("rounds_per", $rounds_per);
	$group->setting("max_rounds", $max_rounds);
	$group->setting("first_year_outs", $first_year_outs);
	$group->setting("special", $special);
	$group->setting("elim_special", $elim_special);
	$group->setting("tab_room", $tab_room);
	$group->setting("dio_min", $dio_min);
	$group->setting("min_burden", $min_burden);
	$group->setting("max_burden", $max_burden);
	$group->setting("free", $free);
	$group->setting("neutrals", $neutrals);
	$group->setting("ask_alts", $ask_alts);
	$group->setting("live_updates", $live_updates);
	$group->setting("alt_max", $alt_max);
	$group->setting("special", $special);
	$group->setting("no_codes", $no_codes);
	$group->setting("field_report", $field_report);
	$group->setting("double_entry", $double_entry);
	$group->setting("code_start", $code_start);

	$msg = "Group changes saved";

	$m->redirect("$Tab::url_prefix/setup/judges/edit.mhtml?group_id=".$group->id."&msg=$msg");

</%init>
