<%args>
	$account
	$group_id => undef
	$tourn
	$circuit
	$err => undef
	$tz
</%args>
<%init>

	my $switch;
	$tz = $tourn->tz unless $tz;

	my $group = Tab::JudgeGroup->retrieve($group_id);

	my $judge_deadline = $tourn->setting("judge_deadline");
	$judge_deadline->set_time_zone($tz) if $judge_deadline;

	my $deadline = $group->setting("deadline");
	$deadline->set_time_zone($tz) if $deadline;

	my $strike_start = $group->setting("strike_start");
	$strike_start->set_time_zone($tz) if $strike_start;

	my $strike_end = $group->setting("strike_end");
	$strike_end->set_time_zone($tz) if $strike_end;

</%init>

    <& menubar.mas, tourn => $tourn, group_id => $group_id, page => "ratings" &>

	<div class="left huge">

		<h2>
			Judge ratings for <% $group->name %> 
		</h2>

		<table cellpadding="5" width="100%" cellspacing="1">  

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
		
				<td>
					<form action="ratings_save.mhtml" method="post">
					<input type="hidden" value="<%$group_id%>" name="group_id">
					Judge registration deadline 

					<br />
						<span class="smaller">(use to set earlier than tournament-wide deadline, <% Tab::niceshortdt($judge_deadline) %>)</span>
				</th>
		
				<td class="rightalign">
		            <& /funclib/datepicker.mas, id => "deadline" &> 
					<input type="text" name="deadline" id="deadline" size="10" value="<% ($deadline) ? Tab::pickerdate($deadline) : "" %>" class="notfirst">
				</td>
		
				<td class="rightalign">
                    <& /funclib/timepicker.mas, name => "deadlinetime", time => $deadline &>
				</td>

			</tr>

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
		
				<td>
					Open ratings
				</th>
		
				<td class="rightalign">
		            <& /funclib/datepicker.mas, id => "strike_start" &> 
					<input type="text" name="strike_start" id="strike_start" size="10" class="notfirst"
						value="<% ($strike_start) ? Tab::pickerdate($strike_start) : "" %>">
				</td>

				<td class="rightalign">
                    <& /funclib/timepicker.mas, name => "strike_start_time", time => $strike_start &>
				</td>
		
			</tr>
		
			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
		
				<td>
					Close ratings
				</th>
		
				<td class="rightalign">
		            <& /funclib/datepicker.mas, id => "strike_end" &> 
					<input type="text" name="strike_end" id="strike_end" size="10" class="notfirst"
						value="<% ($strike_end) ? Tab::pickerdate($strike_end) : "" %>">
				</td>
		
				<td class="rightalign">
                    <& /funclib/timepicker.mas, name => "strike_end_time", time => $strike_end &>
				</td>

			</tr>

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
		
				<td>
					<label for="obligation_before_strikes">
					Judge obligation must be met before schools rate or strike
					</label>
				</td>

				<td class="rightalign" colspan="2">
					<input type="checkbox" id="obligation_before_strikes" name="obligation_before_strikes" value="1" 
						<% $group->setting("obligation_before_strikes") ? "checked" : "" %>>
				</td>
		
			</tr>
		
			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
		
				<td>
					<label for="ask_paradigm">
					Ask for judge paradigms during registration
					</label>
				</td>
		
				<td class="rightalign" colspan="2">
					<input type="checkbox" id="ask_paradigm" name="ask_paradigm" value="1" 
					<% $group->setting("ask_paradigm") ? "checked" : "" %>>
				</td>
		
			</tr>

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
		
				<td>
					<label for="fyo_free_strikes">
						First year out judges are free strikes
					</label>
				</td>
		
				<td class="rightalign" colspan="2">
					<input type="checkbox" id="fyo_free_strikes" name="fyo_free_strikes" value="1" 
					<% $group->setting("fyo_free_strikes") ? "checked" : "" %>>
				</td>
		
			</tr>

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
		
				<td>
					<label for="free_strikes_dont_count">
						Free Strikes don't count towards judge obligation
					</label>
				</td>
		
				<td class="rightalign" colspan="2">
					<input type="checkbox" id="free_strikes_dont_count" name="free_strikes_dont_count" value="1" 
					<% $group->setting("free_strikes_dont_count") ? "checked" : "" %>>
				</td>
		
			</tr>

		</table>

		<div class="halfcolumn">

			<h4>Conflicts</h4>

			<table cellpadding="5" width="100%" cellspacing="1">  

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
			
					<td  colspan="2">
						<label for="conflicts">
							Conflicts entered separately
						</label>
					</td>
			
					<td align="center">
						<input type="checkbox" id="conflicts" name="conflicts" value="1" 
						<% $group->setting("conflicts") ? "checked" : "" %>>
					</td>
				
				</tr>
			
				<tr>
					<td colspan="5">	
						<h4>Strikes</h4>
					</td>
				</tr>

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
			
					<td  colspan="2">
						School-wide strikes/scratches
					</td>
			
					<td align="center">
						<input type="text" name="school_strikes" size="3" 
							value="<% ($group) ? $group->setting("school_strikes") : "" %>">
					</td>
				
				</tr>

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
			
					<td  colspan="2">
						Per-entry strikes/scratches
					</td>
			
					<td align="center">
						<input type="text" name="entry_strikes" size="3" 
							value="<% ($group) ? $group->setting("entry_strikes") : "" %>">
					</td>
				
				</tr>
			
			</table>

		</div>

		<div class="halfcolumn">

			<h4>Judge Preferences</h4> 

%			my $prefs = $group->setting("prefs");

			<table cellpadding="5" width="100%" cellspacing="1">  

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

					<td colspan="2">
						Pref Method 
					</td>
			
					<td align="center">
						<select name="prefs" class="fixedsmall">
							<option value="">
								None
							</option>
							<option value="tiered" <% $prefs eq "tiered" ? "selected" : "" %>>
								Tiered (by judge)
							</option>
							<option value="tiered_round" <% $prefs eq "tiered_round" ? "selected" : "" %>>
								Tiered (by round)
							</option>
							<option value="ordinals" <% $prefs eq "ordinals" ? "selected" : "" %>>
								Ordinals
							</option>
							<option value="community" <% $prefs eq "community" ? "selected" : "" %>>
								Community
							</option>
						</select>
					</td>
				
				</tr>

%				if ($prefs eq "tiered") { 

					<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

						<td colspan="2">
							<label for="cumulate_prefs">
							Extra 1s = less 2s, etc
							</label>
						</th>
			
						<td align="center">
							<input type="checkbox" id="cumulate_prefs" name="cumulate_mjp" value="1" 
							<% $group->setting("cumulate_mjp") ? "checked" : "" %>>
						</td>
					</tr>
%				}

			</table>

			<h4>Coach Ratings</h4>

			<table cellpadding="5" width="100%" cellspacing="1">  

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
			
					<td  colspan="2">
						<label for="coach_ratings">
						Coaches rate their judges
						</label>
					</td>
			
					<td align="center">
						<input type="checkbox" id="coach_ratings" name="coach_ratings" value="1" 
						<% $group->setting("coach_ratings") ? "checked" : "" %>>
					</td>
				
				</tr>

			</table>

			<h4>Tab Ratings</h4>

			<table cellpadding="5" width="100%" cellspacing="1">  

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
			
					<td  colspan="2">
						<label for="tab_ratings">
							Use tab room ratings
						</label>
					</td>
			
					<td align="center">
						<input type="checkbox" id="tab_ratings" name="tab_ratings" value="1" 
							<% $group->setting("tab_ratings") ? "checked" : "" %>>
					</td>
				
				</tr>

			</table>

		</div>

		<table cellpadding="5" width="100%" cellspacing="1">

			<tr class="liblrow">

				<td class="rightalign">
					<input  type="submit" value="    Save Group Changes   ">
					</form>
				</td>

			</tr>

		</table>

	</div>

