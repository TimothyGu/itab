<%args>
	$tourn
	$tz
	$date
</%args>
<%init>

	my $err; 

	TIMESLOT:
	foreach my $timeslot ($tourn->timeslots) { 
		
		my $name = $ARGS{$timeslot->id."_name"};

		my $ts_date = $ARGS{$timeslot->id."_day"};
		$ts_date = $date unless $ts_date;

		my $startstring = $ARGS{$timeslot->id."_start"};
		my $endstring = $ARGS{$timeslot->id."_end"};

		next unless ($startstring && $endstring); 

	    my $start = Tab::dtme($ts_date, $ARGS{$timeslot->id."_start"});
	    my $end = Tab::dtme($ts_date, $ARGS{$timeslot->id."_end"});

	    $start->set_time_zone($tz);
	    $end->set_time_zone($tz);

		$timeslot->start($start);
		$timeslot->end($end);
		$timeslot->name($name);
		$timeslot->update; 
			
	}

	$m->redirect("/setup/schedule/sked.mhtml?date=".$date."&err=$err");

</%init>
