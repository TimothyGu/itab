<%args>
	$tourn
	$account
	$name
	$webname => undef
	$country => undef
	$state => undef
	$timezone => undef
</%args>
<%init>

	$name =~ tr/a-zA-Z0-9 //cd;

	$tourn->name($name);
	$tourn->country($country);
	$tourn->state($state);
	$tourn->tz($timezone);
	$tourn->update;

	if ($webname) { 

        #Remove all the whitespace
        $webname =~ s/ //g;
        #Remove all non-alphanumeric characters
        $webname =~ s/[^\w]//g;
        #Lowercase the whole thing
        $webname = lc($webname);

		my @others = Tab::Tourn->search(webname => $webname);

		my $ok++ unless @others;

		foreach my $other (@others) { 
			$ok++ if Tab::TournAdmin->search( account => $account->id, tourn => $other->id );	
			last if $ok;
		}

		unless ($ok) { 

			my $err = "The webname $webname is already taken by another user.  <br /> Thou must needst choose another";
			$m->redirect("main.mhtml?err=$err");

		}

		$tourn->webname($webname);
		$tourn->update;

	}

	my $msg = "Tournament name saved";

	$m->redirect("main.mhtml?msg=$msg");

</%init>
