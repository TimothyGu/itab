<%args>
	$tourn
	$session
	$panel_id => undef
	$all      => undef
	$advances => undef
</%args>
<%init>

	unless ($panel_id && $advances) { 
		$m->print("You have done something very odd.  I don't know which debate you mean or who advances. Try again");
		$m->abort;
	}

	my $panel = Tab::Panel->retrieve($panel_id);

	foreach my $ballot ($panel->ballots) { 

		my $score = Tab::BallotValue->search( ballot => $ballot->id, tag => "ballot")->first;

		my $value = 0;
		$value = 1 if $advances == $ballot->id;

		if ($score) { 
			$score->value($value);
			$score->update;
		} else { 

			Tab::BallotValue->create({
				ballot => $ballot->id,
				tag => "ballot",
				value => $value
			});
		}

		$ballot->audit("1");
		$ballot->update;

	}

	$m->redirect("index.mhtml?timeslot_id=".$panel->round->timeslot->id."&all=$all");

</%init>
