<%args>
	$group_id
</%args>
<%init>

	use List::Util 'shuffle';

	my $group = Tab::JudgeGroup->retrieve($group_id);
	$m->abort unless ($group);

	if ($group->setting("prefs")) { 

		my @judges = $group->judges;
		my @entries = $m->comp("/funclib/group_entries.mas", group => $group);
		my @tiers = $group->rating_tiers;

		foreach my $entry (@entries) { 

			@judges = shuffle @judges;

			foreach my $judge (@judges) { 

				@tiers = shuffle @tiers;

				my $tier_id = $tiers[0]->id;

				Tab::Rating->create({ 
					entry       => $entry->id,
					judge       => $judge->id,
					type        => "entry",
					rating_tier => $tier_id
				});
			}

		}
	}

	my $msg = "Preffed judges in ".$group->abbr;

	$m->redirect("fake.mhtml?group_id=$group_id&msg=$msg");

</%init>

