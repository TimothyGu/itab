<%args>
	$tourn
        $account
        $session
</%args>

<%init>
#Import the XML
	use XML::Simple;

	my $now = DateTime->now;
	my $tz = $account->tz if $account->tz;
	$tz = "UTC" unless $tz;

	$now->set_time_zone($tz);

	my $req = Apache2::Request->new($r);
	my $xml_file = $req->upload("xml");
	my $xml_filename = $xml_file->tempname;

	print "xml_filename=".$xml_filename."<Br>";
	print '$xml_file->filename = '.$xml_file->filename."<br>";
	
	my $webname=$xml_file->filename;

	`/bin/cp $xml_filename /tmp/keeper.xml`;
	`perl -pi -e s/'&'/'&amp;'/g  $xml_filename`;

	my $xml = new XML::Simple();
	my $data = $xml->XMLin($xml_filename, KeyAttr => "round");

#	this code works if the data is read this way:
#	my $data = $xml->XMLin($xml_filename, KeyAttr => "ident");
#	print "Name:".$data->{team}->{9}->{name}."<br>";
#	print "pullups:".$data->{team}->{9}->{pullups}."<br>";
#	print "home:".$data->{team}->{9}->{home}."<br>";
#	print "ident:".$data->{team}->{9}->{ident}."<br>";
#	use Data::Dumper;
#	print Dumper( $data );

	my @teams;

	eval { 
		@teams = @{$data->{team}};
	};

	push @teams, $data->{team} unless @teams;
	print scalar @teams."<br>";
	print $teams[3]->{name}."<br>";
	$teams[3]->{CATID}=12;
	print $teams[3]->{CATID}."<br>";

	foreach my $team (@teams) { 
		$m->print($team->{ident}." ".$team->{name}."<Br>");
	}


	print "<br>Done";
	
</%init>
