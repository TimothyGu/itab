<%args>
	$round
	$not_in => undef
</%args>
<%init>

	if ($not_in) { 

		Tab::Judge->set_sql(by_round => "
			select distinct judge.*, panel.id as panelid, ballot.chair as chair
				from panel,ballot,judge,entry
				where panel.round = ? 
				and panel.id = ballot.panel
				and ballot.judge = judge.id
				and ballot.audit != 1
				and ballot.entry = entry.id
				and entry.dropped != 1
				group by judge.id
				order by judge.code, judge.last
		");

		return Tab::Judge->search_by_round($round->id);

	} else { 

		Tab::Judge->set_sql(by_round => "
			select distinct judge.*, panel.id as panelid, ballot.chair as chair
				from panel,ballot,judge,entry
				where panel.round = ? 
				and panel.id = ballot.panel
				and ballot.judge = judge.id
				and ballot.entry = entry.id
				and entry.dropped != 1
				group by judge.id
				order by judge.code, judge.last
		");

		return Tab::Judge->search_by_round($round->id);

	}

</%init>
