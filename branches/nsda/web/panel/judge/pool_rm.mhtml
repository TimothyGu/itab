<%args>
	$pool_id
</%args>
<%init>

	my $pool = Tab::Pool->retrieve($pool_id);

	Tab::Round->set_sql( delete_pool => " update round set pool = NULL where pool = ? ");
	Tab::PoolJudge->set_sql( delete_pool => " delete from pool_judge where pool = ? ");

	my $msg;
	my $group_id;

	if ($pool) { 

		Tab::PoolJudge->sql_delete_pool->execute($pool->id);
		Tab::Round->sql_delete_pool->execute($pool->id);
		$msg = $pool->name." has been deleted";
		$group_id = $pool->judge_group->id;
		$pool->delete;

	}

	$m->redirect("edit_pools.mhtml?group_id=$group_id&msg=$msg");


</%init>
